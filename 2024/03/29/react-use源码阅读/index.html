<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>react-useæºç é˜…è¯» | easycodesniper | blog by chen qiyi</title>

  
  <meta name="author" content="chen qiyi">
  

  
  <meta name="description" content="å‰è¨€Reactçš„å¼€å‘ç¦»ä¸å¼€hooksï¼Œåœ¨ç¤¾åŒºä¸­ä¹Ÿæœ‰å„ç§çš„hookså·¥å…·åº“ã€‚æœ¬ç¯‡é˜…è¯»çš„å°±æ˜¯react-useå·¥å…·åº“
å¸Œæœ›é€šè¿‡é˜…è¯»æºç ï¼ŒåŠ æ·±è‡ªå·±å¯¹äºReact Hookçš„ç†è§£ã€‚
useCustomCompareEffectReactçš„useEffectæ¯”è¾ƒä¾èµ–é¡¹çš„è§„åˆ™æ˜¯Object.is()ï¼Œå®ƒå¤§éƒ¨åˆ†æƒ…">
  

  
  
  <meta name="keywords" content="React Hooks">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="react-useæºç é˜…è¯»"/>

  <meta property="og:site_name" content="easycodesniper"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="easycodesniper" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 7.1.1"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">easycodesniper</a>
    </h1>
    <p class="site-description">blog by chen qiyi</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">ä¸»é¡µ</a></li>
      
        <li><a href="/archives">å½’æ¡£</a></li>
      
        <li><a href="/about">å…³äº</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>react-useæºç é˜…è¯»</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2024/03/29/react-useæºç é˜…è¯»/" rel="bookmark">
        <time class="entry-date published" datetime="2024-03-29T13:07:05.000Z">
          2024-03-29
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Reactçš„å¼€å‘ç¦»ä¸å¼€hooksï¼Œåœ¨ç¤¾åŒºä¸­ä¹Ÿæœ‰å„ç§çš„hookså·¥å…·åº“ã€‚æœ¬ç¯‡é˜…è¯»çš„å°±æ˜¯<a target="_blank" rel="noopener" href="https://github.com/streamich/react-use">react-use</a>å·¥å…·åº“</p>
<p>å¸Œæœ›é€šè¿‡é˜…è¯»æºç ï¼ŒåŠ æ·±è‡ªå·±å¯¹äºReact Hookçš„ç†è§£ã€‚</p>
<h2 id="useCustomCompareEffect"><a href="#useCustomCompareEffect" class="headerlink" title="useCustomCompareEffect"></a>useCustomCompareEffect</h2><p>Reactçš„<code>useEffect</code>æ¯”è¾ƒä¾èµ–é¡¹çš„è§„åˆ™æ˜¯<code>Object.is()</code>ï¼Œå®ƒå¤§éƒ¨åˆ†æƒ…å†µä¸‹å’Œ<code>===</code>çš„æ•ˆæœæ˜¯ç›¸åŒçš„<br><code>useCustomCompareEffect</code>Hook ç”¨äºå½“ä¾èµ–é¡¹æ˜¯å¯¹è±¡æˆ–è€…æ•°ç»„æ—¶è‡ªå®šä¹‰ä¾èµ–é¡¹æ¯”è¾ƒæ–¹æ³•ï¼Œå®šä¹‰æ›´åŠ å¤æ‚çš„æ¯”è¾ƒé€»è¾‘</p>
<p>ä½¿ç”¨ç¤ºä¾‹:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useCustomCompareEffect <span class="keyword">from</span> <span class="string">&quot;./hooks/useCustomCompareEffect&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [obj, setObj] = <span class="title function_">useState</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;kyrie&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">21</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°ï¼Œåªæœ‰å½“nameå€¼å‘ç”Ÿå˜åŒ–æ˜¯é‡æ–°æ¸²æŸ“</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">depsEqual</span> = (<span class="params">newDeps, prevDeps</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> (prevDeps[<span class="number">0</span>]?.<span class="property">name</span> === newDeps[<span class="number">0</span>]?.<span class="property">name</span>) ? <span class="literal">true</span> : <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useCustomCompareEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ğŸš€~~ useCustomCompareEffect working !&#x27;</span>);</span><br><span class="line">  &#125;, depsEqual, [obj])</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>name: &#123; obj.name &#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>age: &#123; obj.age &#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setObj(&#123; ...obj, name: &#x27;easy code sniper&#x27; &#125;)&#125;&gt;ä¿®æ”¹name<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setObj(&#123; ...obj, age: 30 &#125;)&#125;&gt;ä¿®æ”¹age<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">DependencyList</span>, <span class="title class_">EffectCallback</span>, useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯åŸºæœ¬ç±»å‹å€¼ï¼Œæ˜¯åŸºæœ¬ç±»å‹å°±è¿”å›true</span></span><br><span class="line"><span class="comment">// Object()ï¼šç»™Object()å‡½æ•°ä¼ é€’ä¸€ä¸ªå€¼ï¼Œå¦‚æœæ˜¯å¯¹è±¡æˆ–è€…æ•°ç»„ï¼Œåˆ™è¿”å›è¯¥å€¼çš„å¼•ç”¨ï¼›å¦‚æœæ˜¯åŸºæœ¬ç±»å‹å€¼ï¼Œåˆ™æŠŠè¯¥åŸºæœ¬ç±»å‹å€¼åŒ…è£…æˆä¸ºå¯¹åº”çš„å¯¹è±¡ç±»å‹</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isPrimitive</span> = (<span class="params">val: any</span>) =&gt; val !== <span class="title class_">Object</span>(val);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼šæ—§çš„deps å’Œ æ–°çš„deps ï¼Œè¯¥å‡½æ•°éœ€è¦è¿”å›ä¸€ä¸ªboolå€¼æ¥è¡¨ç¤ºä¾èµ–æ˜¯å¦å‘ç”Ÿå˜åŒ–</span></span><br><span class="line">type <span class="title class_">DepsEqualFnType</span>&lt;<span class="title class_">TDeps</span> <span class="keyword">extends</span> <span class="title class_">DependencyList</span>&gt; = <span class="function">(<span class="params">prevDeps: TDeps, nextDeps: TDeps</span>) =&gt;</span> boolean;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¥å—ä¸‰ä¸ªå‚æ•°</span></span><br><span class="line"><span class="comment"> * effectï¼šå‰¯ä½œç”¨å‡½æ•°</span></span><br><span class="line"><span class="comment"> * depsï¼šä¾èµ–é¡¹</span></span><br><span class="line"><span class="comment"> * depsEqualï¼šè‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œå‰ä¸€ä¸ªä¾èµ–é¡¹ å’Œ å½“å‰ä¾èµ–é¡¹ï¼Œè¦æ±‚è¿”å›ä¸€ä¸ªbooleanæ¥è¡¨ç¤ºä¾èµ–é¡¹æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> useCustomCompareEffect = &lt;<span class="title class_">TDeps</span> <span class="keyword">extends</span> <span class="title class_">DependencyList</span>&gt;<span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  effect: EffectCallback,</span></span></span><br><span class="line"><span class="params"><span class="function">  deps: TDeps,</span></span></span><br><span class="line"><span class="params"><span class="function">  depsEqual: DepsEqualFnType&lt;TDeps&gt;</span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ç”Ÿäº§ç¯å¢ƒä¸‹çš„ä¸€äº›è­¦å‘Šæç¤ºï¼Œå¯ä»¥å¿½ç•¥</span></span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// depsä¾èµ–å¿…é¡»æœ‰</span></span><br><span class="line">    <span class="keyword">if</span> (!(deps <span class="keyword">instanceof</span> <span class="title class_">Array</span>) || !deps.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">&#x27;`useCustomCompareEffect` should not be used with no dependencies. Use React.useEffect instead.&#x27;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœæ¯ä¸€é¡¹ä¾èµ–éƒ½æ˜¯åŸºæœ¬ç±»å‹ï¼Œé‚£ä½¿ç”¨useEffectå³å¯</span></span><br><span class="line">    <span class="keyword">if</span> (deps.<span class="title function_">every</span>(isPrimitive)) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">&#x27;`useCustomCompareEffect` should not be used with dependencies that are all primitive values. Use React.useEffect instead.&#x27;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// depsEqual å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> depsEqual !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">&#x27;`useCustomCompareEffect` should be used with depsEqual callback for comparing deps list&#x27;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//å®šä¹‰ä¸€ä¸ªrefæ¥å­˜å‚¨ä¾èµ–é¡¹</span></span><br><span class="line">  <span class="keyword">const</span> ref = useRef&lt;<span class="title class_">TDeps</span> | <span class="literal">undefined</span>&gt;(<span class="literal">undefined</span>); </span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  *  !ref.current è¡¨ç¤ºåˆæ¬¡æ¸²æŸ“</span></span><br><span class="line"><span class="comment">  *  !depsEqual(deps, ref.current) æ ¹æ®è‡ªå®šä¹‰çš„æ¯”è¾ƒå‡½æ•°æ¥åˆ¤æ–­ä¾èµ–æ˜¯å¦å‘ç”Ÿå˜åŒ–</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">if</span> (!ref.<span class="property">current</span> || !<span class="title function_">depsEqual</span>(deps, ref.<span class="property">current</span>)) &#123; </span><br><span class="line">    ref.<span class="property">current</span> = deps; <span class="comment">// å½“åˆæ¬¡æ¸²æŸ“æ—¶ï¼Œæˆ–è€…ä¾èµ–é¡¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œrefå­˜å‚¨æ–°çš„ä¾èµ–</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// useEffectä¾èµ–çš„å¹¶ä¸æ˜¯depsï¼Œå®é™…ä¾èµ–çš„æ˜¯ref.current </span></span><br><span class="line">  <span class="comment">// åªæœ‰åœ¨depsEqualå‡½æ•°åˆ¤æ–­ä¾èµ–é¡¹å‘ç”Ÿäº†å˜åŒ–ï¼Œå¹¶æ›´æ–°ref.currentä¹‹åï¼ŒuseEffectæ‰ä¼šé‡æ–°æ‰§è¡Œeffect</span></span><br><span class="line">  <span class="title function_">useEffect</span>(effect, ref.<span class="property">current</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useCustomCompareEffect;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="useShallowCompareEffect"><a href="#useShallowCompareEffect" class="headerlink" title="useShallowCompareEffect"></a>useShallowCompareEffect</h2><p>Reactçš„<code>useEffect</code>æ¯”è¾ƒä¾èµ–é¡¹çš„è§„åˆ™æ˜¯<code>Object.is()</code>ï¼Œå®ƒå¤§éƒ¨åˆ†æƒ…å†µä¸‹å’Œ<code>===</code>çš„æ•ˆæœæ˜¯ç›¸åŒçš„<br><code>useShallowCompareEffect</code>Hook ä¼šå¯¹æ¯ä¸ªä¾èµ–é¡¹è¿›è¡Œæµ…æ¯”è¾ƒï¼Œè€Œä¸æ˜¯å¼•ç”¨ç›¸ç­‰</p>
<blockquote>
<p>æµ…æ¯”è¾ƒ<br>é€šå¸¸æ˜¯æ£€æŸ¥å¯¹è±¡çš„é¡¶å±‚å±æ€§æ˜¯å¦å…·æœ‰ç›¸åŒçš„å€¼å’Œç›¸åŒçš„å¼•ç”¨ï¼Œå¯¹äºåµŒå¥—å¯¹è±¡ä¸è¿›è¡Œæ·±å…¥æ¯”è¾ƒ</p>
</blockquote>
<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">DependencyList</span>, <span class="title class_">EffectCallback</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; equal <span class="keyword">as</span> isShallowEqual &#125; <span class="keyword">from</span> <span class="string">&#x27;fast-shallow-equal&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> useCustomCompareEffect <span class="keyword">from</span> <span class="string">&#x27;./useCustomCompareEffect&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯åŸºæœ¬ç±»å‹å€¼</span></span><br><span class="line"><span class="comment">// ç»™Object()å‡½æ•°ä¼ é€’ä¸€ä¸ªå€¼ï¼Œå¦‚æœæ˜¯å¯¹è±¡æˆ–è€…æ•°ç»„ï¼Œåˆ™è¿”å›è¯¥å€¼çš„å¼•ç”¨ï¼›å¦‚æœæ˜¯åŸºæœ¬ç±»å‹å€¼ï¼Œåˆ™æŠŠè¯¥åŸºæœ¬ç±»å‹å€¼åŒ…è£…æˆä¸ºå¯¹åº”çš„å¯¹è±¡ç±»å‹</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isPrimitive</span> = (<span class="params">val: any</span>) =&gt; val !== <span class="title class_">Object</span>(val);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œå®ç°ä¾èµ–é¡¹çš„æµ…æ¯”è¾ƒ</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">shallowEqualDepsList</span> = (<span class="params">prevDeps: DependencyList, nextDeps: DependencyList</span>) =&gt;</span><br><span class="line">  prevDeps.<span class="title function_">every</span>(<span class="function">(<span class="params">dep, index</span>) =&gt;</span> <span class="title function_">isShallowEqual</span>(dep, nextDeps[index]));</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¥å—ä¸¤ä¸ªå‚æ•°</span></span><br><span class="line"><span class="comment"> * effectï¼šå‰¯ä½œç”¨å‡½æ•°</span></span><br><span class="line"><span class="comment"> * depsï¼šä¾èµ–é¡¹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useShallowCompareEffect</span> = (<span class="params">effect: EffectCallback, deps: DependencyList</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// ç”Ÿäº§ç¯å¢ƒä¸‹çš„ä¸€äº›è­¦å‘Šæç¤ºï¼Œå¯ä»¥å¿½ç•¥</span></span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!(deps <span class="keyword">instanceof</span> <span class="title class_">Array</span>) || !deps.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">&#x27;`useShallowCompareEffect` should not be used with no dependencies. Use React.useEffect instead.&#x27;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (deps.<span class="title function_">every</span>(isPrimitive)) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">&#x27;`useShallowCompareEffect` should not be used with dependencies that are all primitive values. Use React.useEffect instead.&#x27;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è°ƒç”¨ useCustomCompareEffect , å°†shallowEqualDepsListä½œä¸ºè‡ªå®šä¹‰æ¯”è¾ƒæ–¹æ³•</span></span><br><span class="line">  <span class="comment">// å®é™…ä¸Šå°±æ˜¯å¯¹ useCustomCompareEffect çš„åˆä¸€å±‚å°è£…</span></span><br><span class="line">  <span class="title function_">useCustomCompareEffect</span>(effect, deps, shallowEqualDepsList);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useShallowCompareEffect;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="useEvent"><a href="#useEvent" class="headerlink" title="useEvent"></a>useEvent</h2><p>ç”¨äºåœ¨ç‰¹å®šçš„äº‹ä»¶ç›®æ ‡ï¼ˆå¦‚ windowã€document æˆ–ä»»ä½•å®ç°äº†ç‰¹å®šäº‹ä»¶ç›‘å¬å™¨æ¥å£çš„å¯¹è±¡ï¼‰ä¸Šæ·»åŠ å’Œç§»é™¤äº‹ä»¶ç›‘å¬å™¨ï¼Œå®ƒæ—¨åœ¨ åœ¨ä¸åŒç±»å‹çš„äº‹ä»¶ç›®æ ‡ä¸Š æä¾›ä¸€ä¸ªç»Ÿä¸€çš„ API</p>
<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="comment">// isBrower åˆ¤æ–­æ˜¯å¦æ˜¯æµè§ˆå™¨ç¯å¢ƒ</span></span><br><span class="line"><span class="comment">// on off æ˜¯å°è£…å¥½çš„æµè§ˆå™¨äº‹ä»¶ç›‘å¬å™¨æ·»åŠ å’Œç§»é™¤æ–¹æ³•</span></span><br><span class="line"><span class="keyword">import</span> &#123; isBrowser, off, on &#125; <span class="keyword">from</span> <span class="string">&#x27;./misc/util&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ListenerType1 å’Œ ListenerType2 æ¥å£å®šä¹‰äº†ä¸¤ç§ä¸åŒçš„äº‹ä»¶ç›‘å¬æ¨¡å¼</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">ListenerType1</span> &#123;</span><br><span class="line">  <span class="title function_">addEventListener</span>(<span class="attr">name</span>: string, <span class="attr">handler</span>: <span class="function">(<span class="params">event?: any</span>) =&gt;</span> <span class="keyword">void</span>, ...<span class="attr">args</span>: any[]);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">removeEventListener</span>(<span class="attr">name</span>: string, <span class="attr">handler</span>: <span class="function">(<span class="params">event?: any</span>) =&gt;</span> <span class="keyword">void</span>, ...<span class="attr">args</span>: any[]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">ListenerType2</span> &#123;</span><br><span class="line">  <span class="title function_">on</span>(<span class="attr">name</span>: string, <span class="attr">handler</span>: <span class="function">(<span class="params">event?: any</span>) =&gt;</span> <span class="keyword">void</span>, ...<span class="attr">args</span>: any[]);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">off</span>(<span class="attr">name</span>: string, <span class="attr">handler</span>: <span class="function">(<span class="params">event?: any</span>) =&gt;</span> <span class="keyword">void</span>, ...<span class="attr">args</span>: any[]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">UseEventTarget</span> = <span class="title class_">ListenerType1</span> | <span class="title class_">ListenerType2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isListenerType1 å’Œ isListenerType2 ç”¨æ¥åˆ¤æ–­ç›®æ ‡äº‹ä»¶å¯¹è±¡æ˜¯å¦æœ‰ addEventListener æˆ– on å±æ€§æ¥å®ç°çš„</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isListenerType1 = (<span class="attr">target</span>: any): target is <span class="title class_">ListenerType1</span> =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> !!target.<span class="property">addEventListener</span>; <span class="comment">// !! ä»»ä½•çœŸå€¼éƒ½ä¼šè¢«è½¬åŒ–æˆtrueï¼Œå‡å€¼éƒ½ä¼šè¢«è½¬åŒ–æˆfalse</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> isListenerType2 = (<span class="attr">target</span>: any): target is <span class="title class_">ListenerType2</span> =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> !!target.<span class="property">on</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultTarget = isBrowser ? <span class="variable language_">window</span> : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¥å—å››ä¸ªå‚æ•°ï¼›</span></span><br><span class="line"><span class="comment"> * nameï¼šäº‹ä»¶åç§°</span></span><br><span class="line"><span class="comment"> * handlerï¼šäº‹ä»¶å¤„ç†å‡½æ•°</span></span><br><span class="line"><span class="comment"> * targetï¼šäº‹ä»¶ç›‘å¬å™¨çš„ç›®æ ‡å¯¹è±¡ï¼Œé»˜è®¤å€¼æ˜¯ defaultTarget</span></span><br><span class="line"><span class="comment"> * optionsï¼šå¯é€‰å‚æ•°ï¼Œç”¨äºä¼ é€’ç»™äº‹ä»¶ç›‘å¬å™¨çš„é€‰é¡¹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useEvent</span> = (<span class="params"></span></span><br><span class="line"><span class="params">  name,</span></span><br><span class="line"><span class="params">  handler,</span></span><br><span class="line"><span class="params">  target,</span></span><br><span class="line"><span class="params">  options?</span></span><br><span class="line"><span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!handler || !target) &#123; <span class="comment">// å¦‚æœæ²¡æœ‰ä¼ å…¥äº‹ä»¶å¤„ç†å‡½æ•°æˆ–è€…äº‹ä»¶å¯¹è±¡ï¼Œä¸åšä»»ä½•å¤„ç†ç›´æ¥è¿”å›</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isListenerType1</span>(target)) &#123; <span class="comment">//å¦‚æœç›®æ ‡å¯¹è±¡å®ç°çš„æ˜¯addEventListeneræ¨¡å¼ï¼Œå°†å®ƒæ‰‹åŠ¨ä»£ç†æˆonæ¨¡å¼æ¥æ·»åŠ ç›‘å¬å™¨</span></span><br><span class="line">      <span class="title function_">on</span>(target, name, handler, options);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isListenerType2</span>(target)) &#123; <span class="comment">//å¦‚æœç›®æ ‡å¯¹è±¡å®ç°çš„æ˜¯onæ¨¡å¼ï¼Œç›´æ¥ç”¨onæ¨¡å¼æ·»åŠ ç›‘å¬å™¨</span></span><br><span class="line">      target.<span class="title function_">on</span>(name, handler, options);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123; <span class="comment">// åœ¨ç»„ä»¶é”€æ¯æ—¶åˆ é™¤äº‹ä»¶ç›‘å¬</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isListenerType1</span>(target)) &#123;</span><br><span class="line">        <span class="title function_">off</span>(target, name, handler, options);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isListenerType2</span>(target)) &#123;</span><br><span class="line">        target.<span class="title function_">off</span>(name, handler, options);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [name, handler, target, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(options)]);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useEvent;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>on</code> å’Œ <code>off</code>å‡½æ•°çš„å°è£…ï¼š</p>
<p>onå‡½æ•°æ¥å—ä¸€ä¸ªå¯èƒ½ä¸ºnullçš„å¯¹è±¡objå’Œä¸€ä¸ªå‚æ•°åˆ—è¡¨argsã€‚å‚æ•°åˆ—è¡¨å¯ä»¥æ˜¯ä»»ä½•addEventListeneræ–¹æ³•æ¥å—çš„å‚æ•°ã€‚å‡½æ•°å†…éƒ¨ä¼šæ£€æŸ¥objæ˜¯å¦å­˜åœ¨å¹¶ä¸”æ˜¯å¦æœ‰addEventListeneræ–¹æ³•ã€‚å¦‚æœæ¡ä»¶æ»¡è¶³ï¼Œå®ƒä¼šè°ƒç”¨obj.addEventListenerå¹¶ä¼ å…¥argså‚æ•°ã€‚<br>è¿™ä¸ªå‡½æ•°çš„ä¸»è¦ä½œç”¨æ˜¯æ£€æŸ¥å¯¹è±¡æ˜¯å¦å­˜åœ¨å¹¶ä¸”å¯ä»¥æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼Œç„¶åæŒ‰ç…§ç»™å®šçš„å‚æ•°è°ƒç”¨addEventListeneræ–¹æ³•ã€‚è¿™æ ·åšå¯ä»¥é¿å…ç›´æ¥åœ¨ç»„ä»¶å†…éƒ¨è°ƒç”¨addEventListeneræ—¶å¯èƒ½é‡åˆ°çš„nullæˆ–undefinedå¯¹è±¡é”™è¯¯ã€‚</p>
<p>offå‡½æ•°åŒç†</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> on&lt;T <span class="keyword">extends</span> <span class="title class_">Window</span> | <span class="title class_">Document</span> | <span class="title class_">HTMLElement</span> | <span class="title class_">EventTarget</span>&gt;(</span><br><span class="line">  <span class="attr">obj</span>: T | <span class="literal">null</span>,</span><br><span class="line">  ...<span class="attr">args</span>: <span class="title class_">Parameters</span>&lt;T[<span class="string">&#x27;addEventListener&#x27;</span>]&gt; | [string, <span class="title class_">Function</span> | <span class="literal">null</span>, ...any]</span><br><span class="line">): <span class="keyword">void</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (obj &amp;&amp; obj.<span class="property">addEventListener</span>) &#123;</span><br><span class="line">    obj.<span class="title function_">addEventListener</span>(...(args <span class="keyword">as</span> <span class="title class_">Parameters</span>&lt;<span class="title class_">HTMLElement</span>[<span class="string">&#x27;addEventListener&#x27;</span>]&gt;));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> off&lt;T <span class="keyword">extends</span> <span class="title class_">Window</span> | <span class="title class_">Document</span> | <span class="title class_">HTMLElement</span> | <span class="title class_">EventTarget</span>&gt;(</span><br><span class="line">  <span class="attr">obj</span>: T | <span class="literal">null</span>,</span><br><span class="line">  ...<span class="attr">args</span>: <span class="title class_">Parameters</span>&lt;T[<span class="string">&#x27;removeEventListener&#x27;</span>]&gt; | [string, <span class="title class_">Function</span> | <span class="literal">null</span>, ...any]</span><br><span class="line">): <span class="keyword">void</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (obj &amp;&amp; obj.<span class="property">removeEventListener</span>) &#123;</span><br><span class="line">    obj.<span class="title function_">removeEventListener</span>(...(args <span class="keyword">as</span> <span class="title class_">Parameters</span>&lt;<span class="title class_">HTMLElement</span>[<span class="string">&#x27;removeEventListener&#x27;</span>]&gt;));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="useGeolocation"><a href="#useGeolocation" class="headerlink" title="useGeolocation"></a>useGeolocation</h2><p>è¯¥hookç”¨äºè·å–å’Œè¿½é€ç”¨æˆ·çš„åœ°ç†ä½ç½®ï¼ŒåŸºäºæµè§ˆå™¨å†…ç½®å¯¹è±¡<code>navigator</code>å®ç°</p>
<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰è·å–ä½ç½®é”™è¯¯çš„æ¥å£</span></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">IGeolocationPositionError</span> &#123; </span><br><span class="line">  readonly <span class="attr">code</span>: number;</span><br><span class="line">  readonly <span class="attr">message</span>: string;</span><br><span class="line">  readonly <span class="attr">PERMISSION_DENIED</span>: number;</span><br><span class="line">  readonly <span class="attr">POSITION_UNAVAILABLE</span>: number;</span><br><span class="line">  readonly <span class="attr">TIMEOUT</span>: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰å½“å‰ä½ç½®ä¿¡æ¯çš„æ¥å£</span></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">GeoLocationSensorState</span> &#123; </span><br><span class="line">  <span class="attr">loading</span>: boolean; <span class="comment">//ä½ç½®ä¿¡æ¯æ˜¯å¦æ­£åœ¨åŠ è½½ä¸­</span></span><br><span class="line">  <span class="attr">accuracy</span>: number | <span class="literal">null</span>; <span class="comment">//è·å–çš„ä½ç½®çš„ç²¾ç¡®åº¦</span></span><br><span class="line">  <span class="attr">altitude</span>: number | <span class="literal">null</span>;  <span class="comment">//ç›¸å¯¹äºæµ·å¹³é¢çš„é«˜åº¦</span></span><br><span class="line">  <span class="attr">altitudeAccuracy</span>: number | <span class="literal">null</span>; <span class="comment">//é«˜åº¦çš„ç²¾ç¡®åº¦</span></span><br><span class="line">  <span class="attr">heading</span>: number | <span class="literal">null</span>; <span class="comment">//è®¾å¤‡ç§»åŠ¨æ–¹å‘</span></span><br><span class="line">  <span class="attr">latitude</span>: number | <span class="literal">null</span>; <span class="comment">//çº¬åº¦</span></span><br><span class="line">  <span class="attr">longitude</span>: number | <span class="literal">null</span>; <span class="comment">//ç»åº¦</span></span><br><span class="line">  <span class="attr">speed</span>: number | <span class="literal">null</span>; <span class="comment">//é€Ÿåº¦</span></span><br><span class="line">  <span class="attr">timestamp</span>: number | <span class="literal">null</span>; <span class="comment">//è¿™äº›ä½ç½®æ•°æ®çš„æ—¶é—´æˆ³</span></span><br><span class="line">  error?: <span class="title class_">Error</span> | <span class="title class_">IGeolocationPositionError</span>; <span class="comment">//åœ¨è·å–åœ°ç†ä½ç½®ä¿¡æ¯æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¿™é‡Œä¼šå­˜å‚¨é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">PositionOptions</span> &#123;</span><br><span class="line">    enableHighAccuracy?: boolean; <span class="comment">// æ˜¯å¦éœ€è¦é«˜ç²¾åº¦çš„ä½ç½®ä¿¡æ¯</span></span><br><span class="line">    maximumAge?: number; <span class="comment">// èƒ½æ¥å—å¤šæ—§çš„ä½ç½®ä¿¡æ¯</span></span><br><span class="line">    timeout?: number; <span class="comment">//è·å–ä½ç½®ä¿¡æ¯çš„æœ€é•¿ç­‰å¾…æ—¶é—´</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useGeolocation = (options?: <span class="title class_">PositionOptions</span>): <span class="function"><span class="params">GeoLocationSensorState</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = useState&lt;<span class="title class_">GeoLocationSensorState</span>&gt;(&#123;</span><br><span class="line">    <span class="attr">loading</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">accuracy</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">altitude</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">altitudeAccuracy</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">heading</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">latitude</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">longitude</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">speed</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">let</span> mounted = <span class="literal">true</span>; <span class="comment">// è¡¨ç¤ºç»„ä»¶æ˜¯å¦æŒ‚è½½</span></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">watchId</span>: any; <span class="comment">// è°ƒç”¨navigator.geolocation.watchPositionè¿”å›çš„idï¼Œç”¨äºåœ¨ç»„ä»¶å¸è½½æ—¶æ¸…é™¤ç›‘å¬</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½ç½®ä¿¡æ¯è¯·æ±‚æˆåŠŸçš„å›è°ƒå‡½æ•°ï¼Œnavigator.geolocation.getCurrentPositionä¼šåœ¨æˆåŠŸæ—¶ä¼ ç»™è¯¥å‡½æ•°ä¸€ä¸ªPositonå¯¹è±¡ï¼ŒåŒ…å«äº†ä½ç½®ä¿¡æ¯</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onEvent</span> = (<span class="params">event: any</span>) =&gt; &#123; </span><br><span class="line">    <span class="keyword">if</span> (mounted) &#123;</span><br><span class="line">      <span class="title function_">setState</span>(&#123;</span><br><span class="line">        <span class="attr">loading</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">accuracy</span>: event.<span class="property">coords</span>.<span class="property">accuracy</span>,</span><br><span class="line">        <span class="attr">altitude</span>: event.<span class="property">coords</span>.<span class="property">altitude</span>,</span><br><span class="line">        <span class="attr">altitudeAccuracy</span>: event.<span class="property">coords</span>.<span class="property">altitudeAccuracy</span>,</span><br><span class="line">        <span class="attr">heading</span>: event.<span class="property">coords</span>.<span class="property">heading</span>,</span><br><span class="line">        <span class="attr">latitude</span>: event.<span class="property">coords</span>.<span class="property">latitude</span>,</span><br><span class="line">        <span class="attr">longitude</span>: event.<span class="property">coords</span>.<span class="property">longitude</span>,</span><br><span class="line">        <span class="attr">speed</span>: event.<span class="property">coords</span>.<span class="property">speed</span>,</span><br><span class="line">        <span class="attr">timestamp</span>: event.<span class="property">timestamp</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½ç½®ä¿¡æ¯è¯·æ±‚å¤±è´¥çš„å›è°ƒå‡½æ•°ï¼Œnavigator.geolocation.getCurrentPositionä¼šåœ¨å¤±è´¥æ—¶ä¼ ç»™è¯¥å‡½æ•°ä¸€ä¸ªerrorå¯¹è±¡ï¼ŒåŒ…å«äº†é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onEventError</span> = (<span class="params">error: IGeolocationPositionError</span>) =&gt;</span><br><span class="line">    mounted &amp;&amp; <span class="title function_">setState</span>(<span class="function">(<span class="params">oldState</span>) =&gt;</span> (&#123; ...oldState, <span class="attr">loading</span>: <span class="literal">false</span>, error &#125;));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * navigator.geolocation.getCurrentPositionç”¨äºè·å–å½“å‰åœ°ç†ä½ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="comment">   * æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šæˆåŠŸçš„å›è°ƒã€é”™è¯¯æ—¶çš„å›è°ƒï¼ˆå¯é€‰ï¼‰ã€é€‰é¡¹å¯¹è±¡PositionOptionsï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * navigator.geolocation.watchPositionç”¨äºæ³¨å†Œä¸€ä¸ªç›‘å¬å™¨ï¼Œåœ¨ç”¨æˆ·çš„è®¾å¤‡åœ°ç†ä½ç½®å‘ç”Ÿå˜åŒ–æ—¶è¢«è°ƒç”¨ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªidï¼Œç”¨äºå–æ¶ˆç›‘å¬</span></span><br><span class="line"><span class="comment">   * æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šæˆåŠŸçš„å›è°ƒã€é”™è¯¯æ—¶çš„å›è°ƒï¼ˆå¯é€‰ï¼‰ã€é€‰é¡¹å¯¹è±¡PositionOptionsï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * navigator.geolocation.clearWatch(watchId)ç”¨äºå–æ¶ˆç›‘å¬ï¼Œä¼ å…¥ç›‘å¬å™¨id</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    navigator.<span class="property">geolocation</span>.<span class="title function_">getCurrentPosition</span>(onEvent, onEventError, options);</span><br><span class="line">    watchId = navigator.<span class="property">geolocation</span>.<span class="title function_">watchPosition</span>(onEvent, onEventError, options);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      mounted = <span class="literal">false</span>;</span><br><span class="line">      navigator.<span class="property">geolocation</span>.<span class="title function_">clearWatch</span>(watchId);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> state;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useGeolocation;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>navigatorå¯¹è±¡ æ˜¯ æµè§ˆå™¨å†…ç½®å¯¹è±¡ï¼Œå®ƒæä¾›äº†å…³äºç”¨æˆ·æµè§ˆå™¨çš„ä¿¡æ¯</p>
</blockquote>
<img src="/2024/03/29/react-use%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/image-1.png" class title="This is an image">

<h2 id="useHover"><a href="#useHover" class="headerlink" title="useHover"></a>useHover</h2><p><code>useHover</code>æä¾›ä¸€ç§ç®€å•çš„æ–¹å¼æ¥è·Ÿè¸ªé¼ æ ‡æ‚¬åœçŠ¶æ€ã€‚è¿™ä¸ªé’©å­æ¥å—ä¸€ä¸ª React å…ƒç´ æˆ–è€…ä¸€ä¸ªè¿”å› React å…ƒç´ çš„å‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«ä¸€ä¸ªå¸¦æœ‰æ‚¬åœäº‹ä»¶å¤„ç†çš„å…‹éš†å…ƒç´ ä»¥åŠä¸€ä¸ªè¡¨ç¤ºæ‚¬åœçŠ¶æ€ï¼ˆtrue æˆ– falseï¼‰çš„å¸ƒå°”å€¼ã€‚</p>
<p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useHover <span class="keyword">from</span> <span class="string">&#x27;./useHover&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">MyComponent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [hoverableElement, isHovered] = <span class="title function_">useHover</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hover over me!<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;hoverableElement&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;isHovered &amp;&amp; <span class="tag">&lt;<span class="name">div</span>&gt;</span>You are hovering!<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// noop ä¸æ‰§è¡Œä»»ä½•æ“ä½œçš„ç©ºå‡½æ•° () =&gt; &#123;&#125;</span></span><br><span class="line"><span class="keyword">import</span> &#123; noop &#125; <span class="keyword">from</span> <span class="string">&#x27;./misc/util&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; useState &#125; = <span class="title class_">React</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰Elementæ¥å£ï¼Œè¡¨ç¤ºElementç±»å‹å¯ä»¥æ˜¯ä¸€ä¸ªReactå…ƒç´ ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ªbooleanç±»å‹çš„å‚æ•°ï¼Œå¹¶è¿”å›Reactå…ƒç´ </span></span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">Element</span> = (<span class="function">(<span class="params">state: boolean</span>) =&gt;</span> <span class="title class_">React</span>.<span class="property">ReactElement</span>&lt;any&gt;) | <span class="title class_">React</span>.<span class="property">ReactElement</span>&lt;any&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// useHover æ¥å—ä¸€ä¸ªElementç±»å‹çš„å‚æ•°</span></span><br><span class="line"><span class="keyword">const</span> useHover = (<span class="attr">element</span>: <span class="title class_">Element</span>): [<span class="title class_">React</span>.<span class="property">ReactElement</span>&lt;any&gt;, boolean] =&gt; &#123;</span><br><span class="line">  <span class="comment">// stateçŠ¶æ€ç”¨äºè¡¨ç¤ºæ˜¯å¦å¤„äºé¼ æ ‡æ‚¬åœçŠ¶æ€</span></span><br><span class="line">  <span class="keyword">const</span> [state, setState] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¥å—ä¸€ä¸ªåŸå§‹äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚</span></span><br><span class="line">  <span class="comment">// æ–°çš„äº‹ä»¶å¤„ç†å‡½æ•°é¦–å…ˆè°ƒç”¨ä¼ å…¥çš„åŸå§‹äº‹ä»¶å¤„ç†å‡½æ•°ï¼ˆå¦‚æœæ²¡æœ‰æä¾›ï¼Œåˆ™è°ƒç”¨ noopï¼‰ï¼Œç„¶åé€šè¿‡ setState æ›´æ–°æ‚¬åœçŠ¶æ€ã€‚</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onMouseEnter</span> = (<span class="params">originalOnMouseEnter?: any</span>) =&gt; <span class="function">(<span class="params">event: any</span>) =&gt;</span> &#123;</span><br><span class="line">    (originalOnMouseEnter || noop)(event);</span><br><span class="line">    <span class="title function_">setState</span>(<span class="literal">true</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onMouseLeave</span> = (<span class="params">originalOnMouseLeave?: any</span>) =&gt; <span class="function">(<span class="params">event: any</span>) =&gt;</span> &#123;</span><br><span class="line">    (originalOnMouseLeave || noop)(event);</span><br><span class="line">    <span class="title function_">setState</span>(<span class="literal">false</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¼ å…¥çš„elementæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™å°†ä»£è¡¨æ˜¯å¦hoverçš„çŠ¶æ€stateä¼ å…¥æ¥è¿”å›å¯¹åº”çš„Reactå…ƒç´ </span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> element === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    element = <span class="title function_">element</span>(state);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// element.props.onMouseEnter å’Œ element.props.onMouseLeave æ˜¯åŸå§‹å…ƒç´ ä¸Šå¯èƒ½å­˜åœ¨çš„é¼ æ ‡æ‚¬åœå’Œç¦»å¼€å‡½æ•°</span></span><br><span class="line">  <span class="keyword">const</span> el = <span class="title class_">React</span>.<span class="title function_">cloneElement</span>(element, &#123;</span><br><span class="line">    <span class="attr">onMouseEnter</span>: <span class="title function_">onMouseEnter</span>(element.<span class="property">props</span>.<span class="property">onMouseEnter</span>),</span><br><span class="line">    <span class="attr">onMouseLeave</span>: <span class="title function_">onMouseLeave</span>(element.<span class="property">props</span>.<span class="property">onMouseLeave</span>),</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›å…‹éš†çš„Reactå…ƒç´  ä»¥åŠ è¡¨ç¤ºæ‚¬æµ®çŠ¶æ€çš„state</span></span><br><span class="line">  <span class="keyword">return</span> [el, state];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useHover;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><code>React.cloneElement()</code></strong></p>
<p>å®ƒå…è®¸ä½ å…‹éš†ä¸€ä¸ªReactå…ƒç´ ï¼Œå¹¶ä¸”å¯ä»¥é€‰æ‹©æ€§çš„ä¼ å…¥propsã€å­å…ƒç´ ä»¥åŠkeyã€‚å®ƒçš„ä½œç”¨æ˜¯åŸºäºå·²æœ‰çš„Reactå…ƒç´ åˆ›å»ºä¸€ä¸ªæ–°çš„å…ƒç´ ï¼Œé»˜è®¤ä¿ç•™åŸæœ‰å…ƒç´ çš„propsã€å†…éƒ¨çŠ¶æ€å’Œè¡Œä¸º</p>
<blockquote>
<p>é»˜è®¤ä¿ç•™åŸæœ‰å…ƒç´ çš„propsã€å†…éƒ¨çŠ¶æ€å’Œè¡Œä¸º<br>å› ä¸ºåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒReactåªæ˜¯æµ…å…‹éš†äº†åŸæœ‰å…ƒç´ ï¼Œå¹¶ä¼ å…¥æ–°çš„propsã€‚åœ¨ä¸æ”¹å˜keyçš„æƒ…å†µä¸‹ï¼ŒReactä¼šè§†è¿™ä¸¤ä¸ªç»„ä»¶ä¸ºåŒä¸€ä¸ªå®ä¾‹ï¼Œè¿™å°±æ„å‘³ç€ï¼Œå³ä½¿å±æ€§å¯èƒ½æœ‰æ‰€æ”¹å˜ï¼Œä½†ç”±äºç»„ä»¶ç±»å‹å’Œ key æ²¡æœ‰å˜åŒ–ï¼ŒReactçš„é‡ç”¨é€»è¾‘ä¼šä¿ç•™ç»„ä»¶å®ä¾‹åŠå…¶å†…éƒ¨çŠ¶æ€ã€‚</p>
</blockquote>
<p>ä½¿ç”¨<code>React.cloneElement</code>å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ‰©å±•æˆ–ä¿®æ”¹ç»„ä»¶çš„å­å…ƒç´ ï¼Œè€Œä¸éœ€è¦åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ç»„ä»¶ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">React</span>.<span class="title function_">cloneElement</span>(</span><br><span class="line">  element, <span class="comment">// æƒ³è¦å…‹éš†çš„Reactå¯¹è±¡</span></span><br><span class="line">  props, <span class="comment">// å¯é€‰å‚æ•°ã€‚ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«è¦æ·»åŠ æˆ–è€…è¦†ç›–çš„æ–°å±æ€§</span></span><br><span class="line">  [...children] <span class="comment">// å¯é€‰å‚æ•°ã€‚å¯ä»¥ä¼ å…¥ä»»æ„æ•°é‡çš„å­èŠ‚ç‚¹æ¥æ›¿æ¢è¢«å…‹éš†å…ƒç´ çš„å­èŠ‚ç‚¹</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><code>React.cloneElement</code> ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">ListItem</span> = (<span class="params">&#123; children, onClick &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">onClick</span>=<span class="string">&#123;onClick&#125;</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">List</span> = (<span class="params">&#123; items &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;items.map((item, index) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        // å…‹éš†ListItemï¼Œå¹¶ä¸ºæ¯ä¸ªitemæ·»åŠ ç‰¹å®šçš„onClickå¤„ç†å™¨</span></span><br><span class="line"><span class="language-xml">        return React.cloneElement(<span class="tag">&lt;<span class="name">ListItem</span>&gt;</span>&#123;item.text&#125;<span class="tag">&lt;/<span class="name">ListItem</span>&gt;</span>, &#123;</span></span><br><span class="line"><span class="language-xml">          key: index, // å¿…é¡»æä¾›keyï¼Œç‰¹åˆ«æ˜¯åœ¨mapå¾ªç¯ä¸­</span></span><br><span class="line"><span class="language-xml">          onClick: () =&gt; alert(`Item $&#123;index + 1&#125; clicked!`), // ç»‘å®šäº†ä¸€ä¸ªå¼¹çª—äº‹ä»¶</span></span><br><span class="line"><span class="language-xml">        &#125;);</span></span><br><span class="line"><span class="language-xml">      &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨Listç»„ä»¶</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">App</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> items = [</span><br><span class="line">    &#123; <span class="attr">text</span>: <span class="string">&#x27;Item 1&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">text</span>: <span class="string">&#x27;Item 2&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">text</span>: <span class="string">&#x27;Item 3&#x27;</span> &#125;,</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">List</span> <span class="attr">items</span>=<span class="string">&#123;items&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<h2 id="useHoverDirty"><a href="#useHoverDirty" class="headerlink" title="useHoverDirty"></a>useHoverDirty</h2><p><code>useHoverDirty</code>æä¾›ä¸€ç§æ–¹å¼æ¥æ£€æµ‹ç”¨æˆ·æ˜¯å¦æ‚¬æµ®åœ¨æŸä¸ªå…ƒç´ ä¸Š</p>
<p><code>useHover</code>æ¥å—ä¸€ä¸ªReactå…ƒç´ æˆ–è€…ä¸€ä¸ªå‡½æ•°ï¼Œè€Œ<code>useHoverDirty</code>æ¥å—<code>React ref</code><br><code>useHover</code>é€šè¿‡è®¾ç½®Reactå…ƒç´ çš„<code>onMouseOver</code>å’Œ<code>onMouseOut</code>äº‹ä»¶ï¼Œè€Œ<code>useHoverDirty</code>é€šè¿‡è®¾ç½®DOMå…ƒç´ çš„<code>onMouseOver</code>å’Œ<code>onMouseOut</code>äº‹ä»¶</p>
<p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> useHoverDirty <span class="keyword">from</span> <span class="string">&#x27;./useHoverDirty&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">HoverComponent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºä¸€ä¸ªrefæ¥å¼•ç”¨æˆ‘ä»¬æƒ³è¦æ£€æµ‹æ‚¬åœçš„DOMå…ƒç´ </span></span><br><span class="line">  <span class="keyword">const</span> hoverRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="comment">// ä½¿ç”¨æˆ‘ä»¬çš„è‡ªå®šä¹‰Hookæ¥è·å–æ‚¬åœçŠ¶æ€</span></span><br><span class="line">  <span class="keyword">const</span> isHovered = <span class="title function_">useHoverDirty</span>(hoverRef);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ ¹æ®æ‚¬åœçŠ¶æ€åŠ¨æ€è®¾ç½®æ ·å¼</span></span><br><span class="line">  <span class="keyword">const</span> style = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="string">&#x27;200px&#x27;</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="string">&#x27;200px&#x27;</span>,</span><br><span class="line">    <span class="attr">backgroundColor</span>: isHovered ? <span class="string">&#x27;blue&#x27;</span> : <span class="string">&#x27;red&#x27;</span>,</span><br><span class="line">    <span class="comment">// å½“é¼ æ ‡æ‚¬åœæ—¶èƒŒæ™¯è‰²å˜è“ï¼Œå¦åˆ™ä¸ºçº¢è‰²</span></span><br><span class="line">    <span class="attr">color</span>: <span class="string">&#x27;white&#x27;</span>,</span><br><span class="line">    <span class="attr">display</span>: <span class="string">&#x27;flex&#x27;</span>,</span><br><span class="line">    <span class="attr">alignItems</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">    <span class="attr">justifyContent</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">    <span class="attr">transition</span>: <span class="string">&#x27;background-color 0.3s&#x27;</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;hoverRef&#125;</span> <span class="attr">style</span>=<span class="string">&#123;style&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;isHovered ? &#x27;Hovering&#x27; : &#x27;Not Hovering&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">HoverComponent</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RefObject</span>, useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; off, on &#125; <span class="keyword">from</span> <span class="string">&#x27;./misc/util&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ref: è¿™æ˜¯ä¸€ä¸ªReact refå¯¹è±¡ï¼ŒæŒ‡å‘è¦ç›‘å¬æ‚¬æµ®äº‹ä»¶çš„DOMå…ƒç´ ã€‚ä½¿ç”¨refæ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦ç›´æ¥æ“ä½œDOMå…ƒç´ æ¥ç»‘å®šå’Œè§£ç»‘äº‹ä»¶ç›‘å¬å™¨ã€‚</span></span><br><span class="line"><span class="comment"> * enabled: è¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºtrueã€‚å®ƒå…è®¸ä½¿ç”¨è€…å¯ç”¨æˆ–ç¦ç”¨æ‚¬æµ®ç›‘å¬åŠŸèƒ½ã€‚è¿™å¯ä»¥ç”¨æ¥åœ¨æŸäº›æ¡ä»¶ä¸‹åŠ¨æ€å¼€å¯æˆ–å…³é—­äº‹ä»¶ç›‘å¬ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useHoverDirty</span> = (<span class="params">ref: RefObject&lt;Element&gt;, enabled: boolean = <span class="literal">true</span></span>) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¼€å‘æ¨¡å¼ä¸‹çš„è­¦å‘Šï¼Œå¯ä»¥å¿½ç•¥</span></span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> ref !== <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> ref.<span class="property">current</span> === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;useHoverDirty expects a single ref argument.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ˜¯å¦å¤„äºæ‚¬æµ®çŠ¶æ€çš„state</span></span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">onMouseOver</span> = (<span class="params"></span>) =&gt; <span class="title function_">setValue</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">onMouseOut</span> = (<span class="params"></span>) =&gt; <span class="title function_">setValue</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (enabled &amp;&amp; ref &amp;&amp; ref.<span class="property">current</span>) &#123;</span><br><span class="line">      <span class="title function_">on</span>(ref.<span class="property">current</span>, <span class="string">&#x27;mouseover&#x27;</span>, onMouseOver);</span><br><span class="line">      <span class="title function_">on</span>(ref.<span class="property">current</span>, <span class="string">&#x27;mouseout&#x27;</span>, onMouseOut);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; current &#125; = ref;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (enabled &amp;&amp; current) &#123;</span><br><span class="line">        <span class="title function_">off</span>(current, <span class="string">&#x27;mouseover&#x27;</span>, onMouseOver);</span><br><span class="line">        <span class="title function_">off</span>(current, <span class="string">&#x27;mouseout&#x27;</span>, onMouseOut);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [enabled, ref]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useHoverDirty;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// onå‡½æ•° å’Œ offå‡½æ•° çš„å°è£…</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> on&lt;T <span class="keyword">extends</span> <span class="title class_">Window</span> | <span class="title class_">Document</span> | <span class="title class_">HTMLElement</span> | <span class="title class_">EventTarget</span>&gt;(</span><br><span class="line">  <span class="attr">obj</span>: T | <span class="literal">null</span>,</span><br><span class="line">  ...<span class="attr">args</span>: <span class="title class_">Parameters</span>&lt;T[<span class="string">&#x27;addEventListener&#x27;</span>]&gt; | [string, <span class="title class_">Function</span> | <span class="literal">null</span>, ...any]</span><br><span class="line">): <span class="keyword">void</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (obj &amp;&amp; obj.<span class="property">addEventListener</span>) &#123;</span><br><span class="line">    obj.<span class="title function_">addEventListener</span>(...(args <span class="keyword">as</span> <span class="title class_">Parameters</span>&lt;<span class="title class_">HTMLElement</span>[<span class="string">&#x27;addEventListener&#x27;</span>]&gt;));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> off&lt;T <span class="keyword">extends</span> <span class="title class_">Window</span> | <span class="title class_">Document</span> | <span class="title class_">HTMLElement</span> | <span class="title class_">EventTarget</span>&gt;(</span><br><span class="line">  <span class="attr">obj</span>: T | <span class="literal">null</span>,</span><br><span class="line">  ...<span class="attr">args</span>: <span class="title class_">Parameters</span>&lt;T[<span class="string">&#x27;removeEventListener&#x27;</span>]&gt; | [string, <span class="title class_">Function</span> | <span class="literal">null</span>, ...any]</span><br><span class="line">): <span class="keyword">void</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (obj &amp;&amp; obj.<span class="property">removeEventListener</span>) &#123;</span><br><span class="line">    obj.<span class="title function_">removeEventListener</span>(...(args <span class="keyword">as</span> <span class="title class_">Parameters</span>&lt;<span class="title class_">HTMLElement</span>[<span class="string">&#x27;removeEventListener&#x27;</span>]&gt;));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="useIntersection"><a href="#useIntersection" class="headerlink" title="useIntersection"></a>useIntersection</h2><p><code>useIntersection</code>ä½¿ç”¨äº†æµè§ˆå™¨çš„ Intersection Observer API æ¥å¼‚æ­¥åœ°æ£€æµ‹ç›®æ ‡å…ƒç´ ä¸å…¶ç¥–å…ˆå…ƒç´ æˆ–é¡¶çº§æ–‡æ¡£è§†å£çš„äº¤å‰çŠ¶æ€çš„å˜åŒ–ã€‚</p>
<blockquote>
<p>Intersection Observer API æ˜¯ä¸€ä¸ªæµè§ˆå™¨APIï¼Œå®ƒå…è®¸ä½ å¼‚æ­¥è§‚å¯Ÿä¸€ä¸ªå…ƒç´ ä¸å…¶ç¥–å…ˆå…ƒç´ æˆ–å…¨å±€è§†å£çš„äº¤é›†å˜åŒ–ã€‚èƒ½å¤Ÿé«˜æ•ˆå¾—è·å–å…ƒç´ æ˜¯å¦è¿›å…¥æˆ–ç¦»å¼€è§†å£çš„ä¿¡æ¯ã€‚</p>
</blockquote>
<p><strong>ç›¸å…³æ¦‚å¿µ</strong></p>
<ul>
<li><code>rootï¼ˆæ ¹ï¼‰</code>: æƒ³è¦æ£€æŸ¥ç›®æ ‡å…ƒç´ ä¸ä¹‹ç›¸äº¤çš„å®¹å™¨å…ƒç´ ï¼Œå¦‚æœæœªæŒ‡å®šæˆ–ä¸ºnullï¼Œé»˜è®¤ä¸ºæµè§ˆå™¨è§†å£</li>
<li><code>rootMarginï¼ˆæ ¹è¾¹ç•Œï¼‰</code>: ç±»ä¼¼äºCSSçš„marginå±æ€§ã€‚å®ƒå…è®¸ä½ æŒ‡å®šä¸€ä¸ªåœ¨æ ¹å…ƒç´ çš„å¤–å›´å½¢æˆçš„è¾¹æ¡†åŒºåŸŸï¼Œç”¨äºå¢åŠ æˆ–å‡å°‘ç”¨äºæ£€æŸ¥äº¤é›†çš„åŒºåŸŸå¤§å°</li>
<li><code>thresholdï¼ˆé˜ˆå€¼ï¼‰</code>: ä¸€ä¸ªæ•°å­—æˆ–ç”±å¤šä¸ªæ•°å­—ç»„æˆçš„æ•°ç»„ï¼ŒæŒ‡å®šäº†è§‚å¯Ÿè€…çš„å›è°ƒå‡½æ•°è¢«æ‰§è¡Œçš„æ¡ä»¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé˜ˆå€¼æ˜¯0.5ï¼Œåˆ™ç›®æ ‡å…ƒç´ æœ‰50%è¿›å…¥æ ¹å…ƒç´ æ—¶ï¼Œè§‚å¯Ÿè€…çš„å›è°ƒå‡½æ•°å°†è¢«æ‰§è¡Œ</li>
</ul>
<p><strong><code>IntersectionObserver()</code>æ–¹æ³•</strong>æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„ IntersectionObserver å¯¹è±¡ã€‚<br>è¿™ä¸ªæ„é€ å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªå›è°ƒå‡½æ•°å’Œä¸€ä¸ªå¯é€‰çš„é…ç½®å¯¹è±¡ã€‚</p>
<ul>
<li>å›è°ƒå‡½æ•°ï¼šå½“è¢«è§‚å¯Ÿçš„å…ƒç´ è¿›å…¥æˆ–é€€å‡ºäº¤é›†åŒºåŸŸæ—¶ï¼Œå›è°ƒå‡½æ•°ä¼šè¢«æ‰§è¡Œã€‚è¿™ä¸ªå‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š</li>
</ul>
<ul>
<li><code>entries</code>: ä¸€ä¸ª IntersectionObserverEntry å¯¹è±¡æ•°ç»„ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æè¿°äº†ä¸€ä¸ªè¢«è§‚å¯Ÿå…ƒç´ çš„äº¤é›†çŠ¶æ€</li>
<li><code>observer</code>: å¯¹åº”çš„ IntersectionObserver å®ä¾‹ï¼Œå…è®¸ä½ è®¿é—®è§‚å¯Ÿè€…çš„å±æ€§æˆ–è°ƒç”¨å…¶æ–¹æ³•ï¼Œå¦‚ disconnect æˆ– unobserve</li>
</ul>
<ul>
<li>é…ç½®å¯¹è±¡ï¼šåŒ…å«ä¸‰ä¸ªå±æ€§</li>
</ul>
<ul>
<li>root</li>
<li>rootMargin</li>
<li>threshold</li>
</ul>
<p><strong>Intersection Observer</strong></p>
<ul>
<li><code>root</code>: æƒ³è¦æ£€æŸ¥ç›®æ ‡å…ƒç´ ä¸ä¹‹ç›¸äº¤çš„å®¹å™¨å…ƒç´ ï¼Œå¦‚æœæœªæŒ‡å®šæˆ–ä¸ºnullï¼Œé»˜è®¤ä¸ºæµè§ˆå™¨è§†å£</li>
<li><code>rootMargin</code>: ç±»ä¼¼äºCSSçš„marginå±æ€§ã€‚å®ƒå…è®¸ä½ æŒ‡å®šä¸€ä¸ªåœ¨æ ¹å…ƒç´ çš„å¤–å›´å½¢æˆçš„è¾¹æ¡†åŒºåŸŸï¼Œç”¨äºå¢åŠ æˆ–å‡å°‘ç”¨äºæ£€æŸ¥äº¤é›†çš„åŒºåŸŸå¤§å°</li>
<li><code>thresholds</code>: ä¸€ä¸ªæ•°å­—æˆ–ç”±å¤šä¸ªæ•°å­—ç»„æˆçš„æ•°ç»„ï¼ŒæŒ‡å®šäº†è§‚å¯Ÿè€…çš„å›è°ƒå‡½æ•°è¢«æ‰§è¡Œçš„æ¡ä»¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé˜ˆå€¼æ˜¯0.5ï¼Œåˆ™ç›®æ ‡å…ƒç´ æœ‰50%è¿›å…¥æ ¹å…ƒç´ æ—¶ï¼Œè§‚å¯Ÿè€…çš„å›è°ƒå‡½æ•°å°†è¢«æ‰§è¡Œ</li>
<li><code>disconnect()</code>: åœæ­¢è§‚å¯Ÿæ‰€æœ‰ç›®æ ‡</li>
<li><code>observe(target)</code>: å¼€å§‹è§‚å¯Ÿä¸€ä¸ªç›®æ ‡å…ƒç´ </li>
<li><code>takeRecords</code>: è¿”å›æ‰€æœ‰ç›®æ ‡çš„<code>IntersectionObserverEntry</code>å¯¹è±¡æ•°ç»„</li>
<li><code>unobserve(targrt)</code>: åœæ­¢è§‚å¯Ÿä¸€ä¸ªç›®æ ‡å…ƒç´ </li>
</ul>
<p><strong>Intersection Observer Entry</strong></p>
<ul>
<li><code>boundingClientRect</code>: è¿”å›ç›®æ ‡å…ƒç´ çš„çŸ©å½¢ä¿¡æ¯ï¼Œç”¨äºè®¡ç®—ä¸è§†å£çš„äº¤é›†</li>
<li><code>intersectionRatio</code>: ç›®æ ‡å…ƒç´ <strong>å¯è§éƒ¨åˆ†</strong>å æ€»ä½“çš„æ¯”ä¾‹</li>
<li><code>intersectionRect</code>: ç›®æ ‡å…ƒç´ ä¸è§†å£<strong>äº¤å‰éƒ¨åˆ†</strong>çš„çŸ©å½¢ä¿¡æ¯</li>
<li><code>isIntersecting</code>: ç›®æ ‡å…ƒç´ æ˜¯å¦ä¸æ ¹å…ƒç´ ç›¸äº¤</li>
<li><code>rootBounds</code>: æ ¹å…ƒç´ çš„çŸ©å½¢ä¿¡æ¯</li>
<li><code>target</code>: ç›®æ ‡å…ƒç´ </li>
<li><code>time</code>: è§‚å¯Ÿåˆ°äº¤å‰çŠ¶æ€å˜åŒ–æ—¶çš„æ—¶é—´æˆ³</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯</strong></p>
<ul>
<li>æ‡’åŠ è½½ï¼šå½“å›¾ç‰‡æˆ–å…¶ä»–èµ„æºè¿›å…¥è§†å£æ—¶æ‰åŠ è½½å®ƒä»¬ï¼Œä»¥æ­¤èŠ‚çœå¸¦å®½å’Œæé«˜é¡µé¢åŠ è½½é€Ÿåº¦</li>
<li>æ— é™æ»šåŠ¨: å½“ç”¨æˆ·æ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨æ—¶ï¼Œè‡ªåŠ¨åŠ è½½æ›´å¤šå†…å®¹</li>
</ul>
<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RefObject</span>, useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * useIntersectionæ¥å—ä¸¤ä¸ªå‚æ•°</span></span><br><span class="line"><span class="comment"> * refï¼š ä¸€ä¸ªrefå¼•ç”¨å¯¹è±¡ï¼ŒæŒ‡å‘è¦è§‚å¯Ÿçš„ç›®æ ‡å…ƒç´ </span></span><br><span class="line"><span class="comment"> * optionsï¼š é…ç½®å¯¹è±¡ï¼Œç”¨äºåˆå§‹åŒ–Intersection Observerçš„é€‰é¡¹ï¼Œæ¯”å¦‚ rootã€rootMargin å’Œ threshold</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> useIntersection = (</span><br><span class="line">  <span class="attr">ref</span>: <span class="title class_">RefObject</span>&lt;<span class="title class_">HTMLElement</span>&gt;,</span><br><span class="line">  <span class="attr">options</span>: <span class="title class_">IntersectionObserverInit</span></span><br><span class="line">): <span class="title class_">IntersectionObserverEntry</span> | <span class="function"><span class="params">null</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// åˆ›å»º intersectionObserverEntry çŠ¶æ€ï¼Œç”¨äºå­˜å‚¨ intersectionObserverEntry å¯¹è±¡ä¿¡æ¯</span></span><br><span class="line">  <span class="keyword">const</span> [intersectionObserverEntry, setIntersectionObserverEntry] =</span><br><span class="line">    useState&lt;<span class="title class_">IntersectionObserverEntry</span> | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// refæ˜¯å¦å­˜åœ¨ï¼Œæµè§ˆå™¨æ˜¯å¦æ”¯æŒIntersectionObserver</span></span><br><span class="line">    <span class="keyword">if</span> (ref.<span class="property">current</span> &amp;&amp; <span class="keyword">typeof</span> <span class="title class_">IntersectionObserver</span> === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// handleå‡½æ•°ç”¨äºæ›´æ–° intersectionObserverEntry çŠ¶æ€</span></span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">handler</span> = (<span class="params">entries: IntersectionObserverEntry[]</span>) =&gt; &#123;</span><br><span class="line">        <span class="title function_">setIntersectionObserverEntry</span>(entries[<span class="number">0</span>]);</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆ›å»ºä¸€ä¸ªç›‘å¬å™¨å¯¹è±¡</span></span><br><span class="line">      <span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">IntersectionObserver</span>(handler, options);</span><br><span class="line">      <span class="comment">// ç›‘å¬ç›®æ ‡å…ƒç´ </span></span><br><span class="line">      observer.<span class="title function_">observe</span>(ref.<span class="property">current</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ç»„ä»¶é”€æ¯æ—¶å–æ¶ˆç›‘å¬ï¼Œå¹¶æ¸…ç©º intersectionObserverEntry çŠ¶æ€</span></span><br><span class="line">      <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">setIntersectionObserverEntry</span>(<span class="literal">null</span>);</span><br><span class="line">        observer.<span class="title function_">disconnect</span>();</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;&#125;;</span><br><span class="line">  &#125;, [ref.<span class="property">current</span>, options.<span class="property">threshold</span>, options.<span class="property">root</span>, options.<span class="property">rootMargin</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> intersectionObserverEntry;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useIntersection;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨ç¤ºä¾‹</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useIntersection &#125; <span class="keyword">from</span> <span class="string">&#x27;react-use&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Demo</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> intersectionRef = <span class="title class_">React</span>.<span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> intersection = <span class="title function_">useIntersection</span>(intersectionRef, &#123;</span><br><span class="line">    <span class="attr">root</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">rootMargin</span>: <span class="string">&#x27;0px&#x27;</span>,</span><br><span class="line">    <span class="attr">threshold</span>: <span class="number">1</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;intersectionRef&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;intersection &amp;&amp; intersection.intersectionRatio &lt; 1</span></span><br><span class="line"><span class="language-xml">        ? &#x27;Obscured&#x27;</span></span><br><span class="line"><span class="language-xml">        : &#x27;Fully in view&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="useKey"><a href="#useKey" class="headerlink" title="useKey"></a>useKey</h2><p><code>useKey</code>ç”¨äºè®¾ç½®ç›‘å¬é”®ç›˜äº‹ä»¶</p>
<p>æºç åŠè§£æå¦‚ä¸‹ï¼›</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">DependencyList</span>, useMemo &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> useEvent, &#123; <span class="title class_">UseEventOptions</span>, <span class="title class_">UseEventTarget</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./useEvent&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; noop &#125; <span class="keyword">from</span> <span class="string">&#x27;./misc/util&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">KeyPredicate</span> = <span class="function">(<span class="params">event: KeyboardEvent</span>) =&gt;</span> boolean;</span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">KeyFilter</span> = <span class="literal">null</span> | <span class="literal">undefined</span> | string | (<span class="function">(<span class="params">event: KeyboardEvent</span>) =&gt;</span> boolean);</span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">Handler</span> = <span class="function">(<span class="params">event: KeyboardEvent</span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">UseKeyOptions</span>&lt;T <span class="keyword">extends</span> <span class="title class_">UseEventTarget</span>&gt; &#123;</span><br><span class="line">  event?: <span class="string">&#x27;keydown&#x27;</span> | <span class="string">&#x27;keypress&#x27;</span> | <span class="string">&#x27;keyup&#x27;</span>;</span><br><span class="line">  target?: T | <span class="literal">null</span>;</span><br><span class="line">  options?: <span class="title class_">UseEventOptions</span>&lt;T&gt;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// createKeyPredicateæ¥å—ä¸€ä¸ªå‚æ•°keyFilterï¼Œè¯¥å‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªåˆ¤æ–­å‡½æ•°ï¼ˆç”¨äºåˆ¤æ–­ä½•æ—¶ç¬¦åˆæ¡ä»¶ï¼‰ã€ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆæŒ‡å®šçš„keyboardï¼‰ æˆ–è€… undefined/null</span></span><br><span class="line"><span class="comment">// ç„¶å createKeyPredicate æ ¹æ®ä¸åŒçš„å‚æ•°æ¥åˆ›å»ºåˆ¤æ–­å‡½æ•°</span></span><br><span class="line"><span class="comment">// å¦‚æœä¼ å…¥çš„æ˜¯å‡½æ•°ï¼Œå°±è¿”å›è¿™ä¸ªå‡½æ•°</span></span><br><span class="line"><span class="comment">// å¦‚æœä¼ å…¥çš„æ˜¯å­—ç¬¦ä¸²ï¼ˆç‰¹å®šçš„keyboardï¼‰ï¼Œåˆ™å°†å®ƒåŒ…è£…æˆä¸€ä¸ªå‡½æ•°ï¼Œå½“event.key === å­—ç¬¦ä¸² æ—¶è¿”å›trueï¼Œè¡¨ç¤ºç¬¦åˆæ¡ä»¶è§¦å‘å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="comment">// å¦‚æœä¼ å…¥çš„æ˜¯undefined/nullï¼Œåˆ™åŒ…è£…ä¸€ä¸ªå›ºå®šè¿”å›falseçš„å‡½æ•°ï¼Œè¡¨ç¤ºä¸ç¬¦åˆæ¡ä»¶ä¸è§¦å‘å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> createKeyPredicate = (<span class="attr">keyFilter</span>: <span class="title class_">KeyFilter</span>): <span class="function"><span class="params">KeyPredicate</span> =&gt;</span></span><br><span class="line">  <span class="keyword">typeof</span> keyFilter === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">    ? keyFilter</span><br><span class="line">    : <span class="keyword">typeof</span> keyFilter === <span class="string">&#x27;string&#x27;</span></span><br><span class="line">    ? <span class="function">(<span class="params">event: KeyboardEvent</span>) =&gt;</span> event.<span class="property">key</span> === keyFilter</span><br><span class="line">    : keyFilter</span><br><span class="line">    ? <span class="function">() =&gt;</span> <span class="literal">true</span></span><br><span class="line">    : <span class="function">() =&gt;</span> <span class="literal">false</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key æŒ‡å®šè§¦å‘å›è°ƒçš„é”®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> fn è¦è§¦å‘çš„å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> opts é…ç½®é€‰é¡¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> deps ä¾èµ–é¡¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> useKey = &lt;T <span class="keyword">extends</span> <span class="title class_">UseEventTarget</span>&gt;<span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  key: KeyFilter,</span></span></span><br><span class="line"><span class="params"><span class="function">  fn: Handler = noop,</span></span></span><br><span class="line"><span class="params"><span class="function">  opts: UseKeyOptions&lt;T&gt; = &#123;&#125;,</span></span></span><br><span class="line"><span class="params"><span class="function">  deps: DependencyList = [key]</span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// event æŒ‡å®šæ˜¯å“ªç§é”®ç›˜äº‹ä»¶ï¼ˆkeydownï¼Œkeyupï¼Œkeypressï¼‰</span></span><br><span class="line">  <span class="comment">// target ç»‘å®šäº‹ä»¶çš„ç›®æ ‡å¯¹è±¡</span></span><br><span class="line">  <span class="comment">// options ä¼ é€’ç»™useEventçš„é…ç½®é¡¹</span></span><br><span class="line">  <span class="keyword">const</span> &#123; event = <span class="string">&#x27;keydown&#x27;</span>, target, options &#125; = opts;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åŒ…è£…åçš„å›è°ƒå‡½æ•°</span></span><br><span class="line">  <span class="keyword">const</span> useMemoHandler = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®ä¼ å…¥çš„keyå€¼åˆ›å»ºä¸€ä¸ªåˆ¤æ–­å‡½æ•°</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">predicate</span>: <span class="title class_">KeyPredicate</span> = <span class="title function_">createKeyPredicate</span>(key);</span><br><span class="line">    <span class="comment">// handlerEvent æ˜¯æµè§ˆå™¨äº‹ä»¶å¯¹è±¡ï¼Œå½“å‘ç›‘å¬å™¨æ·»åŠ äº‹ä»¶å¤„ç†å‡½æ•°æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ä¼ å…¥äº‹ä»¶å¯¹è±¡ä½œä¸ºå‚æ•°</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬å¯ä»¥é€šè¿‡eventå‚æ•°è®¿é—®åˆ°äº‹ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚è¢«æŒ‰ä¸‹çš„é”®æ˜¯ä»€ä¹ˆï¼ˆevent.keyï¼‰</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">handler</span>: <span class="title class_">Handler</span> = <span class="function">(<span class="params">handlerEvent</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// åˆ¤æ–­æ˜¯å¦ç¬¦åˆè§¦å‘å›è°ƒçš„æ¡ä»¶</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">predicate</span>(handlerEvent)) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœç¬¦åˆï¼Œå°±æ‰§è¡Œç”¨æˆ·ä¼ å…¥çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">fn</span>(handlerEvent);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> handler;</span><br><span class="line">  &#125;, deps);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è°ƒç”¨useEventæ¥ä¸ºç›®æ ‡å¯¹è±¡ç»‘å®šäº‹ä»¶</span></span><br><span class="line">  <span class="title function_">useEvent</span>(event, useMemoHandler, target, options);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useKey;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="useLongPress"><a href="#useLongPress" class="headerlink" title="useLongPress"></a>useLongPress</h2><p><code>useLongPress</code>ç”¨äºè®¾ç½®é•¿æŒ‰ä¹‹åè§¦å‘çš„å›è°ƒ</p>
<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useCallback, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; off, on &#125; <span class="keyword">from</span> <span class="string">&#x27;./misc/util&#x27;</span>;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Options</span> &#123;</span><br><span class="line">  isPreventDefault?: boolean;</span><br><span class="line">  delay?: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isTouchEvent = (<span class="attr">ev</span>: <span class="title class_">Event</span>): ev is <span class="title class_">TouchEvent</span> =&gt; &#123;</span><br><span class="line">  <span class="comment">// æ£€æŸ¥æµè§ˆå™¨ä¼ å…¥çš„äº‹ä»¶å¯¹è±¡ä¸­æ˜¯å¦æœ‰toucheså±æ€§ï¼Œå³æ˜¯å¦è§¦å‘äº†touchesäº‹ä»¶</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;touches&#x27;</span> <span class="keyword">in</span> ev;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">preventDefault</span> = (<span class="params">ev: Event</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isTouchEvent</span>(ev)) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å½“è§¦æ‘¸ç‚¹ä¸ªæ•°å°äº2ä¸ªæ—¶ï¼Œé˜»æ­¢é»˜è®¤äº‹ä»¶</span></span><br><span class="line">  <span class="keyword">if</span> (ev.<span class="property">touches</span>.<span class="property">length</span> &lt; <span class="number">2</span> &amp;&amp; ev.<span class="property">preventDefault</span>) &#123;</span><br><span class="line">    ev.<span class="title function_">preventDefault</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> callback é•¿æŒ‰ä¹‹åçš„å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> options é…ç½®é¡¹å¯¹è±¡ï¼ˆå¯é€‰ï¼‰ï¼Œå…¶ä¸­åŒ…æ‹¬æ˜¯å¦é˜»æ­¢é»˜è®¤äº‹ä»¶ï¼Œå»¶è¿Ÿæ—¶é—´ç­‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useLongPress</span> = (<span class="params"></span></span><br><span class="line"><span class="params">  callback: (e: TouchEvent | MouseEvent) =&gt; <span class="keyword">void</span>,</span></span><br><span class="line"><span class="params">  &#123; isPreventDefault = <span class="literal">true</span>, delay = <span class="number">300</span> &#125;: Options = &#123;&#125;</span></span><br><span class="line"><span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ç”¨äºç¼“å­˜ å®šæ—¶å™¨id å’Œ ç›®æ ‡å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">const</span> timeout = useRef&lt;<span class="title class_">ReturnType</span>&lt;<span class="keyword">typeof</span> <span class="built_in">setTimeout</span>&gt;&gt;();</span><br><span class="line">  <span class="keyword">const</span> target = useRef&lt;<span class="title class_">EventTarget</span>&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°è£…ç›‘å¬è§¦æ‘¸äº‹ä»¶çš„å‡½æ•°</span></span><br><span class="line">  <span class="keyword">const</span> start = <span class="title function_">useCallback</span>(</span><br><span class="line">    <span class="function">(<span class="params">event: TouchEvent | MouseEvent</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// ç»‘å®šè§¦æ‘¸äº‹ä»¶ï¼Œå¹¶ç¼“å­˜ç›®æ ‡å¯¹è±¡</span></span><br><span class="line">      <span class="keyword">if</span> (isPreventDefault &amp;&amp; event.<span class="property">target</span>) &#123;</span><br><span class="line">        <span class="title function_">on</span>(event.<span class="property">target</span>, <span class="string">&#x27;touchend&#x27;</span>, preventDefault, &#123; <span class="attr">passive</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">        target.<span class="property">current</span> = event.<span class="property">target</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// ç¼“å­˜å®šæ—¶å™¨id</span></span><br><span class="line">      timeout.<span class="property">current</span> = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">callback</span>(event), delay);</span><br><span class="line">    &#125;,</span><br><span class="line">    [callback, delay, isPreventDefault]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°è£…è§£é™¤ç›‘å¬äº‹ä»¶çš„å‡½æ•°</span></span><br><span class="line">  <span class="keyword">const</span> clear = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    timeout.<span class="property">current</span> &amp;&amp; <span class="built_in">clearTimeout</span>(timeout.<span class="property">current</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isPreventDefault &amp;&amp; target.<span class="property">current</span>) &#123;</span><br><span class="line">      <span class="title function_">off</span>(target.<span class="property">current</span>, <span class="string">&#x27;touchend&#x27;</span>, preventDefault);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [isPreventDefault]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›çš„å¯¹è±¡å¯ä»¥ç›´æ¥è§£æ„èµ‹å€¼ç»™ç›®æ ‡å…ƒç´ </span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">onMouseDown</span>: <span class="function">(<span class="params">e: any</span>) =&gt;</span> <span class="title function_">start</span>(e),</span><br><span class="line">    <span class="attr">onTouchStart</span>: <span class="function">(<span class="params">e: any</span>) =&gt;</span> <span class="title function_">start</span>(e),</span><br><span class="line">    <span class="attr">onMouseUp</span>: clear,</span><br><span class="line">    <span class="attr">onMouseLeave</span>: clear,</span><br><span class="line">    <span class="attr">onTouchEnd</span>: clear,</span><br><span class="line">  &#125; <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useLongPress;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨ç¤ºä¾‹</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useLongPress &#125; <span class="keyword">from</span> <span class="string">&#x27;./useLongPress&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Demo</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onLongPress</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;calls callback after long pressing 300ms&#x27;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> defaultOptions = &#123;</span><br><span class="line">    <span class="attr">isPreventDefault</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">delay</span>: <span class="number">300</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> longPressEvent = <span class="title function_">useLongPress</span>(onLongPress, defaultOptions);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç›´æ¥è§£æ„èµ‹å€¼ç»™å…ƒç´ </span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> &#123;<span class="attr">...longPressEvent</span>&#125;&gt;</span>useLongPress<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="useMeasure"><a href="#useMeasure" class="headerlink" title="useMeasure"></a>useMeasure</h2><p><code>useMeasure</code>ç”¨äºæµ‹é‡ä¸€ä¸ªDOMå…ƒç´ çš„å°ºå¯¸å’Œä½ç½®ï¼Œå¹¶åœ¨å°ºå¯¸æˆ–ä½ç½®å˜åŒ–æ—¶æ›´æ–°è¿™äº›ä¿¡æ¯ã€‚è¿™ä¸ªHookä¾èµ–äº<code>ResizeObserver API</code>ï¼Œå®ƒå…è®¸ä½ ç›‘å¬ä¸€ä¸ªå…ƒç´ çš„å¤§å°å˜åŒ–ã€‚</p>
<blockquote>
<p><code>ResizeObserver</code>æ˜¯ä¸€ä¸ªå¼ºå¤§çš„Web APIï¼Œå…è®¸å¼€å‘è€…ç›‘å¬HTMLå…ƒç´ çš„å°ºå¯¸å˜åŒ–ã€‚</p>
</blockquote>
<p><strong>åŸºæœ¬ç”¨æ³•</strong></p>
<p>ä½¿ç”¨<code>ResizeObserver</code>åˆ›å»ºä¸€ä¸ªobserverå®ä¾‹ï¼Œå¹¶ç»™å®ƒæä¾›ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåœ¨è¢«è§‚å¯Ÿå…ƒç´ çš„å°ºå¯¸ä½ç½®å‘ç”Ÿå˜åŒ–æ—¶è¢«è°ƒç”¨</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> resizeObserver = <span class="keyword">new</span> <span class="title class_">ResizeObserver</span>(<span class="function"><span class="params">entries</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> entry <span class="keyword">of</span> entries) &#123;</span><br><span class="line">    <span class="comment">// ä» entry.contentRect ä¸­è·å–å…ƒç´ çš„å°ºå¯¸ä½ç½®ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">const</span> &#123; width, height &#125; = entry.<span class="property">contentRect</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Element:&#x27;</span>, entry.<span class="property">target</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Element size: <span class="subst">$&#123;width&#125;</span>px x <span class="subst">$&#123;height&#125;</span>px`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡è®¾æœ‰ä¸€ä¸ªå…ƒç´ æ˜¯è¿™æ ·çš„ï¼š&lt;div id=&quot;myElement&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="keyword">const</span> myElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;myElement&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼€å§‹è§‚å¯ŸmyElementå…ƒç´ </span></span><br><span class="line">resizeObserver.<span class="title function_">observe</span>(myElement);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// åœæ­¢è§‚å¯ŸæŸä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">resizeObserver.<span class="title function_">unobserve</span>(myElement);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœæ­¢è§‚å¯Ÿæ‰€æœ‰å…ƒç´ å¹¶é‡Šæ”¾èµ„æº</span></span><br><span class="line">resizeObserver.<span class="title function_">disconnect</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useMemo, useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isBrowser, noop &#125; <span class="keyword">from</span> <span class="string">&#x27;./misc/util&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">UseMeasureRect</span> = <span class="title class_">Pick</span>&lt;</span><br><span class="line">  <span class="title class_">DOMRectReadOnly</span>,</span><br><span class="line">  <span class="string">&#x27;x&#x27;</span> | <span class="string">&#x27;y&#x27;</span> | <span class="string">&#x27;top&#x27;</span> | <span class="string">&#x27;left&#x27;</span> | <span class="string">&#x27;right&#x27;</span> | <span class="string">&#x27;bottom&#x27;</span> | <span class="string">&#x27;height&#x27;</span> | <span class="string">&#x27;width&#x27;</span></span><br><span class="line">&gt;;</span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">UseMeasureRef</span>&lt;E <span class="keyword">extends</span> <span class="title class_">Element</span> = <span class="title class_">Element</span>&gt; = <span class="function">(<span class="params">element: E</span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">UseMeasureResult</span>&lt;E <span class="keyword">extends</span> <span class="title class_">Element</span> = <span class="title class_">Element</span>&gt; = [<span class="title class_">UseMeasureRef</span>&lt;E&gt;, <span class="title class_">UseMeasureRect</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰é»˜è®¤è®¾ç½®</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">defaultState</span>: <span class="title class_">UseMeasureRect</span> = &#123;</span><br><span class="line">  <span class="attr">x</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">y</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">width</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">height</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">top</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">left</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">bottom</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">right</span>: <span class="number">0</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> useMeasure&lt;E <span class="keyword">extends</span> <span class="title class_">Element</span> = <span class="title class_">Element</span>&gt;(): <span class="title class_">UseMeasureResult</span>&lt;E&gt; &#123;</span><br><span class="line">  <span class="comment">// elementç”¨äºå­˜å‚¨å¯¹DOMå…ƒç´ çš„å¼•ç”¨</span></span><br><span class="line">  <span class="keyword">const</span> [element, ref] = useState&lt;E | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="comment">// rectç”¨äºå­˜å‚¨æµ‹é‡çš„ç»“æœ</span></span><br><span class="line">  <span class="keyword">const</span> [rect, setRect] = useState&lt;<span class="title class_">UseMeasureRect</span>&gt;(defaultState);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ›å»ºä¸€ä¸ªç›‘å¬å™¨å‡½æ•°ï¼Œå½“è¢«ç›‘å¬å…ƒç´ å°ºå¯¸ä½ç½®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè®¾ç½®å¹¶è¿”å›æ–°çš„ä½ç½®å°ºå¯¸ä¿¡æ¯</span></span><br><span class="line">  <span class="keyword">const</span> observer = <span class="title function_">useMemo</span>(</span><br><span class="line">    <span class="function">() =&gt;</span></span><br><span class="line">      <span class="keyword">new</span> (<span class="variable language_">window</span> <span class="keyword">as</span> any).<span class="title class_">ResizeObserver</span>(<span class="function">(<span class="params">entries</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (entries[<span class="number">0</span>]) &#123;</span><br><span class="line">          <span class="keyword">const</span> &#123; x, y, width, height, top, left, bottom, right &#125; = entries[<span class="number">0</span>].<span class="property">contentRect</span>;</span><br><span class="line">          <span class="title function_">setRect</span>(&#123; x, y, width, height, top, left, bottom, right &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;),</span><br><span class="line">    []</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!element) <span class="keyword">return</span>;</span><br><span class="line">    observer.<span class="title function_">observe</span>(element);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      observer.<span class="title function_">disconnect</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [element]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›refå›è°ƒå‡½æ•° å¯ä»¥å°†å®ƒç»‘å®šåˆ°å…ƒç´ çš„refå±æ€§ä¸Šï¼ŒReactä¼šåœ¨ç»„ä»¶æŒ‚è½½æ—¶å°†DOMå…ƒç´ ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¯¥refå›è°ƒå‡½æ•°</span></span><br><span class="line">  <span class="comment">// ä»¥åŠ rectå¯¹è±¡ï¼ˆåŒ…å«äº†å…ƒç´ çš„å°ºå¯¸å’Œä½ç½®ä¿¡æ¯ï¼‰</span></span><br><span class="line">  <span class="keyword">return</span> [ref, rect];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµè§ˆå™¨å…¼å®¹æ€§å¤„ç†</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> isBrowser &amp;&amp; <span class="keyword">typeof</span> (<span class="variable language_">window</span> <span class="keyword">as</span> any).<span class="property">ResizeObserver</span> !== <span class="string">&#x27;undefined&#x27;</span></span><br><span class="line">  ? useMeasure</span><br><span class="line">  : ((<span class="function">() =&gt;</span> [noop, defaultState]) <span class="keyword">as</span> <span class="keyword">typeof</span> useMeasure);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="useMouse"><a href="#useMouse" class="headerlink" title="useMouse"></a>useMouse</h2><p><code>useMouse</code>ç”¨äºåŠ¨æ€è·Ÿè¸ªé¼ æ ‡çš„ä½ç½®</p>
<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RefObject</span>, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> useRafState <span class="keyword">from</span> <span class="string">&#x27;./useRafState&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; off, on &#125; <span class="keyword">from</span> <span class="string">&#x27;./misc/util&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">State</span> &#123;</span><br><span class="line">  <span class="attr">docX</span>: number; <span class="comment">// é¼ æ ‡çš„Xåæ ‡ç›¸å¯¹äºæ•´ä¸ªæ–‡æ¡£ï¼ˆdocumentï¼‰çš„ä½ç½®</span></span><br><span class="line">  <span class="attr">docY</span>: number; <span class="comment">// é¼ æ ‡çš„Yåæ ‡ç›¸å¯¹äºæ•´ä¸ªæ–‡æ¡£çš„ä½ç½®</span></span><br><span class="line">  <span class="attr">posX</span>: number; <span class="comment">// ç›®æ ‡å…ƒç´ çš„Xåæ ‡ç›¸å¯¹äºå…¶å®šä½ä¸Šä¸‹æ–‡ï¼ˆpositioning contextï¼‰çš„ä½ç½®</span></span><br><span class="line">  <span class="attr">posY</span>: number; <span class="comment">// ç›®æ ‡å…ƒç´ çš„Yåæ ‡ç›¸å¯¹äºå…¶å®šä½ä¸Šä¸‹æ–‡çš„ä½ç½®</span></span><br><span class="line">  <span class="attr">elX</span>: number; <span class="comment">// é¼ æ ‡çš„Xåæ ‡ç›¸å¯¹äºç›®æ ‡å…ƒç´ ï¼ˆoffset parentï¼‰çš„ä½ç½®</span></span><br><span class="line">  <span class="attr">elY</span>: number; <span class="comment">// é¼ æ ‡çš„Yåæ ‡ç›¸å¯¹äºç›®æ ‡å…ƒç´ ï¼ˆoffset parentï¼‰çš„ä½ç½®</span></span><br><span class="line">  <span class="attr">elH</span>: number; <span class="comment">// ç›®æ ‡å…ƒç´ è‡ªèº«çš„é«˜åº¦</span></span><br><span class="line">  <span class="attr">elW</span>: number; <span class="comment">// ç›®æ ‡å…ƒç´ è‡ªèº«çš„å®½åº¦</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useMouse = (<span class="attr">ref</span>: <span class="title class_">RefObject</span>&lt;<span class="title class_">Element</span>&gt;): <span class="function"><span class="params">State</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = useRafState&lt;<span class="title class_">State</span>&gt;(&#123;</span><br><span class="line">    <span class="attr">docX</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">docY</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">posX</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">posY</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">elX</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">elY</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">elH</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">elW</span>: <span class="number">0</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">moveHandler</span> = (<span class="params">event: MouseEvent</span>) =&gt; &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœå·²ç»ç»‘å®šäº†å…ƒç´ çš„refå±æ€§</span></span><br><span class="line">      <span class="keyword">if</span> (ref &amp;&amp; ref.<span class="property">current</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; left, top, <span class="attr">width</span>: elW, <span class="attr">height</span>: elH &#125; = ref.<span class="property">current</span>.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line">        <span class="comment">// window.pageXOffset è¡¨ç¤ºå½“å‰æ–‡æ¡£æ°´å¹³æ»šåŠ¨çš„è·ç¦»</span></span><br><span class="line">        <span class="keyword">const</span> posX = left + <span class="variable language_">window</span>.<span class="property">pageXOffset</span>;</span><br><span class="line">        <span class="keyword">const</span> posY = top + <span class="variable language_">window</span>.<span class="property">pageYOffset</span>;</span><br><span class="line">        <span class="keyword">const</span> elX = event.<span class="property">pageX</span> - posX;</span><br><span class="line">        <span class="keyword">const</span> elY = event.<span class="property">pageY</span> - posY;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">setState</span>(&#123;</span><br><span class="line">          <span class="attr">docX</span>: event.<span class="property">pageX</span>,</span><br><span class="line">          <span class="attr">docY</span>: event.<span class="property">pageY</span>,</span><br><span class="line">          posX,</span><br><span class="line">          posY,</span><br><span class="line">          elX,</span><br><span class="line">          elY,</span><br><span class="line">          elH,</span><br><span class="line">          elW,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">on</span>(<span class="variable language_">document</span>, <span class="string">&#x27;mousemove&#x27;</span>, moveHandler);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">off</span>(<span class="variable language_">document</span>, <span class="string">&#x27;mousemove&#x27;</span>, moveHandler);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [ref]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> state;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useMouse;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="usePageLeave"><a href="#usePageLeave" class="headerlink" title="usePageLeave"></a>usePageLeave</h2><p><code>usePageLeave</code> ç”¨äºå½“é¼ æ ‡ç¦»å¼€é¡µé¢æ—¶è§¦å‘ä¸€ä¸ªå›è°ƒ</p>
<blockquote>
<p><code>event.relatedTarget</code> å’Œ <code>event.toElement</code></p>
</blockquote>
<p>æµè§ˆå™¨é»˜è®¤äº‹ä»¶å¯¹è±¡ä¸­çš„å±æ€§ï¼Œ<code>relatedTarget</code>å±æ€§æ˜¯ä¸€ä¸ªäº‹ä»¶å±æ€§ï¼Œå®ƒåœ¨æŸäº›ç‰¹å®šçš„äº‹ä»¶ä¸­æä¾›äº†å…³äºäº‹ä»¶çš„é¢å¤–ä¸Šä¸‹æ–‡ã€‚è¿™ä¸ªå±æ€§ç‰¹åˆ«ç”¨äºé¼ æ ‡äº‹ä»¶ï¼Œæ¯”å¦‚mouseoverå’Œmouseoutï¼Œä»¥åŠç„¦ç‚¹äº‹ä»¶ï¼Œæ¯”å¦‚focusinå’Œfocusoutã€‚</p>
<p>relatedTargetå±æ€§å¼•ç”¨äº†ä¸äº‹ä»¶ç›¸å…³çš„ä¸€ä¸ªDOMå…ƒç´ </p>
<p>å¯¹äº<strong>é¼ æ ‡äº‹ä»¶</strong>ï¼š</p>
<ul>
<li>åœ¨mouseoveräº‹ä»¶ä¸­ï¼Œ<code>relatedTarget</code>å±æ€§å¼•ç”¨çš„æ˜¯é¼ æ ‡åˆšåˆšç¦»å¼€çš„é‚£ä¸ªå…ƒç´ ï¼Œå³é¼ æ ‡æŒ‡é’ˆä¹‹å‰æ‰€åœ¨çš„å…ƒç´ ã€‚</li>
<li>åœ¨mouseoutäº‹ä»¶ä¸­ï¼Œ<code>relatedTarget</code>å±æ€§å¼•ç”¨çš„æ˜¯é¼ æ ‡å³å°†ç§»åŠ¨åˆ°çš„é‚£ä¸ªå…ƒç´ ï¼Œå³é¼ æ ‡æŒ‡é’ˆå³å°†è¿›å…¥çš„å…ƒç´ ã€‚</li>
</ul>
<p>å¯¹äº<strong>ç„¦ç‚¹äº‹ä»¶</strong>ï¼š</p>
<p>åœ¨focusinï¼ˆæˆ–focusï¼‰äº‹ä»¶ä¸­ï¼Œ<code>relatedTarget</code>å±æ€§å¼•ç”¨çš„æ˜¯å¤±å»ç„¦ç‚¹çš„å…ƒç´ ï¼Œå³ç„¦ç‚¹ä»å“ªä¸ªå…ƒç´ ç§»å¼€ã€‚<br>åœ¨focusoutï¼ˆæˆ–blurï¼‰äº‹ä»¶ä¸­ï¼Œ<code>relatedTarget</code>å±æ€§å¼•ç”¨çš„æ˜¯å³å°†è·å¾—ç„¦ç‚¹çš„å…ƒç´ ï¼Œå³ç„¦ç‚¹å°†è¦ç§»åˆ°å“ªä¸ªå…ƒç´ ä¸Šã€‚</p>
<p><code>toElement</code>çš„ä½œç”¨ä¸<code>relatedTarget</code>ç›¸ä¼¼ï¼Œç‰¹åˆ«æ˜¯åœ¨mouseoverå’Œmouseoutäº‹ä»¶ä¸Šï¼Œç”¨äºå…¼å®¹æ—§ç‰ˆæœ¬æµè§ˆå™¨</p>
<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; off, on &#125; <span class="keyword">from</span> <span class="string">&#x27;./misc/util&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">usePageLeave</span> = (<span class="params">onPageLeave, args = []</span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!onPageLeave) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handler</span> = (<span class="params">event</span>) =&gt; &#123;</span><br><span class="line">      event = event ? event : (<span class="variable language_">window</span>.<span class="property">event</span> <span class="keyword">as</span> any);</span><br><span class="line">      <span class="comment">// from ä¿å­˜äº†é¼ æ ‡å³å°†ç§»åŠ¨åˆ°çš„å…ƒç´ </span></span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">from</span> = event.<span class="property">relatedTarget</span> || event.<span class="property">toElement</span>;</span><br><span class="line">      <span class="comment">// é¼ æ ‡æ˜¯å¦ç¦»å¼€æµè§ˆå™¨æ–‡æ¡£é¡µé¢æ—¶è§¦å‘å›è°ƒ</span></span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">from</span> || (<span class="keyword">from</span> <span class="keyword">as</span> any).<span class="property">nodeName</span> === <span class="string">&#x27;HTML&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_">onPageLeave</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">on</span>(<span class="variable language_">document</span>, <span class="string">&#x27;mouseout&#x27;</span>, handler);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">off</span>(<span class="variable language_">document</span>, <span class="string">&#x27;mouseout&#x27;</span>, handler);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, args);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> usePageLeave;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="useClickAway"><a href="#useClickAway" class="headerlink" title="useClickAway"></a>useClickAway</h2><p><code>useClickAway</code>ç”¨äºå½“ç”¨æˆ·åœ¨ç›®æ ‡å…ƒç´ å¤–éƒ¨å•å‡»æ—¶è§¦å‘å›è°ƒ</p>
<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RefObject</span>, useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; off, on &#125; <span class="keyword">from</span> <span class="string">&#x27;./misc/util&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultEvents = [<span class="string">&#x27;mousedown&#x27;</span>, <span class="string">&#x27;touchstart&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * refï¼šç›®æ ‡å¯¹è±¡çš„refå¼•ç”¨</span></span><br><span class="line"><span class="comment"> * onClickAwayï¼šä¼ å…¥çš„å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="comment"> * eventsï¼šéœ€è¦ç»‘å®šçš„äº‹ä»¶ç±»å‹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> useClickAway = &lt;E <span class="keyword">extends</span> <span class="title class_">Event</span> = <span class="title class_">Event</span>&gt;<span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  ref: RefObject&lt;HTMLElement | <span class="literal">null</span>&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">  onClickAway: (event: E) =&gt; <span class="keyword">void</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">  events: string[] = defaultEvents</span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ç¼“å­˜ä¼ å…¥çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">  <span class="keyword">const</span> savedCallback = <span class="title function_">useRef</span>(onClickAway);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    savedCallback.<span class="property">current</span> = onClickAway;</span><br><span class="line">  &#125;, [onClickAway]);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handler</span> = (<span class="params">event</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">current</span>: el &#125; = ref;</span><br><span class="line">      <span class="comment">// el æ˜¯å¯¹DOMå…ƒç´ çš„å¼•ç”¨</span></span><br><span class="line">      <span class="comment">// å¦‚æœ elå­˜åœ¨ å¹¶ä¸” å½“å‰è§¦å‘äº‹ä»¶çš„å…ƒç´ ä¸æ˜¯elåŠå…¶å­å­™èŠ‚ç‚¹ åˆ™ æ‰§è¡Œä¼ å…¥çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">      <span class="comment">// contains æ–¹æ³•æ˜¯ç”¨æ¥æµ‹è¯•ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯å¦ä¸€ä¸ªèŠ‚ç‚¹çš„åä»£ã€‚å¦‚æœç›®æ ‡å…ƒç´ åœ¨ el ä¹‹å¤–ï¼Œcontains æ–¹æ³•ä¼šè¿”å› falseï¼Œå–ååä¸º true</span></span><br><span class="line">      el &amp;&amp; !el.<span class="title function_">contains</span>(event.<span class="property">target</span>) &amp;&amp; savedCallback.<span class="title function_">current</span>(event);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// ç»‘å®šç”¨æˆ·ä¼ å…¥çš„æ‰€æœ‰äº‹ä»¶ç±»å‹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> eventName <span class="keyword">of</span> events) &#123;</span><br><span class="line">      <span class="title function_">on</span>(<span class="variable language_">document</span>, eventName, handler);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> eventName <span class="keyword">of</span> events) &#123;</span><br><span class="line">        <span class="title function_">off</span>(<span class="variable language_">document</span>, eventName, handler);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [events, ref]);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useClickAway;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/React-Hooks/">React Hooks</a>
    </span>
    

    </div>

    
  </div>
</article>

  









    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2024 chen qiyi
    
  </p>
</footer>
    
    
  </div>
</div>
<script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>
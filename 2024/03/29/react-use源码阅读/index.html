<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>react-use源码阅读 | easycodesniper | blog by chen qiyi</title>

  
  <meta name="author" content="chen qiyi">
  

  
  <meta name="description" content="前言React的开发离不开hooks，在社区中也有各种的hooks工具库。本篇阅读的就是react-use工具库
希望通过阅读源码，加深自己对于React Hooks的理解。
LifeCycleuseCustomCompareEffectReact的useEffect比较依赖项的规则是Object.">
  

  
  
  <meta name="keywords" content="React Hooks">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="react-use源码阅读"/>

  <meta property="og:site_name" content="easycodesniper"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="easycodesniper" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 7.1.1"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">easycodesniper</a>
    </h1>
    <p class="site-description">blog by chen qiyi</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
        <li><a href="/about">关于</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>react-use源码阅读</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2024/03/29/react-use源码阅读/" rel="bookmark">
        <time class="entry-date published" datetime="2024-03-29T13:07:05.000Z">
          2024-03-29
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>React的开发离不开hooks，在社区中也有各种的hooks工具库。本篇阅读的就是<a target="_blank" rel="noopener" href="https://github.com/streamich/react-use">react-use</a>工具库</p>
<p>希望通过阅读源码，加深自己对于React Hooks的理解。</p>
<h1 id="LifeCycle"><a href="#LifeCycle" class="headerlink" title="LifeCycle"></a>LifeCycle</h1><h2 id="useCustomCompareEffect"><a href="#useCustomCompareEffect" class="headerlink" title="useCustomCompareEffect"></a>useCustomCompareEffect</h2><p>React的<code>useEffect</code>比较依赖项的规则是<code>Object.is()</code>，它大部分情况下和<code>===</code>的效果是相同的，所以在对象或者数组的比较中，对象或数组内部属性的变化不会引起重新渲染<br><code>useCustomCompareEffect</code>Hook 用于自定义依赖项比较方法，可以定义更加复杂的比较逻辑</p>
<p>源码及解析如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">DependencyList</span>, <span class="title class_">EffectCallback</span>, useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是否是基本类型值</span></span><br><span class="line"><span class="comment">// 给Object()函数传递一个值，如果是对象或者数组，则返回该值的引用；如果是基本类型值，则把该基本类型值包装成为对应的对象类型</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isPrimitive</span> = (<span class="params">val: any</span>) =&gt; val !== <span class="title class_">Object</span>(val);</span><br><span class="line"></span><br><span class="line">type <span class="title class_">DepsEqualFnType</span>&lt;<span class="title class_">TDeps</span> <span class="keyword">extends</span> <span class="title class_">DependencyList</span>&gt; = <span class="function">(<span class="params">prevDeps: TDeps, nextDeps: TDeps</span>) =&gt;</span> boolean;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 接受三个参数</span></span><br><span class="line"><span class="comment"> * effect：副作用函数</span></span><br><span class="line"><span class="comment"> * deps：依赖项</span></span><br><span class="line"><span class="comment"> * depsEqual：自定义比较函数，该函数有两个参数，前一个依赖项 和 当前依赖项，要求返回一个boolean来表示依赖项是否发生了变化</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> useCustomCompareEffect = &lt;<span class="title class_">TDeps</span> <span class="keyword">extends</span> <span class="title class_">DependencyList</span>&gt;<span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  effect: EffectCallback,</span></span></span><br><span class="line"><span class="params"><span class="function">  deps: TDeps,</span></span></span><br><span class="line"><span class="params"><span class="function">  depsEqual: DepsEqualFnType&lt;TDeps&gt;</span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 生产环境下的一些警告提示，可以忽略</span></span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!(deps <span class="keyword">instanceof</span> <span class="title class_">Array</span>) || !deps.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">&#x27;`useCustomCompareEffect` should not be used with no dependencies. Use React.useEffect instead.&#x27;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (deps.<span class="title function_">every</span>(isPrimitive)) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">&#x27;`useCustomCompareEffect` should not be used with dependencies that are all primitive values. Use React.useEffect instead.&#x27;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> depsEqual !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">&#x27;`useCustomCompareEffect` should be used with depsEqual callback for comparing deps list&#x27;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> ref = useRef&lt;<span class="title class_">TDeps</span> | <span class="literal">undefined</span>&gt;(<span class="literal">undefined</span>); <span class="comment">//定义一个ref来存储依赖项</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  *  !ref.current 表示初次渲染</span></span><br><span class="line"><span class="comment">  *  !depsEqual(deps, ref.current) 根据自定义的比较函数来判断依赖是否发生变化</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">if</span> (!ref.<span class="property">current</span> || !<span class="title function_">depsEqual</span>(deps, ref.<span class="property">current</span>)) &#123; </span><br><span class="line">    ref.<span class="property">current</span> = deps; <span class="comment">// 当初次渲染时，或者依赖项发生变化时，ref存储新的依赖</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// useEffect依赖的并不是deps，实际依赖的是ref.current </span></span><br><span class="line">  <span class="comment">// 只有在depsEqual函数判断依赖项发生了变化，并更新ref.current之后，useEffect才会重新执行effect</span></span><br><span class="line">  <span class="title function_">useEffect</span>(effect, ref.<span class="property">current</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useCustomCompareEffect;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="useShallowCompareEffect"><a href="#useShallowCompareEffect" class="headerlink" title="useShallowCompareEffect"></a>useShallowCompareEffect</h2><p>React的<code>useEffect</code>比较依赖项的规则是<code>Object.is()</code>，它大部分情况下和<code>===</code>的效果是相同的<br><code>useShallowCompareEffect</code>Hook 会对每个依赖项进行浅比较，而不是引用相等</p>
<blockquote>
<p>浅比较<br>通常是检查对象的顶层属性是否具有相同的值和相同的引用，对于嵌套对象不进行深入比较</p>
</blockquote>
<p>源码及解析如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">DependencyList</span>, <span class="title class_">EffectCallback</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; equal <span class="keyword">as</span> isShallowEqual &#125; <span class="keyword">from</span> <span class="string">&#x27;fast-shallow-equal&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> useCustomCompareEffect <span class="keyword">from</span> <span class="string">&#x27;./useCustomCompareEffect&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是否是基本类型值</span></span><br><span class="line"><span class="comment">// 给Object()函数传递一个值，如果是对象或者数组，则返回该值的引用；如果是基本类型值，则把该基本类型值包装成为对应的对象类型</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isPrimitive</span> = (<span class="params">val: any</span>) =&gt; val !== <span class="title class_">Object</span>(val);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用第三方库，实现依赖项的浅比较</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">shallowEqualDepsList</span> = (<span class="params">prevDeps: DependencyList, nextDeps: DependencyList</span>) =&gt;</span><br><span class="line">  prevDeps.<span class="title function_">every</span>(<span class="function">(<span class="params">dep, index</span>) =&gt;</span> <span class="title function_">isShallowEqual</span>(dep, nextDeps[index]));</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 接受两个参数</span></span><br><span class="line"><span class="comment"> * effect：副作用函数</span></span><br><span class="line"><span class="comment"> * deps：依赖项</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useShallowCompareEffect</span> = (<span class="params">effect: EffectCallback, deps: DependencyList</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 生产环境下的一些警告提示，可以忽略</span></span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!(deps <span class="keyword">instanceof</span> <span class="title class_">Array</span>) || !deps.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">&#x27;`useShallowCompareEffect` should not be used with no dependencies. Use React.useEffect instead.&#x27;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (deps.<span class="title function_">every</span>(isPrimitive)) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">&#x27;`useShallowCompareEffect` should not be used with dependencies that are all primitive values. Use React.useEffect instead.&#x27;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 调用 useCustomCompareEffect , 将shallowEqualDepsList作为自定义比较方法</span></span><br><span class="line">  <span class="comment">// 实际上就是对 useCustomCompareEffect 的又一层封装</span></span><br><span class="line">  <span class="title function_">useCustomCompareEffect</span>(effect, deps, shallowEqualDepsList);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useShallowCompareEffect;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Sensors"><a href="#Sensors" class="headerlink" title="Sensors"></a>Sensors</h1><h2 id="useEvent"><a href="#useEvent" class="headerlink" title="useEvent"></a>useEvent</h2><p>用于在特定的事件目标（如 window、document 或任何实现了特定事件监听器接口的对象）上添加和移除事件监听器，它旨在在不同类型的事件目标上提供一个统一的 API</p>
<p>源码及解析如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="comment">// isBrower 判断是否是浏览器环境</span></span><br><span class="line"><span class="comment">// on off 是封装好的浏览器事件监听器添加和移除方法</span></span><br><span class="line"><span class="keyword">import</span> &#123; isBrowser, off, on &#125; <span class="keyword">from</span> <span class="string">&#x27;./misc/util&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ListenerType1 和 ListenerType2 接口定义了两种不同的事件监听模式</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">ListenerType1</span> &#123;</span><br><span class="line">  <span class="title function_">addEventListener</span>(<span class="attr">name</span>: string, <span class="attr">handler</span>: <span class="function">(<span class="params">event?: any</span>) =&gt;</span> <span class="keyword">void</span>, ...<span class="attr">args</span>: any[]);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">removeEventListener</span>(<span class="attr">name</span>: string, <span class="attr">handler</span>: <span class="function">(<span class="params">event?: any</span>) =&gt;</span> <span class="keyword">void</span>, ...<span class="attr">args</span>: any[]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">ListenerType2</span> &#123;</span><br><span class="line">  <span class="title function_">on</span>(<span class="attr">name</span>: string, <span class="attr">handler</span>: <span class="function">(<span class="params">event?: any</span>) =&gt;</span> <span class="keyword">void</span>, ...<span class="attr">args</span>: any[]);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">off</span>(<span class="attr">name</span>: string, <span class="attr">handler</span>: <span class="function">(<span class="params">event?: any</span>) =&gt;</span> <span class="keyword">void</span>, ...<span class="attr">args</span>: any[]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">UseEventTarget</span> = <span class="title class_">ListenerType1</span> | <span class="title class_">ListenerType2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isListenerType1 和 isListenerType2 用来判断目标事件对象是否有 addEventListener 或 on 属性来实现的</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isListenerType1 = (<span class="attr">target</span>: any): target is <span class="title class_">ListenerType1</span> =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> !!target.<span class="property">addEventListener</span>; <span class="comment">// !! 任何真值都会被转化成true，假值都会被转化成false</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> isListenerType2 = (<span class="attr">target</span>: any): target is <span class="title class_">ListenerType2</span> =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> !!target.<span class="property">on</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultTarget = isBrowser ? <span class="variable language_">window</span> : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 接受四个参数；</span></span><br><span class="line"><span class="comment"> * name：事件名称</span></span><br><span class="line"><span class="comment"> * handler：事件处理函数</span></span><br><span class="line"><span class="comment"> * target：事件监听器的目标对象，默认值是 defaultTarget</span></span><br><span class="line"><span class="comment"> * options：可选参数，用于传递给事件监听器的选项</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useEvent</span> = (<span class="params"></span></span><br><span class="line"><span class="params">  name,</span></span><br><span class="line"><span class="params">  handler,</span></span><br><span class="line"><span class="params">  target,</span></span><br><span class="line"><span class="params">  options?</span></span><br><span class="line"><span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!handler || !target) &#123; <span class="comment">// 如果没有传入事件处理函数或者事件对象，不做任何处理直接返回</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isListenerType1</span>(target)) &#123; <span class="comment">//如果目标对象实现的是addEventListener模式，将它手动代理成on模式来添加监听器</span></span><br><span class="line">      <span class="title function_">on</span>(target, name, handler, options);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isListenerType2</span>(target)) &#123; <span class="comment">//如果目标对象实现的是on模式，直接用on模式添加监听器</span></span><br><span class="line">      target.<span class="title function_">on</span>(name, handler, options);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123; <span class="comment">// 在组件销毁时删除事件监听</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isListenerType1</span>(target)) &#123;</span><br><span class="line">        <span class="title function_">off</span>(target, name, handler, options);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isListenerType2</span>(target)) &#123;</span><br><span class="line">        target.<span class="title function_">off</span>(name, handler, options);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [name, handler, target, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(options)]);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useEvent;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>on</code> 和 <code>off</code>函数的封装：</p>
<p>on函数接受一个可能为null的对象obj和一个参数列表args。参数列表可以是任何addEventListener方法接受的参数。函数内部会检查obj是否存在并且是否有addEventListener方法。如果条件满足，它会调用obj.addEventListener并传入args参数。<br>这个函数的主要作用是检查对象是否存在并且可以添加事件监听器，然后按照给定的参数调用addEventListener方法。这样做可以避免直接在组件内部调用addEventListener时可能遇到的null或undefined对象错误。</p>
<p>off函数同理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> on&lt;T <span class="keyword">extends</span> <span class="title class_">Window</span> | <span class="title class_">Document</span> | <span class="title class_">HTMLElement</span> | <span class="title class_">EventTarget</span>&gt;(</span><br><span class="line">  <span class="attr">obj</span>: T | <span class="literal">null</span>,</span><br><span class="line">  ...<span class="attr">args</span>: <span class="title class_">Parameters</span>&lt;T[<span class="string">&#x27;addEventListener&#x27;</span>]&gt; | [string, <span class="title class_">Function</span> | <span class="literal">null</span>, ...any]</span><br><span class="line">): <span class="keyword">void</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (obj &amp;&amp; obj.<span class="property">addEventListener</span>) &#123;</span><br><span class="line">    obj.<span class="title function_">addEventListener</span>(...(args <span class="keyword">as</span> <span class="title class_">Parameters</span>&lt;<span class="title class_">HTMLElement</span>[<span class="string">&#x27;addEventListener&#x27;</span>]&gt;));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> off&lt;T <span class="keyword">extends</span> <span class="title class_">Window</span> | <span class="title class_">Document</span> | <span class="title class_">HTMLElement</span> | <span class="title class_">EventTarget</span>&gt;(</span><br><span class="line">  <span class="attr">obj</span>: T | <span class="literal">null</span>,</span><br><span class="line">  ...<span class="attr">args</span>: <span class="title class_">Parameters</span>&lt;T[<span class="string">&#x27;removeEventListener&#x27;</span>]&gt; | [string, <span class="title class_">Function</span> | <span class="literal">null</span>, ...any]</span><br><span class="line">): <span class="keyword">void</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (obj &amp;&amp; obj.<span class="property">removeEventListener</span>) &#123;</span><br><span class="line">    obj.<span class="title function_">removeEventListener</span>(...(args <span class="keyword">as</span> <span class="title class_">Parameters</span>&lt;<span class="title class_">HTMLElement</span>[<span class="string">&#x27;removeEventListener&#x27;</span>]&gt;));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/React-Hooks/">React Hooks</a>
    </span>
    

    </div>

    
  </div>
</article>

  









    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2024 chen qiyi
    
  </p>
</footer>
    
    
  </div>
</div>
<script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>
<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>easycodesniper | blog by chen qiyi</title>

  
  <meta name="author" content="chen qiyi">
  

  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="easycodesniper"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="easycodesniper" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 7.1.1"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">easycodesniper</a>
    </h1>
    <p class="site-description">blog by chen qiyi</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">ä¸»é¡µ</a></li>
      
        <li><a href="/archives">å½’æ¡£</a></li>
      
        <li><a href="/about">å…³äº</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/2024/04/09/classnamesæºç é˜…è¯»/"><span>classnamesæºç é˜…è¯»</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2024/04/09/classnamesæºç é˜…è¯»/" rel="bookmark">
        <time class="entry-date published" datetime="2024-04-09T14:27:15.000Z">
          2024-04-09
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>**<code>classnames</code>**æ˜¯ä¸€ä¸ªJavaScriptå·¥å…·åº“ï¼Œç”¨äº æœ‰æ¡ä»¶åœ° å°†ä¸åŒçš„classç±»åç»„åˆåœ¨ä¸€èµ·</p>
<h2 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">classNames</span>(<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>); <span class="comment">// =&gt; &#x27;foo bar&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">classNames</span>(<span class="string">&#x27;foo&#x27;</span>, &#123; <span class="attr">bar</span>: <span class="literal">true</span> &#125;); <span class="comment">// =&gt; &#x27;foo bar&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">classNames</span>(&#123; <span class="string">&#x27;foo-bar&#x27;</span>: <span class="literal">true</span> &#125;); <span class="comment">// =&gt; &#x27;foo-bar&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">classNames</span>(&#123; <span class="string">&#x27;foo-bar&#x27;</span>: <span class="literal">false</span> &#125;); <span class="comment">// =&gt; &#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">classNames</span>(&#123; <span class="attr">foo</span>: <span class="literal">true</span> &#125;, &#123; <span class="attr">bar</span>: <span class="literal">true</span> &#125;); <span class="comment">// =&gt; &#x27;foo bar&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">classNames</span>(&#123; <span class="attr">foo</span>: <span class="literal">true</span>, <span class="attr">bar</span>: <span class="literal">true</span> &#125;); <span class="comment">// =&gt; &#x27;foo bar&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤šç§ä¸åŒç±»å‹çš„å‚æ•°</span></span><br><span class="line"><span class="title function_">classNames</span>(<span class="string">&#x27;foo&#x27;</span>, &#123; <span class="attr">bar</span>: <span class="literal">true</span>, <span class="attr">duck</span>: <span class="literal">false</span> &#125;, <span class="string">&#x27;baz&#x27;</span>, &#123; <span class="attr">quux</span>: <span class="literal">true</span> &#125;); <span class="comment">// =&gt; &#x27;foo bar baz quux&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡å€¼å¯¹åº”çš„ç±»åéƒ½ä¼šè¢«å¿½ç•¥</span></span><br><span class="line"><span class="title function_">classNames</span>(<span class="literal">null</span>, <span class="literal">false</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="literal">undefined</span>, <span class="number">0</span>, &#123; <span class="attr">baz</span>: <span class="literal">null</span> &#125;, <span class="string">&#x27;&#x27;</span>); <span class="comment">// =&gt; &#x27;bar&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¯æŒåŠ¨æ€ç±»å</span></span><br><span class="line"><span class="keyword">let</span> buttonType = <span class="string">&#x27;primary&#x27;</span>;</span><br><span class="line"><span class="title function_">classNames</span>(&#123; [<span class="string">`btn-<span class="subst">$&#123;buttonType&#125;</span>`</span>]: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨Reactä¸­çš„ä½¿ç”¨ï¼šå°†classNamesèµ‹å€¼ç»™å…ƒç´ çš„classNameå±æ€§å³å¯</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;classNames(...)&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h2 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–å¯¹è±¡çš„hasOwnPropertyæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºåˆ¤æ–­æŸä¸ªå±æ€§æ˜¯å¦æ˜¯å¯¹è±¡æœ¬èº«çš„ï¼Œè€Œä¸æ˜¯ç»§æ‰¿è‡ªåŸå‹é“¾</span></span><br><span class="line"><span class="keyword">const</span> hasOwn = &#123;&#125;.<span class="property">hasOwnProperty</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">classNames</span> () &#123;</span><br><span class="line">	<span class="keyword">let</span> classes = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">arguments</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">		<span class="keyword">const</span> arg = <span class="variable language_">arguments</span>[i];</span><br><span class="line">		<span class="keyword">if</span> (arg) &#123;</span><br><span class="line">			classes = <span class="title function_">appendClass</span>(classes, <span class="title function_">parseValue</span>(arg));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> classes;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">parseValue</span> (arg) &#123;</span><br><span class="line">	<span class="comment">// å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">typeof</span> arg === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> arg;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">// å¦‚æœæ—¢ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿä¸æ˜¯å¯¹è±¡å’Œæ•°ç»„ï¼Œå°±è¿”å›ç©ºå­—ç¬¦ä¸²</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">typeof</span> arg !== <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯æ•°ç»„ï¼Œè°ƒç”¨classNamesæ¥è¿”å›ä¸€ä¸ªç»„åˆå¥½çš„ç»“æœå­—ç¬¦ä¸²</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(arg)) &#123;</span><br><span class="line">		<span class="keyword">return</span> classNames.<span class="title function_">apply</span>(<span class="literal">null</span>, arg);</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">// arg.toString !== Object.prototype.toString è¡¨ç¤ºargçš„toStringæ–¹æ³•ä¸æ˜¯ç»§æ‰¿è‡ªObjectä¸Š</span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *   !arg.toString.toString().includes(&#x27;[native code]&#x27;)</span></span><br><span class="line"><span class="comment">	 *   å¦‚æœargæœ‰toStringæ–¹æ³•ï¼Œè¿›ä¸€æ­¥æ£€æŸ¥è¿™ä¸ªæ–¹æ³•æ˜¯å¦æ˜¯åŸç”Ÿçš„</span></span><br><span class="line"><span class="comment">	 *   æ–¹æ³•æ˜¯å°† arg.toString æ–¹æ³•è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œç„¶åæ£€æŸ¥å®ƒæ˜¯å¦åŒ…å«å­—ç¬¦ä¸² &#x27;[native code]&#x27;ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°çš„å­—ç¬¦ä¸²è¡¨ç¤ºä¸­åŒ…å« &#x27;[native code]&#x27;ï¼Œè¿™é€šå¸¸æ„å‘³ç€å‡½æ•°æ˜¯åŸç”Ÿæä¾›çš„ï¼Œè€Œä¸æ˜¯ç”¨æˆ·å®šä¹‰çš„ã€‚</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (arg.<span class="property">toString</span> !== <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span> &amp;&amp; !arg.<span class="property">toString</span>.<span class="title function_">toString</span>().<span class="title function_">includes</span>(<span class="string">&#x27;[native code]&#x27;</span>)) &#123;</span><br><span class="line">		<span class="keyword">return</span> arg.<span class="title function_">toString</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> classes = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¦‚æœargæ˜¯å¯¹è±¡</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> arg) &#123;</span><br><span class="line">		<span class="comment">// hasOwn åˆ¤æ–­keyæ˜¯å¦æ˜¯argå¯¹è±¡æœ¬èº«çš„å±æ€§ï¼Œè€Œä¸æ˜¯ç»§æ‰¿è‡ªåŸå‹é“¾çš„å±æ€§</span></span><br><span class="line">		<span class="comment">// arg[key] åˆ¤æ–­keyå¯¹åº”çš„å€¼æ˜¯å¦å­˜åœ¨ï¼Œä¸”ä¸ä¸ºfalse</span></span><br><span class="line">		<span class="keyword">if</span> (hasOwn.<span class="title function_">call</span>(arg, key) &amp;&amp; arg[key]) &#123;</span><br><span class="line">			classes = <span class="title function_">appendClass</span>(classes, key);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> classes;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">appendClass</span> (value, newClass) &#123;</span><br><span class="line">	<span class="keyword">if</span> (!newClass) &#123;</span><br><span class="line">		<span class="keyword">return</span> value;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> value ? (value + <span class="string">&#x27; &#x27;</span> + newClass) : newClass;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/å·¥å…·åº“-CSS/">å·¥å…·åº“ CSS</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2024/03/29/react-useæºç é˜…è¯»/"><span>react-useæºç é˜…è¯»</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2024/03/29/react-useæºç é˜…è¯»/" rel="bookmark">
        <time class="entry-date published" datetime="2024-03-29T13:07:05.000Z">
          2024-03-29
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Reactçš„å¼€å‘ç¦»ä¸å¼€hooksï¼Œåœ¨ç¤¾åŒºä¸­ä¹Ÿæœ‰å„ç§çš„hookså·¥å…·åº“ã€‚æœ¬ç¯‡é˜…è¯»çš„å°±æ˜¯<a target="_blank" rel="noopener" href="https://github.com/streamich/react-use">react-use</a>å·¥å…·åº“</p>
<p>å¸Œæœ›é€šè¿‡é˜…è¯»æºç ï¼ŒåŠ æ·±è‡ªå·±å¯¹äºReact Hookçš„ç†è§£ã€‚</p>
<h2 id="useCustomCompareEffect"><a href="#useCustomCompareEffect" class="headerlink" title="useCustomCompareEffect"></a>useCustomCompareEffect</h2><p>Reactçš„<code>useEffect</code>æ¯”è¾ƒä¾èµ–é¡¹çš„è§„åˆ™æ˜¯<code>Object.is()</code>ï¼Œå®ƒå¤§éƒ¨åˆ†æƒ…å†µä¸‹å’Œ<code>===</code>çš„æ•ˆæœæ˜¯ç›¸åŒçš„<br><code>useCustomCompareEffect</code>Hook ç”¨äºå½“ä¾èµ–é¡¹æ˜¯å¯¹è±¡æˆ–è€…æ•°ç»„æ—¶è‡ªå®šä¹‰ä¾èµ–é¡¹æ¯”è¾ƒæ–¹æ³•ï¼Œå®šä¹‰æ›´åŠ å¤æ‚çš„æ¯”è¾ƒé€»è¾‘</p>
<p>ä½¿ç”¨ç¤ºä¾‹:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useCustomCompareEffect <span class="keyword">from</span> <span class="string">&quot;./hooks/useCustomCompareEffect&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [obj, setObj] = <span class="title function_">useState</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;kyrie&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">21</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°ï¼Œåªæœ‰å½“nameå€¼å‘ç”Ÿå˜åŒ–æ˜¯é‡æ–°æ¸²æŸ“</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">depsEqual</span> = (<span class="params">newDeps, prevDeps</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> (prevDeps[<span class="number">0</span>]?.<span class="property">name</span> === newDeps[<span class="number">0</span>]?.<span class="property">name</span>) ? <span class="literal">true</span> : <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useCustomCompareEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ğŸš€~~ useCustomCompareEffect working !&#x27;</span>);</span><br><span class="line">  &#125;, depsEqual, [obj])</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>name: &#123; obj.name &#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>age: &#123; obj.age &#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setObj(&#123; ...obj, name: &#x27;easy code sniper&#x27; &#125;)&#125;&gt;ä¿®æ”¹name<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setObj(&#123; ...obj, age: 30 &#125;)&#125;&gt;ä¿®æ”¹age<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">DependencyList</span>, <span class="title class_">EffectCallback</span>, useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯åŸºæœ¬ç±»å‹å€¼ï¼Œæ˜¯åŸºæœ¬ç±»å‹å°±è¿”å›true</span></span><br><span class="line"><span class="comment">// Object()ï¼šç»™Object()å‡½æ•°ä¼ é€’ä¸€ä¸ªå€¼ï¼Œå¦‚æœæ˜¯å¯¹è±¡æˆ–è€…æ•°ç»„ï¼Œåˆ™è¿”å›è¯¥å€¼çš„å¼•ç”¨ï¼›å¦‚æœæ˜¯åŸºæœ¬ç±»å‹å€¼ï¼Œåˆ™æŠŠè¯¥åŸºæœ¬ç±»å‹å€¼åŒ…è£…æˆä¸ºå¯¹åº”çš„å¯¹è±¡ç±»å‹</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isPrimitive</span> = (<span class="params">val: any</span>) =&gt; val !== <span class="title class_">Object</span>(val);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼šæ—§çš„deps å’Œ æ–°çš„deps ï¼Œè¯¥å‡½æ•°éœ€è¦è¿”å›ä¸€ä¸ªboolå€¼æ¥è¡¨ç¤ºä¾èµ–æ˜¯å¦å‘ç”Ÿå˜åŒ–</span></span><br><span class="line">type <span class="title class_">DepsEqualFnType</span>&lt;<span class="title class_">TDeps</span> <span class="keyword">extends</span> <span class="title class_">DependencyList</span>&gt; = <span class="function">(<span class="params">prevDeps: TDeps, nextDeps: TDeps</span>) =&gt;</span> boolean;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¥å—ä¸‰ä¸ªå‚æ•°</span></span><br><span class="line"><span class="comment"> * effectï¼šå‰¯ä½œç”¨å‡½æ•°</span></span><br><span class="line"><span class="comment"> * depsï¼šä¾èµ–é¡¹</span></span><br><span class="line"><span class="comment"> * depsEqualï¼šè‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œå‰ä¸€ä¸ªä¾èµ–é¡¹ å’Œ å½“å‰ä¾èµ–é¡¹ï¼Œè¦æ±‚è¿”å›ä¸€ä¸ªbooleanæ¥è¡¨ç¤ºä¾èµ–é¡¹æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> useCustomCompareEffect = &lt;<span class="title class_">TDeps</span> <span class="keyword">extends</span> <span class="title class_">DependencyList</span>&gt;<span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  effect: EffectCallback,</span></span></span><br><span class="line"><span class="params"><span class="function">  deps: TDeps,</span></span></span><br><span class="line"><span class="params"><span class="function">  depsEqual: DepsEqualFnType&lt;TDeps&gt;</span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ç”Ÿäº§ç¯å¢ƒä¸‹çš„ä¸€äº›è­¦å‘Šæç¤ºï¼Œå¯ä»¥å¿½ç•¥</span></span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// depsä¾èµ–å¿…é¡»æœ‰</span></span><br><span class="line">    <span class="keyword">if</span> (!(deps <span class="keyword">instanceof</span> <span class="title class_">Array</span>) || !deps.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">&#x27;`useCustomCompareEffect` should not be used with no dependencies. Use React.useEffect instead.&#x27;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœæ¯ä¸€é¡¹ä¾èµ–éƒ½æ˜¯åŸºæœ¬ç±»å‹ï¼Œé‚£ä½¿ç”¨useEffectå³å¯</span></span><br><span class="line">    <span class="keyword">if</span> (deps.<span class="title function_">every</span>(isPrimitive)) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">&#x27;`useCustomCompareEffect` should not be used with dependencies that are all primitive values. Use React.useEffect instead.&#x27;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// depsEqual å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> depsEqual !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">&#x27;`useCustomCompareEffect` should be used with depsEqual callback for comparing deps list&#x27;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//å®šä¹‰ä¸€ä¸ªrefæ¥å­˜å‚¨ä¾èµ–é¡¹</span></span><br><span class="line">  <span class="keyword">const</span> ref = useRef&lt;<span class="title class_">TDeps</span> | <span class="literal">undefined</span>&gt;(<span class="literal">undefined</span>); </span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  *  !ref.current è¡¨ç¤ºåˆæ¬¡æ¸²æŸ“</span></span><br><span class="line"><span class="comment">  *  !depsEqual(deps, ref.current) æ ¹æ®è‡ªå®šä¹‰çš„æ¯”è¾ƒå‡½æ•°æ¥åˆ¤æ–­ä¾èµ–æ˜¯å¦å‘ç”Ÿå˜åŒ–</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">if</span> (!ref.<span class="property">current</span> || !<span class="title function_">depsEqual</span>(deps, ref.<span class="property">current</span>)) &#123; </span><br><span class="line">    ref.<span class="property">current</span> = deps; <span class="comment">// å½“åˆæ¬¡æ¸²æŸ“æ—¶ï¼Œæˆ–è€…ä¾èµ–é¡¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œrefå­˜å‚¨æ–°çš„ä¾èµ–</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// useEffectä¾èµ–çš„å¹¶ä¸æ˜¯depsï¼Œå®é™…ä¾èµ–çš„æ˜¯ref.current </span></span><br><span class="line">  <span class="comment">// åªæœ‰åœ¨depsEqualå‡½æ•°åˆ¤æ–­ä¾èµ–é¡¹å‘ç”Ÿäº†å˜åŒ–ï¼Œå¹¶æ›´æ–°ref.currentä¹‹åï¼ŒuseEffectæ‰ä¼šé‡æ–°æ‰§è¡Œeffect</span></span><br><span class="line">  <span class="title function_">useEffect</span>(effect, ref.<span class="property">current</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useCustomCompareEffect;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="useShallowCompareEffect"><a href="#useShallowCompareEffect" class="headerlink" title="useShallowCompareEffect"></a>useShallowCompareEffect</h2><p>Reactçš„<code>useEffect</code>æ¯”è¾ƒä¾èµ–é¡¹çš„è§„åˆ™æ˜¯<code>Object.is()</code>ï¼Œå®ƒå¤§éƒ¨åˆ†æƒ…å†µä¸‹å’Œ<code>===</code>çš„æ•ˆæœæ˜¯ç›¸åŒçš„<br><code>useShallowCompareEffect</code>Hook ä¼šå¯¹æ¯ä¸ªä¾èµ–é¡¹è¿›è¡Œæµ…æ¯”è¾ƒï¼Œè€Œä¸æ˜¯å¼•ç”¨ç›¸ç­‰</p>
<blockquote>
<p>æµ…æ¯”è¾ƒ<br>é€šå¸¸æ˜¯æ£€æŸ¥å¯¹è±¡çš„é¡¶å±‚å±æ€§æ˜¯å¦å…·æœ‰ç›¸åŒçš„å€¼å’Œç›¸åŒçš„å¼•ç”¨ï¼Œå¯¹äºåµŒå¥—å¯¹è±¡ä¸è¿›è¡Œæ·±å…¥æ¯”è¾ƒ</p>
</blockquote>
<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">DependencyList</span>, <span class="title class_">EffectCallback</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; equal <span class="keyword">as</span> isShallowEqual &#125; <span class="keyword">from</span> <span class="string">&#x27;fast-shallow-equal&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> useCustomCompareEffect <span class="keyword">from</span> <span class="string">&#x27;./useCustomCompareEffect&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯åŸºæœ¬ç±»å‹å€¼</span></span><br><span class="line"><span class="comment">// ç»™Object()å‡½æ•°ä¼ é€’ä¸€ä¸ªå€¼ï¼Œå¦‚æœæ˜¯å¯¹è±¡æˆ–è€…æ•°ç»„ï¼Œåˆ™è¿”å›è¯¥å€¼çš„å¼•ç”¨ï¼›å¦‚æœæ˜¯åŸºæœ¬ç±»å‹å€¼ï¼Œåˆ™æŠŠè¯¥åŸºæœ¬ç±»å‹å€¼åŒ…è£…æˆä¸ºå¯¹åº”çš„å¯¹è±¡ç±»å‹</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isPrimitive</span> = (<span class="params">val: any</span>) =&gt; val !== <span class="title class_">Object</span>(val);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œå®ç°ä¾èµ–é¡¹çš„æµ…æ¯”è¾ƒ</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">shallowEqualDepsList</span> = (<span class="params">prevDeps: DependencyList, nextDeps: DependencyList</span>) =&gt;</span><br><span class="line">  prevDeps.<span class="title function_">every</span>(<span class="function">(<span class="params">dep, index</span>) =&gt;</span> <span class="title function_">isShallowEqual</span>(dep, nextDeps[index]));</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¥å—ä¸¤ä¸ªå‚æ•°</span></span><br><span class="line"><span class="comment"> * effectï¼šå‰¯ä½œç”¨å‡½æ•°</span></span><br><span class="line"><span class="comment"> * depsï¼šä¾èµ–é¡¹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useShallowCompareEffect</span> = (<span class="params">effect: EffectCallback, deps: DependencyList</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// ç”Ÿäº§ç¯å¢ƒä¸‹çš„ä¸€äº›è­¦å‘Šæç¤ºï¼Œå¯ä»¥å¿½ç•¥</span></span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!(deps <span class="keyword">instanceof</span> <span class="title class_">Array</span>) || !deps.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">&#x27;`useShallowCompareEffect` should not be used with no dependencies. Use React.useEffect instead.&#x27;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (deps.<span class="title function_">every</span>(isPrimitive)) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">&#x27;`useShallowCompareEffect` should not be used with dependencies that are all primitive values. Use React.useEffect instead.&#x27;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è°ƒç”¨ useCustomCompareEffect , å°†shallowEqualDepsListä½œä¸ºè‡ªå®šä¹‰æ¯”è¾ƒæ–¹æ³•</span></span><br><span class="line">  <span class="comment">// å®é™…ä¸Šå°±æ˜¯å¯¹ useCustomCompareEffect çš„åˆä¸€å±‚å°è£…</span></span><br><span class="line">  <span class="title function_">useCustomCompareEffect</span>(effect, deps, shallowEqualDepsList);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useShallowCompareEffect;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="useEvent"><a href="#useEvent" class="headerlink" title="useEvent"></a>useEvent</h2><p>ç”¨äºåœ¨ç‰¹å®šçš„äº‹ä»¶ç›®æ ‡ï¼ˆå¦‚ windowã€document æˆ–ä»»ä½•å®ç°äº†ç‰¹å®šäº‹ä»¶ç›‘å¬å™¨æ¥å£çš„å¯¹è±¡ï¼‰ä¸Šæ·»åŠ å’Œç§»é™¤äº‹ä»¶ç›‘å¬å™¨ï¼Œå®ƒæ—¨åœ¨ åœ¨ä¸åŒç±»å‹çš„äº‹ä»¶ç›®æ ‡ä¸Š æä¾›ä¸€ä¸ªç»Ÿä¸€çš„ API</p>
<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="comment">// isBrower åˆ¤æ–­æ˜¯å¦æ˜¯æµè§ˆå™¨ç¯å¢ƒ</span></span><br><span class="line"><span class="comment">// on off æ˜¯å°è£…å¥½çš„æµè§ˆå™¨äº‹ä»¶ç›‘å¬å™¨æ·»åŠ å’Œç§»é™¤æ–¹æ³•</span></span><br><span class="line"><span class="keyword">import</span> &#123; isBrowser, off, on &#125; <span class="keyword">from</span> <span class="string">&#x27;./misc/util&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ListenerType1 å’Œ ListenerType2 æ¥å£å®šä¹‰äº†ä¸¤ç§ä¸åŒçš„äº‹ä»¶ç›‘å¬æ¨¡å¼</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">ListenerType1</span> &#123;</span><br><span class="line">  <span class="title function_">addEventListener</span>(<span class="attr">name</span>: string, <span class="attr">handler</span>: <span class="function">(<span class="params">event?: any</span>) =&gt;</span> <span class="keyword">void</span>, ...<span class="attr">args</span>: any[]);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">removeEventListener</span>(<span class="attr">name</span>: string, <span class="attr">handler</span>: <span class="function">(<span class="params">event?: any</span>) =&gt;</span> <span class="keyword">void</span>, ...<span class="attr">args</span>: any[]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">ListenerType2</span> &#123;</span><br><span class="line">  <span class="title function_">on</span>(<span class="attr">name</span>: string, <span class="attr">handler</span>: <span class="function">(<span class="params">event?: any</span>) =&gt;</span> <span class="keyword">void</span>, ...<span class="attr">args</span>: any[]);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">off</span>(<span class="attr">name</span>: string, <span class="attr">handler</span>: <span class="function">(<span class="params">event?: any</span>) =&gt;</span> <span class="keyword">void</span>, ...<span class="attr">args</span>: any[]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">UseEventTarget</span> = <span class="title class_">ListenerType1</span> | <span class="title class_">ListenerType2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isListenerType1 å’Œ isListenerType2 ç”¨æ¥åˆ¤æ–­ç›®æ ‡äº‹ä»¶å¯¹è±¡æ˜¯å¦æœ‰ addEventListener æˆ– on å±æ€§æ¥å®ç°çš„</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isListenerType1 = (<span class="attr">target</span>: any): target is <span class="title class_">ListenerType1</span> =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> !!target.<span class="property">addEventListener</span>; <span class="comment">// !! ä»»ä½•çœŸå€¼éƒ½ä¼šè¢«è½¬åŒ–æˆtrueï¼Œå‡å€¼éƒ½ä¼šè¢«è½¬åŒ–æˆfalse</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> isListenerType2 = (<span class="attr">target</span>: any): target is <span class="title class_">ListenerType2</span> =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> !!target.<span class="property">on</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultTarget = isBrowser ? <span class="variable language_">window</span> : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¥å—å››ä¸ªå‚æ•°ï¼›</span></span><br><span class="line"><span class="comment"> * nameï¼šäº‹ä»¶åç§°</span></span><br><span class="line"><span class="comment"> * handlerï¼šäº‹ä»¶å¤„ç†å‡½æ•°</span></span><br><span class="line"><span class="comment"> * targetï¼šäº‹ä»¶ç›‘å¬å™¨çš„ç›®æ ‡å¯¹è±¡ï¼Œé»˜è®¤å€¼æ˜¯ defaultTarget</span></span><br><span class="line"><span class="comment"> * optionsï¼šå¯é€‰å‚æ•°ï¼Œç”¨äºä¼ é€’ç»™äº‹ä»¶ç›‘å¬å™¨çš„é€‰é¡¹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useEvent</span> = (<span class="params"></span></span><br><span class="line"><span class="params">  name,</span></span><br><span class="line"><span class="params">  handler,</span></span><br><span class="line"><span class="params">  target,</span></span><br><span class="line"><span class="params">  options?</span></span><br><span class="line"><span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!handler || !target) &#123; <span class="comment">// å¦‚æœæ²¡æœ‰ä¼ å…¥äº‹ä»¶å¤„ç†å‡½æ•°æˆ–è€…äº‹ä»¶å¯¹è±¡ï¼Œä¸åšä»»ä½•å¤„ç†ç›´æ¥è¿”å›</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isListenerType1</span>(target)) &#123; <span class="comment">//å¦‚æœç›®æ ‡å¯¹è±¡å®ç°çš„æ˜¯addEventListeneræ¨¡å¼ï¼Œå°†å®ƒæ‰‹åŠ¨ä»£ç†æˆonæ¨¡å¼æ¥æ·»åŠ ç›‘å¬å™¨</span></span><br><span class="line">      <span class="title function_">on</span>(target, name, handler, options);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isListenerType2</span>(target)) &#123; <span class="comment">//å¦‚æœç›®æ ‡å¯¹è±¡å®ç°çš„æ˜¯onæ¨¡å¼ï¼Œç›´æ¥ç”¨onæ¨¡å¼æ·»åŠ ç›‘å¬å™¨</span></span><br><span class="line">      target.<span class="title function_">on</span>(name, handler, options);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123; <span class="comment">// åœ¨ç»„ä»¶é”€æ¯æ—¶åˆ é™¤äº‹ä»¶ç›‘å¬</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isListenerType1</span>(target)) &#123;</span><br><span class="line">        <span class="title function_">off</span>(target, name, handler, options);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isListenerType2</span>(target)) &#123;</span><br><span class="line">        target.<span class="title function_">off</span>(name, handler, options);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [name, handler, target, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(options)]);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useEvent;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>on</code> å’Œ <code>off</code>å‡½æ•°çš„å°è£…ï¼š</p>
<p>onå‡½æ•°æ¥å—ä¸€ä¸ªå¯èƒ½ä¸ºnullçš„å¯¹è±¡objå’Œä¸€ä¸ªå‚æ•°åˆ—è¡¨argsã€‚å‚æ•°åˆ—è¡¨å¯ä»¥æ˜¯ä»»ä½•addEventListeneræ–¹æ³•æ¥å—çš„å‚æ•°ã€‚å‡½æ•°å†…éƒ¨ä¼šæ£€æŸ¥objæ˜¯å¦å­˜åœ¨å¹¶ä¸”æ˜¯å¦æœ‰addEventListeneræ–¹æ³•ã€‚å¦‚æœæ¡ä»¶æ»¡è¶³ï¼Œå®ƒä¼šè°ƒç”¨obj.addEventListenerå¹¶ä¼ å…¥argså‚æ•°ã€‚<br>è¿™ä¸ªå‡½æ•°çš„ä¸»è¦ä½œç”¨æ˜¯æ£€æŸ¥å¯¹è±¡æ˜¯å¦å­˜åœ¨å¹¶ä¸”å¯ä»¥æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼Œç„¶åæŒ‰ç…§ç»™å®šçš„å‚æ•°è°ƒç”¨addEventListeneræ–¹æ³•ã€‚è¿™æ ·åšå¯ä»¥é¿å…ç›´æ¥åœ¨ç»„ä»¶å†…éƒ¨è°ƒç”¨addEventListeneræ—¶å¯èƒ½é‡åˆ°çš„nullæˆ–undefinedå¯¹è±¡é”™è¯¯ã€‚</p>
<p>offå‡½æ•°åŒç†</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> on&lt;T <span class="keyword">extends</span> <span class="title class_">Window</span> | <span class="title class_">Document</span> | <span class="title class_">HTMLElement</span> | <span class="title class_">EventTarget</span>&gt;(</span><br><span class="line">  <span class="attr">obj</span>: T | <span class="literal">null</span>,</span><br><span class="line">  ...<span class="attr">args</span>: <span class="title class_">Parameters</span>&lt;T[<span class="string">&#x27;addEventListener&#x27;</span>]&gt; | [string, <span class="title class_">Function</span> | <span class="literal">null</span>, ...any]</span><br><span class="line">): <span class="keyword">void</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (obj &amp;&amp; obj.<span class="property">addEventListener</span>) &#123;</span><br><span class="line">    obj.<span class="title function_">addEventListener</span>(...(args <span class="keyword">as</span> <span class="title class_">Parameters</span>&lt;<span class="title class_">HTMLElement</span>[<span class="string">&#x27;addEventListener&#x27;</span>]&gt;));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> off&lt;T <span class="keyword">extends</span> <span class="title class_">Window</span> | <span class="title class_">Document</span> | <span class="title class_">HTMLElement</span> | <span class="title class_">EventTarget</span>&gt;(</span><br><span class="line">  <span class="attr">obj</span>: T | <span class="literal">null</span>,</span><br><span class="line">  ...<span class="attr">args</span>: <span class="title class_">Parameters</span>&lt;T[<span class="string">&#x27;removeEventListener&#x27;</span>]&gt; | [string, <span class="title class_">Function</span> | <span class="literal">null</span>, ...any]</span><br><span class="line">): <span class="keyword">void</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (obj &amp;&amp; obj.<span class="property">removeEventListener</span>) &#123;</span><br><span class="line">    obj.<span class="title function_">removeEventListener</span>(...(args <span class="keyword">as</span> <span class="title class_">Parameters</span>&lt;<span class="title class_">HTMLElement</span>[<span class="string">&#x27;removeEventListener&#x27;</span>]&gt;));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="useGeolocation"><a href="#useGeolocation" class="headerlink" title="useGeolocation"></a>useGeolocation</h2><p>è¯¥hookç”¨äºè·å–å’Œè¿½è¸ªç”¨æˆ·çš„åœ°ç†ä½ç½®ï¼ŒåŸºäºæµè§ˆå™¨å†…ç½®å¯¹è±¡<code>navigator</code>å®ç°</p>
<p>ä½¿ç”¨ç¤ºä¾‹:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useGeolocation <span class="keyword">from</span> <span class="string">&quot;./hooks/useGeolocation&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> geolocation = <span class="title function_">useGeolocation</span>()</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(geolocation);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰è·å–ä½ç½®é”™è¯¯çš„æ¥å£</span></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">IGeolocationPositionError</span> &#123; </span><br><span class="line">  readonly <span class="attr">code</span>: number;</span><br><span class="line">  readonly <span class="attr">message</span>: string;</span><br><span class="line">  readonly <span class="attr">PERMISSION_DENIED</span>: number;</span><br><span class="line">  readonly <span class="attr">POSITION_UNAVAILABLE</span>: number;</span><br><span class="line">  readonly <span class="attr">TIMEOUT</span>: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰å½“å‰ä½ç½®ä¿¡æ¯çš„æ¥å£</span></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">GeoLocationSensorState</span> &#123; </span><br><span class="line">  <span class="attr">loading</span>: boolean; <span class="comment">//ä½ç½®ä¿¡æ¯æ˜¯å¦æ­£åœ¨åŠ è½½ä¸­</span></span><br><span class="line">  <span class="attr">accuracy</span>: number | <span class="literal">null</span>; <span class="comment">//è·å–çš„ä½ç½®çš„ç²¾ç¡®åº¦</span></span><br><span class="line">  <span class="attr">altitude</span>: number | <span class="literal">null</span>;  <span class="comment">//ç›¸å¯¹äºæµ·å¹³é¢çš„é«˜åº¦</span></span><br><span class="line">  <span class="attr">altitudeAccuracy</span>: number | <span class="literal">null</span>; <span class="comment">//é«˜åº¦çš„ç²¾ç¡®åº¦</span></span><br><span class="line">  <span class="attr">heading</span>: number | <span class="literal">null</span>; <span class="comment">//è®¾å¤‡ç§»åŠ¨æ–¹å‘</span></span><br><span class="line">  <span class="attr">latitude</span>: number | <span class="literal">null</span>; <span class="comment">//çº¬åº¦</span></span><br><span class="line">  <span class="attr">longitude</span>: number | <span class="literal">null</span>; <span class="comment">//ç»åº¦</span></span><br><span class="line">  <span class="attr">speed</span>: number | <span class="literal">null</span>; <span class="comment">//é€Ÿåº¦</span></span><br><span class="line">  <span class="attr">timestamp</span>: number | <span class="literal">null</span>; <span class="comment">//è¿™äº›ä½ç½®æ•°æ®çš„æ—¶é—´æˆ³</span></span><br><span class="line">  error?: <span class="title class_">Error</span> | <span class="title class_">IGeolocationPositionError</span>; <span class="comment">//åœ¨è·å–åœ°ç†ä½ç½®ä¿¡æ¯æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¿™é‡Œä¼šå­˜å‚¨é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">PositionOptions</span> &#123;</span><br><span class="line">    enableHighAccuracy?: boolean; <span class="comment">// æ˜¯å¦éœ€è¦é«˜ç²¾åº¦çš„ä½ç½®ä¿¡æ¯</span></span><br><span class="line">    maximumAge?: number; <span class="comment">// èƒ½æ¥å—å¤šæ—§çš„ä½ç½®ä¿¡æ¯</span></span><br><span class="line">    timeout?: number; <span class="comment">//è·å–ä½ç½®ä¿¡æ¯çš„æœ€é•¿ç­‰å¾…æ—¶é—´</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useGeolocation = (options?: <span class="title class_">PositionOptions</span>): <span class="function"><span class="params">GeoLocationSensorState</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = useState&lt;<span class="title class_">GeoLocationSensorState</span>&gt;(&#123;</span><br><span class="line">    <span class="attr">loading</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">accuracy</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">altitude</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">altitudeAccuracy</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">heading</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">latitude</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">longitude</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">speed</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">let</span> mounted = <span class="literal">true</span>; <span class="comment">// è¡¨ç¤ºç»„ä»¶æ˜¯å¦æŒ‚è½½</span></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">watchId</span>: any; <span class="comment">// è°ƒç”¨navigator.geolocation.watchPositionè¿”å›çš„idï¼Œç”¨äºåœ¨ç»„ä»¶å¸è½½æ—¶æ¸…é™¤ç›‘å¬</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½ç½®ä¿¡æ¯è¯·æ±‚æˆåŠŸçš„å›è°ƒå‡½æ•°ï¼Œnavigator.geolocation.getCurrentPositionä¼šåœ¨æˆåŠŸæ—¶ä¼ ç»™è¯¥å‡½æ•°ä¸€ä¸ªPositonå¯¹è±¡ï¼ŒåŒ…å«äº†ä½ç½®ä¿¡æ¯</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onEvent</span> = (<span class="params">event: any</span>) =&gt; &#123; </span><br><span class="line">    <span class="keyword">if</span> (mounted) &#123;</span><br><span class="line">      <span class="title function_">setState</span>(&#123;</span><br><span class="line">        <span class="attr">loading</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">accuracy</span>: event.<span class="property">coords</span>.<span class="property">accuracy</span>,</span><br><span class="line">        <span class="attr">altitude</span>: event.<span class="property">coords</span>.<span class="property">altitude</span>,</span><br><span class="line">        <span class="attr">altitudeAccuracy</span>: event.<span class="property">coords</span>.<span class="property">altitudeAccuracy</span>,</span><br><span class="line">        <span class="attr">heading</span>: event.<span class="property">coords</span>.<span class="property">heading</span>,</span><br><span class="line">        <span class="attr">latitude</span>: event.<span class="property">coords</span>.<span class="property">latitude</span>,</span><br><span class="line">        <span class="attr">longitude</span>: event.<span class="property">coords</span>.<span class="property">longitude</span>,</span><br><span class="line">        <span class="attr">speed</span>: event.<span class="property">coords</span>.<span class="property">speed</span>,</span><br><span class="line">        <span class="attr">timestamp</span>: event.<span class="property">timestamp</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½ç½®ä¿¡æ¯è¯·æ±‚å¤±è´¥çš„å›è°ƒå‡½æ•°ï¼Œnavigator.geolocation.getCurrentPositionä¼šåœ¨å¤±è´¥æ—¶ä¼ ç»™è¯¥å‡½æ•°ä¸€ä¸ªerrorå¯¹è±¡ï¼ŒåŒ…å«äº†é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onEventError</span> = (<span class="params">error: IGeolocationPositionError</span>) =&gt;</span><br><span class="line">    mounted &amp;&amp; <span class="title function_">setState</span>(<span class="function">(<span class="params">oldState</span>) =&gt;</span> (&#123; ...oldState, <span class="attr">loading</span>: <span class="literal">false</span>, error &#125;));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * navigator.geolocation.getCurrentPositionç”¨äºè·å–å½“å‰åœ°ç†ä½ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="comment">   * æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šæˆåŠŸçš„å›è°ƒã€é”™è¯¯æ—¶çš„å›è°ƒï¼ˆå¯é€‰ï¼‰ã€é€‰é¡¹å¯¹è±¡PositionOptionsï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * navigator.geolocation.watchPositionç”¨äºæ³¨å†Œä¸€ä¸ªç›‘å¬å™¨ï¼Œåœ¨ç”¨æˆ·çš„è®¾å¤‡åœ°ç†ä½ç½®å‘ç”Ÿå˜åŒ–æ—¶è¢«è°ƒç”¨ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªidï¼Œç”¨äºå–æ¶ˆç›‘å¬</span></span><br><span class="line"><span class="comment">   * æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šæˆåŠŸçš„å›è°ƒã€é”™è¯¯æ—¶çš„å›è°ƒï¼ˆå¯é€‰ï¼‰ã€é€‰é¡¹å¯¹è±¡PositionOptionsï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * navigator.geolocation.clearWatch(watchId)ç”¨äºå–æ¶ˆç›‘å¬ï¼Œä¼ å…¥ç›‘å¬å™¨id</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    navigator.<span class="property">geolocation</span>.<span class="title function_">getCurrentPosition</span>(onEvent, onEventError, options);</span><br><span class="line">    watchId = navigator.<span class="property">geolocation</span>.<span class="title function_">watchPosition</span>(onEvent, onEventError, options);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      mounted = <span class="literal">false</span>;</span><br><span class="line">      navigator.<span class="property">geolocation</span>.<span class="title function_">clearWatch</span>(watchId);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> state;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useGeolocation;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>navigatorå¯¹è±¡ æ˜¯ æµè§ˆå™¨å†…ç½®å¯¹è±¡ï¼Œå®ƒæä¾›äº†å…³äºç”¨æˆ·æµè§ˆå™¨çš„ä¿¡æ¯</p>
</blockquote>
<img src="/2024/03/29/react-use%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/image-1.png" class title="This is an image">

<h2 id="useHover"><a href="#useHover" class="headerlink" title="useHover"></a>useHover</h2><p><code>useHover</code>æä¾›ä¸€ç§ç®€å•çš„æ–¹å¼æ¥è·Ÿè¸ªé¼ æ ‡æ‚¬åœçŠ¶æ€ã€‚è¿™ä¸ªé’©å­æ¥å—ä¸€ä¸ª React å…ƒç´ æˆ–è€…ä¸€ä¸ªè¿”å› React å…ƒç´ çš„å‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«ä¸€ä¸ªå¸¦æœ‰æ‚¬åœäº‹ä»¶å¤„ç†çš„å…‹éš†å…ƒç´ ä»¥åŠä¸€ä¸ªè¡¨ç¤ºæ‚¬åœçŠ¶æ€ï¼ˆtrue æˆ– falseï¼‰çš„å¸ƒå°”å€¼ã€‚</p>
<p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useHover <span class="keyword">from</span> <span class="string">&quot;./hooks/useHover&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [ el, state ] = <span class="title function_">useHover</span>(</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onMouseEnter</span>=<span class="string">&#123;()</span> =&gt;</span> console.log(&#x27;ğŸš€~~ enter&#x27;)&#125;</span></span><br><span class="line"><span class="language-xml">      onMouseLeave=&#123;() =&gt; console.log(&#x27;ğŸš€~~ leave&#x27;)&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;æˆ‘æ˜¯ä¸€ä¸ªdiv<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;el&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;state &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>Hovered !<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// noop ä¸æ‰§è¡Œä»»ä½•æ“ä½œçš„ç©ºå‡½æ•° () =&gt; &#123;&#125;</span></span><br><span class="line"><span class="keyword">import</span> &#123; noop &#125; <span class="keyword">from</span> <span class="string">&#x27;./misc/util&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; useState &#125; = <span class="title class_">React</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰Elementæ¥å£ï¼Œè¡¨ç¤ºElementç±»å‹å¯ä»¥æ˜¯ä¸€ä¸ªReactå…ƒç´ ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ªbooleanç±»å‹çš„å‚æ•°ï¼Œå¹¶è¿”å›Reactå…ƒç´ </span></span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">Element</span> = (<span class="function">(<span class="params">state: boolean</span>) =&gt;</span> <span class="title class_">React</span>.<span class="property">ReactElement</span>&lt;any&gt;) | <span class="title class_">React</span>.<span class="property">ReactElement</span>&lt;any&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// useHover æ¥å—ä¸€ä¸ªElementç±»å‹çš„å‚æ•°</span></span><br><span class="line"><span class="keyword">const</span> useHover = (<span class="attr">element</span>: <span class="title class_">Element</span>): [<span class="title class_">React</span>.<span class="property">ReactElement</span>&lt;any&gt;, boolean] =&gt; &#123;</span><br><span class="line">  <span class="comment">// stateçŠ¶æ€ç”¨äºè¡¨ç¤ºæ˜¯å¦å¤„äºé¼ æ ‡æ‚¬åœçŠ¶æ€</span></span><br><span class="line">  <span class="keyword">const</span> [state, setState] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¥å—ä¸€ä¸ªåŸå§‹äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚</span></span><br><span class="line">  <span class="comment">// æ–°çš„äº‹ä»¶å¤„ç†å‡½æ•°é¦–å…ˆè°ƒç”¨ä¼ å…¥çš„åŸå§‹äº‹ä»¶å¤„ç†å‡½æ•°ï¼ˆå¦‚æœæ²¡æœ‰æä¾›ï¼Œåˆ™è°ƒç”¨ noopï¼‰ï¼Œç„¶åé€šè¿‡ setState æ›´æ–°æ‚¬åœçŠ¶æ€ã€‚</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onMouseEnter</span> = (<span class="params">originalOnMouseEnter?: any</span>) =&gt; <span class="function">(<span class="params">event: any</span>) =&gt;</span> &#123;</span><br><span class="line">    (originalOnMouseEnter || noop)(event);</span><br><span class="line">    <span class="title function_">setState</span>(<span class="literal">true</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onMouseLeave</span> = (<span class="params">originalOnMouseLeave?: any</span>) =&gt; <span class="function">(<span class="params">event: any</span>) =&gt;</span> &#123;</span><br><span class="line">    (originalOnMouseLeave || noop)(event);</span><br><span class="line">    <span class="title function_">setState</span>(<span class="literal">false</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¼ å…¥çš„elementæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™å°†ä»£è¡¨æ˜¯å¦hoverçš„çŠ¶æ€stateä¼ å…¥æ¥è¿”å›å¯¹åº”çš„Reactå…ƒç´ </span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> element === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    element = <span class="title function_">element</span>(state);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// element.props.onMouseEnter å’Œ element.props.onMouseLeave æ˜¯åŸå§‹å…ƒç´ ä¸Šå¯èƒ½å­˜åœ¨çš„é¼ æ ‡æ‚¬åœå’Œç¦»å¼€å‡½æ•°</span></span><br><span class="line">  <span class="keyword">const</span> el = <span class="title class_">React</span>.<span class="title function_">cloneElement</span>(element, &#123;</span><br><span class="line">    <span class="attr">onMouseEnter</span>: <span class="title function_">onMouseEnter</span>(element.<span class="property">props</span>.<span class="property">onMouseEnter</span>),</span><br><span class="line">    <span class="attr">onMouseLeave</span>: <span class="title function_">onMouseLeave</span>(element.<span class="property">props</span>.<span class="property">onMouseLeave</span>),</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›å…‹éš†çš„Reactå…ƒç´  ä»¥åŠ è¡¨ç¤ºæ‚¬æµ®çŠ¶æ€çš„state</span></span><br><span class="line">  <span class="keyword">return</span> [el, state];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useHover;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><code>React.cloneElement()</code></strong></p>
<p>å®ƒå…è®¸ä½ å…‹éš†ä¸€ä¸ªReactå…ƒç´ ï¼Œå¹¶ä¸”å¯ä»¥é€‰æ‹©æ€§çš„ä¼ å…¥propsã€å­å…ƒç´ ä»¥åŠkeyã€‚å®ƒçš„ä½œç”¨æ˜¯åŸºäºå·²æœ‰çš„Reactå…ƒç´ åˆ›å»ºä¸€ä¸ªæ–°çš„å…ƒç´ ï¼Œé»˜è®¤ä¿ç•™åŸæœ‰å…ƒç´ çš„propsã€å†…éƒ¨çŠ¶æ€å’Œè¡Œä¸º</p>
<blockquote>
<p>é»˜è®¤ä¿ç•™åŸæœ‰å…ƒç´ çš„propsã€å†…éƒ¨çŠ¶æ€å’Œè¡Œä¸º<br>å› ä¸ºåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒReactåªæ˜¯æµ…å…‹éš†äº†åŸæœ‰å…ƒç´ ï¼Œå¹¶ä¼ å…¥æ–°çš„propsã€‚åœ¨ä¸æ”¹å˜keyçš„æƒ…å†µä¸‹ï¼ŒReactä¼šè§†è¿™ä¸¤ä¸ªç»„ä»¶ä¸ºåŒä¸€ä¸ªå®ä¾‹ï¼Œè¿™å°±æ„å‘³ç€ï¼Œå³ä½¿å±æ€§å¯èƒ½æœ‰æ‰€æ”¹å˜ï¼Œä½†ç”±äºç»„ä»¶ç±»å‹å’Œ key æ²¡æœ‰å˜åŒ–ï¼ŒReactçš„é‡ç”¨é€»è¾‘ä¼šä¿ç•™ç»„ä»¶å®ä¾‹åŠå…¶å†…éƒ¨çŠ¶æ€ã€‚</p>
</blockquote>
<p>ä½¿ç”¨<code>React.cloneElement</code>å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ‰©å±•æˆ–ä¿®æ”¹ç»„ä»¶çš„å­å…ƒç´ ï¼Œè€Œä¸éœ€è¦åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ç»„ä»¶ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">React</span>.<span class="title function_">cloneElement</span>(</span><br><span class="line">  element, <span class="comment">// æƒ³è¦å…‹éš†çš„Reactå¯¹è±¡</span></span><br><span class="line">  props, <span class="comment">// å¯é€‰å‚æ•°ã€‚ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«è¦æ·»åŠ æˆ–è€…è¦†ç›–çš„æ–°å±æ€§</span></span><br><span class="line">  [...children] <span class="comment">// å¯é€‰å‚æ•°ã€‚å¯ä»¥ä¼ å…¥ä»»æ„æ•°é‡çš„å­èŠ‚ç‚¹æ¥æ›¿æ¢è¢«å…‹éš†å…ƒç´ çš„å­èŠ‚ç‚¹</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><code>React.cloneElement</code> ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">ListItem</span> = (<span class="params">&#123; children, onClick &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">onClick</span>=<span class="string">&#123;onClick&#125;</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">List</span> = (<span class="params">&#123; items &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;items.map((item, index) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        // å…‹éš†ListItemï¼Œå¹¶ä¸ºæ¯ä¸ªitemæ·»åŠ ç‰¹å®šçš„onClickå¤„ç†å™¨</span></span><br><span class="line"><span class="language-xml">        return React.cloneElement(<span class="tag">&lt;<span class="name">ListItem</span>&gt;</span>&#123;item.text&#125;<span class="tag">&lt;/<span class="name">ListItem</span>&gt;</span>, &#123;</span></span><br><span class="line"><span class="language-xml">          key: index, // å¿…é¡»æä¾›keyï¼Œç‰¹åˆ«æ˜¯åœ¨mapå¾ªç¯ä¸­</span></span><br><span class="line"><span class="language-xml">          onClick: () =&gt; alert(`Item $&#123;index + 1&#125; clicked!`), // ç»‘å®šäº†ä¸€ä¸ªå¼¹çª—äº‹ä»¶</span></span><br><span class="line"><span class="language-xml">        &#125;);</span></span><br><span class="line"><span class="language-xml">      &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨Listç»„ä»¶</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">App</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> items = [</span><br><span class="line">    &#123; <span class="attr">text</span>: <span class="string">&#x27;Item 1&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">text</span>: <span class="string">&#x27;Item 2&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">text</span>: <span class="string">&#x27;Item 3&#x27;</span> &#125;,</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">List</span> <span class="attr">items</span>=<span class="string">&#123;items&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<h2 id="useHoverDirty"><a href="#useHoverDirty" class="headerlink" title="useHoverDirty"></a>useHoverDirty</h2><p><code>useHoverDirty</code>æä¾›ä¸€ç§æ–¹å¼æ¥æ£€æµ‹ç”¨æˆ·æ˜¯å¦æ‚¬æµ®åœ¨æŸä¸ªå…ƒç´ ä¸Š</p>
<p><code>useHover</code>æ¥å—ä¸€ä¸ªReactå…ƒç´ æˆ–è€…ä¸€ä¸ªå‡½æ•°ï¼Œè€Œ<code>useHoverDirty</code>æ¥å—<code>React ref</code><br><code>useHover</code>é€šè¿‡è®¾ç½®Reactå…ƒç´ çš„<code>onMouseOver</code>å’Œ<code>onMouseOut</code>äº‹ä»¶ï¼Œè€Œ<code>useHoverDirty</code>é€šè¿‡è®¾ç½®DOMå…ƒç´ çš„<code>onMouseOver</code>å’Œ<code>onMouseOut</code>äº‹ä»¶</p>
<p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> useHoverDirty <span class="keyword">from</span> <span class="string">&#x27;./useHoverDirty&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">HoverComponent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºä¸€ä¸ªrefæ¥å¼•ç”¨æˆ‘ä»¬æƒ³è¦æ£€æµ‹æ‚¬åœçš„DOMå…ƒç´ </span></span><br><span class="line">  <span class="keyword">const</span> hoverRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="comment">// ä½¿ç”¨æˆ‘ä»¬çš„è‡ªå®šä¹‰Hookæ¥è·å–æ‚¬åœçŠ¶æ€</span></span><br><span class="line">  <span class="keyword">const</span> isHovered = <span class="title function_">useHoverDirty</span>(hoverRef);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ ¹æ®æ‚¬åœçŠ¶æ€åŠ¨æ€è®¾ç½®æ ·å¼</span></span><br><span class="line">  <span class="keyword">const</span> style = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="string">&#x27;200px&#x27;</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="string">&#x27;200px&#x27;</span>,</span><br><span class="line">    <span class="attr">backgroundColor</span>: isHovered ? <span class="string">&#x27;blue&#x27;</span> : <span class="string">&#x27;red&#x27;</span>,</span><br><span class="line">    <span class="comment">// å½“é¼ æ ‡æ‚¬åœæ—¶èƒŒæ™¯è‰²å˜è“ï¼Œå¦åˆ™ä¸ºçº¢è‰²</span></span><br><span class="line">    <span class="attr">color</span>: <span class="string">&#x27;white&#x27;</span>,</span><br><span class="line">    <span class="attr">display</span>: <span class="string">&#x27;flex&#x27;</span>,</span><br><span class="line">    <span class="attr">alignItems</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">    <span class="attr">justifyContent</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">    <span class="attr">transition</span>: <span class="string">&#x27;background-color 0.3s&#x27;</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;hoverRef&#125;</span> <span class="attr">style</span>=<span class="string">&#123;style&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;isHovered ? &#x27;Hovering&#x27; : &#x27;Not Hovering&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">HoverComponent</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RefObject</span>, useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; off, on &#125; <span class="keyword">from</span> <span class="string">&#x27;./misc/util&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ref: è¿™æ˜¯ä¸€ä¸ªReact refå¯¹è±¡ï¼ŒæŒ‡å‘è¦ç›‘å¬æ‚¬æµ®äº‹ä»¶çš„DOMå…ƒç´ ã€‚ä½¿ç”¨refæ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦ç›´æ¥æ“ä½œDOMå…ƒç´ æ¥ç»‘å®šå’Œè§£ç»‘äº‹ä»¶ç›‘å¬å™¨ã€‚</span></span><br><span class="line"><span class="comment"> * enabled: è¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºtrueã€‚å®ƒå…è®¸ä½¿ç”¨è€…å¯ç”¨æˆ–ç¦ç”¨æ‚¬æµ®ç›‘å¬åŠŸèƒ½ã€‚è¿™å¯ä»¥ç”¨æ¥åœ¨æŸäº›æ¡ä»¶ä¸‹åŠ¨æ€å¼€å¯æˆ–å…³é—­äº‹ä»¶ç›‘å¬ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useHoverDirty</span> = (<span class="params">ref: RefObject&lt;Element&gt;, enabled: boolean = <span class="literal">true</span></span>) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¼€å‘æ¨¡å¼ä¸‹çš„è­¦å‘Šï¼Œå¯ä»¥å¿½ç•¥</span></span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> ref !== <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> ref.<span class="property">current</span> === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;useHoverDirty expects a single ref argument.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ˜¯å¦å¤„äºæ‚¬æµ®çŠ¶æ€çš„state</span></span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">onMouseOver</span> = (<span class="params"></span>) =&gt; <span class="title function_">setValue</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">onMouseOut</span> = (<span class="params"></span>) =&gt; <span class="title function_">setValue</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (enabled &amp;&amp; ref &amp;&amp; ref.<span class="property">current</span>) &#123;</span><br><span class="line">      <span class="title function_">on</span>(ref.<span class="property">current</span>, <span class="string">&#x27;mouseover&#x27;</span>, onMouseOver);</span><br><span class="line">      <span class="title function_">on</span>(ref.<span class="property">current</span>, <span class="string">&#x27;mouseout&#x27;</span>, onMouseOut);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; current &#125; = ref;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (enabled &amp;&amp; current) &#123;</span><br><span class="line">        <span class="title function_">off</span>(current, <span class="string">&#x27;mouseover&#x27;</span>, onMouseOver);</span><br><span class="line">        <span class="title function_">off</span>(current, <span class="string">&#x27;mouseout&#x27;</span>, onMouseOut);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [enabled, ref]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useHoverDirty;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// onå‡½æ•° å’Œ offå‡½æ•° çš„å°è£…</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> on&lt;T <span class="keyword">extends</span> <span class="title class_">Window</span> | <span class="title class_">Document</span> | <span class="title class_">HTMLElement</span> | <span class="title class_">EventTarget</span>&gt;(</span><br><span class="line">  <span class="attr">obj</span>: T | <span class="literal">null</span>,</span><br><span class="line">  ...<span class="attr">args</span>: <span class="title class_">Parameters</span>&lt;T[<span class="string">&#x27;addEventListener&#x27;</span>]&gt; | [string, <span class="title class_">Function</span> | <span class="literal">null</span>, ...any]</span><br><span class="line">): <span class="keyword">void</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (obj &amp;&amp; obj.<span class="property">addEventListener</span>) &#123;</span><br><span class="line">    obj.<span class="title function_">addEventListener</span>(...(args <span class="keyword">as</span> <span class="title class_">Parameters</span>&lt;<span class="title class_">HTMLElement</span>[<span class="string">&#x27;addEventListener&#x27;</span>]&gt;));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> off&lt;T <span class="keyword">extends</span> <span class="title class_">Window</span> | <span class="title class_">Document</span> | <span class="title class_">HTMLElement</span> | <span class="title class_">EventTarget</span>&gt;(</span><br><span class="line">  <span class="attr">obj</span>: T | <span class="literal">null</span>,</span><br><span class="line">  ...<span class="attr">args</span>: <span class="title class_">Parameters</span>&lt;T[<span class="string">&#x27;removeEventListener&#x27;</span>]&gt; | [string, <span class="title class_">Function</span> | <span class="literal">null</span>, ...any]</span><br><span class="line">): <span class="keyword">void</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (obj &amp;&amp; obj.<span class="property">removeEventListener</span>) &#123;</span><br><span class="line">    obj.<span class="title function_">removeEventListener</span>(...(args <span class="keyword">as</span> <span class="title class_">Parameters</span>&lt;<span class="title class_">HTMLElement</span>[<span class="string">&#x27;removeEventListener&#x27;</span>]&gt;));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="useIntersection"><a href="#useIntersection" class="headerlink" title="useIntersection"></a>useIntersection</h2><p><code>useIntersection</code>ä½¿ç”¨äº†æµè§ˆå™¨çš„ Intersection Observer API æ¥å¼‚æ­¥åœ°æ£€æµ‹ç›®æ ‡å…ƒç´ ä¸å…¶ç¥–å…ˆå…ƒç´ æˆ–é¡¶çº§æ–‡æ¡£è§†å£çš„äº¤å‰çŠ¶æ€çš„å˜åŒ–ã€‚</p>
<blockquote>
<p>Intersection Observer API æ˜¯ä¸€ä¸ªæµè§ˆå™¨APIï¼Œå®ƒå…è®¸ä½ å¼‚æ­¥è§‚å¯Ÿä¸€ä¸ªå…ƒç´ ä¸å…¶ç¥–å…ˆå…ƒç´ æˆ–å…¨å±€è§†å£çš„äº¤é›†å˜åŒ–ã€‚èƒ½å¤Ÿé«˜æ•ˆå¾—è·å–å…ƒç´ æ˜¯å¦è¿›å…¥æˆ–ç¦»å¼€è§†å£çš„ä¿¡æ¯ã€‚</p>
</blockquote>
<p><strong>ç›¸å…³æ¦‚å¿µ</strong></p>
<ul>
<li><code>rootï¼ˆæ ¹ï¼‰</code>: æƒ³è¦æ£€æŸ¥ç›®æ ‡å…ƒç´ ä¸ä¹‹ç›¸äº¤çš„å®¹å™¨å…ƒç´ ï¼Œå¦‚æœæœªæŒ‡å®šæˆ–ä¸ºnullï¼Œé»˜è®¤ä¸ºæµè§ˆå™¨è§†å£</li>
<li><code>rootMarginï¼ˆæ ¹è¾¹ç•Œï¼‰</code>: ç±»ä¼¼äºCSSçš„marginå±æ€§ã€‚å®ƒå…è®¸ä½ æŒ‡å®šä¸€ä¸ªåœ¨æ ¹å…ƒç´ çš„å¤–å›´å½¢æˆçš„è¾¹æ¡†åŒºåŸŸï¼Œç”¨äºå¢åŠ æˆ–å‡å°‘ç”¨äºæ£€æŸ¥äº¤é›†çš„åŒºåŸŸå¤§å°</li>
<li><code>thresholdï¼ˆé˜ˆå€¼ï¼‰</code>: ä¸€ä¸ªæ•°å­—æˆ–ç”±å¤šä¸ªæ•°å­—ç»„æˆçš„æ•°ç»„ï¼ŒæŒ‡å®šäº†è§‚å¯Ÿè€…çš„å›è°ƒå‡½æ•°è¢«æ‰§è¡Œçš„æ¡ä»¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé˜ˆå€¼æ˜¯0.5ï¼Œåˆ™ç›®æ ‡å…ƒç´ æœ‰50%è¿›å…¥æ ¹å…ƒç´ æ—¶ï¼Œè§‚å¯Ÿè€…çš„å›è°ƒå‡½æ•°å°†è¢«æ‰§è¡Œ</li>
</ul>
<p><strong><code>IntersectionObserver()</code>æ–¹æ³•</strong>æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„ IntersectionObserver å¯¹è±¡ã€‚<br>è¿™ä¸ªæ„é€ å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªå›è°ƒå‡½æ•°å’Œä¸€ä¸ªå¯é€‰çš„é…ç½®å¯¹è±¡ã€‚</p>
<ul>
<li><p>å›è°ƒå‡½æ•°ï¼šå½“è¢«è§‚å¯Ÿçš„å…ƒç´ è¿›å…¥æˆ–é€€å‡ºäº¤é›†åŒºåŸŸæ—¶ï¼Œå›è°ƒå‡½æ•°ä¼šè¢«æ‰§è¡Œã€‚è¿™ä¸ªå‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š</p>
<ul>
<li><code>entries</code>: ä¸€ä¸ª IntersectionObserverEntry å¯¹è±¡æ•°ç»„ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æè¿°äº†ä¸€ä¸ªè¢«è§‚å¯Ÿå…ƒç´ çš„äº¤é›†çŠ¶æ€</li>
<li><code>observer</code>: å¯¹åº”çš„ IntersectionObserver å®ä¾‹ï¼Œå…è®¸ä½ è®¿é—®è§‚å¯Ÿè€…çš„å±æ€§æˆ–è°ƒç”¨å…¶æ–¹æ³•ï¼Œå¦‚ disconnect æˆ– unobserve</li>
</ul>
</li>
<li><p>é…ç½®å¯¹è±¡ï¼šåŒ…å«ä¸‰ä¸ªå±æ€§</p>
<ul>
<li>root</li>
<li>rootMargin</li>
<li>threshold</li>
</ul>
</li>
</ul>
<p><strong>Intersection Observer</strong></p>
<ul>
<li><code>root</code>: æƒ³è¦æ£€æŸ¥ç›®æ ‡å…ƒç´ ä¸ä¹‹ç›¸äº¤çš„å®¹å™¨å…ƒç´ ï¼Œå¦‚æœæœªæŒ‡å®šæˆ–ä¸ºnullï¼Œé»˜è®¤ä¸ºæµè§ˆå™¨è§†å£</li>
<li><code>rootMargin</code>: ç±»ä¼¼äºCSSçš„marginå±æ€§ã€‚å®ƒå…è®¸ä½ æŒ‡å®šä¸€ä¸ªåœ¨æ ¹å…ƒç´ çš„å¤–å›´å½¢æˆçš„è¾¹æ¡†åŒºåŸŸï¼Œç”¨äºå¢åŠ æˆ–å‡å°‘ç”¨äºæ£€æŸ¥äº¤é›†çš„åŒºåŸŸå¤§å°</li>
<li><code>thresholds</code>: ä¸€ä¸ªæ•°å­—æˆ–ç”±å¤šä¸ªæ•°å­—ç»„æˆçš„æ•°ç»„ï¼ŒæŒ‡å®šäº†è§‚å¯Ÿè€…çš„å›è°ƒå‡½æ•°è¢«æ‰§è¡Œçš„æ¡ä»¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé˜ˆå€¼æ˜¯0.5ï¼Œåˆ™ç›®æ ‡å…ƒç´ æœ‰50%è¿›å…¥æ ¹å…ƒç´ æ—¶ï¼Œè§‚å¯Ÿè€…çš„å›è°ƒå‡½æ•°å°†è¢«æ‰§è¡Œ</li>
<li><code>disconnect()</code>: åœæ­¢è§‚å¯Ÿæ‰€æœ‰ç›®æ ‡</li>
<li><code>observe(target)</code>: å¼€å§‹è§‚å¯Ÿä¸€ä¸ªç›®æ ‡å…ƒç´ </li>
<li><code>takeRecords</code>: è¿”å›æ‰€æœ‰ç›®æ ‡çš„<code>IntersectionObserverEntry</code>å¯¹è±¡æ•°ç»„</li>
<li><code>unobserve(targrt)</code>: åœæ­¢è§‚å¯Ÿä¸€ä¸ªç›®æ ‡å…ƒç´ </li>
</ul>
<p><strong>Intersection Observer Entry</strong></p>
<ul>
<li><code>boundingClientRect</code>: è¿”å›ç›®æ ‡å…ƒç´ çš„çŸ©å½¢ä¿¡æ¯ï¼Œç”¨äºè®¡ç®—ä¸è§†å£çš„äº¤é›†</li>
<li><code>intersectionRatio</code>: ç›®æ ‡å…ƒç´ <strong>å¯è§éƒ¨åˆ†</strong>å æ€»ä½“çš„æ¯”ä¾‹</li>
<li><code>intersectionRect</code>: ç›®æ ‡å…ƒç´ ä¸è§†å£<strong>äº¤å‰éƒ¨åˆ†</strong>çš„çŸ©å½¢ä¿¡æ¯</li>
<li><code>isIntersecting</code>: ç›®æ ‡å…ƒç´ æ˜¯å¦ä¸æ ¹å…ƒç´ ç›¸äº¤</li>
<li><code>rootBounds</code>: æ ¹å…ƒç´ çš„çŸ©å½¢ä¿¡æ¯</li>
<li><code>target</code>: ç›®æ ‡å…ƒç´ </li>
<li><code>time</code>: è§‚å¯Ÿåˆ°äº¤å‰çŠ¶æ€å˜åŒ–æ—¶çš„æ—¶é—´æˆ³</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯</strong></p>
<ul>
<li>æ‡’åŠ è½½ï¼šå½“å›¾ç‰‡æˆ–å…¶ä»–èµ„æºè¿›å…¥è§†å£æ—¶æ‰åŠ è½½å®ƒä»¬ï¼Œä»¥æ­¤èŠ‚çœå¸¦å®½å’Œæé«˜é¡µé¢åŠ è½½é€Ÿåº¦</li>
<li>æ— é™æ»šåŠ¨: å½“ç”¨æˆ·æ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨æ—¶ï¼Œè‡ªåŠ¨åŠ è½½æ›´å¤šå†…å®¹</li>
</ul>
<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RefObject</span>, useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * useIntersectionæ¥å—ä¸¤ä¸ªå‚æ•°</span></span><br><span class="line"><span class="comment"> * refï¼š ä¸€ä¸ªrefå¼•ç”¨å¯¹è±¡ï¼ŒæŒ‡å‘è¦è§‚å¯Ÿçš„ç›®æ ‡å…ƒç´ </span></span><br><span class="line"><span class="comment"> * optionsï¼š é…ç½®å¯¹è±¡ï¼Œç”¨äºåˆå§‹åŒ–Intersection Observerçš„é€‰é¡¹ï¼Œæ¯”å¦‚ rootã€rootMargin å’Œ threshold</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> useIntersection = (</span><br><span class="line">  <span class="attr">ref</span>: <span class="title class_">RefObject</span>&lt;<span class="title class_">HTMLElement</span>&gt;,</span><br><span class="line">  <span class="attr">options</span>: <span class="title class_">IntersectionObserverInit</span></span><br><span class="line">): <span class="title class_">IntersectionObserverEntry</span> | <span class="function"><span class="params">null</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// åˆ›å»º intersectionObserverEntry çŠ¶æ€ï¼Œç”¨äºå­˜å‚¨ intersectionObserverEntry å¯¹è±¡ä¿¡æ¯</span></span><br><span class="line">  <span class="keyword">const</span> [intersectionObserverEntry, setIntersectionObserverEntry] =</span><br><span class="line">    useState&lt;<span class="title class_">IntersectionObserverEntry</span> | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// refæ˜¯å¦å­˜åœ¨ï¼Œæµè§ˆå™¨æ˜¯å¦æ”¯æŒIntersectionObserver</span></span><br><span class="line">    <span class="keyword">if</span> (ref.<span class="property">current</span> &amp;&amp; <span class="keyword">typeof</span> <span class="title class_">IntersectionObserver</span> === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// handleå‡½æ•°ç”¨äºæ›´æ–° intersectionObserverEntry çŠ¶æ€</span></span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">handler</span> = (<span class="params">entries: IntersectionObserverEntry[]</span>) =&gt; &#123;</span><br><span class="line">        <span class="title function_">setIntersectionObserverEntry</span>(entries[<span class="number">0</span>]);</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆ›å»ºä¸€ä¸ªç›‘å¬å™¨å¯¹è±¡</span></span><br><span class="line">      <span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">IntersectionObserver</span>(handler, options);</span><br><span class="line">      <span class="comment">// ç›‘å¬ç›®æ ‡å…ƒç´ </span></span><br><span class="line">      observer.<span class="title function_">observe</span>(ref.<span class="property">current</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ç»„ä»¶é”€æ¯æ—¶å–æ¶ˆç›‘å¬ï¼Œå¹¶æ¸…ç©º intersectionObserverEntry çŠ¶æ€</span></span><br><span class="line">      <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">setIntersectionObserverEntry</span>(<span class="literal">null</span>);</span><br><span class="line">        observer.<span class="title function_">disconnect</span>();</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;&#125;;</span><br><span class="line">  &#125;, [ref.<span class="property">current</span>, options.<span class="property">threshold</span>, options.<span class="property">root</span>, options.<span class="property">rootMargin</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> intersectionObserverEntry;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useIntersection;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨ç¤ºä¾‹</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useIntersection <span class="keyword">from</span> <span class="string">&quot;./hooks/useIntersection&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> intersectionRef = <span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> intersection = <span class="title function_">useIntersection</span>(intersectionRef, &#123;</span><br><span class="line">    <span class="attr">root</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">rootMargin</span>: <span class="string">&#x27;0px&#x27;</span>,</span><br><span class="line">    <span class="attr">threshold</span>: <span class="number">1</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(intersection);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">200px</span>&#x27;, <span class="attr">height:</span> &#x27;<span class="attr">200px</span>&#x27;, <span class="attr">backgroundColor:</span> &#x27;<span class="attr">yellow</span>&#x27;, <span class="attr">overflowY:</span> &#x27;<span class="attr">scroll</span>&#x27; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">100</span>%&#x27;, <span class="attr">height:</span> &#x27;<span class="attr">200px</span>&#x27; &#125;&#125; &gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">100px</span>&#x27;, <span class="attr">height:</span> &#x27;<span class="attr">50px</span>&#x27;, <span class="attr">backgroundColor:</span> &#x27;<span class="attr">skyblue</span>&#x27; &#125;&#125; <span class="attr">ref</span>=<span class="string">&#123;intersectionRef&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;</span></span><br><span class="line"><span class="language-xml">          intersection &amp;&amp; (intersection.intersectionRatio &lt; 1)</span></span><br><span class="line"><span class="language-xml">          ? &#x27;Obscured&#x27;</span></span><br><span class="line"><span class="language-xml">          : &#x27;Full in view&#x27;</span></span><br><span class="line"><span class="language-xml">        &#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="useKey"><a href="#useKey" class="headerlink" title="useKey"></a>useKey</h2><p><code>useKey</code>ç”¨äºè®¾ç½®ç›‘å¬é”®ç›˜äº‹ä»¶</p>
<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useKey&#125; <span class="keyword">from</span> <span class="string">&#x27;react-use&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Demo</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, set] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">increment</span> = (<span class="params"></span>) =&gt; <span class="title function_">set</span>(<span class="function"><span class="params">count</span> =&gt;</span> ++count);</span><br><span class="line">  <span class="title function_">useKey</span>(<span class="string">&#x27;ArrowUp&#x27;</span>, increment);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      Press arrow up: &#123;count&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æºç åŠè§£æå¦‚ä¸‹ï¼›</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">DependencyList</span>, useMemo &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> useEvent, &#123; <span class="title class_">UseEventOptions</span>, <span class="title class_">UseEventTarget</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./useEvent&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; noop &#125; <span class="keyword">from</span> <span class="string">&#x27;./misc/util&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">KeyPredicate</span> = <span class="function">(<span class="params">event: KeyboardEvent</span>) =&gt;</span> boolean;</span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">KeyFilter</span> = <span class="literal">null</span> | <span class="literal">undefined</span> | string | (<span class="function">(<span class="params">event: KeyboardEvent</span>) =&gt;</span> boolean);</span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">Handler</span> = <span class="function">(<span class="params">event: KeyboardEvent</span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">UseKeyOptions</span>&lt;T <span class="keyword">extends</span> <span class="title class_">UseEventTarget</span>&gt; &#123;</span><br><span class="line">  event?: <span class="string">&#x27;keydown&#x27;</span> | <span class="string">&#x27;keypress&#x27;</span> | <span class="string">&#x27;keyup&#x27;</span>;</span><br><span class="line">  target?: T | <span class="literal">null</span>;</span><br><span class="line">  options?: <span class="title class_">UseEventOptions</span>&lt;T&gt;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// createKeyPredicateæ¥å—ä¸€ä¸ªå‚æ•°keyFilterï¼Œè¯¥å‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªåˆ¤æ–­å‡½æ•°ï¼ˆç”¨äºåˆ¤æ–­ä½•æ—¶ç¬¦åˆæ¡ä»¶ï¼‰ã€ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆæŒ‡å®šçš„keyboardï¼‰ æˆ–è€… undefined/null</span></span><br><span class="line"><span class="comment">// ç„¶å createKeyPredicate æ ¹æ®ä¸åŒçš„å‚æ•°æ¥åˆ›å»ºåˆ¤æ–­å‡½æ•°</span></span><br><span class="line"><span class="comment">// å¦‚æœä¼ å…¥çš„æ˜¯å‡½æ•°ï¼Œå°±è¿”å›è¿™ä¸ªå‡½æ•°</span></span><br><span class="line"><span class="comment">// å¦‚æœä¼ å…¥çš„æ˜¯å­—ç¬¦ä¸²ï¼ˆç‰¹å®šçš„keyboardï¼‰ï¼Œåˆ™å°†å®ƒåŒ…è£…æˆä¸€ä¸ªå‡½æ•°ï¼Œå½“event.key === å­—ç¬¦ä¸² æ—¶è¿”å›trueï¼Œè¡¨ç¤ºç¬¦åˆæ¡ä»¶è§¦å‘å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="comment">// å¦‚æœä¼ å…¥çš„æ˜¯undefined/nullï¼Œåˆ™åŒ…è£…ä¸€ä¸ªå›ºå®šè¿”å›falseçš„å‡½æ•°ï¼Œè¡¨ç¤ºä¸ç¬¦åˆæ¡ä»¶ä¸è§¦å‘å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> createKeyPredicate = (<span class="attr">keyFilter</span>: <span class="title class_">KeyFilter</span>): <span class="function"><span class="params">KeyPredicate</span> =&gt;</span></span><br><span class="line">  <span class="keyword">typeof</span> keyFilter === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">    ? keyFilter</span><br><span class="line">    : <span class="keyword">typeof</span> keyFilter === <span class="string">&#x27;string&#x27;</span></span><br><span class="line">    ? <span class="function">(<span class="params">event: KeyboardEvent</span>) =&gt;</span> event.<span class="property">key</span> === keyFilter</span><br><span class="line">    : keyFilter</span><br><span class="line">    ? <span class="function">() =&gt;</span> <span class="literal">true</span></span><br><span class="line">    : <span class="function">() =&gt;</span> <span class="literal">false</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key æŒ‡å®šè§¦å‘å›è°ƒçš„é”®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> fn è¦è§¦å‘çš„å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> opts é…ç½®é€‰é¡¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> deps ä¾èµ–é¡¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> useKey = &lt;T <span class="keyword">extends</span> <span class="title class_">UseEventTarget</span>&gt;<span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  key: KeyFilter,</span></span></span><br><span class="line"><span class="params"><span class="function">  fn: Handler = noop,</span></span></span><br><span class="line"><span class="params"><span class="function">  opts: UseKeyOptions&lt;T&gt; = &#123;&#125;,</span></span></span><br><span class="line"><span class="params"><span class="function">  deps: DependencyList = [key]</span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// event æŒ‡å®šæ˜¯å“ªç§é”®ç›˜äº‹ä»¶ï¼ˆkeydownï¼Œkeyupï¼Œkeypressï¼‰</span></span><br><span class="line">  <span class="comment">// target ç»‘å®šäº‹ä»¶çš„ç›®æ ‡å¯¹è±¡</span></span><br><span class="line">  <span class="comment">// options ä¼ é€’ç»™useEventçš„é…ç½®é¡¹</span></span><br><span class="line">  <span class="keyword">const</span> &#123; event = <span class="string">&#x27;keydown&#x27;</span>, target, options &#125; = opts;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åŒ…è£…åçš„å›è°ƒå‡½æ•°</span></span><br><span class="line">  <span class="keyword">const</span> useMemoHandler = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®ä¼ å…¥çš„keyå€¼åˆ›å»ºä¸€ä¸ªåˆ¤æ–­å‡½æ•°</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">predicate</span>: <span class="title class_">KeyPredicate</span> = <span class="title function_">createKeyPredicate</span>(key);</span><br><span class="line">    <span class="comment">// handlerEvent æ˜¯æµè§ˆå™¨äº‹ä»¶å¯¹è±¡ï¼Œå½“å‘ç›‘å¬å™¨æ·»åŠ äº‹ä»¶å¤„ç†å‡½æ•°æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ä¼ å…¥äº‹ä»¶å¯¹è±¡ä½œä¸ºå‚æ•°</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬å¯ä»¥é€šè¿‡eventå‚æ•°è®¿é—®åˆ°äº‹ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚è¢«æŒ‰ä¸‹çš„é”®æ˜¯ä»€ä¹ˆï¼ˆevent.keyï¼‰</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">handler</span>: <span class="title class_">Handler</span> = <span class="function">(<span class="params">handlerEvent</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// åˆ¤æ–­æ˜¯å¦ç¬¦åˆè§¦å‘å›è°ƒçš„æ¡ä»¶</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">predicate</span>(handlerEvent)) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœç¬¦åˆï¼Œå°±æ‰§è¡Œç”¨æˆ·ä¼ å…¥çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">fn</span>(handlerEvent);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> handler;</span><br><span class="line">  &#125;, deps);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è°ƒç”¨useEventæ¥ä¸ºç›®æ ‡å¯¹è±¡ç»‘å®šäº‹ä»¶</span></span><br><span class="line">  <span class="title function_">useEvent</span>(event, useMemoHandler, target, options);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useKey;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="useLongPress"><a href="#useLongPress" class="headerlink" title="useLongPress"></a>useLongPress</h2><p><code>useLongPress</code>ç”¨äºè®¾ç½®é•¿æŒ‰ä¹‹åè§¦å‘çš„å›è°ƒ</p>
<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useCallback, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; off, on &#125; <span class="keyword">from</span> <span class="string">&#x27;./misc/util&#x27;</span>;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Options</span> &#123;</span><br><span class="line">  isPreventDefault?: boolean;</span><br><span class="line">  delay?: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isTouchEvent = (<span class="attr">ev</span>: <span class="title class_">Event</span>): ev is <span class="title class_">TouchEvent</span> =&gt; &#123;</span><br><span class="line">  <span class="comment">// æ£€æŸ¥æµè§ˆå™¨ä¼ å…¥çš„äº‹ä»¶å¯¹è±¡ä¸­æ˜¯å¦æœ‰toucheså±æ€§ï¼Œå³æ˜¯å¦è§¦å‘äº†touchesäº‹ä»¶</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;touches&#x27;</span> <span class="keyword">in</span> ev;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">preventDefault</span> = (<span class="params">ev: Event</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isTouchEvent</span>(ev)) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å½“è§¦æ‘¸ç‚¹ä¸ªæ•°å°äº2ä¸ªæ—¶ï¼Œé˜»æ­¢é»˜è®¤äº‹ä»¶</span></span><br><span class="line">  <span class="keyword">if</span> (ev.<span class="property">touches</span>.<span class="property">length</span> &lt; <span class="number">2</span> &amp;&amp; ev.<span class="property">preventDefault</span>) &#123;</span><br><span class="line">    ev.<span class="title function_">preventDefault</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> callback é•¿æŒ‰ä¹‹åçš„å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> options é…ç½®é¡¹å¯¹è±¡ï¼ˆå¯é€‰ï¼‰ï¼Œå…¶ä¸­åŒ…æ‹¬æ˜¯å¦é˜»æ­¢é»˜è®¤äº‹ä»¶ï¼Œå»¶è¿Ÿæ—¶é—´ç­‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useLongPress</span> = (<span class="params"></span></span><br><span class="line"><span class="params">  callback: (e: TouchEvent | MouseEvent) =&gt; <span class="keyword">void</span>,</span></span><br><span class="line"><span class="params">  &#123; isPreventDefault = <span class="literal">true</span>, delay = <span class="number">300</span> &#125;: Options = &#123;&#125;</span></span><br><span class="line"><span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ç”¨äºç¼“å­˜ å®šæ—¶å™¨id å’Œ ç›®æ ‡å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">const</span> timeout = useRef&lt;<span class="title class_">ReturnType</span>&lt;<span class="keyword">typeof</span> <span class="built_in">setTimeout</span>&gt;&gt;();</span><br><span class="line">  <span class="keyword">const</span> target = useRef&lt;<span class="title class_">EventTarget</span>&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°è£…ç›‘å¬è§¦æ‘¸äº‹ä»¶çš„å‡½æ•°</span></span><br><span class="line">  <span class="keyword">const</span> start = <span class="title function_">useCallback</span>(</span><br><span class="line">    <span class="function">(<span class="params">event: TouchEvent | MouseEvent</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// ç»‘å®šè§¦æ‘¸äº‹ä»¶ï¼Œå¹¶ç¼“å­˜ç›®æ ‡å¯¹è±¡</span></span><br><span class="line">      <span class="keyword">if</span> (isPreventDefault &amp;&amp; event.<span class="property">target</span>) &#123;</span><br><span class="line">        <span class="title function_">on</span>(event.<span class="property">target</span>, <span class="string">&#x27;touchend&#x27;</span>, preventDefault, &#123; <span class="attr">passive</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">        target.<span class="property">current</span> = event.<span class="property">target</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// ç¼“å­˜å®šæ—¶å™¨id</span></span><br><span class="line">      timeout.<span class="property">current</span> = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">callback</span>(event), delay);</span><br><span class="line">    &#125;,</span><br><span class="line">    [callback, delay, isPreventDefault]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°è£…è§£é™¤ç›‘å¬äº‹ä»¶çš„å‡½æ•°</span></span><br><span class="line">  <span class="keyword">const</span> clear = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    timeout.<span class="property">current</span> &amp;&amp; <span class="built_in">clearTimeout</span>(timeout.<span class="property">current</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isPreventDefault &amp;&amp; target.<span class="property">current</span>) &#123;</span><br><span class="line">      <span class="title function_">off</span>(target.<span class="property">current</span>, <span class="string">&#x27;touchend&#x27;</span>, preventDefault);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [isPreventDefault]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›çš„å¯¹è±¡å¯ä»¥ç›´æ¥è§£æ„èµ‹å€¼ç»™ç›®æ ‡å…ƒç´ </span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">onMouseDown</span>: <span class="function">(<span class="params">e: any</span>) =&gt;</span> <span class="title function_">start</span>(e),</span><br><span class="line">    <span class="attr">onTouchStart</span>: <span class="function">(<span class="params">e: any</span>) =&gt;</span> <span class="title function_">start</span>(e),</span><br><span class="line">    <span class="attr">onMouseUp</span>: clear,</span><br><span class="line">    <span class="attr">onMouseLeave</span>: clear,</span><br><span class="line">    <span class="attr">onTouchEnd</span>: clear,</span><br><span class="line">  &#125; <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useLongPress;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨ç¤ºä¾‹</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useLongPress &#125; <span class="keyword">from</span> <span class="string">&#x27;./useLongPress&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Demo</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onLongPress</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;calls callback after long pressing 300ms&#x27;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> defaultOptions = &#123;</span><br><span class="line">    <span class="attr">isPreventDefault</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">delay</span>: <span class="number">300</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> longPressEvent = <span class="title function_">useLongPress</span>(onLongPress, defaultOptions);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç›´æ¥è§£æ„èµ‹å€¼ç»™å…ƒç´ </span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> &#123;<span class="attr">...longPressEvent</span>&#125;&gt;</span>useLongPress<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="useMeasure"><a href="#useMeasure" class="headerlink" title="useMeasure"></a>useMeasure</h2><p><code>useMeasure</code>ç”¨äºæµ‹é‡ä¸€ä¸ªDOMå…ƒç´ çš„å°ºå¯¸å’Œä½ç½®ï¼Œå¹¶åœ¨å°ºå¯¸æˆ–ä½ç½®å˜åŒ–æ—¶æ›´æ–°è¿™äº›ä¿¡æ¯ã€‚è¿™ä¸ªHookä¾èµ–äº<code>ResizeObserver API</code>ï¼Œå®ƒå…è®¸ä½ ç›‘å¬ä¸€ä¸ªå…ƒç´ çš„å¤§å°å˜åŒ–ã€‚</p>
<blockquote>
<p><code>ResizeObserver</code>æ˜¯ä¸€ä¸ªå¼ºå¤§çš„Web APIï¼Œå…è®¸å¼€å‘è€…ç›‘å¬HTMLå…ƒç´ çš„å°ºå¯¸å˜åŒ–ã€‚</p>
</blockquote>
<p><strong>åŸºæœ¬ç”¨æ³•</strong></p>
<p>ä½¿ç”¨<code>ResizeObserver</code>åˆ›å»ºä¸€ä¸ªobserverå®ä¾‹ï¼Œå¹¶ç»™å®ƒæä¾›ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåœ¨è¢«è§‚å¯Ÿå…ƒç´ çš„å°ºå¯¸ä½ç½®å‘ç”Ÿå˜åŒ–æ—¶è¢«è°ƒç”¨</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> resizeObserver = <span class="keyword">new</span> <span class="title class_">ResizeObserver</span>(<span class="function"><span class="params">entries</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> entry <span class="keyword">of</span> entries) &#123;</span><br><span class="line">    <span class="comment">// ä» entry.contentRect ä¸­è·å–å…ƒç´ çš„å°ºå¯¸ä½ç½®ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">const</span> &#123; width, height &#125; = entry.<span class="property">contentRect</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Element:&#x27;</span>, entry.<span class="property">target</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Element size: <span class="subst">$&#123;width&#125;</span>px x <span class="subst">$&#123;height&#125;</span>px`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡è®¾æœ‰ä¸€ä¸ªå…ƒç´ æ˜¯è¿™æ ·çš„ï¼š&lt;div id=&quot;myElement&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="keyword">const</span> myElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;myElement&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼€å§‹è§‚å¯ŸmyElementå…ƒç´ </span></span><br><span class="line">resizeObserver.<span class="title function_">observe</span>(myElement);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// åœæ­¢è§‚å¯ŸæŸä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">resizeObserver.<span class="title function_">unobserve</span>(myElement);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœæ­¢è§‚å¯Ÿæ‰€æœ‰å…ƒç´ å¹¶é‡Šæ”¾èµ„æº</span></span><br><span class="line">resizeObserver.<span class="title function_">disconnect</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useMemo, useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isBrowser, noop &#125; <span class="keyword">from</span> <span class="string">&#x27;./misc/util&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">UseMeasureRect</span> = <span class="title class_">Pick</span>&lt;</span><br><span class="line">  <span class="title class_">DOMRectReadOnly</span>,</span><br><span class="line">  <span class="string">&#x27;x&#x27;</span> | <span class="string">&#x27;y&#x27;</span> | <span class="string">&#x27;top&#x27;</span> | <span class="string">&#x27;left&#x27;</span> | <span class="string">&#x27;right&#x27;</span> | <span class="string">&#x27;bottom&#x27;</span> | <span class="string">&#x27;height&#x27;</span> | <span class="string">&#x27;width&#x27;</span></span><br><span class="line">&gt;;</span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">UseMeasureRef</span>&lt;E <span class="keyword">extends</span> <span class="title class_">Element</span> = <span class="title class_">Element</span>&gt; = <span class="function">(<span class="params">element: E</span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">UseMeasureResult</span>&lt;E <span class="keyword">extends</span> <span class="title class_">Element</span> = <span class="title class_">Element</span>&gt; = [<span class="title class_">UseMeasureRef</span>&lt;E&gt;, <span class="title class_">UseMeasureRect</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰é»˜è®¤è®¾ç½®</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">defaultState</span>: <span class="title class_">UseMeasureRect</span> = &#123;</span><br><span class="line">  <span class="attr">x</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">y</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">width</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">height</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">top</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">left</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">bottom</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">right</span>: <span class="number">0</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> useMeasure&lt;E <span class="keyword">extends</span> <span class="title class_">Element</span> = <span class="title class_">Element</span>&gt;(): <span class="title class_">UseMeasureResult</span>&lt;E&gt; &#123;</span><br><span class="line">  <span class="comment">// elementç”¨äºå­˜å‚¨å¯¹DOMå…ƒç´ çš„å¼•ç”¨</span></span><br><span class="line">  <span class="keyword">const</span> [element, ref] = useState&lt;E | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="comment">// rectç”¨äºå­˜å‚¨æµ‹é‡çš„ç»“æœ</span></span><br><span class="line">  <span class="keyword">const</span> [rect, setRect] = useState&lt;<span class="title class_">UseMeasureRect</span>&gt;(defaultState);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ›å»ºä¸€ä¸ªç›‘å¬å™¨å‡½æ•°ï¼Œå½“è¢«ç›‘å¬å…ƒç´ å°ºå¯¸ä½ç½®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè®¾ç½®å¹¶è¿”å›æ–°çš„ä½ç½®å°ºå¯¸ä¿¡æ¯</span></span><br><span class="line">  <span class="keyword">const</span> observer = <span class="title function_">useMemo</span>(</span><br><span class="line">    <span class="function">() =&gt;</span></span><br><span class="line">      <span class="keyword">new</span> (<span class="variable language_">window</span> <span class="keyword">as</span> any).<span class="title class_">ResizeObserver</span>(<span class="function">(<span class="params">entries</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (entries[<span class="number">0</span>]) &#123;</span><br><span class="line">          <span class="keyword">const</span> &#123; x, y, width, height, top, left, bottom, right &#125; = entries[<span class="number">0</span>].<span class="property">contentRect</span>;</span><br><span class="line">          <span class="title function_">setRect</span>(&#123; x, y, width, height, top, left, bottom, right &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;),</span><br><span class="line">    []</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!element) <span class="keyword">return</span>;</span><br><span class="line">    observer.<span class="title function_">observe</span>(element);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      observer.<span class="title function_">disconnect</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [element]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›refå›è°ƒå‡½æ•° å¯ä»¥å°†å®ƒç»‘å®šåˆ°å…ƒç´ çš„refå±æ€§ä¸Šï¼ŒReactä¼šåœ¨ç»„ä»¶æŒ‚è½½æ—¶å°†DOMå…ƒç´ ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¯¥refå›è°ƒå‡½æ•°</span></span><br><span class="line">  <span class="comment">// ä»¥åŠ rectå¯¹è±¡ï¼ˆåŒ…å«äº†å…ƒç´ çš„å°ºå¯¸å’Œä½ç½®ä¿¡æ¯ï¼‰</span></span><br><span class="line">  <span class="keyword">return</span> [ref, rect];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµè§ˆå™¨å…¼å®¹æ€§å¤„ç†</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> isBrowser &amp;&amp; <span class="keyword">typeof</span> (<span class="variable language_">window</span> <span class="keyword">as</span> any).<span class="property">ResizeObserver</span> !== <span class="string">&#x27;undefined&#x27;</span></span><br><span class="line">  ? useMeasure</span><br><span class="line">  : ((<span class="function">() =&gt;</span> [noop, defaultState]) <span class="keyword">as</span> <span class="keyword">typeof</span> useMeasure);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="useMouse"><a href="#useMouse" class="headerlink" title="useMouse"></a>useMouse</h2><p><code>useMouse</code>ç”¨äºåŠ¨æ€è·Ÿè¸ªé¼ æ ‡çš„ä½ç½®</p>
<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RefObject</span>, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> useRafState <span class="keyword">from</span> <span class="string">&#x27;./useRafState&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; off, on &#125; <span class="keyword">from</span> <span class="string">&#x27;./misc/util&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">State</span> &#123;</span><br><span class="line">  <span class="attr">docX</span>: number; <span class="comment">// é¼ æ ‡çš„Xåæ ‡ç›¸å¯¹äºæ•´ä¸ªæ–‡æ¡£ï¼ˆdocumentï¼‰çš„ä½ç½®</span></span><br><span class="line">  <span class="attr">docY</span>: number; <span class="comment">// é¼ æ ‡çš„Yåæ ‡ç›¸å¯¹äºæ•´ä¸ªæ–‡æ¡£çš„ä½ç½®</span></span><br><span class="line">  <span class="attr">posX</span>: number; <span class="comment">// ç›®æ ‡å…ƒç´ çš„Xåæ ‡ç›¸å¯¹äºå…¶å®šä½ä¸Šä¸‹æ–‡ï¼ˆpositioning contextï¼‰çš„ä½ç½®</span></span><br><span class="line">  <span class="attr">posY</span>: number; <span class="comment">// ç›®æ ‡å…ƒç´ çš„Yåæ ‡ç›¸å¯¹äºå…¶å®šä½ä¸Šä¸‹æ–‡çš„ä½ç½®</span></span><br><span class="line">  <span class="attr">elX</span>: number; <span class="comment">// é¼ æ ‡çš„Xåæ ‡ç›¸å¯¹äºç›®æ ‡å…ƒç´ ï¼ˆoffset parentï¼‰çš„ä½ç½®</span></span><br><span class="line">  <span class="attr">elY</span>: number; <span class="comment">// é¼ æ ‡çš„Yåæ ‡ç›¸å¯¹äºç›®æ ‡å…ƒç´ ï¼ˆoffset parentï¼‰çš„ä½ç½®</span></span><br><span class="line">  <span class="attr">elH</span>: number; <span class="comment">// ç›®æ ‡å…ƒç´ è‡ªèº«çš„é«˜åº¦</span></span><br><span class="line">  <span class="attr">elW</span>: number; <span class="comment">// ç›®æ ‡å…ƒç´ è‡ªèº«çš„å®½åº¦</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useMouse = (<span class="attr">ref</span>: <span class="title class_">RefObject</span>&lt;<span class="title class_">Element</span>&gt;): <span class="function"><span class="params">State</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = useRafState&lt;<span class="title class_">State</span>&gt;(&#123;</span><br><span class="line">    <span class="attr">docX</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">docY</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">posX</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">posY</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">elX</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">elY</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">elH</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">elW</span>: <span class="number">0</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">moveHandler</span> = (<span class="params">event: MouseEvent</span>) =&gt; &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœå·²ç»ç»‘å®šäº†å…ƒç´ çš„refå±æ€§</span></span><br><span class="line">      <span class="keyword">if</span> (ref &amp;&amp; ref.<span class="property">current</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; left, top, <span class="attr">width</span>: elW, <span class="attr">height</span>: elH &#125; = ref.<span class="property">current</span>.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line">        <span class="comment">// window.pageXOffset è¡¨ç¤ºå½“å‰æ–‡æ¡£æ°´å¹³æ»šåŠ¨çš„è·ç¦»</span></span><br><span class="line">        <span class="keyword">const</span> posX = left + <span class="variable language_">window</span>.<span class="property">pageXOffset</span>;</span><br><span class="line">        <span class="keyword">const</span> posY = top + <span class="variable language_">window</span>.<span class="property">pageYOffset</span>;</span><br><span class="line">        <span class="keyword">const</span> elX = event.<span class="property">pageX</span> - posX;</span><br><span class="line">        <span class="keyword">const</span> elY = event.<span class="property">pageY</span> - posY;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">setState</span>(&#123;</span><br><span class="line">          <span class="attr">docX</span>: event.<span class="property">pageX</span>,</span><br><span class="line">          <span class="attr">docY</span>: event.<span class="property">pageY</span>,</span><br><span class="line">          posX,</span><br><span class="line">          posY,</span><br><span class="line">          elX,</span><br><span class="line">          elY,</span><br><span class="line">          elH,</span><br><span class="line">          elW,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">on</span>(<span class="variable language_">document</span>, <span class="string">&#x27;mousemove&#x27;</span>, moveHandler);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">off</span>(<span class="variable language_">document</span>, <span class="string">&#x27;mousemove&#x27;</span>, moveHandler);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [ref]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> state;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useMouse;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="usePageLeave"><a href="#usePageLeave" class="headerlink" title="usePageLeave"></a>usePageLeave</h2><p><code>usePageLeave</code> ç”¨äºå½“é¼ æ ‡ç¦»å¼€é¡µé¢æ—¶è§¦å‘ä¸€ä¸ªå›è°ƒ</p>
<blockquote>
<p><code>event.relatedTarget</code> å’Œ <code>event.toElement</code></p>
</blockquote>
<p>æµè§ˆå™¨é»˜è®¤äº‹ä»¶å¯¹è±¡ä¸­çš„å±æ€§ï¼Œ<code>relatedTarget</code>å±æ€§æ˜¯ä¸€ä¸ªäº‹ä»¶å±æ€§ï¼Œå®ƒåœ¨æŸäº›ç‰¹å®šçš„äº‹ä»¶ä¸­æä¾›äº†å…³äºäº‹ä»¶çš„é¢å¤–ä¸Šä¸‹æ–‡ã€‚è¿™ä¸ªå±æ€§ç‰¹åˆ«ç”¨äºé¼ æ ‡äº‹ä»¶ï¼Œæ¯”å¦‚mouseoverå’Œmouseoutï¼Œä»¥åŠç„¦ç‚¹äº‹ä»¶ï¼Œæ¯”å¦‚focusinå’Œfocusoutã€‚</p>
<p>relatedTargetå±æ€§å¼•ç”¨äº†ä¸äº‹ä»¶ç›¸å…³çš„ä¸€ä¸ªDOMå…ƒç´ </p>
<p>å¯¹äº<strong>é¼ æ ‡äº‹ä»¶</strong>ï¼š</p>
<ul>
<li>åœ¨mouseoveräº‹ä»¶ä¸­ï¼Œ<code>relatedTarget</code>å±æ€§å¼•ç”¨çš„æ˜¯é¼ æ ‡åˆšåˆšç¦»å¼€çš„é‚£ä¸ªå…ƒç´ ï¼Œå³é¼ æ ‡æŒ‡é’ˆä¹‹å‰æ‰€åœ¨çš„å…ƒç´ ã€‚</li>
<li>åœ¨mouseoutäº‹ä»¶ä¸­ï¼Œ<code>relatedTarget</code>å±æ€§å¼•ç”¨çš„æ˜¯é¼ æ ‡å³å°†ç§»åŠ¨åˆ°çš„é‚£ä¸ªå…ƒç´ ï¼Œå³é¼ æ ‡æŒ‡é’ˆå³å°†è¿›å…¥çš„å…ƒç´ ã€‚</li>
</ul>
<p>å¯¹äº<strong>ç„¦ç‚¹äº‹ä»¶</strong>ï¼š</p>
<p>åœ¨focusinï¼ˆæˆ–focusï¼‰äº‹ä»¶ä¸­ï¼Œ<code>relatedTarget</code>å±æ€§å¼•ç”¨çš„æ˜¯å¤±å»ç„¦ç‚¹çš„å…ƒç´ ï¼Œå³ç„¦ç‚¹ä»å“ªä¸ªå…ƒç´ ç§»å¼€ã€‚<br>åœ¨focusoutï¼ˆæˆ–blurï¼‰äº‹ä»¶ä¸­ï¼Œ<code>relatedTarget</code>å±æ€§å¼•ç”¨çš„æ˜¯å³å°†è·å¾—ç„¦ç‚¹çš„å…ƒç´ ï¼Œå³ç„¦ç‚¹å°†è¦ç§»åˆ°å“ªä¸ªå…ƒç´ ä¸Šã€‚</p>
<p><code>toElement</code>çš„ä½œç”¨ä¸<code>relatedTarget</code>ç›¸ä¼¼ï¼Œç‰¹åˆ«æ˜¯åœ¨mouseoverå’Œmouseoutäº‹ä»¶ä¸Šï¼Œç”¨äºå…¼å®¹æ—§ç‰ˆæœ¬æµè§ˆå™¨</p>
<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; off, on &#125; <span class="keyword">from</span> <span class="string">&#x27;./misc/util&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">usePageLeave</span> = (<span class="params">onPageLeave, args = []</span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!onPageLeave) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handler</span> = (<span class="params">event</span>) =&gt; &#123;</span><br><span class="line">      event = event ? event : (<span class="variable language_">window</span>.<span class="property">event</span> <span class="keyword">as</span> any);</span><br><span class="line">      <span class="comment">// from ä¿å­˜äº†é¼ æ ‡å³å°†ç§»åŠ¨åˆ°çš„å…ƒç´ </span></span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">from</span> = event.<span class="property">relatedTarget</span> || event.<span class="property">toElement</span>;</span><br><span class="line">      <span class="comment">// é¼ æ ‡æ˜¯å¦ç¦»å¼€æµè§ˆå™¨æ–‡æ¡£é¡µé¢æ—¶è§¦å‘å›è°ƒ</span></span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">from</span> || (<span class="keyword">from</span> <span class="keyword">as</span> any).<span class="property">nodeName</span> === <span class="string">&#x27;HTML&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_">onPageLeave</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">on</span>(<span class="variable language_">document</span>, <span class="string">&#x27;mouseout&#x27;</span>, handler);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">off</span>(<span class="variable language_">document</span>, <span class="string">&#x27;mouseout&#x27;</span>, handler);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, args);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> usePageLeave;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="useClickAway"><a href="#useClickAway" class="headerlink" title="useClickAway"></a>useClickAway</h2><p><code>useClickAway</code>ç”¨äºå½“ç”¨æˆ·åœ¨ç›®æ ‡å…ƒç´ å¤–éƒ¨å•å‡»æ—¶è§¦å‘å›è°ƒ</p>
<p>æºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RefObject</span>, useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; off, on &#125; <span class="keyword">from</span> <span class="string">&#x27;./misc/util&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultEvents = [<span class="string">&#x27;mousedown&#x27;</span>, <span class="string">&#x27;touchstart&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * refï¼šç›®æ ‡å¯¹è±¡çš„refå¼•ç”¨</span></span><br><span class="line"><span class="comment"> * onClickAwayï¼šä¼ å…¥çš„å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="comment"> * eventsï¼šéœ€è¦ç»‘å®šçš„äº‹ä»¶ç±»å‹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> useClickAway = &lt;E <span class="keyword">extends</span> <span class="title class_">Event</span> = <span class="title class_">Event</span>&gt;<span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  ref: RefObject&lt;HTMLElement | <span class="literal">null</span>&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">  onClickAway: (event: E) =&gt; <span class="keyword">void</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">  events: string[] = defaultEvents</span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ç¼“å­˜ä¼ å…¥çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">  <span class="keyword">const</span> savedCallback = <span class="title function_">useRef</span>(onClickAway);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    savedCallback.<span class="property">current</span> = onClickAway;</span><br><span class="line">  &#125;, [onClickAway]);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handler</span> = (<span class="params">event</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">current</span>: el &#125; = ref;</span><br><span class="line">      <span class="comment">// el æ˜¯å¯¹DOMå…ƒç´ çš„å¼•ç”¨</span></span><br><span class="line">      <span class="comment">// å¦‚æœ elå­˜åœ¨ å¹¶ä¸” å½“å‰è§¦å‘äº‹ä»¶çš„å…ƒç´ ä¸æ˜¯elåŠå…¶å­å­™èŠ‚ç‚¹ åˆ™ æ‰§è¡Œä¼ å…¥çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">      <span class="comment">// contains æ–¹æ³•æ˜¯ç”¨æ¥æµ‹è¯•ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯å¦ä¸€ä¸ªèŠ‚ç‚¹çš„åä»£ã€‚å¦‚æœç›®æ ‡å…ƒç´ åœ¨ el ä¹‹å¤–ï¼Œcontains æ–¹æ³•ä¼šè¿”å› falseï¼Œå–ååä¸º true</span></span><br><span class="line">      el &amp;&amp; !el.<span class="title function_">contains</span>(event.<span class="property">target</span>) &amp;&amp; savedCallback.<span class="title function_">current</span>(event);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// ç»‘å®šç”¨æˆ·ä¼ å…¥çš„æ‰€æœ‰äº‹ä»¶ç±»å‹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> eventName <span class="keyword">of</span> events) &#123;</span><br><span class="line">      <span class="title function_">on</span>(<span class="variable language_">document</span>, eventName, handler);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> eventName <span class="keyword">of</span> events) &#123;</span><br><span class="line">        <span class="title function_">off</span>(<span class="variable language_">document</span>, eventName, handler);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [events, ref]);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useClickAway;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/React-Hooks/">React Hooks</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2024/03/29/useContext/"><span>useContext</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2024/03/29/useContext/" rel="bookmark">
        <time class="entry-date published" datetime="2024-03-29T12:59:23.000Z">
          2024-03-29
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="context"><a href="#context" class="headerlink" title="context"></a><code>context</code></h2><p>åœ¨å¼€å‘ä¸­ï¼Œçˆ¶ç»„ä»¶å¯èƒ½éœ€è¦é€šè¿‡å¤šå±‚ä¸­é—´ç»„ä»¶å°† props ä¼ é€’ç»™æŸä¸ªå­å­™ç»„ä»¶ï¼Œè¿™ä¸ªä¼ é€’ props çš„è¿‡ç¨‹å°±ä¼šå˜å¾—ååˆ†å†—é•¿</p>
<p><code>context</code>å¯ä»¥åœ¨ç»„ä»¶æ ‘ä¸­<strong>ä¸éœ€è¦</strong>props ä¼ é€’æ•°æ®ï¼Œè€Œæ˜¯å°†æ•°æ®<strong>ç›´è¾¾</strong>æ‰€éœ€çš„ç»„ä»¶</p>
<p><code>context</code>å¯ä»¥è®©çˆ¶ç»„ä»¶ä¸ºå…¶<strong>å†…éƒ¨çš„æ•´ä¸ªç»„ä»¶æ ‘äºº</strong>æä¾›æ•°æ®</p>
<h2 id="ä½¿ç”¨context"><a href="#ä½¿ç”¨context" class="headerlink" title="ä½¿ç”¨context"></a>ä½¿ç”¨<code>context</code></h2><p>ä½¿ç”¨<code>context</code>éœ€è¦ä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ª<code>context</code></li>
<li>åœ¨éœ€è¦æ•°æ®çš„ç»„ä»¶ä¸­ä½¿ç”¨åˆ›å»ºçš„<code>context</code></li>
<li>åœ¨æŒ‡å®šæ•°æ®çš„ç»„ä»¶ä¸­æä¾›<code>context</code></li>
</ul>
<h3 id="åˆ›å»ºä¸€ä¸ªcontext"><a href="#åˆ›å»ºä¸€ä¸ªcontext" class="headerlink" title="åˆ›å»ºä¸€ä¸ªcontext"></a>åˆ›å»ºä¸€ä¸ª<code>context</code></h3><p>æ–°å»ºä¸€ä¸ª js æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­åˆ›å»º<code>constext</code>å¹¶å¯¼å‡ºä»–</p>
<p>ä½¿ç”¨<code>createContext()</code>æ¥åˆ›å»ºä¸€ä¸ª contextï¼Œéœ€è¦ç»™ä»–ä¼ å…¥ä¸€ä¸ªé»˜è®¤å€¼</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">MyContext</span> = <span class="title function_">createContext</span>(<span class="number">1</span>); <span class="comment">// åˆ›å»ºå¹¶å¯¼å‡ºä¸€ä¸ªcontext</span></span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨context-1"><a href="#ä½¿ç”¨context-1" class="headerlink" title="ä½¿ç”¨context"></a>ä½¿ç”¨<code>context</code></h3><p>åœ¨éœ€è¦ç”¨åˆ°æ•°æ®çš„ç»„ä»¶ä¸­ï¼Œå¼•å…¥<code>useContext</code>Hook ä»¥åŠ åˆ›å»ºçš„<code>context</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useContext &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MyContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./MyContext.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Son</span>(<span class="params"></span>) [</span><br><span class="line">  <span class="keyword">const</span> context = <span class="title function_">useContext</span>(<span class="title class_">MyContext</span>) <span class="comment">// useContext å‘Šè¯‰ React æƒ³è¦è¯»å– myContext</span></span><br><span class="line">  <span class="comment">// ç°åœ¨ï¼Œå¾—åˆ°çš„contextå°±æ˜¯myContextçš„é»˜è®¤å€¼</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="æä¾›context"><a href="#æä¾›context" class="headerlink" title="æä¾›context"></a>æä¾›<code>context</code></h3><p>åœ¨çˆ¶ç»„ä»¶ä¸­ä½¿ç”¨<code>context provider</code>å°†å­ç»„ä»¶åŒ…è£¹èµ·æ¥ï¼Œå°±å¯ä»¥æä¾›<code>context</code>ç»™ä»–ä»¬</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MyContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./MyContext.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> [ name, setName ] = <span class="title function_">useState</span>(<span class="string">&#x27;easy code sniper&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;MyContext.Provider value=&#123;name&#125;&gt;</span><br><span class="line">      &lt;MyContext.Provider&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™å‘Šè¯‰ Reactï¼šâ€œå¦‚æœåœ¨<code>Parent</code>ç»„ä»¶ä¸­çš„ä»»ä½•å­ç»„ä»¶è¯·æ±‚<code>MyContext</code>ï¼Œç»™ä»–ä»¬è¿™ä¸ª<code>name</code>ã€‚â€<br>ç»„ä»¶ä¼šä½¿ç”¨ UI æ ‘ä¸­åœ¨å®ƒä¸Šå±‚æœ€è¿‘çš„é‚£ä¸ª<code>MyContext.Provider</code>ä¼ é€’è¿‡æ¥çš„å€¼ã€‚</p>
<h2 id="useContext"><a href="#useContext" class="headerlink" title="useContext"></a><code>useContext</code></h2><p><strong>è¯­æ³•ï¼š</strong><code>const value = useContext(SomeContext)</code></p>
<ul>
<li><code>SomeContext</code>å°±æ˜¯å…ˆå‰ç”¨<code>createContext</code>åˆ›å»ºçš„ contextï¼Œcontext æœ¬èº«ä¸åŒ…å«ä¿¡æ¯ï¼Œå®ƒåªä»£è¡¨ä½ å¯ä»¥æä¾›æˆ–ä»ç»„ä»¶ä¸­è¯»å–çš„ä¿¡æ¯ç±»å‹ã€‚</li>
</ul>
<p><strong>è¿”å›å€¼</strong></p>
<p><code>useContext</code>ä¸ºè°ƒç”¨å®ƒçš„ç»„ä»¶è¿”å› context çš„å€¼ã€‚å®ƒçš„è¿”å›å€¼è¢«ç¡®å®šä¸ºä¼ é€’ç»™æ ‘ä¸­è°ƒç”¨ç»„ä»¶ä¸Šæ–¹æœ€è¿‘çš„<code>SmeContext.Provider</code>çš„<code>value</code>ã€‚<br>å¦‚æœæ²¡æœ‰è¿™æ ·çš„ providerï¼Œé‚£ä¹ˆè¿”å›å€¼å°†ä¼šæ˜¯ä¸ºåˆ›å»ºè¯¥ context ä¼ é€’ç»™<code>createContext</code>çš„<code>defaultValue</code>ã€‚è¿”å›çš„å€¼å§‹ç»ˆæ˜¯æœ€æ–°çš„ï¼Œå¦‚æœ context å‘ç”Ÿå˜åŒ–ï¼ŒReact ä¼šè‡ªåŠ¨é‡æ–°æ¸²æŸ“è¯»å– context çš„ç»„ä»¶ã€‚</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/React-Hooks/">React Hooks</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2024/03/26/è®¾è®¡æ¨¡å¼æµ…è°ˆ/"><span>è®¾è®¡æ¨¡å¼æµ…è°ˆ</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2024/03/26/è®¾è®¡æ¨¡å¼æµ…è°ˆ/" rel="bookmark">
        <time class="entry-date published" datetime="2024-03-26T13:01:25.000Z">
          2024-03-26
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="å¤šæ€"><a href="#å¤šæ€" class="headerlink" title="å¤šæ€"></a>å¤šæ€</h2><p>å¤šæ€çš„å«ä¹‰æ˜¯ï¼šåŒä¸€æ“ä½œä½œç”¨äºä¸åŒå¯¹è±¡ä¸Šï¼Œå¯ä»¥äº§ç”Ÿä¸åŒçš„è§£é‡Šå’Œä¸åŒçš„æ‰§è¡Œç»“æœã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç»™ä¸åŒçš„å¯¹è±¡å‘é€åŒä¸€ä¸ªæ¶ˆæ¯ï¼Œå¯¹è±¡ä¼šåšå‡ºä¸åŒçš„åé¦ˆ</p>
<p>ä¸‹é¢çš„ä»£ç å°±ä½“ç°ç€å¤šæ€æ€§ï¼Œå½“æˆ‘ä»¬åˆ†åˆ«å‘ç¨‹åºå‘˜å’Œè€å¸ˆå‘å‡ºå·¥ä½œçš„æ¶ˆæ¯æ—¶ï¼Œä»–ä»¬æ ¹æ®æ­¤ä½œå‡ºäº†ä¸åŒçš„ååº”</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> work = <span class="keyword">function</span> (<span class="params">person</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(person <span class="keyword">instanceof</span> <span class="title class_">Coder</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;coding&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (person <span class="keyword">instanceof</span> <span class="title class_">Teacher</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;teaching&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Coder</span> = <span class="keyword">function</span> (<span class="params"></span>)&#123;&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Teacher</span> = <span class="keyword">function</span> (<span class="params"></span>)&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">work</span>(<span class="keyword">new</span> <span class="title class_">Coder</span>()) <span class="comment">// coding</span></span><br><span class="line"><span class="title function_">work</span>(<span class="keyword">new</span> <span class="title class_">Teacher</span>()) <span class="comment">// teaching</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä½†è¿™æ ·çš„å¤šæ€æ€§æ— æ³•ä»¤äººæ»¡æ„ï¼Œå¦‚æœç°åœ¨è¦æ–°å¢ä¸€ä¸ªå¸æœºç±»å‹ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦ä¿®æ”¹workå‡½æ•°çš„ä»£ç ã€‚ä¿®æ”¹çš„ä»£ç è¶Šå¤šï¼Œå°±å­˜åœ¨è¶Šå¤šçš„å±é™©ï¼Œå¹¶ä¸”workå‡½æ•°ä¹Ÿä¼šéšç€ç±»å‹çš„å˜å¤šæˆä¸ºä¸€ä¸ªå·¨å¤§çš„å‡½æ•°</p>
<p>å¤šæ€èƒŒåçš„æ€æƒ³æ˜¯ï¼šå°†<strong>åšä»€ä¹ˆ</strong>ä¸<strong>è°å»åšæ€ä¹ˆåš</strong>åˆ†ç¦»å¼€æ¥ã€‚<br>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œäººéƒ½ä¼šå·¥ä½œï¼Œä½†æ˜¯ä¸åŒçš„äººæ€ä¹ˆå·¥ä½œæ˜¯ä¸åŒçš„ã€‚æŠŠä¸å˜çš„éƒ¨åˆ†éš”ç¦»å‡ºæ¥ï¼ŒæŠŠå¯å˜çš„éƒ¨åˆ†å°è£…èµ·æ¥ï¼Œè¿™å°±ç»™äºˆäº†æˆ‘ä»¬æ‰©å±•ç¨‹åºçš„èƒ½åŠ›ã€‚</p>
<p>é€šè¿‡ä¸‹é¢çš„æ”¹åŠ¨ï¼Œå°†ä¸å˜çš„éƒ¨åˆ†éš”ç¦»å‡ºæ¥ï¼Œé‚£å°±æ˜¯æ‰€æœ‰äººéƒ½ä¼šå·¥ä½œã€‚ç„¶åæŠŠå¯å˜çš„éƒ¨åˆ†å„è‡ªå°è£…èµ·æ¥</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> work = <span class="keyword">function</span> (<span class="params">person</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(person.<span class="property">work</span> <span class="keyword">instanceof</span> <span class="title class_">Function</span>) &#123;</span><br><span class="line">    person.<span class="title function_">work</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Coder</span> = <span class="keyword">function</span> (<span class="params"></span>)&#123;&#125;</span><br><span class="line"><span class="title class_">Coder</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">work</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;coding&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Teacher</span> = <span class="keyword">function</span> (<span class="params"></span>)&#123;&#125;</span><br><span class="line"><span class="title class_">Teacher</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">work</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;teaching&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">work</span>(<span class="keyword">new</span> <span class="title class_">Coder</span>())</span><br><span class="line"><span class="title function_">work</span>(<span class="keyword">new</span> <span class="title class_">Teacher</span>())</span><br></pre></td></tr></table></figure>

<p>ä¸é™æ€è¯­è¨€ç±»å‹ä¸åŒçš„æ˜¯ï¼ŒJavaScriptçš„å˜é‡ç±»å‹åœ¨è¿è¡ŒæœŸæ˜¯å¯å˜çš„ã€‚ä¸€ä¸ªJavaScriptå¯¹è±¡ï¼Œæ—¢å¯ä»¥æ˜¯<code>Coder</code>ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯<code>Teacher</code>ç±»å‹ã€‚è¿™å°±æ„å‘³ç€<strong>JavaScriptå¯¹è±¡çš„å¤šæ€æ€§æ˜¯ä¸ç”Ÿä¿±æ¥çš„</strong></p>
<h2 id="å°è£…"><a href="#å°è£…" class="headerlink" title="å°è£…"></a>å°è£…</h2><p>å°è£…çš„ç›®çš„æ˜¯å°†ä¿¡æ¯éšè—ï¼Œå°è£…å¯ä»¥æ˜¯<strong>å¯¹ä»»ä½•å½¢å¼å†…å®¹çš„å°è£…</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå°è£…ä¸ä»…ä»…æ˜¯éšè—æ•°æ®ï¼Œè¿˜åŒ…æ‹¬éšè—å®ç°ç»†èŠ‚ã€è®¾è®¡ç»†èŠ‚ä»¥åŠéšè—å¯¹è±¡çš„ç±»å‹ç­‰</p>
<p>å°è£…ä½¿å¾—å¯¹è±¡å†…éƒ¨çš„å˜åŒ–å¯¹å…¶ä»–å¯¹è±¡è€Œè¨€æ˜¯é€æ˜çš„ï¼Œå…¶ä»–å¯¹è±¡ä¹Ÿä¸å…³å¿ƒå®ƒçš„å†…éƒ¨å®ç°ã€‚</p>
<p><strong>å°è£…å˜åŒ–</strong></p>
<p>é€šè¿‡å°è£…å˜åŒ–çš„æ–¹å¼ï¼ŒæŠŠç³»ç»Ÿä¸­ç¨³å®šä¸å˜çš„éƒ¨åˆ†å’Œæ˜“äºå˜åŒ–çš„éƒ¨åˆ†éš”ç¦»å¼€æ¥ï¼Œæˆ‘ä»¬åªéœ€è¦æ›¿æ¢æ˜“äºå˜åŒ–çš„éƒ¨åˆ†ã€‚è¿™å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šä¿è¯ç¨‹åºçš„ç¨³å®šæ€§å’Œå¯æ‰©å±•æ€§</p>
<h2 id="åŸå‹æ¨¡å¼"><a href="#åŸå‹æ¨¡å¼" class="headerlink" title="åŸå‹æ¨¡å¼"></a>åŸå‹æ¨¡å¼</h2><p>åœ¨ä»¥ç±»ä¸ºä¸­å¿ƒçš„é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå¯¹è±¡æ€»æ˜¯ä»ç±»ä¸­åˆ›å»ºå‡ºæ¥çš„ã€‚è€Œåœ¨åŸå‹ç¼–ç¨‹çš„æ€æƒ³ä¸­ï¼Œç±»ä¸æ˜¯å¿…é¡»çš„ï¼Œå¯¹è±¡ä¹Ÿæœªå¿…éœ€è¦ä»ç±»ä¸­åˆ›å»ºå‡ºæ¥ã€‚ä¸€ä¸ªå¯¹è±¡æ˜¯é€šè¿‡å…‹éš†å¦ä¸€ä¸ªå¯¹è±¡æ‰€å¾—åˆ°çš„ã€‚</p>
<p>åŸå‹æ¨¡å¼çš„å…³é”®åœ¨äº<strong>é€šè¿‡å…‹éš†æ¥åˆ›å»ºå¯¹è±¡</strong>ï¼Œå³è¯­è¨€æœ¬èº«æ˜¯å¦æä¾›äº†cloneæ–¹æ³•ã€‚åœ¨ES5ä¸­æä¾›äº†<code>Object.create</code>æ–¹æ³•æ¥å…‹éš†å¯¹è±¡</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title class_">Person</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&#x27;easy code sniper&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = <span class="number">22</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person = <span class="keyword">new</span> <span class="title class_">Person</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> clonePerson = <span class="title class_">Object</span>.<span class="title function_">create</span>( person )</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(clonePerson) <span class="comment">// &#123; name: &#x27;easy code sniper&#x27;, age: 22 &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="JavaScriptä¸­çš„åŸå‹ç»§æ‰¿"><a href="#JavaScriptä¸­çš„åŸå‹ç»§æ‰¿" class="headerlink" title="JavaScriptä¸­çš„åŸå‹ç»§æ‰¿"></a>JavaScriptä¸­çš„åŸå‹ç»§æ‰¿</h3><p>JavaScriptéµå¾ªåŸå‹ç¼–ç¨‹çš„åŸºæœ¬è§„åˆ™ï¼š</p>
<ul>
<li>æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯å¯¹è±¡</li>
<li>è¦å¾—åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œä¸æ˜¯é€šè¿‡å®ä¾‹åŒ–ç±»ï¼Œè€Œæ˜¯æ‰¾åˆ°ä¸€ä¸ªå¯¹è±¡ä½œä¸ºåŸå‹å¹¶å…‹éš†å®ƒ</li>
<li>å¯¹è±¡ä¼šè®°ä½å®ƒçš„åŸå‹</li>
<li>å¦‚æœå¯¹è±¡æ— æ³•å“åº”æŸä¸ªè¯·æ±‚ï¼Œå®ƒä¼šæŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™è‡ªå·±çš„åŸå‹</li>
</ul>
<p><strong>1.æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯å¯¹è±¡</strong></p>
<p>JavaScriptæœ‰ä¸¤ç§ç±»å‹æœºåˆ¶ï¼šåŸºæœ¬ç±»å‹ å’Œ å¯¹è±¡ç±»å‹</p>
<p>åŸºäºä¸€åˆ‡éƒ½åº”è¯¥æ˜¯å¯¹è±¡çš„æœ¬æ„ï¼ˆé™¤äº†undefinedä¹‹å¤–ï¼‰ï¼ŒåŸºæœ¬ç±»å‹æ•°æ®å¯ä»¥é€šè¿‡åŒ…è£…ç±»çš„æ–¹å¼å˜æˆå¯¹è±¡ç±»å‹æ•°æ®</p>
<p>JavaScriptä¸­çš„æ ¹å¯¹è±¡æ˜¯<code>Object.prototype</code>å¯¹è±¡ï¼Œ<code>Object.prototype</code>å¯¹è±¡æ˜¯ä¸€ä¸ªç©ºçš„å¯¹è±¡ã€‚åœ¨JSä¸­é‡åˆ°çš„æ¯ä¸ªå¯¹è±¡ï¼Œå®é™…éƒ½æ˜¯ä»<code>Object.prototype</code>å¯¹è±¡å…‹éš†è€Œæ¥çš„</p>
<p><strong>2.è¦å¾—åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œä¸æ˜¯é€šè¿‡å®ä¾‹åŒ–ç±»ï¼Œè€Œæ˜¯æ‰¾åˆ°ä¸€ä¸ªå¯¹è±¡ä½œä¸ºåŸå‹å¹¶å…‹éš†å®ƒ</strong></p>
<p>åœ¨JavaScriptä¸­æˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒå…‹éš†çš„ç»†èŠ‚ï¼Œåªæ˜¯æ˜¾å¼åœ°è°ƒç”¨<code>let obj = new Object()</code>æˆ–<code>let obj = &#123;&#125;</code>ï¼Œå¼•æ“å†…éƒ¨ä¼šä»<code>Object.prototype</code>ä¸Šé¢å…‹éš†ä¸€ä¸ªå¯¹è±¡å‡ºæ¥</p>
<p>JavaScriptçš„å‡½æ•°é›†å¯ä»¥ä½œä¸ºæ™®é€šå‡½æ•°è¢«è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºæ„é€ å™¨è¢«è°ƒç”¨ã€‚å½“ä½¿ç”¨<code>new</code>è¿ç®—ç¬¦æ¥è°ƒç”¨å‡½æ•°æ—¶ï¼Œæ­¤æ—¶çš„å‡½æ•°å°±æ˜¯ä¸€ä¸ªæ„é€ å™¨ã€‚ç”¨<code>new</code>è¿ç®—ç¬¦æ¥åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ï¼Œå®é™…ä¸Šä¹Ÿåªæ˜¯å…ˆå…‹éš†<code>Object.prototype</code>å¯¹è±¡ï¼Œå†è¿›è¡Œä¸€äº›å…¶ä»–é¢å¤–æ“ä½œçš„è¿‡ç¨‹</p>
<p>æ¨¡æ‹Ÿ<code>new</code>åˆ›å»ºå¯¹è±¡ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> objectFactory = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> obj = <span class="keyword">new</span> <span class="title class_">Object</span>() <span class="comment">// å…ˆå…‹éš†ä¸€ä¸ªç©ºå¯¹è±¡</span></span><br><span class="line">    <span class="title class_">Constructor</span> = [].<span class="property">shift</span>.<span class="title function_">call</span>( <span class="variable language_">arguments</span> ) <span class="comment">// å–å‡ºå‚æ•°ä¸­çš„ç¬¬ä¸€é¡¹ï¼Œå³å¤–éƒ¨ä¼ å…¥çš„æ„é€ å™¨</span></span><br><span class="line">    obj.<span class="property">__proto__</span> = <span class="title class_">Constructor</span>.<span class="property"><span class="keyword">prototype</span></span> <span class="comment">// æŒ‡å‘æ­£å¸¸çš„åŸå‹</span></span><br><span class="line">    <span class="keyword">let</span> ret = <span class="title class_">Constructor</span>.<span class="title function_">apply</span>(obj, <span class="variable language_">arguments</span>) <span class="comment">// åŸºäºå‰©ä½™çš„argumentsç»™objè®¾ç½®å±æ€§</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> ret === <span class="string">&#x27;object&#x27;</span> ? ret : obj <span class="comment">// ç¡®ä¿æ„é€ å™¨æ€»æ˜¯è¿”å›ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getName</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="title function_">objectFactory</span>(<span class="title class_">Person</span>, <span class="string">&#x27;easy code sniper&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( a.<span class="property">name</span> ); <span class="comment">// easy code sniper</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( a.<span class="title function_">getName</span>() ); <span class="comment">// easy code sniper</span></span><br></pre></td></tr></table></figure>

<p><strong>3.å¯¹è±¡ä¼šè®°ä½å®ƒçš„åŸå‹</strong></p>
<p>JavaScriptç»™å¯¹è±¡æä¾›ä¸€ä¸ª<code>__proto__</code>å±æ€§ï¼ŒæŸä¸ªå¯¹è±¡çš„<code>__proto__</code>å±æ€§é»˜è®¤ä¼šæŒ‡å‘å®ƒçš„æ„é€ å™¨çš„åŸå‹å¯¹è±¡ï¼Œå³<code>Constructor.prototype</code></p>
<p><code>__proto__</code>å°±æ˜¯ å¯¹è±¡ å’Œ å¯¹è±¡æ„é€ å™¨çš„åŸå‹ è”ç³»èµ·æ¥çš„çº½å¸¦ã€‚è¿™å°±æ˜¯æˆ‘ä»¬åœ¨<code>objectFactory</code>å‡½æ•°ä¸­éœ€è¦æ‰‹åŠ¨ç»™objå¯¹è±¡è®¾ç½®æ­£ç¡®çš„<code>__proto__</code>æŒ‡å‘</p>
<h2 id="this-çš„æŒ‡å‘"><a href="#this-çš„æŒ‡å‘" class="headerlink" title="this çš„æŒ‡å‘"></a>this çš„æŒ‡å‘</h2><p>this çš„æŒ‡å‘å¤§è‡´å¯ä»¥åˆ†ä¸º 4 ç§æƒ…å†µï¼š</p>
<ul>
<li>ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨</li>
<li>ä½œä¸ºæ™®é€šå‡½æ•°è°ƒç”¨</li>
<li>æ„é€ å™¨è°ƒç”¨</li>
<li><code>call</code> å’Œ <code>apply</code> è°ƒç”¨</li>
</ul>
<h3 id="ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨"><a href="#ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨" class="headerlink" title="ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨"></a>ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨</h3><p>å½“å‡½æ•°ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œthis æŒ‡å‘è¯¥å¯¹è±¡</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;easy code sniper&quot;</span>,</span><br><span class="line">  <span class="attr">getName</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span> === obj); <span class="comment">// true</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>); <span class="comment">// easy code sniper</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.<span class="title function_">getName</span>();</span><br></pre></td></tr></table></figure>

<h3 id="ä½œä¸ºæ™®é€šå‡½æ•°è°ƒç”¨"><a href="#ä½œä¸ºæ™®é€šå‡½æ•°è°ƒç”¨" class="headerlink" title="ä½œä¸ºæ™®é€šå‡½æ•°è°ƒç”¨"></a>ä½œä¸ºæ™®é€šå‡½æ•°è°ƒç”¨</h3><p>å½“å‡½æ•°ä½œä¸ºæ™®é€šå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œthis æŒ‡å‘å…¨å±€å¯¹è±¡ã€‚åœ¨æµè§ˆå™¨ä¸­ï¼Œå…¨å±€å¯¹è±¡å°±æ˜¯ windowï¼›åœ¨ Node ç¯å¢ƒä¸­ï¼Œå…¨å±€å¯¹è±¡å°±æ˜¯ globalThis</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">globalThis.<span class="property">name</span> = <span class="string">&quot;easy code sniper&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">func</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">func</span>(); <span class="comment">// easy code sniper</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–è€…</span></span><br><span class="line"></span><br><span class="line">globalThis.<span class="property">name</span> = <span class="string">&quot;cqy&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;easy code sniper&quot;</span>,</span><br><span class="line">  <span class="attr">getName</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span> === obj); <span class="comment">// false</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>); <span class="comment">// cqy</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> func = obj.<span class="property">getName</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">func</span>();</span><br></pre></td></tr></table></figure>

<h3 id="æ„é€ å™¨è°ƒç”¨"><a href="#æ„é€ å™¨è°ƒç”¨" class="headerlink" title="æ„é€ å™¨è°ƒç”¨"></a>æ„é€ å™¨è°ƒç”¨</h3><p>é™¤äº†ä¸€äº›å†…ç½®å‡½æ•°ï¼Œå¤§éƒ¨åˆ† JS å‡½æ•°éƒ½å¯ä»¥å½“ä½œæ„é€ å™¨ä½¿ç”¨ã€‚å½“ä½¿ç”¨ new è¿ç®—ç¬¦è°ƒç”¨å‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°æ€»æ˜¯è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæ„é€ å™¨é‡Œçš„ this å°±<strong>æŒ‡å‘è¿”å›çš„å¯¹è±¡</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title class_">Func</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&#x27;easy code sniper&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = <span class="keyword">new</span> <span class="title class_">Func</span>()</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">name</span>); <span class="comment">// easy code sniper</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ„é€ å™¨æ˜¾å¼çš„è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆè¿”å›çš„å°†ä¼šæ˜¯è¿™ä¸ªå¯¹è±¡ï¼Œthisä¹Ÿä¼šæŒ‡å‘è¿™ä¸ªå¯¹è±¡</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title class_">Func</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&#x27;easy code sniper&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;cqy&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = <span class="keyword">new</span> <span class="title class_">Func</span>()</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">name</span>); <span class="comment">// cqy</span></span><br></pre></td></tr></table></figure>


<h2 id="call-å’Œ-apply"><a href="#call-å’Œ-apply" class="headerlink" title="call å’Œ apply"></a>call å’Œ apply</h2><p><code>Function.prototype.call</code>å’Œ<code>Function.prototype.apply</code>æ˜¯å®šä¹‰åœ¨Functionçš„åŸå‹ä¸Šçš„ä¸¤ä¸ªæ–¹æ³•ï¼Œç”¨äºåŠ¨æ€çš„æ”¹å˜thisæŒ‡å‘</p>
<p>callå’Œapplyçš„ä½œç”¨ä¸€æ¨¡ä¸€æ ·ï¼ŒåŒºåˆ«ä»…åœ¨äºä¼ å…¥å‚æ•°çš„å½¢å¼ä¸åŒï¼š</p>
<ul>
<li>applyæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šå‡½æ•°ä½“å†…thisçš„æŒ‡å‘ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼šä½œä¸ºå‚æ•°ä¼ é€’ç»™è¢«è°ƒç”¨çš„å‡½æ•°ï¼Œç±»å‹ä¸ºæ•°ç»„æˆ–ç±»æ•°ç»„</li>
<li>callä¼ å…¥å‚æ•°æ•°é‡ä¸å›ºå®šï¼Œç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šå‡½æ•°ä½“å†…thisçš„æŒ‡å‘ï¼Œä»ç¬¬äºŒä¸ªå‚æ•°å¼€å§‹å¾€åï¼Œæ¯ä¸ªå‚æ•°è¢«ä¾æ¬¡ä¼ å…¥å‡½æ•°</li>
</ul>
<p>å½“ä½¿ç”¨callæˆ–è€…applyçš„æ—¶å€™ï¼Œå¦‚æœä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºnullï¼Œå‡½æ•°ä½“å†…çš„thisä¼šæŒ‡å‘é»˜è®¤çš„å®¿ä¸»å¯¹è±¡ï¼Œåœ¨æµè§ˆå™¨ä¸­åˆ™æ˜¯window</p>
<h3 id="ç”¨é€”"><a href="#ç”¨é€”" class="headerlink" title="ç”¨é€”"></a>ç”¨é€”</h3><p><strong>1.æ”¹å˜thisæŒ‡å‘</strong></p>
<p>callå’Œapplyæœ€å¸¸è§çš„ç”¨é€”æ˜¯æ”¹å˜å‡½æ•°å†…éƒ¨çš„thisæŒ‡å‘</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj1 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;easy code sniper&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj2 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;cqy&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">name</span> = <span class="string">&#x27;window&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> getName = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">getName</span>() <span class="comment">// window</span></span><br><span class="line">getName.<span class="title function_">call</span>(obj1) <span class="comment">// easy code sniper</span></span><br><span class="line">getName.<span class="title function_">call</span>(obj2) <span class="comment">// cqy</span></span><br></pre></td></tr></table></figure>

<p><strong>2.Function.prototype.bind</strong></p>
<p>å¤§éƒ¨åˆ†é«˜çº§æµè§ˆå™¨éƒ½å®ç°äº†å†…ç½®çš„<code>Function.prototype.bind</code>ï¼Œç”¨æ¥æŒ‡å®šå‡½æ•°å†…éƒ¨çš„thisæŒ‡å‘ï¼Œå³ä½¿æ²¡æœ‰åŸç”Ÿçš„<code>Function.prototype.bind</code>å®ç°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨callæˆ–è€…applyæ¨¡æ‹Ÿ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">bind</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> self = <span class="variable language_">this</span> <span class="comment">// ä¿å­˜è°ƒç”¨bindçš„åŸå‡½æ•°</span></span><br><span class="line">  context = [].<span class="property">shift</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>) <span class="comment">// å€Ÿç”¨æ•°ç»„çš„shiftæ–¹æ³•æ‹¿åˆ°argumentsçš„ç¬¬ä¸€é¡¹ï¼Œå³éœ€è¦æŒ‡å‘çš„this</span></span><br><span class="line">  args = [].<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>) <span class="comment">// å°†å‰©ä½™å‚æ•°è½¬åŒ–ä¸ºæ•°ç»„</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// æŒ‡å®šthisä¸ºä¹‹å‰ä¼ å…¥çš„context</span></span><br><span class="line">    <span class="comment">// åˆå¹¶ä¸¤æ¬¡ä¼ å…¥çš„å‚æ•°ï¼Œä½œä¸ºæ–°å‡½æ•°çš„å‚æ•°</span></span><br><span class="line">    <span class="keyword">return</span> self.<span class="title function_">apply</span>(context, [].<span class="property">concat</span>.<span class="title function_">call</span>(args, [].<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>)))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;cqy&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> func = <span class="keyword">function</span>(<span class="params">a,b,c,d</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>([a,b,c,d])</span><br><span class="line">&#125;.<span class="title function_">bind</span>(obj, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">func</span>(<span class="number">3</span>, <span class="number">4</span>) <span class="comment">// è¾“å‡ºï¼šcqy [1, 2, 3, 4]</span></span><br></pre></td></tr></table></figure>

<p><strong>3.å€Ÿç”¨å…¶ä»–å¯¹è±¡çš„æ–¹æ³•</strong></p>
<p>å€Ÿç”¨æ–¹æ³•è¾ƒä¸ºå¸¸è§çš„å°±æ˜¯ï¼š<br>å‡½æ•°çš„å‚æ•°åˆ—è¡¨argumentsæ˜¯ä¸€ä¸ªç±»æ•°ç»„å¯¹è±¡ï¼Œå®ƒå¹¶éçœŸæ­£çš„æ•°ç»„ï¼Œæ‰€ä»¥ä¸èƒ½åƒæ•°ç»„ä¸€æ ·ï¼Œè¿›è¡Œæ’åºæ“ä½œæˆ–è€…å¾€é›†åˆé‡Œæ·»åŠ ä¸€ä¸ªæ–°çš„å…ƒç´ ã€‚æˆ‘ä»¬å¸¸å¸¸ä¼šå€Ÿç”¨<code>Array.prototype</code>å¯¹è±¡ä¸Šçš„æ–¹æ³•</p>
<p>æ¯”å¦‚æƒ³å¾€argumentsä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„å…ƒç´ ï¼Œé€šå¸¸å€Ÿç”¨<code>Array.prototype.push</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> func = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">push</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="number">3</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">func</span>(<span class="number">1</span>,<span class="number">2</span>) <span class="comment">// [1,2,3]</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æ“ä½œargumentsçš„æ—¶å€™ï¼Œæˆ‘ä»¬ç»å¸¸éå¸¸é¢‘ç¹åœ°æ‰¾<code>Array.prototype</code>å¯¹è±¡å€Ÿç”¨æ–¹æ³•ã€‚<br>æƒ³æŠŠargumentsè½¬æˆçœŸæ­£çš„æ•°ç»„çš„æ—¶å€™ï¼Œå¯ä»¥å€Ÿç”¨<code>Array.prototype.slice</code>æ–¹æ³•;æƒ³æˆªå»argumentsåˆ—è¡¨ä¸­çš„å¤´ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œåˆå¯ä»¥å€Ÿç”¨<code>Array.prototype.shift</code>æ–¹æ³•ã€‚</p>
<h2 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h2><p><strong>å˜é‡çš„ä½œç”¨åŸŸ</strong></p>
<p>åœ¨JSä¸­ï¼Œå‡½æ•°å¯ä»¥ç”¨æ¥åˆ›é€ å‡½æ•°ä½œç”¨åŸŸã€‚å‡½æ•°å°±åƒä¸€å±‚åŠé€æ˜çš„ç»ç’ƒï¼Œåœ¨å‡½æ•°é‡Œé¢å¯ä»¥çœ‹åˆ°å¤–é¢çš„ä¾¿åˆ©ï¼Œè€Œåœ¨å‡½æ•°å¤–é¢åˆ™æ— æ³•çœ‹åˆ°å‡½æ•°é‡Œé¢çš„å˜é‡ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºå½“åœ¨å‡½æ•°ä¸­æœç´¢ä¸€ä¸ªå˜é‡çš„æ—¶å€™ï¼Œå¦‚æœè¯¥å‡½æ•°å†…å¹¶æ²¡æœ‰å£°æ˜è¿™ä¸ªå˜é‡ï¼Œé‚£ä¹ˆæ­¤æ¬¡æœç´¢çš„è¿‡ç¨‹ä¼šéšç€ä»£ç æ‰§è¡Œç¯å¢ƒåˆ›å»ºçš„ä½œç”¨åŸŸé“¾å¾€å¤–å±‚é€å±‚æœç´¢ï¼Œä¸€ç›´æœç´¢åˆ°å…¨å±€å¯¹è±¡ä¸ºæ­¢ã€‚å˜é‡çš„æœç´¢æ˜¯<strong>ä»å†…åˆ°å¤–</strong>çš„ã€‚</p>
<p><strong>å˜é‡çš„ç”Ÿå­˜å‘¨æœŸ</strong></p>
<p>å¯¹äºå…¨å±€å˜é‡æ¥è¯´ï¼Œç”Ÿå­˜å‘¨æœŸæ˜¯æ°¸ä¹…çš„ï¼Œé™¤éä¸»åŠ¨é”€æ¯è¿™ä¸ªå…¨å±€å˜é‡</p>
<p>å¯¹äºå‡½æ•°å†…çš„å±€éƒ¨å˜é‡æ¥è¯´ï¼Œå½“é€€å‡ºå‡½æ•°æ—¶ï¼Œè¿™äº›å±€éƒ¨å˜é‡å°±å¤±å»äº†ä»–ä»¬ä»·å€¼ï¼Œéšç€å‡½æ•°è°ƒç”¨çš„ç»“æŸè€Œé”€æ¯</p>
<p>é€€å‡ºå‡½æ•°åå±€éƒ¨å˜é‡aå°†è¢«é”€æ¯</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> func = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">1</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a) <span class="comment">// 1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">func</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a) <span class="comment">// ReferenceError: a is not defined</span></span><br></pre></td></tr></table></figure>

<p>å†çœ‹çœ‹ä¸‹é¢è¿™æ®µä»£ç </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> func = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">1</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    a++</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> f = <span class="title function_">func</span>()</span><br><span class="line"></span><br><span class="line"><span class="title function_">f</span>() <span class="comment">// 2</span></span><br><span class="line"><span class="title function_">f</span>() <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œé€€å‡ºå‡½æ•°ä¹‹åï¼Œå±€éƒ¨å˜é‡aå¹¶æ²¡æœ‰æ¶ˆå¤±ã€‚å½“æ‰§è¡Œ<code>let f = func()</code>æ—¶ï¼Œfæ‹¿åˆ°ä¸€ä¸ªåŒ¿åå‡½æ•°çš„å¼•ç”¨ï¼Œå®ƒå¯ä»¥è®¿é—®åˆ°funcè¢«è°ƒç”¨æ—¶äº§ç”Ÿçš„ç¯å¢ƒï¼Œè€Œå±€éƒ¨å˜é‡aä¸€ç›´å¤„åœ¨è¿™ä¸ªç¯å¢ƒé‡Œã€‚</p>
<p>æ—¢ç„¶å±€éƒ¨å˜é‡æ‰€åœ¨çš„ç¯å¢ƒè¿˜èƒ½è¢«å¤–ç•Œè®¿é—®ï¼Œè¿™ä¸ªå±€éƒ¨å˜é‡å°±æœ‰äº†ä¸è¢«é”€æ¯çš„ç†ç”±ã€‚åœ¨è¿™é‡Œäº§ç”Ÿäº†ä¸€ä¸ªé—­åŒ…ç»“æ„ï¼Œå±€éƒ¨å˜é‡çš„ç”Ÿå‘½çœ‹èµ·æ¥è¢«å»¶ç»­äº†ã€‚</p>
<h3 id="é—­åŒ…çš„åº”ç”¨"><a href="#é—­åŒ…çš„åº”ç”¨" class="headerlink" title="é—­åŒ…çš„åº”ç”¨"></a>é—­åŒ…çš„åº”ç”¨</h3><p><strong>å°è£…å˜é‡</strong></p>
<p>é—­åŒ…å¯ä»¥å¸®åŠ©æŠŠä¸€äº›ä¸éœ€è¦æš´éœ²åœ¨å…¨å±€çš„å˜é‡å°è£…æˆâ€˜ç§æœ‰å˜é‡â€™ï¼Œä¾‹å¦‚ä¸‹é¢æœ‰ä¸€ä¸ªè®¡ç®—å‚æ•°ä¹˜ç§¯çš„ç®€å•å‡½æ•°ï¼Œå¹¶ä½¿ç”¨å…¨å±€çš„cacheå˜é‡ç¼“å­˜ç»“æœæ¥æé«˜æ€§èƒ½ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> cache = &#123;&#125; <span class="comment">// ç¼“å­˜ç»“æœ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> mult = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> args = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">join</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="string">&#x27;,&#x27;</span>) <span class="comment">// å°†å‚æ•°æ‹¼æ¥æˆå­—ç¬¦ä¸²ï¼Œä½œä¸ºcacheä¸­çš„å±æ€§å</span></span><br><span class="line">  <span class="keyword">if</span>( cache[args] ) &#123; <span class="comment">// å¦‚æœå‘½ä¸­ç¼“å­˜å°±è¿”å›ç»“æœ</span></span><br><span class="line">    <span class="keyword">return</span> cache[args]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">1</span></span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">arguments</span>.<span class="property">length</span>; i++ ) &#123;</span><br><span class="line">    a *= <span class="variable language_">arguments</span>[i]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> cache[args] = a</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>cacheå˜é‡ä»…åœ¨multå‡½æ•°ä¸­è¢«ä½¿ç”¨ï¼Œä¸å…¶è®©ä»–æš´éœ²åœ¨å…¨å±€ä½œç”¨åŸŸä¸‹ï¼Œä¸å¦‚å°†å®ƒå°é—­åœ¨multå‡½æ•°å†…éƒ¨</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mult = (<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> cache = &#123;&#125; <span class="comment">// å°†cacheå°è£…åœ¨multé‡Œé¢</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> args = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">join</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="string">&#x27;,&#x27;</span>) <span class="comment">// å°†å‚æ•°æ‹¼æ¥æˆå­—ç¬¦ä¸²ï¼Œä½œä¸ºcacheä¸­çš„å±æ€§å</span></span><br><span class="line">    <span class="keyword">if</span>( cache[args] ) &#123; <span class="comment">// å¦‚æœå‘½ä¸­ç¼“å­˜å°±è¿”å›ç»“æœ</span></span><br><span class="line">      <span class="keyword">return</span> cache[args]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">arguments</span>.<span class="property">length</span>; i++ ) &#123;</span><br><span class="line">      a *= <span class="variable language_">arguments</span>[i]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cache[args] = a</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<h2 id="é«˜é˜¶å‡½æ•°"><a href="#é«˜é˜¶å‡½æ•°" class="headerlink" title="é«˜é˜¶å‡½æ•°"></a>é«˜é˜¶å‡½æ•°</h2><p>é«˜é˜¶å‡½æ•°æ˜¯æŒ‡è‡³å°‘æ»¡è¶³ä¸‹åˆ—æ¡ä»¶ä¹‹ä¸€çš„å‡½æ•°ï¼š</p>
<ul>
<li>å‡½æ•°å¯ä»¥ä½œä¸ºå‚æ•°è¢«ä¼ é€’</li>
<li>å‡½æ•°å¯ä»¥ä½œä¸ºè¿”å›å€¼è¾“å‡º</li>
</ul>
<h3 id="å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’"><a href="#å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’" class="headerlink" title="å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’"></a>å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’</h3><p>å°†å‡½æ•°ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ï¼Œä¸€ä¸ªå¾ˆé‡è¦çš„åº”ç”¨åœºæ™¯å°±æ˜¯å›è°ƒå‡½æ•°ã€‚è¿™ä»£è¡¨æˆ‘ä»¬å°†å®¹æ˜“å˜åŒ–çš„ä¸šåŠ¡é€»è¾‘æŠ½ç¦»å‡ºæ¥ï¼ŒæŠŠè¿™éƒ¨åˆ†ä¸šåŠ¡é€»è¾‘æ”¾åœ¨å‡½æ•°å‚æ•°ä¸­ï¼Œè¿™æ ·ä¸€æ¥å¯ä»¥åˆ†ç¦»ä¸šåŠ¡ä»£ç ä¸­å˜åŒ–ä¸ä¸å˜çš„éƒ¨åˆ†</p>
<p>æ¯”å¦‚æˆ‘ä»¬æƒ³åœ¨é¡µé¢ä¸­åˆ›å»ºä¸€ä¸ªdivèŠ‚ç‚¹ï¼Œç„¶åç»™è¿™ä¸ªèŠ‚ç‚¹è®¾ç½®ä¸€äº›æ ·å¼ï¼Œä¸‹é¢æ˜¯ä¸€ç§ç¼–å†™ä»£ç çš„æ–¹å¼ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> appendDiv = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> div = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">  div.<span class="property">innerHTML</span> = <span class="string">&#x27;æˆ‘æ˜¯ä¸€ä¸ªdiv&#x27;</span></span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(div)</span><br><span class="line">  div.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span> <span class="comment">// è®¾ç½®æ ·å¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŠŠ<code>div.style.display = &#39;none&#39;</code>çš„é€»è¾‘ç¡¬ç¼–ç åœ¨appendDivé‡Œæ˜¾ç„¶ä¸å¤ªåˆç†ï¼Œè¿™ä½¿å¾—appendDivæœ‰ç‚¹å¤ªä¸ªæ€§åŒ–é‡Œï¼Œæˆä¸ºäº†ä¸€ä¸ªéš¾ä»¥æ•·ç”¨çš„å‡½æ•°ã€‚</p>
<p>å¦‚æœæŠŠ<code>div.style.display = &#39;none&#39;</code>çš„é€»è¾‘æŠ½ç¦»å‡ºæ¥ï¼Œç”¨å›è°ƒå‡½æ•°çš„å½¢å¼ä¼ å…¥appendDivï¼Œè¿™æ ·appendDivåªè¦ä¸“æ³¨äºåˆ›å»ºèŠ‚ç‚¹å°±è¡Œäº†</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> appendDiv = <span class="keyword">function</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> div = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">  div.<span class="property">innerHTML</span> = <span class="string">&#x27;æˆ‘æ˜¯ä¸€ä¸ªdiv&#x27;</span></span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(div)</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> callback === <span class="string">&#x27;function&#x27;</span>)   &#123;</span><br><span class="line">    <span class="title function_">callback</span>(div)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">appendDiv</span>(<span class="keyword">function</span>(<span class="params">node</span>) &#123;</span><br><span class="line">  node.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>é™¤æ­¤ä¹‹å¤–ï¼Œ<code>Array.prototype.sort</code>æ–¹æ³•æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªå‡½æ•°é‡Œé¢å°è£…äº†æ•°ç»„å…ƒç´ çš„æ’åºè§„åˆ™ã€‚æ’åºè§„åˆ™æ˜¯å¯å˜çš„ï¼ŒæŠŠå¯å˜çš„å°è£…åœ¨å‡½æ•°å‚æ•°é‡Œã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>].<span class="title function_">sort</span>(<span class="keyword">function</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a - b</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1, 3, 5</span></span><br></pre></td></tr></table></figure>

<h3 id="å‡½æ•°ä½œä¸ºè¿”å›å€¼è¾“å‡º"><a href="#å‡½æ•°ä½œä¸ºè¿”å›å€¼è¾“å‡º" class="headerlink" title="å‡½æ•°ä½œä¸ºè¿”å›å€¼è¾“å‡º"></a>å‡½æ•°ä½œä¸ºè¿”å›å€¼è¾“å‡º</h3><p>è®©å‡½æ•°è¿”å›ä¸€ä¸ªå¯æ‰§è¡Œçš„å‡½æ•°ï¼Œæ„å‘³ç€è¿ç®—è¿‡ç¨‹æ˜¯å¯å»¶ç»­çš„ï¼Œæ›´èƒ½ä½“ç°å‡½æ•°å¼ç¼–ç¨‹çš„å·§å¦™</p>
<p><strong>1.åˆ¤æ–­æ•°æ®çš„ç±»å‹</strong></p>
<p>è¦åˆ¤æ–­æ•°æ®ç±»å‹ï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯ç”¨<code>Object.prototype.toString</code>æ¥è®¡ç®—ï¼Œ<code>Object.prototype.toString.call(obj)</code>è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> isString = <span class="keyword">function</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(obj) === <span class="string">&#x27;[object String]&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> isArray = <span class="keyword">function</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(obj) === <span class="string">&#x27;[object Array]&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> isNumber = <span class="keyword">function</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(obj) === <span class="string">&#x27;[object Number]&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> isObject = <span class="keyword">function</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(obj) === <span class="string">&#x27;[object Object]&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™äº›å‡½æ•°çš„å‘éƒ¨åˆ†å®ç°éƒ½æ˜¯ç›¸åŒçš„ï¼Œä¸åŒçš„æ˜¯åˆ¤æ–­éƒ¨åˆ†ã€‚ä¸ºäº†é¿å…å¤šä½™çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›ä»£è¡¨æ•°æ®ç±»å‹çš„å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°æå‰ä¼ å…¥<code>isType</code>å‡½æ•°</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> isType = <span class="keyword">function</span>(<span class="params">type</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(obj) === <span class="string">`[object <span class="subst">$&#123;type&#125;</span>]`</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> isString = <span class="title function_">isType</span>(<span class="string">&#x27;String&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> isArray = <span class="title function_">isType</span>(<span class="string">&#x27;Array&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> isNumber = <span class="title function_">isType</span>(<span class="string">&#x27;Number&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> isObject = <span class="title function_">isType</span>(<span class="string">&#x27;Object&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="é«˜é˜¶å‡½æ•°çš„å…¶ä»–åº”ç”¨"><a href="#é«˜é˜¶å‡½æ•°çš„å…¶ä»–åº”ç”¨" class="headerlink" title="é«˜é˜¶å‡½æ•°çš„å…¶ä»–åº”ç”¨"></a>é«˜é˜¶å‡½æ•°çš„å…¶ä»–åº”ç”¨</h3><p><strong>1.å‡½æ•°æŸ¯é‡ŒåŒ–ï¼ˆcurryingï¼‰</strong></p>
<p>ä¸€ä¸ªcurryingçš„å‡½æ•°é¦–å…ˆä¼šæ¥å—ä¸€äº›å‚æ•°ï¼Œæ¥å—äº†è¿™äº›å‚æ•°åï¼Œè¯¥å‡½æ•°ä¸ä¼šç«‹å³æ±‚å€¼ï¼Œè€Œæ˜¯ç»§ç»­è¿”å›å¦å¤–ä¸€ä¸ªå‡½æ•°ï¼Œåˆšæ‰ä¼ å…¥çš„å‚æ•°åœ¨å‡½æ•°å½¢æˆçš„é—­åŒ…ä¸­è¢«ä¿å­˜èµ·æ¥ã€‚å¾…åˆ°å‡½æ•°çœŸæ­£éœ€è¦æ±‚å€¼çš„æ—¶å€™ï¼Œä¹‹å‰ä¼ å…¥çš„æ‰€æœ‰å‚æ•°éƒ½ä¼šè¢«ä¸€æ¬¡æ€§ç”¨äºæ±‚å€¼</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨äºå°†å‡½æ•°è¿›è¡ŒæŸ¯é‡ŒåŒ–</span></span><br><span class="line"><span class="comment"> * æ¥å—ä¸€ä¸ªå‚æ•°ï¼šå³å°†è¦è¢«curryingçš„å‡½æ•° </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> currying = <span class="keyword">function</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> args = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        [].<span class="property">push</span>.<span class="title function_">apply</span>(args, <span class="variable language_">arguments</span>)</span><br><span class="line">        <span class="comment">// arguments.callee æ˜¯ä¸€ä¸ªåœ¨å‡½æ•°å†…éƒ¨å¯ç”¨çš„å±æ€§ï¼Œå®ƒæŒ‡å‘å½“å‰æ­£åœ¨æ‰§è¡Œçš„å‡½æ•°ã€‚è¿™åœ¨åŒ¿åå‡½æ•°ä¸­ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸ä½ å¼•ç”¨å‡½æ•°æœ¬èº«ï¼Œè€Œä¸éœ€è¦çŸ¥é“å‡½æ•°çš„åå­—ã€‚</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">arguments</span>.<span class="property">callee</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sum = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> res = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">arguments</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      res += <span class="variable language_">arguments</span>[i]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†sumå‡½æ•°è¿›è¡ŒæŸ¯é‡ŒåŒ–</span></span><br><span class="line"><span class="keyword">let</span> curryingSum = <span class="title function_">currying</span>(sum)</span><br><span class="line"></span><br><span class="line"><span class="title function_">curryingSum</span>(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">curryingSum</span>(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">curryingSum</span>(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">curryingSum</span>()); <span class="comment">// 6</span></span><br></pre></td></tr></table></figure>

<p><strong>2.å‡½æ•°èŠ‚æµ</strong></p>
<p>å‡½æ•°æœ‰å¯èƒ½è¢«éå¸¸é¢‘ç¹åœ°è°ƒç”¨ï¼Œè€Œé€ æˆå¤§çš„æ€§èƒ½é—®é¢˜ã€‚å‡½æ•°èŠ‚æµçš„åŸç†ï¼šå°†å³å°†è¦è¢«æ‰§è¡Œçš„å‡½æ•°ç”¨setTimeoutå»¶è¿Ÿä¸€æ®µæ—¶é—´æ‰§è¡Œã€‚å¦‚æœè¯¥æ¬¡å»¶è¿Ÿæ‰§è¡Œè¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™å¿½ç•¥æ¥ä¸‹æ¥è°ƒç”¨è¯¥å‡½æ•°çš„è¯·æ±‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * èŠ‚æµå‡½æ•°</span></span><br><span class="line"><span class="comment"> * fnï¼šéœ€è¦è¢«å»¶è¿Ÿæ‰§è¡Œçš„å‡½æ•°</span></span><br><span class="line"><span class="comment"> * intervalï¼šå»¶è¿Ÿæ‰§è¡Œçš„æ—¶é—´</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> throttle = <span class="keyword">function</span>(<span class="params">fn, interval</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> _self = fn <span class="comment">// ä¿å­˜è¢«å»¶è¿Ÿæ‰§è¡Œçš„å‡½æ•°å¼•ç”¨</span></span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span> <span class="comment">// å®šæ—¶å™¨</span></span><br><span class="line">  <span class="keyword">let</span> firstTime = <span class="literal">true</span> <span class="comment">// æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> args = <span class="variable language_">arguments</span></span><br><span class="line">    <span class="keyword">let</span> _me = <span class="variable language_">this</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(firstTime) &#123; <span class="comment">// å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œä¸éœ€è¦å»¶è¿Ÿæ‰§è¡Œ</span></span><br><span class="line">      _self.<span class="title function_">apply</span>(_me, args)</span><br><span class="line">      <span class="keyword">return</span> firstTime = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(timer) &#123; <span class="comment">// å‰ä¸€æ¬¡å»¶è¿Ÿæ‰§è¡Œè¿˜æ²¡æœ‰å®Œæˆï¼Œå¿½ç•¥æ­¤æ¬¡è¯·æ±‚</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="comment">// å»¶è¿Ÿä¸€æ®µæ—¶é—´æ‰§è¡Œ</span></span><br><span class="line">      <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">      timer = <span class="literal">null</span></span><br><span class="line">      _self.<span class="title function_">apply</span>(_me, args)</span><br><span class="line">    &#125;, interval || <span class="number">500</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç¤ºä¾‹ï¼šç›‘å¬æµè§ˆå™¨å°ºå¯¸å˜åŒ–</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">onresize</span> = <span class="title function_">throttle</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">&#125;, <span class="number">500</span>)</span><br></pre></td></tr></table></figure>

<p><strong>3.åˆ†æ—¶å‡½æ•°</strong></p>
<p>æŸäº›å‡½æ•°æ˜¯ç”¨æˆ·ä¸»åŠ¨è°ƒç”¨çš„ï¼Œä½†å› ä¸ºä¸€äº›å®¢è§‚åŸå› ï¼Œè¿™äº›å‡½æ•°ä¼šä¸¥é‡å½±å“é¡µé¢æ€§èƒ½</p>
<p>ä¾‹å¦‚æˆ‘ä»¬è¦åœ¨é¡µé¢ä¸Šæ¸²æŸ“1000ä¸ªdivèŠ‚ç‚¹ï¼Œåœ¨çŸ­æ—¶é—´å†…å¾€é¡µé¢ä¸­å¤§é‡æ·»åŠ DOMèŠ‚ç‚¹ä¼šå¯¼è‡´æµè§ˆå™¨å¡é¡¿ç”šè‡³å‡æ­»</p>
<p>è§£å†³æ–¹æ¡ˆä¹‹ä¸€å°±æ˜¯å°†åˆ›å»ºèŠ‚ç‚¹çš„å·¥ä½œåˆ†æ‰¹è¿›è¡Œã€‚æ¯”å¦‚æŠŠ1ç§’åˆ›å»º1000ä¸ªèŠ‚ç‚¹ï¼Œæ”¹ä¸ºæ¯éš”200æ¯«ç§’åˆ›å»º8ä¸ªèŠ‚ç‚¹</p>
<p>è®¾è®¡ä¸€ä¸ª<code>timeChunk</code>å‡½æ•°æ¥åˆ†æ‰¹åˆ›å»ºèŠ‚ç‚¹ï¼Œå‡½æ•°æ¥å—3ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>aryï¼šåˆ›å»ºèŠ‚ç‚¹æ—¶éœ€è¦ç”¨åˆ°çš„åŸå§‹æ•°æ®</li>
<li>fnï¼šå°è£…äº†åˆ›å»ºèŠ‚ç‚¹é€»è¾‘çš„å‡½æ•°</li>
<li>countï¼šæ¯ä¸€æ‰¹åˆ›å»ºçš„èŠ‚ç‚¹æ•°é‡</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> timeChunk = <span class="keyword">function</span>(<span class="params">ary, fn, count</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> obj, timer</span><br><span class="line">  <span class="keyword">let</span> len = ary.<span class="property">length</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> start = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="title class_">Math</span>.<span class="title function_">min</span>(count || <span class="number">1</span>, len); i++) &#123;</span><br><span class="line">      <span class="keyword">let</span> item = ary.<span class="title function_">shift</span>()</span><br><span class="line">      <span class="title function_">fn</span>(item)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    timer = <span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span>(len === <span class="number">0</span>) &#123; <span class="comment">// å¦‚æœå…¨éƒ¨èŠ‚ç‚¹éƒ½åˆ›å»ºå¥½äº†ï¼Œå–æ¶ˆå®šæ—¶å™¨</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">clearInterval</span>(timer)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">start</span>()</span><br><span class="line">    &#125;, <span class="number">200</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ary = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;= <span class="number">1000</span>; i++) &#123;</span><br><span class="line">  ary.<span class="title function_">push</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> renderList = <span class="title function_">timeChunk</span>(ary, <span class="keyword">function</span>(<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> div = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">  div.<span class="property">innerHTML</span> = n</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(div)</span><br><span class="line">&#125;, <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">renderList</span>()</span><br></pre></td></tr></table></figure>


      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/è®¾è®¡æ¨¡å¼/">è®¾è®¡æ¨¡å¼</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2024/03/26/useMemoå’ŒuseCallback/"><span>useMemo &amp; useCallback</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2024/03/26/useMemoå’ŒuseCallback/" rel="bookmark">
        <time class="entry-date published" datetime="2024-03-26T12:59:28.000Z">
          2024-03-26
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="useMemo"><a href="#useMemo" class="headerlink" title="useMemo"></a><code>useMemo</code></h1><p><code>useMemo</code>ç”¨äºç¼“å­˜æ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½éœ€è¦è®¡ç®—çš„ç»“æœ</p>
<h2 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h2><p><strong><code>useMemo(calculateValue,dependencies)</code></strong></p>
<ul>
<li><code>calculateValue</code>: ç¼“å­˜è®¡ç®—å€¼çš„å‡½æ•°ï¼Œå®ƒåº”è¯¥æ˜¯ä¸€ä¸ªæ²¡æœ‰å‚æ•°çš„çº¯å‡½æ•°ã€‚Reactå°†åœ¨é¦–æ¬¡æ¸²æŸ“æ—¶è°ƒç”¨è¯¥å‡½æ•°ï¼Œåœ¨ä¹‹åçš„æ¸²æŸ“ä¸­ï¼Œå¦‚æœä¾èµ–é¡¹ï¼ˆ<code>dependencies</code>ï¼‰æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼ŒReactå°†ä¸ä¼šè°ƒç”¨è¯¥å‡½æ•°ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ç¼“å­˜çš„å€¼</li>
<li><code>dependencies</code>: ä¾èµ–é¡¹</li>
</ul>
<p><strong>è¿”å›å€¼</strong></p>
<ul>
<li>åœ¨åˆæ¬¡æ¸²æŸ“æ—¶ï¼Œè¿”å›<code>calculateValue</code>å‡½æ•°çš„è¿”å›å€¼</li>
<li>åœ¨ä¹‹åçš„æ¸²æŸ“ä¸­ï¼Œå¦‚æœä¾èµ–é¡¹æ²¡æœ‰å˜åŒ–ï¼Œåˆ™è¿”å›ç¼“å­˜çš„å€¼ï¼›å¦‚æœä¾èµ–é¡¹å‘ç”Ÿäº†å˜åŒ–ï¼Œå°†é‡æ–°è°ƒç”¨<code>calculateValue</code>å‡½æ•°å¹¶è®¡ç®—å‡ºæ–°çš„è¿”å›å€¼</li>
</ul>
<h2 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h2><p><code>useMemo</code>ä¸»è¦çš„ç”¨æ³•æœ‰ä¸¤ç§ï¼š</p>
<ul>
<li>é€šè¿‡ç¼“å­˜æ•°æ®ï¼Œæ¥è·³è¿‡ä»£ä»·æ˜‚è´µçš„è®¡ç®—</li>
<li>è·³è¿‡ç»„ä»¶çš„é‡æ–°æ¸²æŸ“</li>
</ul>
<p><strong>è·³è¿‡ä»£ä»·æ˜‚è´µçš„è®¡ç®—</strong></p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªtodosçš„å¤§æ•°ç»„ï¼Œéœ€è¦æ ¹æ®tabæ¥ç­›é€‰å‡ºæŸäº›æ•°ç»„é¡¹ã€‚åœ¨åˆæ¬¡æ¸²æŸ“ä¹‹åï¼Œåªæœ‰å½“todosæ•°ç»„æˆ–è€…tabå‘ç”Ÿæ”¹å˜äº†æ‰ä¼šé‡æ–°æ‰§è¡Œè¿‡æ»¤æ•°ç»„çš„æ–¹æ³•ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">TodoList</span>(<span class="params">&#123; todos, tab, theme &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> visibleTodos = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> <span class="title function_">filterTodos</span>(todos, tab), [todos, tab]);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è·³è¿‡ç»„ä»¶çš„é‡æ–°æ¸²æŸ“</strong></p>
<p>ä¾‹å¦‚ï¼Œ<code>ParentComp</code>ç»„ä»¶æ¥å—ä¸€ä¸ª<code>theme</code>çš„propsï¼Œç”¨äºæ”¹å˜ç»„ä»¶å†…éƒ¨æ ·å¼ï¼Œ<strong>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼ŒReactä¼šé€’å½’é‡æ–°æ¸²æŸ“å®ƒçš„æ‰€æœ‰å­ç»„å»º</strong>ã€‚ä¹Ÿå°±æ˜¯ï¼Œå½“<code>theme</code>é‡æ–°æ¸²æŸ“æ—¶ï¼Œä¼šå¯¼è‡´<code>SonComp</code>ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œä½†å…¶å®<code>SonComp</code>ç»„ä»¶å¹¶ä¸éœ€è¦é‡æ–°æ¸²æŸ“ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ParentComp</span>(<span class="params">&#123; theme &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> visibleTodos = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> <span class="title function_">filterTodos</span>(todos, tab), [todos, tab]);</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;theme&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">SonComp</span> <span class="attr">items</span>=<span class="string">&#123;visibleTodos&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥é€šè¿‡å°†ç»„ä»¶ç”¨<code>memo</code>åŒ…è£¹èµ·æ¥ï¼Œè¿™æ ·å½“å®ƒçš„propså’Œä¸Šæ¬¡ä¼ å…¥çš„ç›¸åŒæ—¶ï¼Œå°±ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; memo &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">SonComp</span> = <span class="title function_">memo</span>(<span class="keyword">function</span> <span class="title function_">SonComp</span>(<span class="params">&#123; items &#125;</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>å¼•å‡º<code>usecallback</code></strong></p>
<p>ç°åœ¨ï¼Œ<code>SonComp</code>ç»„ä»¶è¢«åŒ…è£¹åœ¨<code>memo</code>ä¸­ï¼Œæ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºpropsã€‚æ¯æ¬¡<code>ParentComp</code>ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œéƒ½ä¼šå¯¼è‡´<code>handleClick</code>å‡½æ•°çš„é‡æ–°åˆ›å»ºï¼Œå³äº§ç”Ÿä¸åŒçš„<code>handleClick</code>ï¼Œè¿™å°±ä¼šå¯¼è‡´<code>SonComp</code>ç»„ä»¶çš„é‡æ–°æ¸²æŸ“</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ParentComp</span>(<span class="params">&#123; theme &#125;</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> handleClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">SonComp</span> <span class="attr">handleClick</span>=<span class="string">&#123;handleClick&#125;/</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">SonComp</span> = <span class="title function_">memo</span>(<span class="keyword">function</span> <span class="title function_">SonComp</span>(<span class="params">&#123; handleClick &#125;</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;) </span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°ä½¿ç”¨<code>useMemo</code>æ¥ç¼“å­˜handleClickå‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handleClick = <span class="title function_">useMeme</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123; <span class="comment">// åŸæ¥handleClickçš„é€»è¾‘</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;,[xxx])</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çœ‹ä¸Šå»å°±å¾ˆå†—ä½™äº†ï¼Œåœ¨Reactä¸­æœ‰å¦å¤–ä¸€ä¸ªHookç”¨äºç¼“å­˜å‡½æ•°ã€‚</p>
<h1 id="useCallback"><a href="#useCallback" class="headerlink" title="useCallback"></a><code>useCallback</code></h1><p><code>useCallback</code>å…è®¸ä½ åœ¨å¤šæ¬¡æ¸²æŸ“ä¸­ç¼“å­˜å‡½æ•°</p>
<h2 id="è¯­æ³•-1"><a href="#è¯­æ³•-1" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h2><p><strong><code>useCallback(fn, dependencies)</code></strong></p>
<ul>
<li><code>fn</code>: æƒ³è¦ç¼“å­˜å‡½æ•°ï¼Œå®ƒå¯ä»¥ä¼ å…¥ä»»ä½•å‚æ•°å¹¶ä¸”è¿”å›ä»»ä½•å€¼ã€‚Reactå°†åœ¨é¦–æ¬¡æ¸²æŸ“æ—¶<strong>è¿”å›</strong>ï¼ˆä¸æ˜¯è°ƒç”¨ï¼‰è¯¥å‡½æ•°ï¼Œåœ¨ä¹‹åçš„æ¸²æŸ“ä¸­ï¼Œå¦‚æœä¾èµ–é¡¹ï¼ˆ<code>dependencies</code>ï¼‰æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼ŒReactå°†è¿”å›ç›¸åŒçš„å‡½æ•°ã€‚<strong>åœ¨ä»»ä½•æ¸²æŸ“ä¸­ï¼ŒReactéƒ½ä¸ä¼šè°ƒç”¨è¯¥å‡½æ•°ï¼Œè€Œæ˜¯è¿”å›è¯¥å‡½æ•°</strong></li>
<li><code>dependencies</code>: ä¾èµ–é¡¹</li>
</ul>
<p><strong>è¿”å›å€¼</strong></p>
<p>åœ¨åˆæ¬¡æ¸²æŸ“æ—¶ï¼Œ<code>useCallback</code>è¿”å›ä½ å·²ç»ä¼ å…¥çš„<code>fn</code>å‡½æ•°</p>
<p>åœ¨ä¹‹åçš„æ¸²æŸ“ä¸­, å¦‚æœä¾èµ–æ²¡æœ‰æ”¹å˜ï¼Œ<code>useCallback</code>è¿”å›ä¸Šä¸€æ¬¡æ¸²æŸ“ä¸­ç¼“å­˜çš„<code>fn</code>å‡½æ•°ï¼›å¦åˆ™è¿”å›è¿™ä¸€æ¬¡æ¸²æŸ“ä¼ å…¥çš„<code>fn</code>ã€‚</p>
<h2 id="ç”¨æ³•-1"><a href="#ç”¨æ³•-1" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h2><p>æ¥ç€ä¸Šé¢çš„ä¾‹å­å¯¹<code>handleClick</code>è¿›è¡Œæ”¹é€ ï¼Œä½¿å®ƒä¹Ÿè¢«ç¼“å­˜èµ·æ¥</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handleClick = <span class="title function_">useCallback</span>(<span class="function">(<span class="params">args</span>) =&gt;</span> &#123; <span class="comment">//å’Œæ™®é€šå‡½æ•°ä¸€æ ·ä½¿ç”¨</span></span><br><span class="line">    <span class="comment">// ç›´æ¥åœ¨æ­¤å¤„ä¹¦å†™é€»è¾‘ä»£ç </span></span><br><span class="line">&#125;,[xxx])</span><br></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/React-HookS/">React HookS</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2024/03/24/useRef/"><span>useRef</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2024/03/24/useRef/" rel="bookmark">
        <time class="entry-date published" datetime="2024-03-24T13:50:54.000Z">
          2024-03-24
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><code>useRef</code>å¯ä»¥ç”¨äºå¼•ç”¨ä¸€ä¸ªä¸éœ€è¦æ¸²æŸ“çš„å€¼</p>
<h2 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h2><p><strong><code>useRef(initialValue)</code></strong></p>
<ul>
<li><code>initialValue</code>: refå¯¹è±¡çš„<code>current</code>å±æ€§çš„åˆå§‹å€¼ï¼Œåªåœ¨åˆæ¬¡æ¸²æŸ“çš„æ—¶å€™æœ‰æ•ˆ</li>
</ul>
<p><strong>è¿”å›å€¼</strong></p>
<p><code>useRef</code>è¿”å›ä¸€ä¸ªåªæœ‰<code>current</code>å±æ€§çš„å¯¹è±¡ã€‚<code>current</code>åˆå§‹å€¼ä¸ºä¼ é€’çš„<code>initialValue</code>ï¼Œä¹‹åå¯ä»¥å°†å…¶è®¾ç½®ä¸ºå…¶ä»–å€¼</p>
<p>å¦‚æœå°†refå¯¹è±¡ä½œä¸ºä¸€ä¸ªJSXèŠ‚ç‚¹çš„<code>ref</code>å±æ€§ï¼ŒReactä¼šä¸ºå®ƒè®¾ç½®<code>current</code>å±æ€§</p>
<p><strong>æ³¨æ„</strong></p>
<ul>
<li><code>ref.current</code>å±æ€§å¯ä»¥ä¿®æ”¹ï¼Œå®ƒæ˜¯å¯å˜çš„ï¼Œè¿™ä¸<code>state</code>ä¸åŒ</li>
<li>æ”¹å˜<code>ref.current</code>å±æ€§ï¼Œ<strong>ä¸ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶</strong></li>
<li>é™¤äº†è¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œä¸è¦åœ¨æ¸²æŸ“æœŸé—´å†™å…¥æˆ–è¯»å–<code>ref.current</code></li>
</ul>
<blockquote>
<p>ä¸è¦åœ¨æ¸²æŸ“æœŸé—´å†™å…¥æˆ–è€…è¯»å–<code>ref.current</code>ï¼Œå¦‚æœä¸å¾—ä¸åœ¨æ¸²æŸ“æœŸé—´è¯»å–æˆ–å†™å…¥ï¼Œåº”è¯¥ä½¿ç”¨<code>state</code></p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  myRef.<span class="property">current</span> = <span class="number">123</span> <span class="comment">// âŒ ä¸è¦å†æ¸²æŸ“æœŸé—´å†™å…¥ ref</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;myRef.current&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span> <span class="comment">// âŒ ä¸è¦å†æ¸²æŸ“æœŸé—´è¯»å– ref</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨<strong>äº‹ä»¶å¤„ç†ç¨‹åºæˆ–è€…Effect</strong>ä¸­è¯»å–æˆ–å†™å…¥<code>ref</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    myRef.<span class="property">current</span> = <span class="number">123</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p><code>useRef</code>çš„ä½¿ç”¨åœºæ™¯ä¸»è¦æœ‰ä¸¤ç§ï¼š</p>
<ul>
<li>å¼•ç”¨æˆ–å­˜å‚¨ä¸€äº›ä¸å½±å“è§†å›¾çš„ä¿¡æ¯ã€‚ï¼ˆå› ä¸ºæ”¹å˜refä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ï¼‰</li>
<li>é€šè¿‡refå¯¹è±¡èµ‹å€¼ç»™DOMçš„<code>ref</code>å±æ€§æ¥è·å–æˆ–æ“ä½œDOM</li>
</ul>
<h3 id="å¼•ç”¨æˆ–å­˜å‚¨ä¸€ä¸ªå€¼"><a href="#å¼•ç”¨æˆ–å­˜å‚¨ä¸€ä¸ªå€¼" class="headerlink" title="å¼•ç”¨æˆ–å­˜å‚¨ä¸€ä¸ªå€¼"></a>å¼•ç”¨æˆ–å­˜å‚¨ä¸€ä¸ªå€¼</h3><p>ç¤ºä¾‹ï¼šä¿å­˜å®šæ—¶å™¨çš„id</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timerRef = <span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleStartClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">    timerRef.<span class="property">current</span> = timer <span class="comment">// ä¿å­˜å®šæ—¶å™¨id</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleStopClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">clearTimeout</span>(timerRef.<span class="property">current</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      // ....</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é€šè¿‡refæ“ä½œDOM"><a href="#é€šè¿‡refæ“ä½œDOM" class="headerlink" title="é€šè¿‡refæ“ä½œDOM"></a>é€šè¿‡refæ“ä½œDOM</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>(<span class="literal">null</span>) <span class="comment">// å£°æ˜ä¸€ä¸ªåˆå§‹å€¼ä¸º null çš„refå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    inputRef.<span class="property">current</span>.<span class="title function_">focus</span>() <span class="comment">//inputRef.currentè·å–åˆ°DOmèŠ‚ç‚¹ï¼Œå¹¶è°ƒç”¨inputèŠ‚ç‚¹ä¸Šçš„focusæ–¹æ³•</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> /&gt;</span></span> <span class="comment">// å°†DOMèŠ‚ç‚¹çš„refå¯¹è±¡èµ‹å€¼ç»™ref</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ— æ³•è·å–è‡ªå®šä¹‰ç»„ä»¶çš„ref"><a href="#æ— æ³•è·å–è‡ªå®šä¹‰ç»„ä»¶çš„ref" class="headerlink" title="æ— æ³•è·å–è‡ªå®šä¹‰ç»„ä»¶çš„ref"></a>æ— æ³•è·å–è‡ªå®šä¹‰ç»„ä»¶çš„ref</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œè‡ªå®šä¹‰ç»„ä»¶ä¸ä¼šæš´éœ²ä»–ä»¬å†…éƒ¨DOMèŠ‚ç‚¹çš„ref</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MyComp</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [x, setX] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;x&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> myRef = <span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(myRef.<span class="property">current</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">MyComp</span> <span class="attr">ref</span>=<span class="string">&#123;myRef&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span>è·å–ref<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å°è­¦å‘Šï¼Œæ— æ³•è·å–åˆ°ref</p>
<img src="/2024/03/24/useRef/image.png" class title="This is an image">

<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨<code>forwardRef</code>åŒ…è£¹å­ç»„ä»¶ï¼Œè¿™æ ·çˆ¶ç»„ä»¶å°±èƒ½å¾—åˆ°å®ƒçš„ref</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect, useState, useRef, forwardRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyComp</span> = <span class="title function_">forwardRef</span>(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;  <span class="comment">//forwardRefåŒ…è£¹ç»„ä»¶ï¼Œå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯refå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">const</span> [x, setX] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span>&gt;</span>&#123;x&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> myRef = <span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(myRef.<span class="property">current</span>); <span class="comment">//å¯ä»¥è·å–åˆ°å­ç»„ä»¶çš„ref</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">MyComp</span> <span class="attr">ref</span>=<span class="string">&#123;myRef&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span>è·å–ref<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/React-Hooks/">React Hooks</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2024/03/24/useState/"><span>useState</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2024/03/24/useState/" rel="bookmark">
        <time class="entry-date published" datetime="2024-03-24T03:29:45.000Z">
          2024-03-24
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><strong>ä½œä¸ºä¸€ä¸ªReact Hook</strong>ï¼Œå®ƒåªèƒ½åœ¨ç»„ä»¶çš„é¡¶å±‚è°ƒç”¨</p>
<h2 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h2><p><strong><code>useState(initialState)</code></strong></p>
<ul>
<li><code>initialState</code>ï¼šstateçš„åˆå§‹å€¼ã€‚å½“ä¼ é€’å‡½æ•°ä½œä¸ºinitialStateæ—¶ï¼Œå®ƒå°†è¢«è§†ä¸º<strong>åˆå§‹åŒ–å‡½æ•°</strong>ï¼Œå®ƒåº”è¯¥æ˜¯ä¸€ä¸ª<strong>çº¯å‡½æ•°</strong>ï¼Œä¸åº”è¯¥ä¼ å…¥ä»»ä½•å‚æ•°ï¼Œå¹¶ä¸”åº”è¯¥è¿”å›ä¸€ä¸ªå€¼æ¥ä½œä¸ºåˆå§‹å€¼ã€‚<strong>æ­¤å‚æ•°åªæœ‰åœ¨åˆå§‹åŒ–æ¸²æŸ“æ—¶ä½¿ç”¨ï¼Œåœ¨ä¹‹åå°†è¢«å¿½ç•¥</strong></li>
</ul>
<p><code>useState</code>è¿”å›ä¸€ä¸ªæ•°ç»„ï¼šçŠ¶æ€å˜é‡ å’Œ çŠ¶æ€è®¾ç½®ï¼ˆsetï¼‰å‡½æ•°</p>
<p>æŒ‰ç…§æƒ¯ä¾‹ï¼Œä½¿ç”¨è§£æ„èµ‹å€¼çš„æ–¹æ³•æ¥å‘½åçŠ¶æ€å’ŒçŠ¶æ€è®¾ç½®å‡½æ•°ï¼Œä¾‹å¦‚<code>const [x, setX] = useState(0)</code></p>
<p><strong><code>set</code>å‡½æ•°</strong></p>
<p>é€šè¿‡è°ƒç”¨<code>set</code>å‡½æ•°æ¥æ›´æ–°çŠ¶æ€å˜é‡çš„å€¼ï¼Œä½ å¯ä»¥ï¼š</p>
<ul>
<li>ä¼ å…¥ä¸€ä¸ªä¸åŒçš„æ–°å€¼ï¼Œä¾‹å¦‚: <code>setName(&#39;cqy&#39;)</code></li>
<li>åŸºäºå¾…å®šçš„<code>state</code>æ¥è®¡ç®—æ–°çš„çŠ¶æ€ï¼ˆ<strong>æ›´æ–°å‡½æ•°</strong>ï¼‰ï¼Œä¾‹å¦‚: <code>setAge(a =&gt; a + 1)</code></li>
</ul>
<blockquote>
<p>å½“å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™<code>set</code>å‡½æ•°æ—¶ï¼Œå®ƒè¢«è§†ä¸º<strong>æ›´æ–°å‡½æ•°</strong>ã€‚å®ƒå¿…é¡»æ˜¯çº¯å‡½æ•°ï¼Œå”¯ä¸€çš„å‚æ•°æ˜¯å¾…å®šçš„<code>state</code>ï¼Œå¹¶åº”è¯¥è¿”å›ä¸‹ä¸€ä¸ªçŠ¶æ€</p>
</blockquote>
<p><strong>æ³¨æ„äº‹é¡¹</strong></p>
<p><code>set</code>å‡½æ•°<strong>ä»…æ›´æ–° ä¸‹ä¸€æ¬¡ æ¸²æŸ“çš„çŠ¶æ€å˜é‡</strong>ï¼Œå¦‚æœåœ¨è°ƒç”¨<code>set</code>å‡½æ•°åç«‹åˆ»è¯»å–çŠ¶æ€ä¾¿äº†ï¼Œ<strong>å¾—åˆ°çš„ä»ç„¶æ˜¯æ¸²æŸ“åœ¨å±å¹•ä¸Šçš„æ—§å€¼</strong>ã€‚</p>
<p><strong>å¾…å®šçš„<code>state</code></strong></p>
<p>ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ç‚¹å‡»ä¹‹åå°†countå¢åŠ 3ï¼Œä½†ç»“æœæ˜¯countåªä¼šå¢åŠ 1ã€‚<br>åŸå› å°±åœ¨äºï¼Œå‰ä¸€ä¸ª<code>set</code>å‡½æ•°æ‰§è¡Œå®Œåï¼Œåä¸€ä¸ª<code>set</code>å‡½æ•°è¯»å–çš„ä»ç„¶æ˜¯æ—§çš„çŠ¶æ€ï¼ŒReactä¼šæ‰¹é‡å¤„ç†çŠ¶æ€æ›´æ–°ï¼Œåœ¨æ‰€æœ‰äº‹ä»¶å¤„ç†å‡½æ•°è¿è¡Œå¹¶è°ƒç”¨å…¶<code>set</code>å‡½æ•°åæ›´æ–°å±å¹•ã€‚æ‰€ä»¥<strong>åœ¨é¡µé¢é‡æ–°æ¸²æŸ“å‰</strong>ï¼Œè·å–åˆ°çš„ä»ç„¶æ˜¯<strong>æ—§å€¼</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">setCount</span>(count + <span class="number">1</span>);</span><br><span class="line">    <span class="title function_">setCount</span>(count + <span class="number">1</span>);</span><br><span class="line">    <span class="title function_">setCount</span>(count + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      You pressed me &#123;count&#125; times</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ç»™<code>set</code>å‡½æ•°ä¼ é€’ä¸€ä¸ª<strong>æ›´æ–°å‡½æ•°</strong>ï¼Œå®ƒå¯ä»¥æ ¹æ®**æœ€æ–°çš„<code>state</code>**ï¼ˆå³å¾…å®šçš„<code>state</code>ï¼Œå¯ä»¥ç†è§£ä¸ºè‹¥æ²¡æœ‰åç»­æ”¹å˜stateçš„æ“ä½œï¼Œè¯¥stateå°†ä¼šåœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æ—¶è¢«ä½¿ç”¨ï¼‰çŠ¶æ€æ¥è®¡ç®—æ›´æ–°ä¸‹ä¸€ä¸ª<code>state</code>çŠ¶æ€</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">setCount</span>(<span class="function"><span class="params">c</span> =&gt;</span> c + <span class="number">1</span>); <span class="comment">// setCount(0 =&gt; 1)</span></span><br><span class="line">  <span class="title function_">setCount</span>(<span class="function"><span class="params">c</span> =&gt;</span> c + <span class="number">1</span>); <span class="comment">// setCount(1 =&gt; 2)</span></span><br><span class="line">  <span class="title function_">setCount</span>(<span class="function"><span class="params">c</span> =&gt;</span> c + <span class="number">1</span>); <span class="comment">// setCount(2 =&gt; 3)</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// c =&gt; c + 1 æ˜¯æ›´æ–°å‡½æ•°ï¼Œå®ƒè·å– å¾…å®šçŠ¶æ€ å¹¶æ ¹æ®æ­¤è®¡ç®—ä¸‹ä¸€ä¸ªçŠ¶æ€</span></span><br></pre></td></tr></table></figure>

<h2 id="æ›´æ–°çŠ¶æ€ä¸­çš„å¯¹è±¡å’Œæ•°ç»„"><a href="#æ›´æ–°çŠ¶æ€ä¸­çš„å¯¹è±¡å’Œæ•°ç»„" class="headerlink" title="æ›´æ–°çŠ¶æ€ä¸­çš„å¯¹è±¡å’Œæ•°ç»„"></a>æ›´æ–°çŠ¶æ€ä¸­çš„å¯¹è±¡å’Œæ•°ç»„</h2><p>å½“æŠŠå¯¹è±¡å’Œæ•°ç»„ä½œä¸ºçŠ¶æ€å˜é‡æ—¶ï¼Œä½ åº”è¯¥æ›¿æ¢å®ƒè€Œä¸åº”è¯¥å•çº¯çš„æ”¹å˜å¯¹è±¡ä¸­çš„æŸä¸ªå±æ€§æˆ–è€…æ•°ç»„ä¸­çš„æŸé¡¹</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [obj, setObj] = <span class="title function_">useState</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;easycodesniper&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">22</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">obj.<span class="property">name</span> = <span class="string">&#x27;xxx&#x27;</span>  <span class="comment">//âŒ é”™è¯¯çš„ä¿®æ”¹æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">setObj</span>(&#123; <span class="comment">// æ­£ç¡®çš„ä¿®æ”¹æ–¹æ³•</span></span><br><span class="line">  ...obj,  </span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="é¿å…é‡å¤åˆ›å»ºåˆå§‹çŠ¶æ€"><a href="#é¿å…é‡å¤åˆ›å»ºåˆå§‹çŠ¶æ€" class="headerlink" title="é¿å…é‡å¤åˆ›å»ºåˆå§‹çŠ¶æ€"></a>é¿å…é‡å¤åˆ›å»ºåˆå§‹çŠ¶æ€</h2><p>Reactåªåœ¨åˆæ¬¡æ¸²æŸ“æ—¶ä¿å­˜åˆå§‹çŠ¶æ€ï¼Œåç»­æ¸²æŸ“éƒ½ä¼šå¿½ç•¥</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [ x, setX ] = <span class="title function_">useState</span>(<span class="title function_">createInitialX</span>()) <span class="comment">//ä¸å¥½çš„å®è·µ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å°½ç®¡<code>createInitialX()</code>çš„ç»“æœä»…ç”¨äºåˆæ¬¡æ¸²æŸ“ï¼Œä½†æ˜¯æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶éƒ½è¦è°ƒç”¨æ­¤å‡½æ•°ï¼Œå¦‚æœå®ƒçš„æ‰§è¡Œéœ€è¦æ˜‚è´µçš„è®¡ç®—ï¼Œä¼šå¯¼è‡´èµ„æºæµªè´¹<br>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ åº”è¯¥æŠŠå‡½æ•°æœ¬èº«ä½œä¸ºåˆå§‹åŒ–å‡½æ•°ä¼ é€’ç»™<code>useState</code>ï¼Œè€Œä¸æ˜¯è°ƒç”¨è¯¥å‡½æ•°</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [ x, setX ] = <span class="title function_">useState</span>(createInitialX) <span class="comment">//åˆç†çš„å®è·µ</span></span><br></pre></td></tr></table></figure>

<h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/React-Hooks/">React Hooks</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2024/03/23/useEffect/"><span>useEffect</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2024/03/23/useEffect/" rel="bookmark">
        <time class="entry-date published" datetime="2024-03-23T09:07:57.000Z">
          2024-03-23
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><code>Effect</code>åœ¨Reactä¸­è¢«ä¸“é—¨å®šä¹‰ä¸ºï¼šç”±æ¸²æŸ“å¼•èµ·çš„å‰¯ä½œç”¨ã€‚å®ƒå…è®¸ä½ æŒ‡å®šç”±æ¸²æŸ“æœ¬èº«ï¼Œè€Œä¸æ˜¯ç‰¹å®šäº‹ä»¶å¼•èµ·çš„å‰¯ä½œç”¨</p>
<p><code>useEffect</code>è¢«è®¾è®¡ç”¨äºå°†ç»„ä»¶å’Œå¤–éƒ¨ç³»ç»ŸåŒæ­¥ï¼Œä¾‹å¦‚æ•°æ®è·å–ã€æœåŠ¡å™¨çš„é“¾æ¥ã€è®¾ç½®è®¢é˜…ç­‰ä¸å—Reactæ§åˆ¶çš„ç³»ç»Ÿ</p>
<p><strong>ä½œä¸ºä¸€ä¸ªReact Hook</strong>ï¼Œå®ƒåªèƒ½åœ¨ç»„ä»¶çš„é¡¶å±‚è°ƒç”¨ï¼Œå¦‚æœä½ éœ€è¦åœ¨å¾ªç¯æˆ–åˆ¤æ–­çš„é€»è¾‘ä¸­è°ƒç”¨ï¼Œå¯ä»¥å°†è¿™éƒ¨åˆ†é€»è¾‘æŠ½ç¦»å‡ºå»æˆä¸ºä¸€ä¸ªç»„ä»¶ã€‚</p>
<h2 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h2><p><strong><code>useEffect(setup, dependencies?)</code></strong></p>
<ul>
<li><code>setup</code>: å¤„ç†Effectçš„å‡½æ•°ï¼Œå¯ä»¥é€‰æ‹©æ€§çš„è¿”å›ä¸€ä¸ªæ¸…ç†ï¼ˆcleanupï¼‰å‡½æ•°ã€‚å½“ ç»„ä»¶è¢«æ·»åŠ åˆ°DOMæ—¶ å’Œ æ¯æ¬¡ä¾èµ–é¡¹å‘ç”Ÿå˜åŒ–é‡æ–°æ¸²æŸ“åï¼ŒReactä¼šé¦–å…ˆåˆ©ç”¨æ—§å€¼è¿è¡Œ<code>cleanup</code>å‡½æ•°ï¼ˆå¦‚æœä½ è®¾ç½®äº†è¯¥å‡½æ•°ï¼‰ï¼Œç„¶åä½¿ç”¨æ–°å€¼è¿è¡Œ<code>setup</code>å‡½æ•°ã€‚åœ¨ç»„ä»¶ä»DOMä¸­ç§»é™¤åï¼ŒReactå°†æœ€åä¸€æ¬¡è¿è¡Œ<code>cleanup</code>å‡½æ•°</li>
<li><code>dependencies</code>ï¼ˆå¯é€‰ï¼‰: <code>setup</code>å‡½æ•°ä¸­å¼•ç”¨çš„æ‰€æœ‰å“åº”å¼å€¼çš„åˆ—è¡¨ã€‚<ul>
<li>Reactä¼šä½¿ç”¨<code>Object.is</code>æ¥æ¯”è¾ƒæ¯ä¸ªä¾èµ–é¡¹å’Œå®ƒå…ˆå‰çš„å€¼ï¼Œåªè¦æœ‰ä¾èµ–é¡¹å’Œå…ˆå‰çš„å€¼ä¸åŒæ—¶ï¼Œå°†ä¼šé‡æ–°è¿è¡Œ<code>setup</code>å‡½æ•°ã€‚</li>
<li>å¦‚æœå¿½ç•¥æ­¤å‚æ•°ï¼Œåˆ™åœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“ç»„ä»¶ä¹‹åï¼Œå°†é‡æ–°æ‰§è¡Œ<code>setup</code>å‡½æ•°</li>
<li>å¦‚æœæ­¤å‚æ•°ä¸ºç©ºæ•°ç»„<code>[]</code>ï¼Œåˆ™åªåœ¨åˆæ¬¡æ¸²æŸ“ç»„ä»¶çš„æ—¶å€™æ‰§è¡Œ<code>setup</code>å‡½æ•°</li>
</ul>
</li>
</ul>
<p><code>useEffect</code>çš„è¿è¡Œè¿‡ç¨‹ï¼š</p>
<ol>
<li>å°†ç»„ä»¶æŒ‚è½½åˆ°é¡µé¢æ—¶ï¼Œå°†è¿è¡Œ<code>setup</code>å‡½æ•°</li>
<li>é‡æ–°æ¸²æŸ“ä¾èµ–é¡¹å˜æ›´çš„ç»„ä»¶åï¼š</li>
</ol>
<ul>
<li>é¦–å…ˆï¼Œä½¿ç”¨æ—§å€¼è¿è¡Œ<code>cleanup</code>å‡½æ•°</li>
<li>ç„¶åï¼Œä½¿ç”¨æ–°å€¼è¿è¡Œ<code>setup</code>å‡½æ•°</li>
</ul>
<ol start="3">
<li>å½“ç»„ä»¶ä»é¡µé¢å¸è½½åï¼Œ<code>cleanup</code>å‡½æ•°å°†è¿è¡Œæœ€åä¸€æ¬¡</li>
</ol>
<blockquote>
<p>åœ¨<strong>å¼€å‘ç¯å¢ƒ</strong>ä¸‹ï¼ŒReactåœ¨è¿è¡Œ<code>setup</code>ä¹‹å‰ä¼šé¢å¤–è¿è¡Œä¸€æ¬¡<code>setup</code>å’Œ<code>cleanup</code>ï¼Œè¿™æ˜¯ä¸€ç§å‹åŠ›æµ‹è¯•ï¼Œæ¥éªŒè¯Effecté€»è¾‘æ˜¯å¦æ­£ç¡®å®ç°</p>
</blockquote>
<p>ä½¿ç”¨ç¤ºä¾‹ï¼šæ¨¡æ‹Ÿä¸€ä¸ªè¿æ¥æœåŠ¡å™¨çš„ç»„ä»¶</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [serverUrl, setServerUrl] = <span class="title function_">useState</span>(<span class="string">&#x27;easycodesniper.top&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> connection = <span class="title function_">createConnection</span>(serverUrl) <span class="comment">//æ¨¡æ‹Ÿè¿æ¥æœåŠ¡å™¨</span></span><br><span class="line">    connection.<span class="title function_">connect</span>()</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123; <span class="comment">//åœ¨é”€æ¯ç»„ä»¶æ—¶æ–­å¼€è¿æ¥</span></span><br><span class="line">      connection.<span class="title function_">disconnect</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [serverUrl]) <span class="comment">//ä¾èµ–é¡¹ï¼Œå½“æœåŠ¡å™¨è·¯å¾„æ”¹å˜æ—¶é‡æ–°æ‰§è¡Œsetup</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>æ¬¢è¿æ¥åˆ°&#123;serverUrl&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<h2 id="useEffectæ‰§è¡Œæ—¶æœº"><a href="#useEffectæ‰§è¡Œæ—¶æœº" class="headerlink" title="useEffectæ‰§è¡Œæ—¶æœº"></a><code>useEffect</code>æ‰§è¡Œæ—¶æœº</h2><p>æ¯å½“ä½ çš„ç»„ä»¶æ¸²æŸ“æ—¶ï¼ŒReactå°†æ›´æ–°è§†å›¾ï¼Œ<strong>ç„¶åè¿è¡Œ</strong><code>useEffect</code>ä¸­çš„ä»£ç ã€‚æ¢å¥è¯è¯´ï¼Œ**<code>useEffect</code>ä¼šæŠŠè¿™æ®µä»£ç æ”¾åˆ°è§†å›¾æ›´æ–°æ¸²æŸ“ä¹‹åæ‰§è¡Œ**</p>
<h2 id="å®è·µå¯¼å‘"><a href="#å®è·µå¯¼å‘" class="headerlink" title="å®è·µå¯¼å‘"></a>å®è·µå¯¼å‘</h2><h3 id="åœ¨Effectä¸­æ ¹æ®å…ˆå‰çš„stateæ›´æ–°state"><a href="#åœ¨Effectä¸­æ ¹æ®å…ˆå‰çš„stateæ›´æ–°state" class="headerlink" title="åœ¨Effectä¸­æ ¹æ®å…ˆå‰çš„stateæ›´æ–°state"></a>åœ¨Effectä¸­æ ¹æ®å…ˆå‰çš„stateæ›´æ–°state</h3><p>å½“æƒ³åœ¨Effectä¸­æ ¹æ®å…ˆå‰çš„stateæ›´æ–°stateæ—¶ï¼Œä¼šé‡åˆ°é—®é¢˜ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [cnt, setCnt] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setCnt</span>(cnt + <span class="number">1</span>) <span class="comment">//æ¯ç§’å°†cntåŠ 1</span></span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(timer)</span><br><span class="line">  &#125;, [cnt]) <span class="comment">//å°†cntä½œä¸ºä¾èµ–é¡¹</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">spsn</span>&gt;</span>&#123;cnt&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å› ä¸º<code>cnt</code>æ˜¯å“åº”å¼æ•°æ®ï¼Œæ‰€ä»¥å¿…é¡»åœ¨ä¾èµ–é¡¹åˆ—è¡¨ä¸­æŒ‡å®šå®ƒï¼Œè¿™å°±ä¼šå¯¼è‡´Effectåœ¨æ¯æ¬¡cntå˜åŒ–ä¹‹åéƒ½è¦æ‰§è¡Œ<code>cleanup</code>å’Œ<code>setup</code></p>
<p>è§£å†³æ–¹æ³•ï¼šåœ¨<code>setCnt</code>ä¸­ä¸æ˜¯ç›´æ¥ä¼ å…¥ä¿®æ”¹çš„å€¼ï¼Œè€Œæ˜¯ä¼ å…¥<code>c =&gt; c + 1</code>çŠ¶æ€æ›´æ–°å™¨ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ï¼š<strong>å°†cntä»ä¾èµ–é¡¹ä¸­ç§»é™¤</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [cnt, setCnt] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setCnt</span>(<span class="function"><span class="params">c</span> =&gt;</span> c + <span class="number">1</span>) <span class="comment">//æ¯ç§’å°†cntåŠ 1</span></span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(timer)</span><br><span class="line">  &#125;, []) </span><br></pre></td></tr></table></figure>

<h3 id="Effectä¾èµ–äºå¯¹è±¡æˆ–å‡½æ•°"><a href="#Effectä¾èµ–äºå¯¹è±¡æˆ–å‡½æ•°" class="headerlink" title="Effectä¾èµ–äºå¯¹è±¡æˆ–å‡½æ•°"></a>Effectä¾èµ–äºå¯¹è±¡æˆ–å‡½æ•°</h3><p>å¦‚æœä½ çš„Effectä¾èµ–äºæ¸²æŸ“æœŸé—´åˆ›å»ºçš„å¯¹è±¡æˆ–å‡½æ•°ï¼Œåˆ™å®ƒå¯èƒ½ä¼šé¢‘ç¹è¿è¡Œ</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">createOptions</span>(<span class="params">serverUrl</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      serverUrl,</span><br><span class="line">      <span class="comment">// ... others</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> options = <span class="title function_">createOptions</span>(<span class="string">&#x27;easycodesniper.top&#x27;</span>) <span class="comment">//åœ¨Effectä¸­è¢«ä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">const</span> connection = <span class="title function_">createConnection</span>(options)</span><br><span class="line">    connection.<span class="title function_">connect</span>()</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123; </span><br><span class="line">      connection.<span class="title function_">disconnect</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [createOptions]) </span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>æ¬¢è¿æ¥åˆ°&#123;serverUrl&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<p>å¯¹<code>createOptions</code>å‡½æ•°æœ¬èº«çš„å°è£…å¹¶æ²¡æœ‰é—®é¢˜ã€‚</p>
<p>é¦–å…ˆï¼Œå¯¹è±¡æˆ–å‡½æ•°éƒ½æ˜¯å¼•ç”¨ç±»å‹çš„å€¼ï¼Œåˆ¤æ–­ä»–ä»¬æ˜¯å¦ç›¸åŒæ˜¯é€šè¿‡æ˜¯å¦æŒ‡å‘åŒä¸€å—å†…å­˜åœ°å€</p>
<p>ç„¶åï¼Œæ¯æ¬¡ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œéƒ½ä¼šä»å¤´åˆ›å»ºä¸€ä¸ª<code>createOptions</code>å‡½æ•°ï¼Œé‚£è¿™ä¸ªå‡½æ•°çš„åœ°å€å’Œä¹‹å‰çš„åœ°å€è‚¯å®šä¸åŒï¼Œä¹Ÿå°±æ„å‘³ç€è¿™ä¸¤è€…ä¸æ˜¯ç›¸åŒçš„ï¼ˆå³ä¾èµ–é¡¹å‘ç”Ÿäº†æ”¹å˜ï¼‰ï¼Œä¼šå¯¼è‡´Effectåœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“ä¹‹åå†æ¬¡é‡æ–°æ‰§è¡Œ</p>
<p>æ‰€ä»¥ï¼Œ<strong>é¿å…ä½¿ç”¨åœ¨æ¸²æŸ“æœŸé—´åˆ›å»ºçš„å‡½æ•°ä½œä¸ºä¾èµ–é¡¹</strong>ï¼Œ<strong>è¯·åœ¨<code>Effect</code>å†…éƒ¨å£°æ˜å®ƒ</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [serverUrl, setServerUrl] = <span class="title function_">useState</span>(<span class="string">&#x27;easycodesniper.top&#x27;</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨Effectå†…éƒ¨åˆ›å»ºå®ƒ</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">createOptions</span>(<span class="params">serverUrl</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        serverUrl,</span><br><span class="line">        <span class="comment">// ... others</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> options = <span class="title function_">createOptions</span>(serverUrl) <span class="comment">//åœ¨Effectä¸­è¢«ä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">const</span> connection = <span class="title function_">createConnection</span>(options)</span><br><span class="line">    connection.<span class="title function_">connect</span>()</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123; </span><br><span class="line">      connection.<span class="title function_">disconnect</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [serverUrl]) </span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>æ¬¢è¿æ¥åˆ°&#123;serverUrl&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡åœ¨<code>Effect</code>å†…éƒ¨å®šä¹‰<code>createOption</code>å‡½æ•°ï¼Œè¿™æ ·<code>Effect</code>åªä¾èµ–äº<code>serverUrl</code>å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²ä½œä¸ºåŸºç¡€ç±»å‹å€¼ï¼Œé™¤éä½ å°†å®ƒè®¾ç½®ä¸ºå…¶ä»–å€¼ï¼Œå¦åˆ™å®ƒä¸ä¼šæ”¹å˜</p>
<h3 id="ä½ ä¸éœ€è¦Effect"><a href="#ä½ ä¸éœ€è¦Effect" class="headerlink" title="ä½ ä¸éœ€è¦Effect"></a>ä½ ä¸éœ€è¦<code>Effect</code></h3><p><code>Effect</code>æ˜¯ReactèŒƒå¼ä¸­çš„ä¸€ç§è„±å›´æœºåˆ¶ã€‚å®ƒè®©ä½ å¯ä»¥ä½¿ç»„ä»¶å’Œä¸€äº›å¤–éƒ¨çš„ç³»ç»ŸåŒæ­¥ã€‚å¦‚æœæ²¡æœ‰æ¶‰åŠåˆ°å¤–éƒ¨ç³»ç»Ÿï¼ˆä¾‹å¦‚åªæ˜¯åƒæ ¹æ®propsæˆ–stateçš„å˜åŒ–æ›´æ–°ä¸€ä¸ªç»„ä»¶çš„stateï¼‰ï¼Œä½ å°±ä¸åº”è¯¥ä½¿ç”¨<code>Effect</code></p>
<p><strong>å¸¸è§çš„æƒ…å†µï¼š</strong></p>
<ol>
<li><strong>ä¸å¿…ä½¿ç”¨Effectæ¥è½¬æ¢æ¸²æŸ“æ‰€éœ€çš„æ•°æ®</strong>ã€‚ä¾‹å¦‚ï¼Œæƒ³åœ¨å±•ç¤ºä¸€ä¸ªåˆ—è¡¨ä¹‹å‰å…ˆåšç­›é€‰ï¼Œä½ å¯èƒ½ä¼šå†™ä¸€ä¸ªå½“åˆ—è¡¨å˜åŒ–æ—¶æ›´æ–°stateçš„<code>Effect</code>ã€‚ç„¶è€Œï¼Œè¿™æ˜¯ä½æ•ˆçš„ã€‚</li>
</ol>
<ul>
<li>å½“ä½ æ›´æ–°stateï¼ŒReacté¦–å…ˆä¼šè°ƒç”¨ç»„ä»¶æ¥æ¸²æŸ“è§†å›¾</li>
<li>ç„¶åReactä¼šæ‰§è¡Œä½ çš„<code>Effect</code>ï¼Œå¦‚æœä½ çš„<code>Effect</code>ä¹Ÿç«‹å³æ›´æ–°äº†è¿™ä¸ªstateï¼Œå°†ä¼šé‡æ–°æ‰§è¡Œæ•´ä¸ªç»„ä»¶</li>
</ul>
<p>æ‰€ä»¥ï¼Œä½ åº”è¯¥åœ¨ç»„ä»¶çš„é¡¶å±‚è½¬æ¢æ•°æ®</p>
<ol start="2">
<li><strong>æ ¹æ®propsæˆ–stateæ¥æ›´æ–°state</strong>ã€‚ä¾‹å¦‚ï¼Œä½ åˆä¸€ä¸ªåŒ…å«äº†ä¸¤ä¸ªstateå˜é‡çš„ç»„ä»¶ï¼š<code>firstName</code> å’Œ <code>lastName</code>ã€‚ä½ æƒ³é€šè¿‡ä»–ä»¬è®¡ç®—å‡º<code>fullName</code>ã€‚ä½ å¯èƒ½ä¼šå†™ä¸€ä¸ªå½“<code>firstName</code>æˆ–è€…<code>lastName</code>å˜åŒ–æ—¶æ›´æ–°<code>fullName</code>çš„<code>Effect</code></li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [firstName, setFirstName] = <span class="title function_">useState</span>(<span class="string">&#x27;easycode&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> [lastName, setLastName] = <span class="title function_">useState</span>(<span class="string">&#x27;sniper&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [fullName, setFullName] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setFullName</span>(firstName + <span class="string">&#x27; &#x27;</span> + lastName);</span><br><span class="line">  &#125;, [firstName, lastName]);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·åšä¼šå¯¼è‡´ï¼š</p>
<ul>
<li>é¦–å…ˆï¼ŒReactä¼šè°ƒç”¨ç»„ä»¶ï¼Œä½¿ç”¨<code>fullName</code>çš„æ—§å€¼æ‰§è¡Œæ•´ä¸ªæ¸²æŸ“æµç¨‹</li>
<li>ç„¶åï¼ŒReactä¼šæ‰§è¡Œä½ çš„<code>Effect</code>ï¼Œç”¨æ›´æ–°åçš„å€¼åˆé‡æ–°æ¸²æŸ“äº†ä¸€é</li>
</ul>
<p>æ‰€ä»¥ï¼Œä½ åº”è¯¥ç›´æ¥è®¡ç®—è¿™ä¸ªå€¼<code>const fullName = firstName + &#39; &#39; + lastName</code></p>
<h3 id="åˆå§‹åŒ–åº”ç”¨"><a href="#åˆå§‹åŒ–åº”ç”¨" class="headerlink" title="åˆå§‹åŒ–åº”ç”¨"></a>åˆå§‹åŒ–åº”ç”¨</h3><p>æœ‰äº›é€»è¾‘åªéœ€è¦åœ¨åº”ç”¨åŠ è½½æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œä½ å¯èƒ½ä¼šå°†å®ƒæ”¾åˆ°ä¸€é¡¶å±‚ç»„ä»¶çš„<code>Effect</code>ä¸­</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">loadFunction</span>() </span><br><span class="line">  &#125;, [])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼šåœ¨å¼€å‘ç¯å¢ƒå®ƒä¼šè¢«æ‰§è¡Œä¸¤æ¬¡ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ½œåœ¨çš„é—®é¢˜</p>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<p><strong>æ·»åŠ ä¸€ä¸ªé¡¶å±‚å˜é‡æ¥è®°å½•å®ƒæ˜¯å¦å·²ç»æ‰§è¡Œè¿‡äº†</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> didInit = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!didInit) &#123;</span><br><span class="line">      didInit = <span class="literal">true</span></span><br><span class="line">      <span class="comment">// åªåœ¨æ¯æ¬¡åº”ç”¨åŠ è½½æ—¶æ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">      <span class="title function_">loadFunction</span>() </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;, [])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è·å–æ•°æ®"><a href="#è·å–æ•°æ®" class="headerlink" title="è·å–æ•°æ®"></a>è·å–æ•°æ®</h3><p>å¾ˆå¤šåœºæ™¯éƒ½éœ€è¦ä½¿ç”¨<code>Effect</code>æ¥å‘èµ·æ•°æ®è¯·æ±‚ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">SearchResults</span>(<span class="params">&#123; query &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [results, setResults] = <span class="title function_">useState</span>([]);</span><br><span class="line">  <span class="keyword">const</span> [page, setPage] = <span class="title function_">useState</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿå‘é€æ•°æ®è¯·æ±‚</span></span><br><span class="line">    <span class="title function_">fetchResults</span>(query, page).<span class="title function_">then</span>(<span class="function"><span class="params">json</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setResults</span>(json);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, [query, page]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶è€Œä¸Šé¢çš„ä»£ç æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå‡å¦‚ä½ å¿«é€Ÿçš„è¾“å…¥<code>hello</code>ï¼Œé‚£ä¹ˆqueryä¼šä»<code>h</code>å˜æˆ<code>he</code>,<code>hel</code>,<code>hell</code>æœ€åæ˜¯<code>hello</code>ï¼Œè¿™ä¼šè§¦å‘ä¸€è¿ä¸²ä¸åŒçš„æ•°æ®è¯·æ±‚ï¼Œä½†æ— æ³•ä¿è¯è¿”å›é¡ºåºã€‚ä¾‹å¦‚ï¼Œ<code>hell</code>çš„å“åº”å¯èƒ½åœ¨<code>hello</code>çš„å“åº”<strong>ä¹‹å</strong>è¿”å›ï¼Œè¿™å°†ä¼šæ˜¾ç¤ºé”™è¯¯çš„æœç´¢ç»“æœ</p>
<p>ä¸ºäº†ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ª<strong>æ¸…ç†å‡½æ•°</strong>æ¥å¿½ç•¥è¾ƒæ—©çš„è¿”å›ç»“æœ</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">SearchResults</span>(<span class="params">&#123; query &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [results, setResults] = <span class="title function_">useState</span>([]);</span><br><span class="line">  <span class="keyword">const</span> [page, setPage] = <span class="title function_">useState</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> ignore = <span class="literal">false</span>;</span><br><span class="line">    <span class="title function_">fetchResults</span>(query, page).<span class="title function_">then</span>(<span class="function"><span class="params">json</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!ignore) &#123;</span><br><span class="line">        <span class="title function_">setResults</span>(json);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      ignore = <span class="literal">true</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [query, page]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™å¯ä»¥ç¡®ä¿åœ¨<code>Effect</code>ä¸­è·å–æ•°æ®æ—¶ï¼Œé™¤äº†æœ€åä¸€æ¬¡è¯·æ±‚çš„æ‰€æœ‰è¿”å›ç»“æœéƒ½å°†è¢«å¿½ç•¥</p>
<h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/React-Hooks/">React Hooks</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2024/03/11/æµ…å°React/"><span>æµ…å°React</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2024/03/11/æµ…å°React/" rel="bookmark">
        <time class="entry-date published" datetime="2024-03-11T06:28:57.000Z">
          2024-03-11
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="èƒ¡å­è¯­æ³•"><a href="#èƒ¡å­è¯­æ³•" class="headerlink" title="èƒ¡å­è¯­æ³•{}"></a>èƒ¡å­è¯­æ³•<code>&#123;&#125;</code></h2><p>åœ¨<code>&#123;&#125;</code> ä¸­å¯ä»¥åµŒå…¥JSè¡¨è¾¾å¼ï¼š</p>
<ol>
<li>å˜é‡&#x2F;å€¼:  <code>&#123; text &#125;</code></li>
<li>æ•°å­¦è¿ç®—</li>
<li>åˆ¤æ–­: ä¸‰å…ƒè¿ç®—ç¬¦ã€å–åã€ä¸æˆ–éç­‰é€»è¾‘åˆ¤æ–­</li>
<li>å¾ªç¯: å€ŸåŠ©äºæ•°ç»„çš„è¿­ä»£æ–¹æ³•å¤„ç†ï¼Œä¾‹å¦‚mapã€filter</li>
</ol>
<p>æ³¨æ„ç‚¹ï¼š</p>
<ol>
<li>ä¸æ”¯æŒæ¸²æŸ“æ™®é€šå¯¹è±¡ï¼Œä½†ä¹Ÿæœ‰ç‰¹æ®Šæƒ…å†µï¼š<ul>
<li>æ¸²æŸ“JSXè™šæ‹ŸDOMå¯¹è±¡</li>
<li>ç»™å…ƒç´ è®¾ç½®styleè¡Œå†…æ ·å¼ï¼Œè¦æ±‚å¿…é¡»å†™æˆä¸€ä¸ªå¯¹è±¡æ ¼å¼ï¼Œå¯¹è±¡å†…çš„æ ·å¼å†™æˆé©¼å³°å‘½å</li>
</ul>
</li>
<li>æ•°ç»„å¯¹è±¡ï¼šæŠŠæ•°ç»„ä¸­çš„æ¯ä¸€é¡¹éƒ½æ‹¿å‡ºæ¥æ¸²æŸ“ï¼Œå¹¶ä¸æ˜¯å˜ä¸ºå­—ç¬¦ä¸²æ¸²æŸ“ï¼Œä¸­é—´æ²¡æœ‰é€—å·</li>
<li>å‡½æ•°å¯¹è±¡ï¼Œä¸æ”¯æŒç›´æ¥æ¸²æŸ“ï¼Œå¯ä»¥ä½œä¸ºå‡½æ•°ç»„ä»¶çš„å½¢å¼æ¸²æŸ“</li>
</ol>
<h2 id="JSXæ¸²æŸ“æœºåˆ¶"><a href="#JSXæ¸²æŸ“æœºåˆ¶" class="headerlink" title="JSXæ¸²æŸ“æœºåˆ¶"></a>JSXæ¸²æŸ“æœºåˆ¶</h2><p>ç¬¬ä¸€æ­¥ï¼šå°†æˆ‘ä»¬ç¼–å†™çš„JSXè¯­æ³•ç¼–è¯‘ä¸ºvirtualDOMå¯¹è±¡ï¼ˆvirtualDOMå¯¹è±¡ï¼šæ¡†æ¶è‡ªå·±å†…éƒ¨æ„å»ºçš„ä¸€å¥—å¯¹è±¡ä½“ç³»ï¼ŒåŸºäºå¯¹è±¡çš„å±æ€§æè¿°å‡ºæ‰€æ„å»ºè§†å›¾ä¸­çš„DOMèŠ‚ç‚¹çš„ç›¸å…³ç‰¹å¾ï¼‰</p>
<ul>
<li>åŸºäº babel-preset-react-app æŠŠJSXç¼–è¯‘ä¸º <code>React.createElement()</code>çš„æ ¼å¼</li>
<li><code>React.createElement(ele, props, ...children)</code><ul>
<li>ele: å…ƒç´ æ ‡ç­¾åæˆ–ç»„ä»¶å</li>
<li>props: å…ƒç´ çš„å±æ€§é›†åˆï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®è¿‡ä»»ä½•å±æ€§ï¼Œå€¼ä¸ºnull</li>
<li>children: ä»ç¬¬ä¸‰ä¸ªåŠä»¥åçš„å‚æ•°ï¼Œéƒ½æ˜¯å½“å‰å…ƒç´ çš„å­èŠ‚ç‚¹</li>
</ul>
</li>
<li>å†æŠŠcreateElementæ–¹æ³•æ‰§è¡Œï¼Œåˆ›å»ºå‡ºvirtualDOM</li>
<li>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">virtualDOM = &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="attr">$$typeof</span>: <span class="title class_">Symbol</span>(react.<span class="property">element</span>), </span><br><span class="line">  <span class="attr">ref</span>: <span class="literal">null</span>, </span><br><span class="line">  <span class="attr">key</span>: <span class="literal">null</span>, </span><br><span class="line">  <span class="attr">type</span>: æ ‡ç­¾å, </span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    å…ƒç´ ç›¸å…³å±æ€§ï¼Œ</span><br><span class="line">    <span class="attr">children</span>: å­èŠ‚ç‚¹ä¿¡æ¯</span><br><span class="line">  &#125; || &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
ç¬¬äºŒæ­¥ï¼šæŠŠæ„å»ºçš„virtualDOMæ¸²æŸ“ä¸ºçœŸå®DOM</li>
</ul>
<p>ç¬¬ä¸€æ¬¡æ¸²æŸ“å®Œæ¯•åï¼Œä¼šæŠŠåˆ›å»ºçš„virtualDOMç¼“å­˜èµ·æ¥</p>
<p>å½“æˆ‘ä»¬ç»è¿‡æŸäº›æ“ä½œï¼Œæ”¹å˜äº†è§†å›¾ä¸­çš„æ•°æ®ï¼Œè§†å›¾å°±éœ€è¦æ›´æ–°</p>
<ul>
<li>æŒ‰ç…§æœ€æ–°çš„æ•°æ®ï¼ŒæŠŠJSXé‡æ–°ç¼–è¯‘ä¸º å…¨æ–°çš„virtualDOM</li>
</ul>
<p>æ‹¿æ–°çš„virtualDOMä¸ä¹‹å‰ç¼“å­˜çš„virtualDOMä½¿ç”¨diffç®—æ³•è¿›è¡Œå¯¹æ¯”ï¼Œç”Ÿæˆè¡¥ä¸åŒ…Patchï¼Œåªé‡æ–°æ¸²æŸ“è¡¥ä¸åŒ…</p>
<h2 id="å‡½æ•°ç»„ä»¶çš„æ¸²æŸ“æœºåˆ¶"><a href="#å‡½æ•°ç»„ä»¶çš„æ¸²æŸ“æœºåˆ¶" class="headerlink" title="å‡½æ•°ç»„ä»¶çš„æ¸²æŸ“æœºåˆ¶"></a>å‡½æ•°ç»„ä»¶çš„æ¸²æŸ“æœºåˆ¶</h2><p>å‡½æ•°ç»„ä»¶ï¼šåˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œè®©å‡½æ•°è¿”å›JSXè§†å›¾æˆ–è€…virtualDOMå¯¹è±¡</p>
<p>è°ƒç”¨å‡½æ•°ç»„ä»¶æ—¶ï¼Œå¯ä»¥è®¾ç½®å„ç§å±æ€§</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Demo</span> title=<span class="string">&quot;æˆ‘æ˜¯æ ‡é¢˜&quot;</span> x=&#123;<span class="number">10</span>&#125; data=&#123;[<span class="number">100</span>, <span class="number">200</span>]&#125; className=<span class="string">&quot;box&quot;</span> style=&#123;&#123; <span class="attr">fontSize</span>: <span class="string">&#x27;20px&#x27;</span> &#125;&#125; /&gt;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè®¾ç½®çš„å±æ€§å€¼ä¸æ˜¯å­—ç¬¦ä¸²æ ¼å¼ï¼Œéœ€è¦åŸºäº<code>&#123;&#125;</code>è¯­æ³•è¿›è¡ŒåµŒå¥—</p>
<p>æ¸²æŸ“è¿‡ç¨‹è¿˜æ˜¯å¦‚ä¸Šæ‰€è¿°ï¼š</p>
<ol>
<li>åŸºäº babel-preset-react-app æŠŠJSXç¼–è¯‘ä¸º <code>React.createElement()</code>çš„æ ¼å¼</li>
<li>æŠŠcreateElementæ–¹æ³•æ‰§è¡Œï¼Œåˆ›å»ºå‡ºvirtualDOM</li>
<li>æŠŠæ„å»ºçš„virtualDOMæ¸²æŸ“ä¸ºçœŸå®DOM</li>
</ol>
<p>ä¸åŒç‚¹åœ¨äºï¼ŒvirtualDOMä¸­çš„ type å€¼ä¸å†æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ­¤æ—¶ï¼š</p>
<ul>
<li>æŠŠå‡½æ•°æ‰§è¡Œ -&gt; Demo()</li>
<li>æŠŠvirtualDOMä¸­çš„propsï¼Œä½œä¸ºå®å‚ä¼ é€’ç»™å‡½æ•° -&gt; Demo(props)</li>
<li>æ¥æ”¶å‡½æ•°æ‰§è¡Œçš„è¿”å›ç»“æœï¼Œä¹Ÿå°±æ˜¯virtualDOMå¯¹è±¡</li>
<li>æœ€ååŸºäºrenderå°†virtualDOMå˜ä¸ºçœŸå®DOMï¼Œæ’å…¥åˆ°#rootå®¹å™¨ä¸­</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">DemoOne</span> <span class="keyword">from</span> <span class="string">&#x27;./view/DemoOne&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">DemoOne</span> <span class="attr">title</span>=<span class="string">&quot;æˆ‘æ˜¯æ ‡é¢˜&quot;</span> <span class="attr">x</span>=<span class="string">&#123;10&#125;</span> <span class="attr">data</span>=<span class="string">&#123;[100,</span> <span class="attr">200</span>]&#125; <span class="attr">className</span>=<span class="string">&quot;box&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">fontSize:</span> &#x27;<span class="attr">20px</span>&#x27; &#125;&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//DemoOne.jsx</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">DemoOne</span> = <span class="keyword">function</span> <span class="title function_">DemoOne</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(props);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;demo-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      æˆ‘æ˜¯demo-one</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">DemoOne</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<img src="/2024/03/11/%E6%B5%85%E5%B0%9DReact/image-3.png" class title="This is an image">

<p>å¦‚æœå‡½æ•°ç»„ä»¶åŸºäºåŒé—­åˆæ ‡ç­¾è°ƒç”¨çš„è¯ï¼Œè¿˜å¯ä»¥ä¼ é€’å­èŠ‚ç‚¹</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">DemoOne</span> <span class="keyword">from</span> <span class="string">&#x27;./view/DemoOne&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">DemoOne</span> <span class="attr">title</span>=<span class="string">&quot;æˆ‘æ˜¯æ ‡é¢˜&quot;</span> <span class="attr">x</span>=<span class="string">&#123;10&#125;</span> <span class="attr">data</span>=<span class="string">&#123;[100,</span> <span class="attr">200</span>]&#125; <span class="attr">className</span>=<span class="string">&quot;box&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">fontSize:</span> &#x27;<span class="attr">20px</span>&#x27; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>æˆ‘æ˜¯span<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">DemoOne</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>
<img src="/2024/03/11/%E6%B5%85%E5%B0%9DReact/image-4.png" class title="This is an image">

<h2 id="propså±æ€§ç»†èŠ‚"><a href="#propså±æ€§ç»†èŠ‚" class="headerlink" title="propså±æ€§ç»†èŠ‚"></a>propså±æ€§ç»†èŠ‚</h2><p>propsä¼ é€’è¿›æ¥çš„å±æ€§æ˜¯åªè¯»çš„ï¼Œä¸èƒ½è¿›è¡Œä¿®æ”¹ã€‚ä½†å¯ä»¥å°†propså±æ€§èµ‹å€¼ç»™å˜é‡ï¼Œç„¶åå¯¹å˜é‡è¿›è¡Œæ“ä½œ</p>
<blockquote>
<p>å…³äºå¯¹è±¡çš„è§„åˆ™è®¾ç½®</p>
<ul>
<li>å†»ç»“<br>å†»ç»“å¯¹è±¡: Object.freeze(obj)   æµ…å†»ç»“ï¼ŒåµŒå¥—å¯¹è±¡éœ€è¦é€’å½’è°ƒç”¨æ¥å®Œå…¨å†»ç»“<br>åˆ¤æ–­æ˜¯å¦å†»ç»“: Object.isFrozen(obj) &#x3D;&gt; true&#x2F;false<br>è¢«å†»ç»“å¯¹è±¡ä¸èƒ½ä¿®æ”¹æˆå‘˜å€¼ï¼Œä¸èƒ½æ–°å¢æˆå‘˜ï¼Œä¸èƒ½åˆ é™¤æˆå‘˜ï¼Œä¸èƒ½åŠ«æŒæˆå‘˜</li>
<li>å¯†å°<br>å¯†å°å¯¹è±¡: Object.seal(obj)<br>åˆ¤æ–­æ˜¯å¦å¯†å°: Object.isSealed(obj) &#x3D;&gt; true&#x2F;false<br>è¢«å¯†å°çš„å¯¹è±¡å¯ä»¥ä¿®æ”¹æˆå‘˜å€¼ï¼Œä½†ä¸èƒ½åˆ é™¤ã€æ–°å¢å’ŒåŠ«æŒæˆå‘˜</li>
<li>æ‰©å±•<br>æŠŠå¯¹è±¡è®¾ç½®ä¸ºä¸å¯æ‰©å±•: Object.preventExtensions(obj)<br>æ£€æµ‹æ˜¯å¦å¯æ‰©å±•: Object.isExtensible(obj)</li>
</ul>
</blockquote>
<p><strong>ç»™propsè®¾ç½®é»˜è®¤å€¼</strong><br>æ–¹æ³•ä¸€ï¼šé€šè¿‡æŠŠå‡½æ•°å½“åšå¯¹è±¡ï¼Œè®¾ç½®é™æ€çš„ç§æœ‰å±æ€§æ–¹æ³•ï¼Œæ¥ç»™å…¶è®¾ç½®å±æ€§çš„é»˜è®¤å€¼</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">DemoOne</span> = <span class="keyword">function</span> <span class="title function_">DemoOne</span>(<span class="params">props</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;demo-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      æˆ‘æ˜¯demo-one</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">DemoOne</span>.<span class="property">defaultProps</span> = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;é»˜è®¤æ ‡é¢˜&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">DemoOne</span>;</span><br></pre></td></tr></table></figure>

<p>æ–¹æ³•äºŒï¼ˆå®˜æ–¹æ–‡æ¡£ï¼‰ï¼šç›´æ¥åœ¨å‚æ•°åé¢å†™ä¸Šé»˜è®¤å€¼</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">DemoOne</span> = <span class="keyword">function</span> <span class="title function_">DemoOne</span>(<span class="params">&#123; title = <span class="string">&quot;é»˜è®¤æ ‡é¢˜&quot;</span> &#125;</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;demo-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      æˆ‘æ˜¯demo-one</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">DemoOne</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ç»™propsè¿›è¡Œå±æ€§æ ¡éªŒ</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// å®‰è£…ä¾èµ–</span><br><span class="line">npm i prop-types</span><br></pre></td></tr></table></figure>

<p>åœ¨ç»„ä»¶ä¸­å¯¼å…¥ï¼Œå¹¶ä½¿ç”¨</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">PropTypes</span> <span class="keyword">from</span> <span class="string">&#x27;prop-types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">DemoOne</span> = <span class="keyword">function</span> <span class="title function_">DemoOne</span>(<span class="params">props</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;demo-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      æˆ‘æ˜¯demo-one</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">DemoOne</span>.<span class="property">propTypes</span> = &#123; <span class="comment">//è§„åˆ™æ ¡éªŒ</span></span><br><span class="line">  <span class="attr">title</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span>.<span class="property">isRequired</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">DemoOne</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>PropTypes.string</code> è¡¨ç¤ºç±»å‹æ˜¯string<br><code>isRequired</code> è¡¨ç¤ºè¿™ä¸ªpropæ˜¯å¿…ä¼ çš„</p>
<p>è¯¦ç»†æ ¡éªŒè§„åˆ™çš„ä½¿ç”¨è§<a target="_blank" rel="noopener" href="https://github.com/facebook/prop-types">å®˜ç½‘</a></p>
<h2 id="å¯¹props-childrençš„æ•°é‡è¿›è¡Œåˆ¤æ–­"><a href="#å¯¹props-childrençš„æ•°é‡è¿›è¡Œåˆ¤æ–­" class="headerlink" title="å¯¹props.childrençš„æ•°é‡è¿›è¡Œåˆ¤æ–­"></a>å¯¹props.childrençš„æ•°é‡è¿›è¡Œåˆ¤æ–­</h2><p>childrençš„ä¸åŒæƒ…å†µï¼š</p>
<ol>
<li>å½“æ²¡æœ‰childrenæ—¶ï¼Œå¾—åˆ°çš„æ˜¯undefined</li>
<li>å½“åªæœ‰ä¸€ä¸ªchildrenæ—¶ï¼Œå¾—åˆ°çš„æ˜¯childrenå¯¹è±¡</li>
<li>å½“æœ‰å¤šä¸ªchildrenæ—¶ï¼Œå¾—åˆ°çš„æ˜¯ä¸€ä¸ªæ•°ç»„</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨React.Childrenå¯¹childrenè¿›è¡Œæ•°é‡åˆ¤æ–­ï¼Œä»¥åŠå…¶ä»–çš„ä¸€äº›æ“ä½œ</p>
<img src="/2024/03/11/%E6%B5%85%E5%B0%9DReact/image-2.png" class title="This is an image">

<ol>
<li>countå‡½æ•°å¯ä»¥è¿”å›childrençš„æ•°é‡</li>
<li>forEachå’Œmapä¼šå¯¹childrenè¿›è¡Œéå†ï¼ˆchildrenä¸ºundefinedä¹Ÿæ²¡å…³ç³»ï¼‰</li>
<li>toArrayä¼šå°†childrenè½¬åŒ–æˆæ•°ç»„ï¼ˆchildrenä¸ºundefinedæ—¶è½¬åŒ–æˆç©ºæ•°ç»„ï¼‰</li>
</ol>
<h2 id="é™æ€ç»„ä»¶"><a href="#é™æ€ç»„ä»¶" class="headerlink" title="é™æ€ç»„ä»¶"></a>é™æ€ç»„ä»¶</h2><p><strong>å‡½æ•°æ˜¯é™æ€ç»„ä»¶</strong></p>
<p>ç¬¬ä¸€æ¬¡æ¸²æŸ“ç»„ä»¶æ—¶ï¼Œä¼šæŠŠå‡½æ•°æ‰§è¡Œ</p>
<ul>
<li>äº§ç”Ÿä¸€ä¸ªç§æœ‰çš„ä¸Šä¸‹æ–‡</li>
<li>æŠŠè§£æå‡ºæ¥çš„propsä¼ é€’è¿›å»</li>
<li>æ¸²æŸ“å‡½æ•°è¿”å›çš„virtualDOM</li>
</ul>
<p>å½“æˆ‘ä»¬ä¿®æ”¹ä¸Šä¸‹æ–‡ä¸­çš„å˜é‡ï¼Œå˜é‡çš„å€¼ä¼šå‘ç”Ÿæ”¹å˜ï¼Œä½†æ˜¯è§†å›¾<strong>ä¸ä¼šæ›´æ–°</strong></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡½æ•°ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“å®Œæ¯•åï¼Œç»„å»ºçš„å†…å®¹ä¸ä¼šæ ¹æ®ç»„ä»¶å†…çš„æŸäº›æ“ä½œå†è¿›è¡Œæ›´æ–°ï¼Œæ‰€ä»¥ç§°ä»–ä¸º<strong>é™æ€ç»„ä»¶</strong></p>
<p>é™¤éå†çˆ¶ç»„ä»¶ä¸­é‡æ–°è°ƒç”¨è¿™ä¸ªå‡½æ•°ç»„ä»¶ï¼Œé‚£æ ·å°±å¯ä»¥ä¼ é€’ä¸åŒçš„ä¿¡æ¯</p>
<h2 id="åŠ¨æ€ç»„ä»¶"><a href="#åŠ¨æ€ç»„ä»¶" class="headerlink" title="åŠ¨æ€ç»„ä»¶"></a>åŠ¨æ€ç»„ä»¶</h2><h3 id="åŸºäºç±»ç»„ä»¶æ„å»ºåŠ¨æ€ç»„ä»¶"><a href="#åŸºäºç±»ç»„ä»¶æ„å»ºåŠ¨æ€ç»„ä»¶" class="headerlink" title="åŸºäºç±»ç»„ä»¶æ„å»ºåŠ¨æ€ç»„ä»¶"></a>åŸºäºç±»ç»„ä»¶æ„å»ºåŠ¨æ€ç»„ä»¶</h3><p>åˆ›å»ºç±»ç»„ä»¶</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œè¦æ±‚å¿…é¡»ç»§æ‰¿React.Component&#x2F;PureComponentè¿™ä¸ªç±»</li>
<li>å¿…é¡»ç»™å½“å‰ç±»è®¾ç½®ä¸€ä¸ªrenderæ–¹æ³•ï¼Œåœ¨renderæ–¹æ³•ä¸­è¿”å›éœ€è¦æ¸²æŸ“çš„è§†å›¾</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Vote</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props) <span class="comment">//ä¼šæŠŠä¼ é€’è¿›æ¥çš„å±æ€§æŒ‚è½½åˆ°thiså®ä¾‹ä¸Š</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">props</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      </span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Vote</span>; </span><br></pre></td></tr></table></figure>

<p>Reactçš„renderå‡½æ•°åœ¨æ¸²æŸ“çš„æ—¶å€™ï¼Œå¦‚æœtypeæ˜¯ï¼š</p>
<ul>
<li>å­—ç¬¦ä¸²ï¼šå°±åˆ›å»ºä¸€ä¸ªæ ‡ç­¾</li>
<li>æ™®é€šå‡½æ•°ï¼šæŠŠå‡½æ•°æ‰§è¡Œï¼Œå¹¶æŠŠpropsä¼ é€’ç»™å‡½æ•°</li>
<li>æ„é€ å‡½æ•°ï¼šæŠŠæ„é€ å‡½æ•°åŸºäºnewæ‰§è¡Œï¼ˆä¹Ÿå°±æ˜¯åˆ›å»ºä»¥æ¶æç±»çš„å®ä¾‹ï¼‰ï¼ŒæŠŠè§£æå‡ºæ¥çš„propsä¼ é€’è¿‡å»<ul>
<li>æŠŠåœ¨ç±»ç»„ä»¶ä¸­ç¼–å†™çš„renderå‡½æ•°æ‰§è¡Œï¼ŒæŠŠè¿”å›çš„JSX virtualDOMå½“ä½œç»„ä»¶è§†å›¾è¿›è¡Œæ¸²æŸ“</li>
</ul>
</li>
</ul>
<p>ä»<strong>ç¬¬ä¸€æ¬¡è°ƒç”¨</strong>ç±»ç»„ä»¶å¼€å§‹ï¼Œç±»ç»„ä»¶å†…éƒ¨å‘ç”Ÿçš„äº‹æƒ…ï¼š</p>
<ol>
<li><strong>åˆå§‹åŒ–å±æ€§ &amp;&amp; è§„åˆ™æ ¡éªŒ</strong><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line"><span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="variable language_">super</span>(props) <span class="comment">//ä¼šæŠŠä¼ é€’è¿›æ¥çš„å±æ€§æŒ‚è½½åˆ°thiså®ä¾‹ä¸Š</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
å³ä½¿æˆ‘ä»¬ä¸åœ¨constructorä¸­å¤„ç†ï¼ˆæˆ–è€…æ²¡å†™constructorï¼‰ï¼ŒReactå†…éƒ¨ä¹Ÿä¼šæŠŠä¼ é€’çš„propsæŒ‚è½½åˆ°å®ä¾‹ä¸Š</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è§„åˆ™æ ¡éªŒ</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PropTypes</span> <span class="keyword">from</span> <span class="string">&#x27;prop-types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Vote</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> defaultProps = &#123; <span class="comment">//è®¾ç½®é»˜è®¤å€¼</span></span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;æˆ‘æ˜¯é»˜è®¤title&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> propTypes = &#123; <span class="comment">//è®¾ç½®è§„åˆ™æ ¡éªŒ</span></span><br><span class="line">    <span class="attr">title</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span>.<span class="property">isRequired</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props) <span class="comment">//ä¼šæŠŠä¼ é€’è¿›æ¥çš„å±æ€§æŒ‚è½½åˆ°thiså®ä¾‹ä¸Š</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">props</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      </span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Vote</span>; </span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>åˆå§‹åŒ–çŠ¶æ€</strong></li>
</ol>
<p>ä¿®æ”¹çŠ¶æ€ï¼Œå¯ä»¥è§¦å‘è§†å›¾æ›´æ–°<br>éœ€è¦æ‰‹åŠ¨åˆå§‹åŒ–çŠ¶æ€ï¼Œå¦‚æœæ²¡æœ‰æ‰‹åŠ¨åˆå§‹åŒ–ï¼Œé»˜è®¤ä¼šå¾€å®ä¾‹ä¸ŠæŒ‚è½½ä¸€ä¸ªstateï¼Œåˆå§‹å€¼ä¸º<strong>null</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vote</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;æˆ‘æ˜¯é»˜è®¤title&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span>.<span class="property">isRequired</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123; <span class="comment">//æ–¹æ³•ä¸€ï¼šåœ¨constructorä¸­åˆå§‹åŒ–</span></span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123; </span><br><span class="line">      <span class="attr">supNum</span>: <span class="number">10</span>,</span><br><span class="line">      <span class="attr">oppNum</span>: <span class="number">5</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  state = &#123; <span class="comment">//æ–¹æ³•äºŒï¼šç»™å®ä¾‹åŠ ç§æœ‰å±æ€§åˆå§‹åŒ–</span></span><br><span class="line">    <span class="attr">supNum</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="attr">oppNum</span>: <span class="number">5</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      </span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Vote</span>;</span><br></pre></td></tr></table></figure>

<img src="/2024/03/11/%E6%B5%85%E5%B0%9DReact/image-5.png" class title="This is an image">

<p><strong>ä¿®æ”¹çŠ¶æ€ï¼Œæ›´æ–°è§†å›¾</strong></p>
<p>ä½¿ç”¨<code>this.state.å±æ€§ = xxx</code>è¿™ç§æ“ä½œä»…ä»…åªæ˜¯ä¿®æ”¹äº†çŠ¶æ€å€¼ï¼Œä½†æ— æ³•è®©è§†å›¾æ›´æ–°<br>æƒ³è®©è§†å›¾æ›´æ–°ï¼Œæˆ‘ä»¬éœ€è¦åŸºäºReact.ComponentåŸå‹ä¸Šçš„æ–¹æ³•æ“ä½œï¼š</p>
<ol>
<li><code>this.setState(partialState)</code>æ–¹æ³•ï¼Œä¿®æ”¹éƒ¨åˆ†çŠ¶æ€ï¼Œåªéœ€è¦ä¼ å…¥ä½ æƒ³è¦ä¿®æ”¹çš„çŠ¶æ€å³å¯</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¤ºä¾‹ä»£ç </span></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">  <span class="attr">xxx</span>: xxx</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><code>this.forceUpdate()</code>å¼ºåˆ¶æ›´æ–°è§†å›¾ï¼ˆå¯ä»¥ï¼Œä½†ä¸æ¨èï¼‰</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onClick=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">oppNum</span>++ <span class="comment">//ç›´æ¥ä¿®æ”¹stateä¸­çš„å±æ€§</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">forceUpdate</span>() <span class="comment">//è§¦å‘å¼ºåˆ¶æ›´æ–°</span></span><br><span class="line">&#125;&#125;&gt; æŒ‰é’® &lt;/button&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>è§¦å‘å‘¨æœŸå‡½æ•°</strong></li>
</ol>
<p><code>componentWillMount</code>é’©å­å‡½æ•°ï¼šç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹å‰ï¼ˆæ­¤å‡½æ•°ç›®å‰ä¸å®‰å…¨ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼‰</p>
<p><code>render</code>é’©å­å‡½æ•°ï¼Œè¿›è¡Œè§†å›¾æ¸²æŸ“ï¼Œè¿™å°±å’Œç±»ç»„ä»¶ä¸­å¿…é¡»æœ‰ä¸€ä¸ªrenderå‡½æ•°å¯¹åº”ä¸Šäº†ï¼Œæ¸²æŸ“çš„å°±æ˜¯ç±»ç»„ä»¶renderä¸­è¿”å›çš„virtualDOM</p>
<p><code>componentDidMount</code>é’©å­å‡½æ•°ï¼šç¬¬ä¸€æ¬¡æ¸²æŸ“å®Œæ¯•ï¼Œå·²ç»æŠŠvirtualDOMå˜ä¸ºçœŸå®DOMäº†</p>
<h3 id="ç±»ç»„ä»¶çš„ç»„ä»¶æ›´æ–°é€»è¾‘"><a href="#ç±»ç»„ä»¶çš„ç»„ä»¶æ›´æ–°é€»è¾‘" class="headerlink" title="ç±»ç»„ä»¶çš„ç»„ä»¶æ›´æ–°é€»è¾‘"></a>ç±»ç»„ä»¶çš„ç»„ä»¶æ›´æ–°é€»è¾‘</h3><ol>
<li>ç»„ä»¶æ›´æ–°ä¼šè§¦å‘ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œ<code>shouldComponentUpdate()</code>å‘¨æœŸå‡½æ•°ï¼Œè¡¨ç¤ºæ˜¯å¦å…è®¸æ›´æ–°</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * nextProps</span></span><br><span class="line"><span class="comment"> * nextState: å­˜å‚¨è¦ä¿®æ”¹çš„æœ€æ–°çŠ¶æ€</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * return true/false</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">shouldComponentUpdate</span>(<span class="params">nextProps, nextState</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">state</span>) <span class="comment">//å­˜å‚¨çš„è¿˜æ˜¯ä¿®æ”¹å‰çš„çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//å¿…é¡»è¿”å›trueæˆ–è€…false</span></span><br><span class="line">  <span class="comment">//è¿”å›trueè¡¨ç¤ºå…è®¸æ›´æ–°ï¼Œè¿”å›falseè¡¨ç¤ºä¸å…è®¸æ›´æ–°</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>æ¥ç€è§¦å‘<code>componentWillUpdate()</code>å‘¨æœŸå‡½æ•°ï¼šæ›´æ–°ä¹‹å‰<br>æ­¤å‘¨æœŸå‡½æ•°ä¹Ÿæ˜¯<strong>ä¸å®‰å…¨</strong>çš„ï¼Œåœ¨è¿™ä¸ªèŠ‚ç‚¹çŠ¶æ€è¿˜æ²¡æœ‰è¢«ä¿®æ”¹</p>
</li>
<li><p>ä¿®æ”¹çŠ¶æ€å€¼ï¼ŒæŒ‰ç…§æœ€æ–°çš„çŠ¶æ€æŠŠè¿”å›çš„JSXç¼–è¯‘æˆvirtualDOMã€‚å’Œå‰ä¸€æ¬¡æ¸²æŸ“å‡ºæ¥çš„virtualDOMè¿›è¡Œå¯¹æ¯”ï¼Œè®¡ç®—å‡ºè¡¥ä¸åŒ…Patchï¼Œè§¦å‘renderå‡½æ•°ï¼ŒæŠŠå·®å¼‚çš„éƒ¨åˆ†è¿›è¡Œæ¸²æŸ“ä¸ºçœŸå®DOM</p>
</li>
<li><p>æœ€åè§¦å‘<code>componentDidUpdate()</code>å‡½æ•°ï¼Œè¡¨ç¤ºç»„ä»¶æ›´æ–°å®Œæ¯•</p>
</li>
</ol>
<h3 id="ç±»ç»„ä»¶ä¸­-ref-çš„ä½¿ç”¨æ–¹æ³•"><a href="#ç±»ç»„ä»¶ä¸­-ref-çš„ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ç±»ç»„ä»¶ä¸­ ref çš„ä½¿ç”¨æ–¹æ³•"></a>ç±»ç»„ä»¶ä¸­ ref çš„ä½¿ç”¨æ–¹æ³•</h3><p>refå¯ç”¨äºè·å–çœŸå®DOMå…ƒç´ å’Œè·å–ç±»ç»„ä»¶å®ä¾‹</p>
<p>åˆ›å»º ref çš„æ–¹æ³•ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–¹æ³•ä¸€ï¼ˆä¸æ¨èä½¿ç”¨ï¼‰</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨this.refs.h1çš„æ–¹æ³•æ‹¿åˆ°DOMå…ƒç´ å’Œç±»ç»„ä»¶å®ä¾‹</span></span><br><span class="line"><span class="comment">*/</span> </span><br><span class="line"><span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">ref</span> = <span class="string">&quot;h1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span> = <span class="string">&quot;input1&quot;</span> /&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–¹æ³•äºŒ</span></span><br><span class="line"><span class="comment"> * æ­¤å¤„çš„xå³å½“å‰DOMå…ƒç´ ï¼Œå°†å®ƒèµ‹å€¼åˆ°å®ä¾‹ä¸Š</span></span><br><span class="line"><span class="comment">*/</span> </span><br><span class="line"><span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">ref</span> = <span class="string">&#123;</span> <span class="attr">x</span> =&gt;</span> this.h1 = x &#125;&gt;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–¹æ³•ä¸‰</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨React.createRef()åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œå¹¶é€šè¿‡this.h1.currentè·å–åˆ°DOMå…ƒç´ </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Ref</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    h1 = <span class="title class_">React</span>.<span class="title function_">createRef</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">ref</span> = <span class="string">&#123;</span> <span class="attr">this.h1</span> &#125;&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Hooksç»„ä»¶"><a href="#Hooksç»„ä»¶" class="headerlink" title="Hooksç»„ä»¶"></a>Hooksç»„ä»¶</h3><p>åŸºäºReactä¸­æ–°æä¾›çš„Hookå‡½æ•°ï¼Œå¯ä»¥<strong>è®©å‡½æ•°ç»„ä»¶åŠ¨æ€åŒ–</strong></p>
<h2 id="Hookå‡½æ•°"><a href="#Hookå‡½æ•°" class="headerlink" title="Hookå‡½æ•°"></a>Hookå‡½æ•°</h2><p>å‡½æ•°ç»„ä»¶ï¼ˆæˆ–è€…è¯´Hooksç»„ä»¶ï¼‰ä¸æ˜¯ç±»ç»„ä»¶ï¼Œæ‰€ä»¥æ²¡æœ‰å®ä¾‹çš„æ¦‚å¿µï¼Œè°ƒç”¨ç»„ä»¶ä¸å†æ˜¯åˆ›å»ºç±»çš„å®ä¾‹ï¼Œè€Œæ˜¯æŠŠå‡½æ•°æ‰§è¡Œï¼Œäº§ç”Ÿä¸€ä¸ªç§æœ‰ä¸Šä¸‹æ–‡ã€‚æ‰€ä»¥åœ¨å‡½æ•°ç»„ä»¶ä¸­ä¸æ¶‰åŠthisçš„å¤„ç†</p>
<p>å‡½æ•°ç»„ä»¶çš„æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æ˜¯æŠŠå‡½æ•°é‡æ–°æ‰§è¡Œï¼Œäº§ç”Ÿä¸€ä¸ªå…¨æ–°çš„ç§æœ‰ä¸Šä¸‹æ–‡</p>
<h3 id="useState"><a href="#useState" class="headerlink" title="useState"></a>useState</h3><blockquote>
<p><strong>ä½œç”¨ï¼š</strong> åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨çŠ¶æ€ï¼Œä¿®æ”¹çŠ¶æ€å€¼å¯è®©å‡½æ•°ç»„ä»¶æ›´æ–°ï¼Œç±»ä¼¼äºç±»ç»„ä»¶çš„setState<br><strong>è¯­æ³•ï¼š</strong> <code>const [state, setState] = useState(initialState)</code><br>è¿”å›ä¸€ä¸ªstateï¼Œä»¥åŠç”¨äºæ›´æ–°stateçš„å‡½æ•°</p>
</blockquote>
<p>æ¯ä¸€æ¬¡ç»„ä»¶æ›´æ–°éƒ½ä¼šæŠŠuseStateé‡æ–°æ‰§è¡Œï¼Œä½†æ˜¯åªæœ‰ç¬¬ä¸€æ¬¡æ‰§è¡ŒuseStateæ—¶ï¼Œè®¾ç½®çš„åˆå§‹å€¼ä¼šç”Ÿæ•ˆï¼›å…¶ä½™ä»¥åå†æ‰§è¡Œï¼Œè·å–çš„çŠ¶æ€éƒ½æ˜¯<strong>æœ€æ–°çš„çŠ¶æ€</strong>è€Œä¸æ˜¯åˆå§‹å€¼</p>
<p><code>useState</code>è‡ªå¸¦äº†æ€§èƒ½ä¼˜åŒ–çš„æœºåˆ¶ï¼š<br>æ¯ä¸€æ¬¡ä¿®æ”¹çŠ¶æ€å€¼çš„æ—¶å€™ï¼Œéƒ½ä¼šæ‹¿æœ€æ–°è¦ä¿®æ”¹çš„å€¼å’Œä¹‹å‰çš„çŠ¶æ€å€¼è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœå‘ç°ä¸¤æ¬¡çš„å€¼æ˜¯ä¸€æ ·çš„ï¼Œåˆ™ä¸ä¼šä¿®æ”¹çŠ¶æ€ï¼Œä¹Ÿä¸ä¼šè®©è§†å›¾æ›´æ–°</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">DemoOne</span> = <span class="keyword">function</span> <span class="title function_">DemoOne</span>(<span class="params">props</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Reactæ¸²æŸ“&#x27;</span>); <span class="comment">//ç‚¹å‡»æ–°å¢ä¹‹åä¸ä¼šè¿›è¡Œè§†å›¾æ›´æ–°ï¼Œæ‰€ä»¥ä¸ä¼šæ‰“å°æ­¤ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> [x, setx] = <span class="title function_">useState</span>(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handle</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">setx</span>(<span class="number">10</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;demo-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>x: &#123; x &#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handle&#125;</span>&gt;</span>æ–°å¢<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">DemoOne</span>;</span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬æƒ³åœ¨ä¸€æ¬¡ç‚¹å‡»æ“ä½œä¸­å¾ªç¯ä¿®æ”¹çŠ¶æ€å€¼ï¼ˆå¦‚ä¸‹æ–¹ä»£ç æ‰€ç¤ºï¼‰ï¼Œæˆ‘ä»¬æœŸæœ›çš„æ—¶åœ¨ç‚¹å‡»â€œæ–°å¢â€æŒ‰é’®ä¹‹åï¼Œxçš„å€¼ç´¯åŠ åˆ°20</p>
<p>ä½†å®é™…çš„è¿è¡Œç»“æœç¡®å®ï¼šx&#x3D;11</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">DemoOne</span> = <span class="keyword">function</span> <span class="title function_">DemoOne</span>(<span class="params">props</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> [x, setx] = <span class="title function_">useState</span>(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handle</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">      <span class="title function_">setx</span>(x+<span class="number">1</span>) <span class="comment">//æƒ³è¦å¾ªç¯x+1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;demo-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>x: &#123; x &#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handle&#125;</span>&gt;</span>æ–°å¢<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">DemoOne</span>;</span><br></pre></td></tr></table></figure>

<p>å°±å¦‚Reactå®˜æ–¹æ–‡æ¡£æ‰€è¿°ï¼ŒReactåœ¨è°ƒç”¨å‡½æ•°ç»„ä»¶æ—¶ï¼Œä¼šä¸ºç‰¹å®šçš„é‚£ä¸€æ¬¡æ¸²æŸ“æä¾›ä¸€å¼ stateå¿«ç…§ï¼Œå…¶ä¸­æ‰€æœ‰çš„å€¼éƒ½æ˜¯<strong>æ ¹æ®é‚£ä¸€æ¬¡æ¸²æŸ“ä¸­stateçš„å€¼</strong>è¢«è®¡ç®—å‡ºæ¥çš„</p>
<p><strong>ä¹Ÿå°±æ˜¯è¯´ï¼Œstateçš„å€¼åªä¼šåœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“ä¸­å˜æ›´</strong></p>
<p><strong>ä¸€ä¸ªstateå˜é‡çš„å€¼æ°¸è¿œä¸ä¼šåœ¨ä¸€æ¬¡æ¸²æŸ“çš„å†…éƒ¨å˜åŒ–</strong></p>
<p>å½“å¾ªç¯è°ƒç”¨æ—¶ï¼Œæ¯ä¸€æ¬¡çš„setx()éƒ½ä¼šè¿›å…¥å¼‚æ­¥é˜Ÿåˆ—ï¼Œç­‰è¿™ä¸ªé˜Ÿåˆ—å…¨éƒ¨æ‰§è¡Œå®Œï¼Œæ‰è¿›è¡Œè§†å›¾çš„æ›´æ–°ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å¼‚æ­¥é˜Ÿåˆ—æ‰§è¡Œå®Œè§†å›¾æ›´æ–°ä¹‹å‰ï¼Œè®¿é—®åˆ°çš„stateéƒ½æ˜¯ä¸Šä¸€æ¬¡æ¸²æŸ“çš„stateï¼Œå³xå§‹ç»ˆæ˜¯10ï¼Œæ¯ä¸€æ¬¡æ“ä½œéƒ½ç›¸å½“äº<code>setx(10 + 1)</code></p>
<p>å¦‚æœçœŸçš„éœ€è¦åœ¨ä¸‹æ¬¡æ¸²æŸ“ä¹‹å‰å¤šæ¬¡æ›´æ–°åŒä¸€ä¸ªstateï¼Œå¯ä»¥ä½¿ç”¨<code>setx(prev =&gt; prev + 1)</code>è¿™æ ·ä¼ å…¥ä¸€ä¸ªæ ¹æ®é˜Ÿåˆ—ä¸­å‰ä¸€ä¸ªstateè®¡ç®—ä¸‹ä¸€ä¸ªstateçš„<strong>å‡½æ•°</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">handle</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">      <span class="title function_">setx</span>(<span class="function"><span class="params">prev</span> =&gt;</span> prev + <span class="number">1</span>) </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a>useEffect</h3><blockquote>
<p><strong>ä½œç”¨:</strong> åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸå‡½æ•°<br><strong>è¯­æ³•:</strong> <code>useEffect(callback, dependencies)</code><br>callbackä»£è¡¨å¤„ç†Effectçš„å‡½æ•°ï¼Œåœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“å®Œæ¯•ï¼Œä»¥åŠåœ¨æ¯ä¸€æ¬¡æ›´æ–°å®Œæ¯•åæ‰§è¡Œ<br>dependenciesä»£è¡¨ä¾èµ–é¡¹åˆ—è¡¨ï¼Œ<strong>å¯é€‰</strong>ï¼Œä¾èµ–é¡¹åˆ—è¡¨çš„å…ƒç´ æ•°é‡å¿…é¡»æ˜¯å›ºå®šçš„ï¼Œå¹¶ä¸”å¿…é¡»åƒ<code>[dep1, dep2, dep3]</code>è¿™æ ·å†…è”ç¼–å†™</p>
</blockquote>
<blockquote>
<p><strong>ç”¨æ³•1:</strong> <code>useEffect(callback)</code> ä¸ä¼ å…¥ä¾èµ–é¡¹åˆ—è¡¨<br>ç¬¬ä¸€æ¬¡æ¸²æŸ“å®Œæ¯•åæ‰§è¡Œcallbackï¼Œç­‰ä»·äºcomponentDidMount<br>åœ¨ç»„ä»¶æ¯ä¸€æ¬¡æ›´æ–°å®Œæ¯•åï¼Œä¹Ÿä¼šæ‰§è¡Œcallbackï¼Œç­‰ä»·äºcomponentDidUpdate</p>
</blockquote>
<blockquote>
<p><strong>ç”¨æ³•2:</strong> <code>useEffect(callback, [])</code> ä¼ å…¥ç©ºçš„ä¾èµ–é¡¹åˆ—è¡¨<br>åªæœ‰åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“å®Œæ¯•åï¼Œæ‰ä¼šæ‰§è¡Œcallbackï¼›æ¯ä¸€æ¬¡è§†å›¾æ›´æ–°åcallbackä¸å†æ‰§è¡Œ</p>
</blockquote>
<blockquote>
<p><strong>ç”¨æ³•3:</strong> <code>useEffect(callback, [dep1])</code><br>åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“å®Œæ¯•åæ‰§è¡Œcallbackï¼›æ¯ä¸€æ¬¡ä¾èµ–é¡¹dep1æ›´æ–°æ—¶æ‰§è¡Œcallback</p>
</blockquote>
<blockquote>
<p><strong>ç”¨æ³•4:</strong><code>useEffect(() =&gt; &#123; return () =&gt; &#123;  &#125; &#125;)</code><br>åœ¨callbackä¸­å†è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåœ¨ç»„ä»¶é‡Šæ”¾çš„æ—¶å€™æ‰§è¡Œï¼›å¦‚æœç»„ä»¶æ›´æ–°ï¼Œä¼šæŠŠä¸Šä¸€æ¬¡è¿”å›çš„è¿™ä¸ªå‡½æ•°æ‰§è¡Œï¼ˆå¯ä»¥ç†è§£ä¸ºä¸Šä¸€æ¬¡æ¸²æŸ“çš„ç»„ä»¶é‡Šæ”¾äº†ï¼‰<br>callbackä¸­è‹¥æœ‰è¿”å›å€¼ï¼Œå¿…é¡»<strong>è¿”å›ä¸€ä¸ªå‡½æ•°</strong></p>
</blockquote>
<p>ç°åœ¨æ¨¡æ‹Ÿå‘æœåŠ¡å™¨è¯·æ±‚æ•°æ®ï¼Œç„¶ååœ¨åˆæ¬¡æ¸²æŸ“æ—¶æ¥æ”¶åˆ°</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">queryData</span> = (<span class="params"></span>) =&gt; &#123; <span class="comment">//æ¨¡æ‹Ÿè¯·æ±‚æ•°æ®</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">res</span>([<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>])</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">DemoOne</span> = <span class="keyword">function</span> <span class="title function_">DemoOne</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="keyword">async</span> () =&gt; &#123; <span class="comment">//åœ¨åˆæ¬¡æ¸²æŸ“æ—¶æ‹¿åˆ°æ•°æ®</span></span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">await</span> <span class="title function_">queryData</span>()</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;demo-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">DemoOne</span>;</span><br></pre></td></tr></table></figure>
<img src="/2024/03/11/%E6%B5%85%E5%B0%9DReact/image-6.png" class title="This is an image">

<p>å¯ä»¥çœ‹åˆ°è¿™ç§å†™æ³•æ˜¯ä¸æ­£ç¡®çš„ï¼Œå› ä¸ºcallbackè‹¥æœ‰è¿”å›å€¼ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ï¼›è€Œ async ä¿®é¥°çš„å‡½æ•°é»˜è®¤è¿”å›ä¸€ä¸ªpromiseå¯¹è±¡</p>
<p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ–¹æ¡ˆä¸€ï¼šä¸ç”¨asyncè¯­æ³•ç³–ï¼Œé‡‡ç”¨thençš„å†™æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//åœ¨åˆæ¬¡æ¸²æŸ“æ—¶æ‹¿åˆ°æ•°æ®</span></span><br><span class="line">    <span class="title function_">queryData</span>().<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–¹æ¡ˆäºŒï¼šåœ¨callbackä¸­å†åŒ…ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åè°ƒç”¨è¿™ä¸ªå‡½æ•°</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//åœ¨åˆæ¬¡æ¸²æŸ“æ—¶æ‹¿åˆ°æ•°æ®</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">next</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">let</span> data = <span class="keyword">await</span> <span class="title function_">queryData</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">  &#125;, [])</span><br></pre></td></tr></table></figure>

<h3 id="useRef"><a href="#useRef" class="headerlink" title="useRef"></a>useRef</h3><p>åœ¨å‡½æ•°ç»„ä»¶ä¸­æƒ³è¦ä½¿ç”¨refï¼š</p>
<ol>
<li>å¯ä»¥åŸºäº<code>ref = &#123; å‡½æ•° &#125;</code>çš„æ–¹å¼ï¼Œå°†åˆ›å»ºçš„DOMå…ƒç´ èµ‹å€¼ç»™å˜é‡ï¼Œä½†<strong>ä¸æ¨èä½¿ç”¨</strong></li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">DemoOne</span> = <span class="keyword">function</span> <span class="title function_">DemoOne</span>(<span class="params">props</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> box;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(box) <span class="comment">//å¯ä»¥è·å–åˆ°DOMå…ƒç´ </span></span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;demo-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">ref</span>=<span class="string">&#123;</span> <span class="attr">x</span> =&gt;</span> box = x &#125;&gt;111<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å¯ä»¥åŸºäº<code>React.createRef()</code>åˆ›å»ºrefå¯¹è±¡æ¥è·å–å†…å®¹</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">DemoOne</span> = <span class="keyword">function</span> <span class="title function_">DemoOne</span>(<span class="params">props</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> box = <span class="title class_">React</span>.<span class="title function_">createRef</span>();</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(box) <span class="comment">//å¯ä»¥è·å–åˆ°DOMå…ƒç´ </span></span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;demo-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">ref</span>=<span class="string">&#123;</span> <span class="attr">box</span> &#125;&gt;</span>111<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>åŸºäº<strong>useRef Hookå‡½æ•°</strong>ï¼Œåˆ›å»ºä¸€ä¸ªrefå¯¹è±¡</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">DemoOne</span> = <span class="keyword">function</span> <span class="title function_">DemoOne</span>(<span class="params">props</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> box = <span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(box.<span class="property">current</span>); <span class="comment">//å¯ä»¥è·å–åˆ°DOMå…ƒç´ </span></span><br><span class="line">  &#125;, [])</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;demo-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">ref</span>=<span class="string">&#123;</span> <span class="attr">box</span> &#125;&gt;</span>1111<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      </span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<blockquote>
<p><code>useRef</code> å’Œ <code>createRef()</code> çš„åŒºåˆ«ï¼šåœ¨<strong>éä¸¥æ ¼æ¨¡å¼</strong>ä¸‹<br>åœ¨æ¯ä¸€æ¬¡ç»„ä»¶æ›´æ–°æ—¶ï¼Œå†æ¬¡æ‰§è¡ŒuseRefæ–¹æ³•ï¼Œä¸ä¼šåˆ›å»ºæ–°çš„Refå¯¹è±¡ï¼Œè·å–åˆ°çš„è¿˜æ˜¯ç¬¬ä¸€æ¬¡åˆ›å»ºçš„é‚£ä¸ªå¯¹è±¡ï¼ˆå¤ç”¨å¯¹è±¡ï¼Œå†…å®¹è¿˜æ˜¯å‘ç”Ÿäº†æ›´æ–°çš„ï¼‰<br>createeRef()åœ¨æ¯ä¸€æ¬¡ç»„ä»¶æ›´æ–°æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„Refå¯¹è±¡</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> pre1, pre2;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">DemoOne</span> = <span class="keyword">function</span> <span class="title function_">DemoOne</span>(<span class="params">props</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> box1 = <span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">let</span> box2 = <span class="title class_">React</span>.<span class="title function_">createRef</span>()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> [num, setNum] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!pre1) &#123; <span class="comment">//ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼ŒæŠŠåˆ›å»ºçš„Refå¯¹è±¡èµ‹å€¼</span></span><br><span class="line">    pre1 = box1</span><br><span class="line">    pre2 = box2</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">//ä¹‹åæ¯æ¬¡æ›´æ–°åæ‰§è¡Œï¼ŒéªŒè¯æ–°åˆ›å»ºçš„Refå¯¹è±¡å’Œå‰ä¸€æ¬¡çš„æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(pre1 === box1); <span class="comment">//true</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(box1.<span class="property">current</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(pre2 === box2); <span class="comment">//false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;box1&#x27;</span>, box1.<span class="property">current</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;box2&#x27;</span>, box2.<span class="property">current</span>);</span><br><span class="line">  &#125;, [])</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;demo-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">ref</span>=<span class="string">&#123;</span> <span class="attr">box1</span> &#125;&gt;</span>&#123; num &#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">ref</span>=<span class="string">&#123;</span> <span class="attr">box2</span> &#125;&gt;</span>222<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> () =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        setNum(num+1)</span></span><br><span class="line"><span class="language-xml">      &#125; &#125;&gt;æ–°å¢<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç±»å­ç»„ä»¶å’Œå‡½æ•°å­ç»„ä»¶çš„refä½¿ç”¨"><a href="#ç±»å­ç»„ä»¶å’Œå‡½æ•°å­ç»„ä»¶çš„refä½¿ç”¨" class="headerlink" title="ç±»å­ç»„ä»¶å’Œå‡½æ•°å­ç»„ä»¶çš„refä½¿ç”¨"></a>ç±»å­ç»„ä»¶å’Œå‡½æ•°å­ç»„ä»¶çš„refä½¿ç”¨</h3><ol>
<li>å­ç»„ä»¶ä¸ºç±»ç»„ä»¶æ—¶</li>
</ol>
<p>å¯ä»¥é€šè¿‡useRefåˆ›å»ºä¸€ä¸ªRefå¯¹è±¡ï¼Œç„¶åç»‘å®šåˆ°å­ç»„ä»¶æ ‡ç­¾ä¸Š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useEffect, useRef, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123; <span class="comment">//å­ç»„ä»¶æ˜¯ç±»ç»„ä»¶</span></span><br><span class="line">  state = &#123; <span class="attr">x</span>: <span class="number">100</span> &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;child-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123; this.state.x &#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">DemoOne</span> = <span class="keyword">function</span> <span class="title function_">DemoOne</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> x = <span class="title function_">useRef</span>(<span class="literal">null</span>) <span class="comment">//åˆ›å»ºRefå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x.<span class="property">current</span>);</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;demo-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Child</span> <span class="attr">ref</span>=<span class="string">&#123;</span> <span class="attr">x</span> &#125;/&gt;</span>  </span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">DemoOne</span>;</span><br></pre></td></tr></table></figure>

<img src="/2024/03/11/%E6%B5%85%E5%B0%9DReact/image.png" class title="This is an image">

<ol start="2">
<li>å­ç»„ä»¶ä¸ºå‡½æ•°ç»„ä»¶æ—¶</li>
</ol>
<p>å½“æˆ‘ä»¬ä¾æ—§ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•æ¥è·å–refæ—¶ï¼Œ</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Child</span> = <span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;child-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>å“ˆå“ˆå“ˆ<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">DemoOne</span> = <span class="keyword">function</span> <span class="title function_">DemoOne</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> x = <span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x.<span class="property">current</span>);</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;demo-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Child</span> <span class="attr">ref</span>=<span class="string">&#123;</span> <span class="attr">x</span> &#125;/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">DemoOne</span>;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å°ä¼šæŠ¥é”™ï¼š<strong>ä¸èƒ½ç›´æ¥ç»™å‡½æ•°ç»„ä»¶è®¾ç½®Refå±æ€§</strong></p>
<img src="/2024/03/11/%E6%B5%85%E5%B0%9DReact/image-7.png" class title="This is an image">

<p>è§£å†³æ–¹æ³•ï¼šä½¿ç”¨<code>forwardRef()</code>å°†å‡½æ•°ç»„ä»¶åŒ…èµ·æ¥ï¼Œå®ç°refè½¬å‘</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; forwardRef, useEffect, useRef, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Child</span> = <span class="title function_">forwardRef</span>(<span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params">props, ref</span>) &#123; <span class="comment">//æ­¤å¤„çš„refå°±æ˜¯åœ¨çˆ¶ç»„ä»¶ä¸­è°ƒç”¨å­ç»„ä»¶æ—¶ä¼ å…¥çš„refå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;child-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">ref</span>=<span class="string">&#123;</span> <span class="attr">ref</span> &#125;&gt;</span>å“ˆå“ˆå“ˆ<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">DemoOne</span> = <span class="keyword">function</span> <span class="title function_">DemoOne</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> x = <span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x.<span class="property">current</span>); <span class="comment">//å¯ä»¥è·å–åˆ°å­ç»„ä»¶</span></span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;demo-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Child</span> <span class="attr">ref</span>=<span class="string">&#123;</span> <span class="attr">x</span> &#125;/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">DemoOne</span>;</span><br></pre></td></tr></table></figure>

<img src="/2024/03/11/%E6%B5%85%E5%B0%9DReact/image-8.png" class title="This is an image">


<p>ä½¿ç”¨<code>forwardRef()</code>å¯ä»¥é€šè¿‡refè½¬å‘è·å–åˆ°å­ç»„ä»¶å†…éƒ¨çš„æŸä¸ªå…ƒç´ ï¼Œä½†æ˜¯<strong>æ— æ³•æ‹¿åˆ°</strong>å­ç»„ä»¶ä¸­å®šä¹‰çš„çŠ¶æ€æˆ–è€…æ–¹æ³•</p>
<p>è§£å†³æ–¹æ³•ï¼šé…åˆå¦å¤–ä¸€ä¸ªHookå‡½æ•° <code>useImperativeHandle()</code>æ¥è·å–åˆ°å­ç»„ä»¶ä¸­å®šä¹‰çš„çŠ¶æ€å’Œæ–¹æ³•</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; forwardRef, useEffect, useImperativeHandle, useRef, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Child</span> = <span class="title function_">forwardRef</span>(<span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params">props, ref</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> [text, setText] = <span class="title function_">useState</span>(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">submit</span> = (<span class="params"></span>) =&gt; &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useImperativeHandle</span>(ref, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// åœ¨è¿™é‡Œè¢«è¿”å›çš„å†…å®¹ï¼Œéƒ½å¯ä»¥è¢«çˆ¶ç»„ä»¶çš„Refå¯¹è±¡è·å–åˆ°</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      text,</span><br><span class="line">      setText,</span><br><span class="line">      submit</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;child-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>å“ˆå“ˆå“ˆ<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">DemoOne</span> = <span class="keyword">function</span> <span class="title function_">DemoOne</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> x = <span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x.<span class="property">current</span>);</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;demo-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Child</span> <span class="attr">ref</span>=<span class="string">&#123;</span> <span class="attr">x</span> &#125;/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">DemoOne</span>;</span><br></pre></td></tr></table></figure>

<img src="/2024/03/11/%E6%B5%85%E5%B0%9DReact/image-9.png" class title="This is an image">


<h3 id="useMemo"><a href="#useMemo" class="headerlink" title="useMemo"></a>useMemo</h3><blockquote>
<p><strong>ä½œç”¨:</strong> åœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“çš„æ—¶å€™èƒ½å¤Ÿç¼“å­˜è®¡ç®—çš„ç»“æœï¼Œå¯ä»¥ç”¨äºè·³è¿‡ä»£ä»·æ˜‚è´µçš„é‡æ–°è®¡ç®—<br><strong>è¯­æ³•:</strong> <code>useMemo(callback, dependencies)</code><br>callbackæ˜¯ä¸€ä¸ªç¼“å­˜è®¡ç®—å€¼çš„å‡½æ•°ï¼Œåœ¨é¦–æ¬¡æ¸²æŸ“æ—¶è°ƒç”¨è¯¥å‡½æ•°ï¼›åœ¨ä¹‹åçš„æ¸²æŸ“ä¸­ï¼Œåªæœ‰dependenciesä¸­ä¾èµ–çš„æ•°æ®å‘ç”Ÿäº†æ”¹å˜ï¼Œæ‰ä¼šè°ƒç”¨callback</p>
</blockquote>
<p>ç¤ºä¾‹ï¼šä¸€ä¸ªç®€æ˜“æŠ•ç¥¨å™¨ï¼Œå¹¶è®¡ç®—å‡ºæ”¯æŒç‡ã€‚å½“æœ‰äººå¼ƒæƒæ—¶ï¼Œä¸éœ€è¦é‡æ–°è®¡ç®—æ”¯æŒç‡</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">DemoOne</span> = <span class="keyword">function</span> <span class="title function_">DemoOne</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> [ supNum, setSupNum ] = <span class="title function_">useState</span>(<span class="number">10</span>)</span><br><span class="line">  <span class="keyword">let</span> [ oppNum, setOppNum ] = <span class="title function_">useState</span>(<span class="number">5</span>)</span><br><span class="line">  <span class="keyword">let</span> [ x, setX ] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> ratio = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//è®¡ç®—æ”¯æŒç‡çš„ä»£ç æ®µç”¨useMemoåŒ…èµ·æ¥ï¼Œå¹¶ä¾èµ–supNumã€oppNumï¼›åªæœ‰å½“è¿™ä¸¤è€…å‘ç”Ÿå˜åŒ–æ—¶æ‰ä¼šé‡æ–°è°ƒç”¨å‡½æ•°è®¡ç®—ratio</span></span><br><span class="line">    <span class="keyword">let</span> total = supNum + oppNum</span><br><span class="line">    <span class="keyword">let</span> ratio;</span><br><span class="line">    <span class="keyword">if</span>(total &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      ratio = ( supNum / total * <span class="number">100</span> ).<span class="title function_">toFixed</span>(<span class="number">2</span>) + <span class="string">&#x27;%&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ratio</span><br><span class="line">  &#125;, [supNum, oppNum])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;demo-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>æ”¯æŒäººæ•°ï¼š&#123;supNum&#125;äºº<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>åå¯¹äººæ•°ï¼š&#123;oppNum&#125;äºº<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>æ”¯æŒæ¯”ç‡ï¼š &#123; ratio &#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>å¼ƒæƒï¼š&#123;x&#125;äºº<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setSupNum(supNum + 1)&#125;&gt;æ”¯æŒ<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setOppNum(oppNum + 1)&#125;&gt;åå¯¹<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setX(x + 1)&#125;&gt;å¼ƒæƒ<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">DemoOne</span>;</span><br></pre></td></tr></table></figure>

<h3 id="useCallback"><a href="#useCallback" class="headerlink" title="useCallback"></a>useCallback</h3><blockquote>
<p><strong>ä½œç”¨:</strong> åœ¨å¤šæ¬¡æ¸²æŸ“ä¸­ç¼“å­˜å‡½æ•°<br><strong>è¯­æ³•:</strong> <code>useCallback(fn, dependencies)</code><br>åœ¨åˆæ¬¡æ¸²æŸ“æ—¶ï¼ŒuseCallbackè¿”å›ä½ å·²ç»ä¼ å…¥çš„fnå‡½æ•°<br>åœ¨ä¹‹åçš„æ¸²æŸ“ä¸­ï¼Œå¦‚æœä¾èµ–æ²¡æœ‰æ”¹å˜ï¼ŒuseCallbackè¿”å›ä¸Šä¸€æ¬¡æ¸²æŸ“ä¸­ç¼“å­˜çš„fnï¼›å¦åˆ™å°±é‡æ–°åˆ›å»ºfnå‡½æ•°</p>
</blockquote>
<p>ç¤ºä¾‹ï¼š </p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">DemoOne</span> = <span class="keyword">function</span> <span class="title function_">DemoOne</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> handle = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//å‡½æ•°é€»è¾‘</span></span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;demo-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      // ...</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">DemoOne</span>;</span><br></pre></td></tr></table></figure>

<h2 id="ç»„ä»¶é€šä¿¡"><a href="#ç»„ä»¶é€šä¿¡" class="headerlink" title="ç»„ä»¶é€šä¿¡"></a>ç»„ä»¶é€šä¿¡</h2><h3 id="çˆ¶å­ç»„ä»¶é€šä¿¡ï¼ˆç±»ç»„ä»¶ï¼‰"><a href="#çˆ¶å­ç»„ä»¶é€šä¿¡ï¼ˆç±»ç»„ä»¶ï¼‰" class="headerlink" title="çˆ¶å­ç»„ä»¶é€šä¿¡ï¼ˆç±»ç»„ä»¶ï¼‰"></a>çˆ¶å­ç»„ä»¶é€šä¿¡ï¼ˆç±»ç»„ä»¶ï¼‰</h3><p>çˆ¶å­ç»„ä»¶é—´é€šä¿¡ä¸»è¦æ˜¯åŸºäº<code>props</code>å±æ€§ï¼š</p>
<ol>
<li>çˆ¶äº²æŠŠé€šè¿‡å±æ€§æŠŠä¿¡æ¯ä¼ é€’ç»™å„¿å­</li>
<li>å„¿å­æƒ³ä¿®æ”¹çˆ¶äº²çš„æ•°æ®ï¼Œçˆ¶äº²è¦æŠŠä¿®æ”¹æ•°æ®çš„æ–¹æ³•åŸºäºå±æ€§ä¼ é€’ç»™å„¿å­ï¼Œç„¶åå„¿å­è°ƒç”¨æ–¹æ³•</li>
<li>çˆ¶äº²å¯ä»¥é€šè¿‡ç»™å„¿å­è®¾ç½®Refï¼Œä»¥æ­¤æ¥è·å–å„¿å­çš„å®ä¾‹æˆ–è€…æš´éœ²çš„å±æ€§å’Œæ–¹æ³•</li>
</ol>
<p>ç¤ºä¾‹ï¼šè¦åšä¸€ä¸ªæŠ•ç¥¨å™¨æ¡ˆä¾‹ï¼Œæœ‰ä¸€ä¸ªVoteçˆ¶ç»„ä»¶ï¼Œä»¥åŠVoteMainå’ŒVoteFooterä¸¤ä¸ªå­ç»„ä»¶</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Vote.jsx  ---&gt;  çˆ¶ç»„ä»¶</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VoteFooter</span> <span class="keyword">from</span> <span class="string">&#x27;./VoteFooter&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VoteMain</span> <span class="keyword">from</span> <span class="string">&#x27;./VoteMain&#x27;</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Vote</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">supNum</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="attr">oppNum</span>: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  change = <span class="function">(<span class="params">type</span>) =&gt;</span> &#123; <span class="comment">//å®šä¹‰ä¿®æ”¹å‡½æ•°</span></span><br><span class="line">    <span class="keyword">let</span> &#123; supNum, oppNum &#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">    <span class="keyword">if</span>(type === <span class="string">&#x27;sup&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">supNum</span>: supNum + <span class="number">1</span> &#125;)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(type === <span class="string">&#x27;opp&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">oppNum</span>: oppNum + <span class="number">1</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; supNum, oppNum &#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;vote-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">h2</span> <span class="attr">className</span>=<span class="string">&quot;title&quot;</span>&gt;</span>Reactæ˜¯å¾ˆæ£’çš„å‰ç«¯æ¡†æ¶<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;num&#x27;</span>&gt;</span>å‚ä¸äººæ•°: &#123; this.state.supNum + this.state.oppNum &#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">VoteMain</span> <span class="attr">supNum</span>=<span class="string">&#123;supNum&#125;</span> <span class="attr">oppNum</span>=<span class="string">&#123;oppNum&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">VoteFooter</span> <span class="attr">change</span>=<span class="string">&#123;this.change&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Vote</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//VoteMain ----&gt; å­ç»„ä»¶1</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VoteMain</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params">props</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> &#123; supNum, oppNum &#125; = <span class="variable language_">this</span>.<span class="property">props</span> <span class="comment">//è§£æ„å‡ºè¦ç”¨åˆ°çš„å±æ€§</span></span><br><span class="line">    <span class="keyword">let</span> ratio = <span class="string">&#x27;--&#x27;</span></span><br><span class="line">    <span class="keyword">let</span> total = supNum + oppNum</span><br><span class="line">    <span class="keyword">if</span>(total &gt; <span class="number">0</span>) ratio = ( supNum / total * <span class="number">100</span> ).<span class="title function_">toFixed</span>(<span class="number">2</span>) + <span class="string">&#x27;%&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>æ”¯æŒäººæ•°: &#123;supNum&#125;äºº <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>åå¯¹äººæ•°: &#123;oppNum&#125;äºº<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>æ”¯æŒæ¯”ç‡: &#123; ratio &#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">VoteMain</span></span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//VoteFooter ----&gt; å­ç»„ä»¶2</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VoteFooter</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> &#123; change &#125; = <span class="variable language_">this</span>.<span class="property">props</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;footer&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> <span class="attr">change.bind</span>(<span class="attr">null</span>, &#x27;<span class="attr">sup</span>&#x27;) &#125;&gt;</span>æ”¯æŒ<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> <span class="attr">change.bind</span>(<span class="attr">null</span>, &#x27;<span class="attr">opp</span>&#x27;) &#125;&gt;</span>åå¯¹<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">VoteFooter</span>;</span><br></pre></td></tr></table></figure>

<h2 id="ReduxåŸºç¡€"><a href="#ReduxåŸºç¡€" class="headerlink" title="ReduxåŸºç¡€"></a>ReduxåŸºç¡€</h2><p>Reduxæ˜¯ç”¨äºå­˜å‚¨å’Œå¤„ç†ç»„ä»¶å…¬å…±çŠ¶æ€ä¿¡æ¯çš„å·¥å…·åº“ï¼Œç±»ä¼¼äºVueä¸­çš„Vuex<br><strong>Reduxå·¥ä½œé€»è¾‘</strong></p>
<img src="/2024/03/11/%E6%B5%85%E5%B0%9DReact/image-10.png" class title="This is an image">


<p><strong>é€»è¾‘ç¤ºä¾‹</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> initial = &#123;</span><br><span class="line">  <span class="attr">supNum</span>: <span class="number">10</span>,</span><br><span class="line">  <span class="attr">oppNum</span>: <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> reducer = <span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state = initial, action</span>) &#123;</span><br><span class="line">  <span class="comment">//stateå­˜å‚¨å®¹å™¨ä¸­çš„å…¬å…±çŠ¶æ€</span></span><br><span class="line">  <span class="comment">//actionæ˜¯æ¯ä¸€æ¬¡åŸºäºdispatchæ´¾å‘çš„æ—¶å€™ï¼Œä¼ é€’è¿›æ¥çš„è¡Œä¸ºå¯¹è±¡ï¼Œè¦æ±‚å¿…é¡»å…·å¤‡typeå±æ€§ï¼Œå­˜å‚¨æ´¾å‘çš„è¡Œä¸ºæ ‡è¯†</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//ä¸ºäº†æ¥ä¸‹æ¥çš„æ“ä½œä¸­ï¼Œæˆ‘ä»¬æ“ä½œstateä¸ä¼šç›´æ¥ä¿®æ”¹å®¹å™¨ä¸­çš„çŠ¶æ€ï¼Œè¦ç­‰åˆ°æœ€åreturnçš„æ—¶å€™</span></span><br><span class="line">  state = &#123; ...state &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//éœ€è¦åŸºäºæ´¾å‘çš„è¡Œä¸ºæ ‡è¯†ï¼Œä¿®æ”¹storeå®¹å™¨ä¸­çš„å…¬å…±çŠ¶æ€ä¿¡æ¯</span></span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;VOTE_SUP&#x27;</span>:</span><br><span class="line">      state.<span class="property">supNum</span>++</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;VOTE_OPP&#x27;</span>:</span><br><span class="line">      state.<span class="property">oppNum</span>++</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//returnçš„å†…å®¹ä¼šæ•´ä½“æ›¿æ¢storeä¸­çš„å†…å®¹</span></span><br><span class="line">  <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(reducer)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€æ¬¡æ´¾å‘æ—¶stateæ²¡æœ‰å€¼ï¼Œä¼šæŠŠinitialçš„å€¼èµ‹å€¼ç»™stateï¼ˆç¬¬ä¸€æ¬¡æ´¾å‘æ˜¯åœ¨reduxå†…éƒ¨æ´¾å‘çš„ï¼‰ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">store.<span class="title function_">dispatch</span>(&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;VOTE_SUP&#x27;</span>,</span><br><span class="line">  <span class="attr">step</span>: <span class="number">10</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒæ¬¡åŸºäºä¸šåŠ¡é€»è¾‘å®ç°æ‰‹åŠ¨æ´¾å‘ï¼Œäºswitchçš„ç¬¬ä¸€é¡¹åŒ¹é…ï¼Œä½†æ˜¯<strong>ä¸ä¼š</strong>ç›´æ¥ä¿®æ”¹supNumçš„å€¼ã€‚è€Œæ˜¯åœ¨å†…éƒ¨å…ˆå…‹éš†ä¸€ä»½stateï¼Œç„¶åå¯¹è¿™ä¸ªstateè¿›è¡Œä¿®æ”¹ï¼Œæœ€åç”¨è¿™ä¸ªæ–°çš„stateæ›¿æ¢æ‰åŸæ¥çš„state</p>
<h3 id="åœ¨ç»„ä»¶ä¸­ä½¿ç”¨store"><a href="#åœ¨ç»„ä»¶ä¸­ä½¿ç”¨store" class="headerlink" title="åœ¨ç»„ä»¶ä¸­ä½¿ç”¨store"></a>åœ¨ç»„ä»¶ä¸­ä½¿ç”¨store</h3><p>ä¸ºäº†åœ¨å„ä¸ªç»„ä»¶ä¸­éƒ½å¯ä»¥è·å–åˆ°storeï¼Œå¯ä»¥åŸºäºä¸Šä¸‹æ–‡çš„æ–¹æ³•ï¼š</p>
<ol>
<li>åœ¨index.jsä¸­ï¼ŒåŸºäºThemeContext.ProvideræŠŠåˆ›å»ºçš„storeæ”¾åœ¨ä¸Šä¸‹æ–‡ä¸­</li>
<li>å› ä¸ºæ‰€æœ‰ç»„ä»¶æœ€åéƒ½æ˜¯åœ¨index.jsä¸­æ¸²æŸ“ï¼Œæ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥ç†è§£ä¸ºindex.jsçš„åä»£ç»„ä»¶ï¼Œåä»£ç»„ä»¶åŸºäºä¸Šä¸‹æ–‡æ–¹æ¡ˆå³å¯è·å–åœ¨ä¸Šä¸‹æ–‡ä¸­å­˜å‚¨çš„storeäº†</li>
</ol>
<p><strong>åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡ï¼š</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/ThemeContext.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">React</span>.<span class="title function_">createContext</span>() <span class="comment">//åˆ›å»ºå¹¶å¯¼å‡ºä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡</span></span><br></pre></td></tr></table></figure>
<p><strong>åœ¨index.jsä¸­ä½¿ç”¨ï¼š</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span>; <span class="comment">//å¯¼å…¥store</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ThemeContext</span> <span class="keyword">from</span> <span class="string">&#x27;./ThemeContext&#x27;</span> <span class="comment">//å¯¼å…¥ä¸Šä¸‹æ–‡</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(store);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>));</span><br><span class="line">root.<span class="title function_">render</span>(</span><br><span class="line">  <span class="comment">// ä½¿ç”¨ThemeContext.Providerå°†storeæ”¾åˆ°ä¸Šä¸‹æ–‡ä¸­</span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">ThemeContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">store</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">ThemeContext.Provider</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>åä»£ç»„ä»¶ï¼ˆå‡½æ•°ç»„ä»¶ï¼‰è·å–storeï¼š</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useContext, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VoteFooter</span> <span class="keyword">from</span> <span class="string">&#x27;./VoteFooter&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VoteMain</span> <span class="keyword">from</span> <span class="string">&#x27;./VoteMain&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ThemeContext</span> <span class="keyword">from</span> <span class="string">&#x27;../ThemeContext&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Vote</span> = <span class="keyword">function</span> <span class="title function_">Vote</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//ä½¿ç”¨useContext Hookå‡½æ•°ï¼Œå¹¶å°†åˆ›å»ºçš„ä¸Šä¸‹æ–‡ä¼ å…¥</span></span><br><span class="line">  <span class="keyword">const</span> context = <span class="title function_">useContext</span>(<span class="title class_">ThemeContext</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(context);</span><br><span class="line">  <span class="keyword">const</span> &#123; store &#125; = context</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">// ....</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Vote</span>;</span><br></pre></td></tr></table></figure>

<img src="/2024/03/11/%E6%B5%85%E5%B0%9DReact/image-11.png" class title="This is an image">

<p>å¾—åˆ°çš„storeä¸­ï¼š</p>
<ol>
<li><code>dispatch</code>ç”¨äºè¡Œä¸ºæ´¾å‘</li>
<li><code>getState</code>ç”¨äºè·å–å…¬å…±çŠ¶æ€ä¿¡æ¯</li>
<li><code>subscribe</code>ç”¨äºå°†å®ç°ç»„ä»¶æ›´æ–°çš„æ–¹æ³•æ”¾åˆ°storeçš„äº‹ä»¶æ± ä¸­</li>
</ol>
<p><strong>åä»£ç»„ä»¶ï¼ˆç±»ç»„ä»¶ï¼‰è·å–storeï¼š</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ThemeContext</span> <span class="keyword">from</span> <span class="string">&quot;../ThemeContext&quot;</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VoteMain</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> contextType = <span class="title class_">ThemeContext</span> <span class="comment">//è·å–ä¸Šä¸‹æ–‡ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//å®Œæˆä¸Šé¢çš„æ“ä½œä¹‹åï¼Œä¼šåœ¨thisä¸ŠæŒ‚è½½ä¸€ä¸ªcontextå±æ€§ï¼Œå­˜æ”¾ç€ä¸Šä¸‹æ–‡ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">const</span> &#123; store &#125; = <span class="variable language_">this</span>.<span class="property">context</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(store)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>æ”¯æŒäººæ•°<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>åå¯¹äººæ•°<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç»„ä»¶è·å–å…¬å…±çŠ¶æ€ä¿¡æ¯ï¼š</strong></p>
<p>ä½¿ç”¨<code>store.getState()</code>æ–¹æ³•æ¥è·å–å…¬å…±çŠ¶æ€ä¿¡æ¯<br>å½“ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“å®Œæ¯•åï¼Œéœ€è¦æŠŠè®©ç»„ä»¶æ›´æ–°çš„æ–¹æ³•æ”¾åˆ°storeçš„äº‹ä»¶æ± ä¸­ï¼Œè¿™æ ·åœ¨çŠ¶æ€æ”¹å˜æ—¶ï¼Œæ‰ä¼šè°ƒç”¨äº‹ä»¶æ¥æ›´æ–°è§†å›¾</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ThemeContext</span> <span class="keyword">from</span> <span class="string">&quot;../ThemeContext&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">VoteMain</span> = <span class="keyword">function</span> <span class="title function_">VoteMain</span>(<span class="params">props</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; store &#125; = <span class="title function_">useContext</span>(<span class="title class_">ThemeContext</span>)</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(store.<span class="title function_">getState</span>()); <span class="comment">//æ‰“å°ç»“æœå¦‚ä¸‹å›¾</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> &#123; supNum, oppNum &#125; = store.<span class="title function_">getState</span>() <span class="comment">//è§£æ„å‡ºçŠ¶æ€</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“å®Œæ¯•ï¼ŒæŠŠè®©ç»„ä»¶æ›´æ–°çš„æ–¹æ³•æ”¾åˆ°storeçš„äº‹ä»¶æ± ä¸­</span></span><br><span class="line">  <span class="keyword">let</span> [ _, setNum ] = <span class="title function_">useState</span>(<span class="number">0</span>) <span class="comment">//è®¾ç½®çŠ¶æ€å˜é‡</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨subscribeæ–¹æ³•å°†è®©ç»„ä»¶æ›´æ–°çš„æ–¹æ³•æ”¾åœ¨storeçš„äº‹ä»¶æ± ä¸­</span></span><br><span class="line">    <span class="comment">// è¿”å›unsubscribeæ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•ï¼Œå¯ä»¥æŠŠåˆšæ‰æ”¾å…¥äº‹ä»¶æ± ä¸­çš„æ–¹æ³•ç§»é™¤</span></span><br><span class="line">    <span class="keyword">let</span> unsubscribe = store.<span class="title function_">subscribe</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setNum</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>())</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">unsubscribe</span>() <span class="comment">//åœ¨ä¸Šä¸€æ¬¡ç»„ä»¶é‡Šæ”¾çš„æ—¶å€™ï¼Œé”€æ¯ä¸Šä¸€æ¬¡æ”¾åœ¨äº‹ä»¶æ± çš„æ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [num])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>æ”¯æŒäººæ•°: &#123;supNum&#125;äºº <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>åå¯¹äººæ•°: &#123;oppNum&#125;äºº<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>æ”¯æŒæ¯”ç‡: --<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">VoteMain</span></span><br></pre></td></tr></table></figure>

<img src="/2024/03/11/%E6%B5%85%E5%B0%9DReact/image-12.png" class title="This is an image">

<p>ç±»ç»„ä»¶ä¸­çš„ç»„ä»¶æ›´æ–°ç­–ç•¥ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">VoteMain</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> contextType = <span class="title class_">ThemeContext</span> <span class="comment">//è·å–ä¸Šä¸‹æ–‡ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//å®Œæˆä¸Šé¢çš„æ“ä½œä¹‹åï¼Œä¼šåœ¨thisä¸ŠæŒ‚è½½ä¸€ä¸ªcontextå±æ€§ï¼Œå­˜æ”¾ç€ä¸Šä¸‹æ–‡ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">const</span> &#123; store &#125; = <span class="variable language_">this</span>.<span class="property">context</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(store)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>æ”¯æŒäººæ•°<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>åå¯¹äººæ•°<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; store &#125; = <span class="variable language_">this</span>.<span class="property">context</span></span><br><span class="line">    store.<span class="title function_">subscribe</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">forceUpdate</span>() <span class="comment">//ç›´æ¥è®©ç»„ä»¶å¼ºåˆ¶æ›´æ–°</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç»„ä»¶æ´¾å‘ä»»åŠ¡ï¼š</strong></p>
<p>åœ¨ç»„ä»¶ä¸­è°ƒç”¨<code>store.dispatch</code>è¿›è¡Œä»»åŠ¡æ´¾å‘ï¼Œé€šçŸ¥reduceræ‰§è¡Œä¼ é€’çš„actionè¡Œä¸ºå¯¹è±¡</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ThemeContext</span> <span class="keyword">from</span> <span class="string">&quot;../ThemeContext&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">VoteFooter</span> = <span class="keyword">function</span> <span class="title function_">VoteFooter</span>(<span class="params">props</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; store &#125; = <span class="title function_">useContext</span>(<span class="title class_">ThemeContext</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;footer&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> () =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        store.dispatch(&#123;</span></span><br><span class="line"><span class="language-xml">          type: &#x27;VOTE_SUP&#x27;</span></span><br><span class="line"><span class="language-xml">        &#125;)</span></span><br><span class="line"><span class="language-xml">      &#125; &#125;&gt;æ”¯æŒ<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> () =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        store.dispatch(&#123;</span></span><br><span class="line"><span class="language-xml">          type: &#x27;VOTE_OPP&#x27;</span></span><br><span class="line"><span class="language-xml">        &#125;)</span></span><br><span class="line"><span class="language-xml">      &#125; &#125;&gt;åå¯¹<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">VoteFooter</span>;</span><br></pre></td></tr></table></figure>

<h2 id="Reduxå·¥ç¨‹åŒ–"><a href="#Reduxå·¥ç¨‹åŒ–" class="headerlink" title="Reduxå·¥ç¨‹åŒ–"></a>Reduxå·¥ç¨‹åŒ–</h2><p>åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œè¦æŠŠreducerè¿›è¡Œæ¨¡å—åŒ–ç®¡ç†ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰è‡ªå·±çš„reducerï¼›æœ€åè¿˜è¦æŠŠæ‰€æœ‰çš„reducerè¿›è¡Œåˆå¹¶ï¼Œåˆå¹¶æˆä¸€ä¸ªåèµ‹å€¼ç»™åˆ›å»ºçš„storeå®¹å™¨</p>
<p><strong>ç¤ºä¾‹ï¼š</strong>æœ‰ä¸¤ä¸ªæ¨¡å—ï¼Œvoteå’Œpersonaléƒ½éœ€è¦è¿›è¡Œå…¬å…±çŠ¶æ€ç®¡ç†</p>
<p>åˆ›å»ºå¯¹åº”çš„reduceræ–‡ä»¶å’Œæ€»çš„reduceræ–‡ä»¶</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–‡ä»¶å¤¹ç›®å½•  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// src/store/reducers</span></span><br><span class="line"><span class="comment">// - index.js   ----  æœ€ååˆæˆä¸€ä¸ªæ€»çš„reducer</span></span><br><span class="line"><span class="comment">// - voteReducer.js  ----  voteæ¨¡å—çš„reducer</span></span><br><span class="line"><span class="comment">// - personalReducer.js  ----  personalæ¨¡å—çš„reducer</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç„¶ååˆ›å»ºä¸åŒæ¨¡å—çš„reducer</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¨¡æ¿</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initial = &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">VoteReducer</span>(<span class="params">state = initial, action</span>) &#123;</span><br><span class="line">  state = &#123; ...state &#125;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> state</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ reducers&#x2F;index.js ä¸­è¿›è¡Œreduceråˆå¹¶ï¼Œè°ƒç”¨reduxä¸­çš„<code>combineReducers()</code>æ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ªåŒ…å«å„ä¸ªreducerçš„å¯¹è±¡ã€‚</p>
<p>æœ€åç”¨<code>createStore()</code>æ–¹æ³•ï¼Œå¹¶ä¼ å…¥åˆå¹¶å¥½çš„reduceråˆ›å»ºstoreå®¹å™¨</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* åˆå¹¶å„ä¸ªæ¨¡å—çš„reducer */</span></span><br><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VoteReducer</span> <span class="keyword">from</span> <span class="string">&#x27;./VoteReducer&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PersonalReducer</span> <span class="keyword">from</span> <span class="string">&#x27;./personalReducer&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reducer = <span class="title function_">combineReducers</span>(&#123;</span><br><span class="line">  <span class="attr">vote</span>: <span class="title class_">VoteReducer</span>,</span><br><span class="line">  <span class="attr">personal</span>: <span class="title class_">PersonalReducer</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> reducer;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ­¤æ—¶å®¹å™¨ä¸­çš„å…¬å…±çŠ¶æ€ä¼šæŒ‰ç…§è®¾ç½®çš„æˆå‘˜åå­—è¿›è¡Œåˆ†æ¨¡å—åŒ–ç®¡ç†</span></span><br><span class="line"><span class="comment"> * åŸºäºstore.getState()è·å–åˆ°çš„çŠ¶æ€å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment"> * state = &#123;</span></span><br><span class="line"><span class="comment"> *   vote: &#123;</span></span><br><span class="line"><span class="comment"> *     // voteæ¨¡å—ä¸­çš„çŠ¶æ€</span></span><br><span class="line"><span class="comment"> *   &#125;,</span></span><br><span class="line"><span class="comment"> *   personal: &#123;</span></span><br><span class="line"><span class="comment"> *     // personalæ¨¡å—ä¸­çš„çŠ¶æ€</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>è·å–å…¬å…±çŠ¶æ€ä¿¡æ¯çš„æ“ä½œéœ€è¦æŒ‰æ¨¡å—è·å–äº†ï¼Œä¾‹å¦‚<code>store.getState().vote</code>ï¼Œå°±èƒ½æ‹¿åˆ°voteReducerä¸­å¯¹åº”çš„çŠ¶æ€<br>åœ¨è¡Œä¸ºæ´¾å‘æ–¹æ³•ä¸­ï¼Œ<code>store.dispatch</code>ä¼šå»æ¯ä¸ªæ¨¡å—ä¸­å¯»æ‰¾åŒ¹é…çš„typeï¼ŒæŠŠåŒ¹é…ä¸Šçš„é€»è¾‘<strong>éƒ½æ‰§è¡Œä¸€é</strong>ã€‚</p>
</blockquote>
<h3 id="åŸºäºå®ç®¡ç†æ´¾å‘æ ‡è¯†"><a href="#åŸºäºå®ç®¡ç†æ´¾å‘æ ‡è¯†" class="headerlink" title="åŸºäºå®ç®¡ç†æ´¾å‘æ ‡è¯†"></a>åŸºäºå®ç®¡ç†æ´¾å‘æ ‡è¯†</h3><p>åœ¨<code>/src/store</code>ç›®å½•ä¸‹æ–°å»º<code>action-types.js</code>æ–‡ä»¶ï¼Œå°†æ ‡è¯†å®šä¹‰åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶æš´éœ²å‡ºå»ã€‚è¿™æ ·åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­å®šä¹‰æ ‡è¯†ï¼Œå¯ä»¥é˜²æ­¢æ ‡è¯†å‘½åé‡å¤å¸¦æ¥çš„é—®é¢˜</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¤ºä¾‹ä»£ç </span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»Ÿä¸€ç®¡ç†éœ€è¦æ´¾å‘çš„è¡Œä¸ºæ ‡è¯†ï¼Œä¿è¯ä¸ä¼šå‘ç”Ÿå‘½åå†²çª</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">VOTE_SUP</span> = <span class="string">&quot;VOTE_SUP&quot;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">VOTE_OPP</span> = <span class="string">&quot;VOTE_OPP&quot;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">PERSONAL_SUP</span> = <span class="string">&quot;PERSONAL_SUP&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="actionè¡Œä¸ºå¯¹è±¡çš„ç®¡ç†"><a href="#actionè¡Œä¸ºå¯¹è±¡çš„ç®¡ç†" class="headerlink" title="actionè¡Œä¸ºå¯¹è±¡çš„ç®¡ç†"></a>actionè¡Œä¸ºå¯¹è±¡çš„ç®¡ç†</h3><p>åœ¨è°ƒç”¨<code>store.dispatch()</code>æ˜¯éœ€è¦ä¼ å…¥ä¸€ä¸ªè¡Œä¸ºå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ¨¡å—åŒ–è¿›è¡Œç®¡ç†</p>
<p>åœ¨<code>src/store</code>ä¸‹åˆ›å»ºactionsæ–‡ä»¶å¤¹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–‡ä»¶å¤¹ç›®å½•  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// src/store/actions</span></span><br><span class="line"><span class="comment">// - index.js   ----  æœ€ååˆæˆä¸€ä¸ªæ€»çš„action</span></span><br><span class="line"><span class="comment">// - voteAction.js  ----  voteæ¨¡å—çš„action</span></span><br><span class="line"><span class="comment">// - personalAction.js  ----  personalæ¨¡å—çš„action</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç„¶ååˆ›å»ºä¸åŒæ¨¡å—çš„action</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¨¡æ¿</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="variable constant_">TYPES</span> <span class="keyword">from</span> <span class="string">&#x27;../action-types&#x27;</span></span><br><span class="line"><span class="keyword">const</span> voteAction = &#123;</span><br><span class="line">  <span class="comment">//å®šä¹‰voteæ¨¡å—ä¸­éœ€è¦æ´¾å‘çš„è¡Œä¸ºå¯¹è±¡ï¼Œ å³è°ƒç”¨store.dispatch()æ˜¯ä¼ å…¥çš„å¯¹è±¡</span></span><br><span class="line">  <span class="title function_">support</span>(<span class="params"></span>) &#123; </span><br><span class="line">    <span class="comment">// è¿”å›ä¸€ä¸ªå«typeå±æ€§çš„æ´¾å‘å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">TYPES</span>.<span class="property">VOTE_SUP</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">oppose</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">TYPES</span>.<span class="property">VOTE_OPP</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> voteAction</span><br></pre></td></tr></table></figure>

<p>å°†å„ä¸ªæ¨¡å—çš„actionæ–‡ä»¶å¯¼å…¥åˆ°<code>actions/index.js</code>ä¸­åˆå¹¶æˆä¸€ä¸ªaction</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//actions/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**æŠŠå„ä¸ªæ¨¡å—çš„actionåˆå¹¶ä¸ºä¸€ä¸ªaction */</span></span><br><span class="line"><span class="keyword">import</span> voteAction <span class="keyword">from</span> <span class="string">&quot;./voteAction&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> personalAction <span class="keyword">from</span> <span class="string">&quot;./personalAction&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> action = &#123;</span><br><span class="line">  <span class="attr">vote</span>: voteAction,</span><br><span class="line">  <span class="attr">personal</span>: personalAction</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> action</span><br></pre></td></tr></table></figure>

<p>ä¹‹ååœ¨ä½¿ç”¨æ´¾å‘çš„æ—¶å€™ï¼Œä¸éœ€è¦æ‰‹å†™æ´¾å‘å¯¹è±¡äº†ï¼›åªéœ€è¦è°ƒç”¨å¯¹åº”çš„å‡½æ•°å³å¯ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">store.<span class="title function_">dispatch</span>(action.<span class="property">vote</span>.<span class="title function_">support</span>())</span><br></pre></td></tr></table></figure>

<p>æœ€åçš„ç›®å½•ç»“æ„ï¼š</p>
<img src="/2024/03/11/%E6%B5%85%E5%B0%9DReact/image-13.png" class title="This is an image">

<h2 id="react-redux"><a href="#react-redux" class="headerlink" title="react-redux"></a>react-redux</h2><p>è¦åœ¨é¡¹ç›®ä¸­ä½¿ç”¨reduxè¿˜æ˜¯æœ‰ç‚¹å¤æ‚ï¼Œ<code>react-redux</code>çš„ä½œç”¨å°±æ˜¯è®©reduxçš„æ“ä½œåœ¨é¡¹ç›®ä¸­èƒ½ç®€å•ä¸€ç‚¹</p>
<p>reduxçš„å·¥ç¨‹åŒ–æ“ä½œè¯¥æ€ä¹ˆå¼„è¿˜æ˜¯æ€ä¹ˆå¼„ï¼Œreact-reduxä¸»è¦æ˜¯è®©reduxåœ¨ç»„ä»¶ä¸­çš„åº”ç”¨æ›´æ–¹ä¾¿ä¸€äº›ã€‚</p>
<ol>
<li>react-reduxå†…éƒ¨è‡ªå·±åˆ›å»ºäº†ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥æŠŠstoreæ”¾åœ¨ä¸Šä¸‹æ–‡ä¸­ï¼Œåœ¨ç»„ä»¶ä¸­ä½¿ç”¨æ—¶æ— éœ€æˆ‘ä»¬è‡ªå·±å†è·å–ä¸Šä¸‹æ–‡ä¸­çš„storeäº†</li>
</ol>
<p>è¿™æ ·å°±ä¸éœ€è¦è¦å•ç‹¬åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡äº†ï¼Œç›´æ¥åœ¨é¡¹ç›®çš„index.jsä¸­å¼•å…¥react-reduxä¸­æä¾›çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œç»‘å®šstoreå¹¶ä½¿ç”¨</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span>; <span class="comment">//è‡ªå·±å®šä¹‰çš„å…¬å…±çŠ¶æ€å®¹å™¨</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Provider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span> <span class="comment">//å¯¼å…¥ä¸Šä¸‹æ–‡</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>));</span><br><span class="line">root.<span class="title function_">render</span>(</span><br><span class="line">  &lt;!-- ä½¿ç”¨<span class="title class_">Provider</span>ï¼Œå¹¶ç»‘å®šæˆ‘ä»¬çš„store --&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;</span> <span class="attr">store</span> &#125;&gt;</span> </span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>


<ol start="2">
<li>åœ¨ç»„ä»¶ä¸­è·å–å…¬å…±çŠ¶æ€ä¿¡æ¯ï¼Œæ— éœ€è‡ªå·±åŸºäºä¸Šä¸‹æ–‡å¯¹è±¡è·å–storeï¼Œç›´æ¥åŸºäºreact-reduxæä¾›çš„<code>connect</code>å‡½æ•°å¤„ç†å³å¯ï¼›ä¹Ÿä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æŠŠè®©ç»„ä»¶æ›´æ–°çš„æ–¹æ³•æ”¾åˆ°äº‹ä»¶æ± ä¸­ï¼Œreact-reduxå†…éƒ¨å¸®æˆ‘ä»¬å¤„ç†äº†</li>
</ol>
<blockquote>
<p><code>connect</code>è¯­æ³•ï¼š<code>connect(mapStateToProps, mapDispatchProps)(è¦æ¸²æŸ“çš„ç»„ä»¶)</code></p>
</blockquote>
<blockquote>
<p>mapStateToPropså¯ä»¥è·å–åˆ°reduxä¸­çš„å…¬å…±çŠ¶æ€ï¼Œç„¶åæŠŠçŠ¶æ€ä½œä¸º<strong>propså±æ€§</strong>ä¼ é€’ç»™ç»„ä»¶</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mapStateToPropsæ˜¯ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line"><span class="title function_">connect</span>(<span class="function"><span class="params">state</span> =&gt;</span> &#123; <span class="comment">//stateè¡¨ç¤ºå­˜å‚¨åœ¨reduxå®¹å™¨ä¸­æ‰€æœ‰æ¨¡å—çš„å…¬å…±çŠ¶æ€ä¿¡æ¯</span></span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="comment">//è¿”å›çš„å†…å®¹å°±æ˜¯è¦ä½œä¸ºå±æ€§ä¼ é€’ç»™ç»„ä»¶çš„çŠ¶æ€</span></span><br><span class="line">    <span class="attr">supNum</span>: state.<span class="property">vote</span>.<span class="property">supNum</span></span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//å¦‚æœè¦æŠŠæŸä¸ªreduxæ¨¡å—æ‰€æœ‰çŠ¶æ€éƒ½ä½œä¸ºå±æ€§ï¼Œé‚£å°±ç›´æ¥è¿”å›é‚£ä¸ªæ¨¡å—</span></span><br><span class="line">  <span class="keyword">return</span> state.<span class="property">vote</span></span><br><span class="line"></span><br><span class="line">&#125;, mapDispatchProps)(ç»„ä»¶)</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VoteFooter</span> <span class="keyword">from</span> <span class="string">&#x27;./VoteFooter&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VoteMain</span> <span class="keyword">from</span> <span class="string">&#x27;./VoteMain&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Vote</span> = <span class="keyword">function</span> <span class="title function_">Vote</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> &#123; supNum, oppNum &#125; = props <span class="comment">//åœ¨propsä¸­è§£æ„å‡ºçŠ¶æ€</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;vote-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h2</span> <span class="attr">className</span>=<span class="string">&quot;title&quot;</span>&gt;</span>Reactæ˜¯å¾ˆæ£’çš„å‰ç«¯æ¡†æ¶<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;num&#x27;</span>&gt;</span>å‚ä¸äººæ•°: &#123; supNum + oppNum &#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">VoteMain</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">VoteFooter</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">connect</span>(<span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">vote</span>)(<span class="title class_">Vote</span>); <span class="comment">//å°†voteæ¨¡å—çš„çŠ¶æ€éƒ½ä½œä¸ºå±æ€§</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>mapDispatchToPropså¯ä»¥æŠŠéœ€è¦æ´¾å‘çš„ä»»åŠ¡å½“ä½œå±æ€§ä¼ é€’ç»™ç»„ä»¶</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mapDispatchToProps</span></span><br><span class="line"><span class="comment">//æ ‡å‡†ã€å¤è€çš„å†™æ³•</span></span><br><span class="line"><span class="title function_">connect</span>(</span><br><span class="line">  mapStateToProps,</span><br><span class="line">  <span class="function"><span class="params">dispatch</span> =&gt;</span> &#123; <span class="comment">//dispatchå°±æ˜¯store.dispatchï¼Œæ´¾å‘ä»»åŠ¡çš„æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="comment">//è¿”å›çš„ä¿¡æ¯å°†ä½œä¸ºå±æ€§ä¼ é€’ç»™ç»„ä»¶</span></span><br><span class="line">      <span class="title function_">support</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">dispatch</span>(action.<span class="property">vote</span>.<span class="title function_">support</span>())</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">oppose</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">dispatch</span>(action.<span class="property">vote</span>.<span class="title function_">oppose</span>())</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç®€å•çš„å†™æ³•</span></span><br><span class="line"><span class="title function_">connect</span>(</span><br><span class="line">  mapSateToProps,</span><br><span class="line">  action.<span class="property">vote</span> <span class="comment">//ç›´æ¥ä¼ å…¥æˆ‘ä»¬å·¥ç¨‹åŒ–å®šä¹‰å¥½çš„æ¨¡å—å°±è¡Œ</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<img src="/2024/03/11/%E6%B5%85%E5%B0%9DReact/image-14.png" class title="This is an image">

<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> action <span class="keyword">from</span> <span class="string">&quot;../store/actions&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">VoteFooter</span> = <span class="keyword">function</span> <span class="title function_">VoteFooter</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;footer&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> () =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        props.support() //è°ƒç”¨æ´¾å‘çš„æ–¹æ³•</span></span><br><span class="line"><span class="language-xml">      &#125; &#125;&gt;æ”¯æŒ<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> () =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">       props.oppose()</span></span><br><span class="line"><span class="language-xml">      &#125; &#125;&gt;åå¯¹<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">connect</span>(</span><br><span class="line">  <span class="literal">null</span>, </span><br><span class="line">  action.<span class="property">vote</span></span><br><span class="line">)(<span class="title class_">VoteFooter</span>);</span><br></pre></td></tr></table></figure>

<h2 id="reduxä¸­é—´ä»¶"><a href="#reduxä¸­é—´ä»¶" class="headerlink" title="reduxä¸­é—´ä»¶"></a>reduxä¸­é—´ä»¶</h2><p>reduxæä¾›<code>applyMiddleware</code>æ–¹æ³•æ¥åŠ è½½ä¸­é—´ä»¶</p>
<p><strong>redux-loggerä¸­é—´ä»¶</strong></p>
<p>redux-loggerå¯ä»¥è®°å½•reduxå®¹å™¨çš„æ´¾å‘ä»»åŠ¡ï¼Œä»¥åŠæ¯ä¸ªæ´¾å‘å¯¹åº”çš„æ–°æ—§çŠ¶æ€</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// å®‰è£…</span><br><span class="line">npm i redux-logger</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> action <span class="keyword">from</span> <span class="string">&#x27;./actions&#x27;</span></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">&#x27;./reducers&#x27;</span></span><br><span class="line"><span class="keyword">import</span> reduxLogger <span class="keyword">from</span> <span class="string">&#x27;redux-logger&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(</span><br><span class="line">  reducer,</span><br><span class="line">  <span class="title function_">applyMiddleware</span>(reduxLogger) <span class="comment">//ä½¿ç”¨applyMiddlewareæ³¨å†Œä¸­é—´ä»¶</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>

<p>å½“ç»„ä»¶è§¦å‘äº†ä»»åŠ¡æ´¾å‘æ—¶ï¼Œæ§åˆ¶å°å°±ä¼šæ‰“å°æ—¥å¿—ï¼š</p>
<img src="/2024/03/11/%E6%B5%85%E5%B0%9DReact/image-15.png" class title="This is an image">


<p><strong>redux-thunk</strong></p>
<p>åœ¨ä¸ä½¿ç”¨ä»»ä½•ä¸­é—´ä»¶çš„æƒ…å†µä¸‹ï¼ŒmapDispatchToPropsä¸­è¿”å›çš„å¯¹è±¡ä¸æ”¯æŒå¼‚æ­¥æ“ä½œï¼Œå¿…é¡»è¿”å›æ ‡å‡†çš„actionå¯¹è±¡ï¼Œè€Œä¸èƒ½æ˜¯ä¸€ä¸ªpromiseå®ä¾‹</p>
<p>ä½¿ç”¨redux-thunkå¯ä»¥ä½¿å…¶æ”¯æŒå¼‚æ­¥æ“ä½œ</p>
<p>å®‰è£…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i redux-thunk</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> action <span class="keyword">from</span> <span class="string">&#x27;./actions&#x27;</span></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">&#x27;./reducers&#x27;</span></span><br><span class="line"><span class="keyword">import</span> reduxLogger <span class="keyword">from</span> <span class="string">&#x27;redux-logger&#x27;</span></span><br><span class="line"><span class="keyword">import</span> reduxThunk <span class="keyword">from</span> <span class="string">&#x27;redux-thunk&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(</span><br><span class="line">  reducer,</span><br><span class="line">  <span class="title function_">applyMiddleware</span>(reduxLogger, reduxThunk)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br><span class="line"></span><br><span class="line"><span class="comment">// voteAction.js</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="variable constant_">TYPES</span> <span class="keyword">from</span> <span class="string">&#x27;../action-types&#x27;</span></span><br><span class="line"><span class="keyword">const</span> voteAction = &#123;</span><br><span class="line">  <span class="title function_">support</span>(<span class="params"></span>) &#123; <span class="comment">//å®šä¹‰voteæ¨¡å—ä¸­éœ€è¦æ´¾å‘çš„è¡Œä¸ºå¯¹è±¡ï¼Œ å³è°ƒç”¨store.dispatch()æ˜¯ä¼ å…¥çš„å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// redux-thunkè¯­æ³•</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">delay</span>() <span class="comment">//æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ</span></span><br><span class="line">      <span class="title function_">dispatch</span>(&#123; <span class="comment">//åœ¨é‡Œé¢æ‰‹åŠ¨æ´¾å‘actionå¯¹è±¡</span></span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">TYPES</span>.<span class="property">VOTE_SUP</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">oppose</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">TYPES</span>.<span class="property">VOTE_OPP</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> voteAction</span><br></pre></td></tr></table></figure>

<p>å†…éƒ¨æµç¨‹ï¼š</p>
<ol>
<li>é¦–å…ˆsupportæ–¹æ³•æ‰§è¡Œè¿”å›ä¸€ä¸ªå‡½æ•°ï¼ˆä¹Ÿæ˜¯å¯¹è±¡ï¼‰ï¼Œå†…éƒ¨ç»™å‡½æ•°è‡ªåŠ¨<strong>è®¾ç½®ä¸€ä¸ªtypeå±æ€§</strong>ï¼Œä¸è¿‡è¯¥å±æ€§å€¼ä¸ä¼šå’Œreducerä¸­çš„ä»»ä½•typeåŒ¹é…ï¼Œæ‰€ä»¥ä¸ä¼šä¿®æ”¹ä»»ä½•çŠ¶æ€</li>
<li>æ¥ç€æŠŠè¿”å›çš„å‡½æ•°æ‰§è¡Œï¼ŒæŠŠæ´¾å‘å‡½æ•°dispatchä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ƒï¼›åœ¨å‡½æ•°ä¸­å®Œæˆå¼‚æ­¥æ“ä½œï¼Œç„¶åæ‰‹åŠ¨åŸºäºdispatchè¿›è¡Œæ´¾å‘</li>
</ol>
<p>æ‰€ä»¥æ€»å…±æ˜¯æ´¾å‘<strong>ä¸¤æ¬¡</strong>ï¼š</p>
<ul>
<li>ç¬¬ä¸€æ¬¡æ´¾å‘çš„æ˜¯æ‰§è¡Œçš„å‡½æ•°ï¼Œä½†ä¸ä¼šä¿®æ”¹ä»»ä½•çŠ¶æ€</li>
<li>ç¬¬äºŒæ¬¡æ´¾å‘çš„æ‰ä¼šä¿®æ”¹çŠ¶æ€</li>
</ul>
<p><strong>redux-promise</strong></p>
<p>redux-promiseä¹Ÿå¯ä»¥ç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œï¼Œä½¿ç”¨èµ·æ¥<strong>æ›´ç®€æ´</strong></p>
<p>å®‰è£…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i redux-promise</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> action <span class="keyword">from</span> <span class="string">&#x27;./actions&#x27;</span></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">&#x27;./reducers&#x27;</span></span><br><span class="line"><span class="keyword">import</span> reduxLogger <span class="keyword">from</span> <span class="string">&#x27;redux-logger&#x27;</span></span><br><span class="line"><span class="keyword">import</span> reduxPromise <span class="keyword">from</span> <span class="string">&#x27;redux-promise&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(</span><br><span class="line">  reducer,</span><br><span class="line">  <span class="title function_">applyMiddleware</span>(reduxLogger, reduxPromise)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br><span class="line"></span><br><span class="line"><span class="comment">// voteAction.js</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="variable constant_">TYPES</span> <span class="keyword">from</span> <span class="string">&#x27;../action-types&#x27;</span></span><br><span class="line"><span class="keyword">const</span> voteAction = &#123;</span><br><span class="line">  <span class="title function_">support</span>(<span class="params"></span>) &#123; <span class="comment">//å®šä¹‰voteæ¨¡å—ä¸­éœ€è¦æ´¾å‘çš„è¡Œä¸ºå¯¹è±¡ï¼Œ å³è°ƒç”¨store.dispatch()æ˜¯ä¼ å…¥çš„å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// redux-promiseè¯­æ³•ï¼Œå’Œæ­£å¸¸ç”¨å¼‚æ­¥æ“ä½œä¸€æ ·</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">support</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">delay</span>()</span><br><span class="line">      <span class="keyword">return</span> &#123; </span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">TYPES</span>.<span class="property">VOTE_SUP</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">oppose</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">TYPES</span>.<span class="property">VOTE_OPP</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> voteAction</span><br></pre></td></tr></table></figure>

<h2 id="React-router"><a href="#React-router" class="headerlink" title="React-router"></a>React-router</h2><h3 id="ç‰ˆæœ¬5"><a href="#ç‰ˆæœ¬5" class="headerlink" title="ç‰ˆæœ¬5"></a>ç‰ˆæœ¬5</h3><p>å®‰è£…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i react-router-dom@5</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ï¼š</p>
<ol>
<li>å¯¼å…¥<code>react-router-dom</code>åŒ…</li>
<li>åœ¨src&#x2F;index.jsä¸­å¼•å…¥<code>BrowserRouter</code>ç»„ä»¶ï¼Œå¹¶å°†å®ƒåŒ…è£¹åœ¨æ ¹ç»„ä»¶å¤–é¢ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨<code>HashRouter</code>ç»„ä»¶ï¼Œä¸¤è€…åœ¨å¼€å‘ç¯å¢ƒä¸‹å¹¶æ²¡æœ‰å¤ªå¤§åŒºåˆ«ï¼‰</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>));</span><br><span class="line">root.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">BrowserRouter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">BrowserRouter</span>&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨Routeç»„ä»¶æ¥æ˜ å°„åœ°å€å’Œç»„ä»¶ï¼Œå®ƒæœ‰å¦‚ä¸‹å±æ€§ï¼š</p>
<ol>
<li><code>path</code> æ˜ å°„çš„urlåœ°å€</li>
<li><code>component</code> è¦æŒ‚è½½çš„ç»„ä»¶</li>
<li><code>render</code> å’Œcomponentä¸€æ ·ç”¨äºæŒ‚è½½ç»„ä»¶ï¼Œrenderè¦æ±‚ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°çš„è¿”å›å€¼ä¼šè¢«æŒ‚è½½<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Route</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Comp1</span> <span class="keyword">from</span> <span class="string">&#x27;./components/comp1&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Comp2</span> <span class="keyword">from</span> <span class="string">&#x27;./components/comp2&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>æˆ‘æ˜¯æ ‡é¢˜<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;Comp1&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/comp2&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;Comp2&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure></li>
</ol>
<img src="/2024/03/11/%E6%B5%85%E5%B0%9DReact/image-16.png" class title="This is an image">

<p>åˆä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è®¿é—®çš„æ˜¯<code>/comp2</code>çš„è·¯ç”±ï¼Œä½†æ˜¯comp1ä¹Ÿè¢«æ¸²æŸ“å‡ºæ¥äº†ï¼Œè¿™æ˜¯å› ä¸ºRouteé»˜è®¤å¹¶<strong>ä¸æ˜¯ä¸¥æ ¼åŒ¹é…</strong>ï¼Œåªæœ‰urlåœ°å€çš„å¤´éƒ¨å’Œpathä¸€è‡´ï¼Œç»„ä»¶å°±ä¼šæŒ‚è½½</p>
<p>æƒ³è¦ä¸¥æ ¼åŒ¹é…ï¼Œéœ€è¦åœ¨Routeç»„ä»¶ä¸Šå¢åŠ <code>exact</code>å±æ€§ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Route</span> exact path=<span class="string">&#x27;/comp2&#x27;</span> component=&#123;<span class="title class_">Comp2</span>&#125;/&gt;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡<code>component</code>æ„å»ºçš„ç»„ä»¶ï¼Œä¼šè‡ªåŠ¨ä¼ é€’å‚æ•°ï¼Œå¯ä»¥åœ¨ç»„ä»¶ä¸­é€šè¿‡propså±æ€§æ¥æ”¶åˆ°ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Comp2</span> = <span class="keyword">function</span> <span class="title function_">Comp2</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(props); <span class="comment">//æ‰“å°ä¼ é€’çš„å‚æ•°</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;comp1&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>æˆ‘æ˜¯comp-2<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Comp2</span></span><br></pre></td></tr></table></figure>
<img src="/2024/03/11/%E6%B5%85%E5%B0%9DReact/image-19.png" class title="This is an image">

<p>å…¶ä¸­ï¼š</p>
<ol>
<li><code>match</code>è¡¨ç¤ºåŒ¹é…çš„ä¿¡æ¯</li>
<li><code>location</code>è¡¨ç¤ºåœ°å€çš„ä¿¡æ¯</li>
<li><code>history</code>è¡¨ç¤ºå†å²ä¿¡æ¯ï¼Œä¸€èˆ¬ç”¨äºæ§åˆ¶è·¯ç”±è·³è½¬</li>
</ol>
<p>é€šè¿‡<code>render</code>æŒ‚è½½çš„ç»„ä»¶è·å–ä¸åˆ°ä¸Šè¿°å±æ€§ï¼Œéœ€è¦æ‰‹åŠ¨ä¼ å…¥</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Route</span> exact path=<span class="string">&#x27;/comp2&#x27;</span> render=&#123;<span class="function">(<span class="params">routeProps</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(routeProps) <span class="comment">//è·å–åˆ°çš„routePropså°±æ˜¯ä¸Šè¿°çš„å±æ€§</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Comp2</span> <span class="attr">route</span>=<span class="string">&#123;routeProps&#125;</span> /&gt;</span></span> <span class="comment">//é€šè¿‡propsä¼ å…¥</span></span><br><span class="line">&#125;&#125;/&gt;</span><br></pre></td></tr></table></figure>

<p><strong>Link å’Œ NavLink</strong></p>
<p>å¯ä»¥ä½¿ç”¨<code>Link</code>ç»„ä»¶æ¥åˆ›å»ºå¸¸è§„é“¾æ¥ï¼Œå®ƒçš„<code>to</code>å±æ€§è¡¨ç¤ºæ˜ å°„çš„urlåœ°å€</p>
<p><code>NavLink</code>ç»„ä»¶å’Œ<code>Link</code>ç»„ä»¶çš„ä½¿ç”¨æ–¹æ³•ç±»ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯å¯ä»¥ä¸º<code>NavLink</code>è®¾ç½®æ¿€æ´»çš„æ ·å¼çŠ¶æ€ï¼Œé€šè¿‡è®¾ç½®<code>activeClassName</code>å±æ€§æˆ–è€…<code>activeStyle</code>å±æ€§å®ç°</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Route</span>, <span class="title class_">Link</span>, <span class="title class_">NavLink</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Comp1</span> <span class="keyword">from</span> <span class="string">&#x27;./components/comp1&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Comp2</span> <span class="keyword">from</span> <span class="string">&#x27;./components/comp2&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>æˆ‘æ˜¯æ ‡é¢˜<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Link</span> <span class="attr">exact</span> <span class="attr">to</span>=<span class="string">&#x27;/comp1&#x27;</span>&gt;</span>comp1<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">NavLink</span> <span class="attr">exact</span> <span class="attr">to</span>=<span class="string">&#x27;/comp2&#x27;</span> <span class="attr">activeClassName</span>=<span class="string">&#123;active&#125;</span>&gt;</span>comp2<span class="tag">&lt;/<span class="name">NavLink</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/comp1&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;Comp1&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/comp2&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;Comp2&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="/2024/03/11/%E6%B5%85%E5%B0%9DReact/image-17.png" class title="This is an image">
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/React/">React</a>
    </span>
    

    </div>

    
  </div>
</article>




<nav class="pagination">
  
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2024 chen qiyi
    
  </p>
</footer>
    
    
  </div>
</div>
<script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>